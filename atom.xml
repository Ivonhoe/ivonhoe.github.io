<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ç—…å·²çš„åšå®¢</title>
  <subtitle>æ•ä¸Šï¼Œé©¬ä¸Šï¼Œå•ä¸Š</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://ivonhoe.github.io/"/>
  <updated>2018-05-27T08:42:15.000Z</updated>
  <id>https://ivonhoe.github.io/</id>
  
  <author>
    <name>ç—…å·²</name>
    <email>yangfan3687@163.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>HTTPS</title>
    <link href="https://ivonhoe.github.io/2018/05/21/https/"/>
    <id>https://ivonhoe.github.io/2018/05/21/https/</id>
    <published>2018-05-21T13:55:38.000Z</published>
    <updated>2018-05-27T08:42:15.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="0x00_å‰è¨€">0x00 å‰è¨€</h3><p>httpsä¸ºä»€ä¹ˆå®‰å…¨ï¼Ÿå› ä¸ºç›¸å¯¹httpçš„æ˜æ–‡ä¼ è¾“ï¼Œhttpså¼•å…¥äº†æ•°æ®åŠ å¯†å’Œèº«ä»½è®¤è¯ã€‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„æ¶ˆæ¯åªæœ‰æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯èƒ½å¤Ÿè¯»æ‡‚ï¼Œä¿è¯äº†æ•°æ®çš„ä¿å¯†æ€§ã€‚åŒæ—¶åœ¨äº¤æ¢æ•°æ®ä¹‹å‰ï¼ŒéªŒè¯äº†å¯¹æ–¹çš„åˆæ³•èº«ä»½ï¼Œä¿è¯äº†é€šä¿¡åŒæ–¹çš„å®‰å…¨ã€‚è¿™ç¯‡æ€»ç»“ä¸»è¦è®°å½•äº†åœ¨ç†è§£httpså®‰å…¨æ€§çš„è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚</p>
<h3 id="0x01_ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†">0x01 ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†</h3><p>åœ¨httpsçš„åè®®ä¸­å¦‚ä½•å®ç°æ•°æ®åŠ å¯†å’Œèº«ä»½è®¤è¯å‘¢ï¼Ÿç®€å•æ¥è¯´æ˜¯å®¢æˆ·ç«¯å…ˆè·å–éå¯¹ç§°åŠ å¯†çš„å…¬é’¥ï¼Œé€šè¿‡å…¬é’¥å’ŒæœåŠ¡å™¨åå•†ç”Ÿæˆå¯¹ç§°åŠ å¯†çš„å¯¹ç§°å¯†é’¥ï¼Œå¹¶ä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†ä¼ è¾“æ•°æ®ã€‚</p>
<a id="more"></a>
<p><img src="/res/https/https-1.png" alt=""></p>
<h4 id="1-1_å¯¹ç§°åŠ å¯†">1.1 å¯¹ç§°åŠ å¯†</h4><p><strong>ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†ï¼š</strong>åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒå¯†é’¥çš„ç®—æ³•ã€‚å®ƒè¦æ±‚å‘é€æ–¹å’Œæ¥æ”¶æ–¹åœ¨å®‰å…¨é€šä¿¡ä¹‹å‰ï¼Œå•†å®šä¸€ä¸ªå¯¹ç§°å¯†é’¥ã€‚å¯¹ç§°ç®—æ³•çš„å®‰å…¨æ€§å®Œå…¨ä¾èµ–äºå¯†é’¥ï¼Œå¯†é’¥æ³„æ¼å°±æ„å‘³ç€ä»»ä½•äººéƒ½å¯ä»¥å¯¹ä»–ä»¬å‘é€æˆ–æ¥æ”¶çš„æ¶ˆæ¯è§£å¯†ï¼Œæ‰€ä»¥å¯†é’¥çš„ä¿å¯†æ€§å¯¹é€šä¿¡è‡³å…³é‡è¦ã€‚</p>
<p><strong>ç‰¹ç‚¹ï¼š</strong>è®¡ç®—é‡å°ã€åŠ å¯†é€Ÿåº¦å¿«ã€åŠ å¯†æ•ˆç‡é«˜ã€‚äº¤æ˜“åŒæ–¹éƒ½ä½¿ç”¨åŒæ ·å¯†é’¥ï¼Œå®‰å…¨æ€§å¾—ä¸åˆ°ä¿è¯ã€‚æ¯æ¬¡ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•æ—¶ï¼Œéƒ½éœ€è¦ä½¿ç”¨å…¶ä»–äººä¸çŸ¥é“çš„æƒŸä¸€å¯†é’¥ï¼Œè¿™ä¼šä½¿å¾—å‘æ”¶ä¿¡æ¯åŒæ–¹æ‰€æ‹¥æœ‰çš„é’¥åŒ™æ•°é‡å‘ˆå‡ ä½•çº§æ•°å¢é•¿ï¼Œå¯†é’¥ç®¡ç†æˆä¸ºè´Ÿæ‹…ã€‚</p>
<p><strong>ä»£è¡¨ç®—æ³•ï¼š</strong> DESã€AES</p>
<h4 id="1-2_éå¯¹ç§°åŠ å¯†">1.2 éå¯¹ç§°åŠ å¯†</h4><p><strong>ä»€ä¹ˆæ˜¯éå¯¹ç§°åŠ å¯†ï¼š</strong> éœ€è¦ä¸¤ä¸ªå¯†é’¥æ¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚åˆ†åˆ«æ˜¯å…¬å¼€å¯†é’¥å’Œç§æœ‰å¯†é’¥ã€‚å¦‚æœç”¨å…¬å¼€å¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œåªæœ‰ç”¨å¯¹åº”çš„ç§æœ‰å¯†é’¥æ‰èƒ½è§£å¯†ï¼›å¦‚æœç”¨ç§æœ‰å¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œé‚£ä¹ˆåªæœ‰ç”¨å¯¹åº”çš„å…¬å¼€å¯†é’¥æ‰èƒ½è§£å¯†ã€‚å› ä¸ºåŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯†é’¥ï¼Œæ‰€ä»¥è¿™ç§ç®—æ³•å«ä½œéå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚ </p>
<p><strong>ç‰¹ç‚¹ï¼š</strong> CPUè®¡ç®—èµ„æºæ¶ˆè€—éå¸¸å¤§ï¼Œæ•ˆç‡è¾ƒä½ã€‚éå¯¹ç§°åŠ å¯†ç®—æ³•å¯¹åŠ å¯†å†…å®¹çš„é•¿åº¦æœ‰é™åˆ¶ï¼Œä¸èƒ½è¶…è¿‡å…¬é’¥é•¿åº¦ã€‚æ¯”å¦‚ç°åœ¨å¸¸ç”¨çš„å…¬é’¥é•¿åº¦æ˜¯2048ä½ï¼Œæ„å‘³ç€å¾…åŠ å¯†å†…å®¹ä¸èƒ½è¶…è¿‡256ä¸ªå­—èŠ‚ã€‚</p>
<p><strong>ä»£è¡¨ç®—æ³•ï¼š</strong> RSA</p>
<h3 id="0x02_ä¸­é—´äººåŠ«æŒ">0x02 ä¸­é—´äººåŠ«æŒ</h3><p>å¦‚æœåœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚è¢«ä¸­é—´äººåŠ«æŒï¼Œé‚£ä¹ˆä¸­é—´äººå¯ä»¥å°±å¯ä¼ªè£…æˆâ€œå†’ç‰Œå®¢æˆ·ç«¯â€å’ŒæœåŠ¡å™¨é€šä¿¡ï¼ŒåŒæ—¶ä¼ªè£…æˆâ€œå†’ç‰ŒæœåŠ¡å™¨â€ä¸å®¢æˆ·ç«¯é€šä¿¡ã€‚ä»è€Œè¾¾åˆ°è·å–å®¢æˆ·ç«¯æœåŠ¡ç«¯é€šä¿¡å†…å®¹çš„ç›®çš„ï¼ä¸»è¦è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä¸­é—´äººåœ¨æœåŠ¡å™¨å‘é€å…¬é’¥ä¹‹å‰åŠ«æŒå®¢æˆ·ç«¯è¯·æ±‚ï¼Œä¼ªé€ å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·SSLæ¡æ‰‹</li>
<li>ä¸­é—´äººè·å–æœåŠ¡ç«¯åŠ å¯†å…¬é’¥ï¼Œä¼ªé€ å‡ºä¸€ä¸ªè‡ªå·±çš„å…¬é’¥å‘é€ç»™å®¢æˆ·ç«¯</li>
<li>å®¢æˆ·ç«¯æ¥å—åˆ°ä¼ªé€ çš„å…¬é’¥ï¼Œä½¿ç”¨ä¼ªé€ çš„å…¬é’¥å‘é€å¯¹ç§°å¯†é’¥</li>
<li>ä¸­é—´äººåŠ«æŒåˆ°å¯¹ç§°å¯†é’¥ï¼Œå¹¶åˆ©ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å‡ºå¯¹ç§°å¯†é’¥</li>
<li>åˆ©ç”¨æ­¥éª¤2ä¸­çš„æ­£ç¡®æœåŠ¡å™¨åŠ å¯†å…¬é’¥ï¼ŒåŠ å¯†å®¢æˆ·ç«¯å¯¹ç§°å¯†é’¥å‘é€ç»™æœåŠ¡</li>
<li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨è¢«ä¸­é—´äººç ´è§£çš„å¯¹ç§°å¯†é’¥ä¼ è¾“æ•°æ®ï¼Œä¸­é—´äººå¯ä»¥è·å–æ‰€æœ‰ä¼ è¾“ä¿¡æ¯</li>
</ol>
<p><img src="/res/https/https-2.jpeg" alt=""></p>
<h4 id="2-1_æ•°å­—ç­¾å">2.1 æ•°å­—ç­¾å</h4><p>æ•°å­—ç­¾åè¿‡ç¨‹ï¼š</p>
<ol>
<li>æœåŠ¡ç«¯æŠŠä¸€ä¸ªæŠ¥æ–‡ç»è¿‡HASHå¤„ç†ç”Ÿæˆæ¶ˆæ¯æ‘˜è¦ä¿¡æ¯Digestï¼Œä½¿ç”¨ç§é’¥åŠ å¯†æ‘˜è¦ä¿¡æ¯ç”Ÿæˆç­¾åä¿¡æ¯ã€‚</li>
<li>å°†æŠ¥æ–‡ã€ç­¾åå‘ç”Ÿç»™å®¢æˆ·ç«¯</li>
<li>å®¢æˆ·ç«¯ä½¿ç”¨ç›¸åŒçš„HASHç®—æ³•å¯¹æŠ¥æ–‡åšç›¸åŒçš„HASHå¤„ç†ï¼Œè·å–æ‘˜è¦Digest1</li>
<li>å®¢æˆ·ç«¯ä½¿ç”¨å…¬é’¥è§£å¯†ç­¾åç”Ÿæˆæ‘˜è¦Digest2ï¼Œå¹¶ä¸”å¯¹æ¯”Digest1å’ŒDigest2æ˜¯å¦ä¸€è‡´</li>
<li>å¦‚æœDigest1å’ŒDigest2ä¸€è‡´è¯´æ˜æŠ¥æ–‡æ²¡æœ‰è¢«ç¯¡æ”¹è¿‡ï¼Œè¿™ä»½æŠ¥æ–‡å’Œç­¾åæ˜¯å¯¹åº”çš„ï¼Œå…·æœ‰ä¸å¯æŠµèµ–æ€§ã€‚</li>
</ol>
<h4 id="2-2_æ•°å­—è¯ä¹¦">2.2 æ•°å­—è¯ä¹¦</h4><p>è§£å†³ä¸­é—´äººåŠ«æŒé—®é¢˜çš„å…³é”®åœ¨äºï¼Œå®¢æˆ·ç«¯å¦‚ä½•èƒ½å¤Ÿåˆ†è¾¨å‡ºæ¥æ”¶åˆ°çš„å…¬é’¥ç¡®å®æ˜¯æœåŠ¡ç«¯çš„å‘¢ï¼Ÿè¿™æ—¶å€™å°±éœ€è¦æ•°å­—è¯ä¹¦äº†ã€‚</p>
<p>æ•°å­—è¯ä¹¦æ˜¯å…¬å¸å‘ä¸€ä¸ªè¯ä¹¦å‘å¸ƒæœºæ„â€SecureTrust CAâ€ç”³è¯·çš„ã€‚è¿™ä¸ªè¯ä¹¦å‘å¸ƒæœºæ„â€SecureTrust CAâ€æ˜¯ä¸€ä¸ªå¤§å®¶å…¬è®¤å¹¶è¢«ä¸€äº›æƒå¨æœºæ„æ¥å—çš„è¯ä¹¦å‘å¸ƒæœºæ„ï¼Œ<strong>å¹¶ä¸”æˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿé‡Œé¢å·²ç»å®‰è£…äº†â€SecureTrust CAâ€çš„è¯ä¹¦</strong>ã€‚â€SecureTrust CAâ€åœ¨ç»™æˆ‘ä»¬å‘å¸ƒè¯ä¹¦æ—¶ï¼ŒæŠŠIssuer,Public key,Subject,Valid from,Valid toç­‰ä¿¡æ¯ä»¥æ˜æ–‡çš„å½¢å¼å†™åˆ°è¯ä¹¦é‡Œé¢ï¼Œç„¶åç”¨ä¸€ä¸ªæ‘˜è¦ç®—æ³•è®¡ç®—å‡ºè¿™äº›æ•°å­—è¯ä¹¦å†…å®¹çš„ä¸€ä¸ªDigestï¼Œå¹¶ä½¿ç”¨CAè‡ªå·±çš„ç§é’¥å¯¹Digestè¿›è¡ŒåŠ å¯†ï¼Œç”Ÿæˆè¯ä¹¦çš„æ•°å­—ç­¾åã€‚</p>
<p>éªŒè¯å…¬é’¥è¿‡ç¨‹ï¼š</p>
<ol>
<li>æœåŠ¡ç«¯å°†è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ï¼Œ<strong>è¿™é‡Œä¸æ˜¯å…¬é’¥</strong></li>
<li>å®¢æˆ·ç«¯æå–è¯ä¹¦ä¸­çš„å‘å¸ƒæœºæ„(Issuer)ä¸ºâ€SecureTrust CAâ€ï¼Œåœ¨æ“ä½œç³»ç»Ÿä¸­å—ä¿¡ä»»çš„å‘å¸ƒæœºæ„çš„è¯ä¹¦ä¸­å»æ‰¾â€SecureTrust CAâ€çš„è¯ä¹¦ï¼Œå¦‚æœæŸ¥ä¸åˆ°è¯´æ˜è¯ä¹¦æœ‰é—®é¢˜ã€‚</li>
<li>å¦‚æœæ‰¾åˆ°äº†â€SecureTrust CAâ€çš„è¯ä¹¦ï¼Œå®¢æˆ·ç«¯ä»ç³»ç»Ÿçš„è¯ä¹¦ä¸­æå–â€SecureTrust CAâ€çš„å…¬é’¥ï¼Œ</li>
<li>ä½¿ç”¨CAå…¬é’¥å¯¹æ­¥éª¤1ä¸­è·å–åˆ°è¯ä¹¦ä¸­çš„ç­¾åä¿¡æ¯çš„è¿›è¡Œè§£å¯†è·å–è§£å¯†æ‘˜è¦ï¼Œå¹¶ä½¿ç”¨æ‘˜è¦ç®—æ³•è®¡ç®—è¯ä¹¦çš„æ‘˜è¦</li>
<li>å¯¹æ¯”è§£å¯†æ‘˜è¦å’Œè®¡ç®—å‡ºçš„æ‘˜è¦ä¿¡æ¯æ˜¯å¦ä¸€è‡´ã€‚å¦‚æœä¸€è‡´è¯´æ˜è®¤è¯æˆåŠŸï¼Œå½“å‰è¯ä¹¦ä¸­åŒ…å«çš„å…¬é’¥ä¿¡æ¯æ˜¯å¯ä»¥ä¿¡è®¤çš„ã€‚</li>
</ol>
<p><img src="/res/https/https-3.jpeg" alt=""></p>
<p>æ•°å­—è¯ä¹¦ä¸­åŒ…å«å…¬é’¥å’Œè¯ä¹¦æ‰€æœ‰è€…ä¿¡æ¯ï¼Œå¹¶ä¸”ä¿è¯æ•°å­—è¯ä¹¦é‡Œçš„å…¬é’¥ç¡®å®æ˜¯è¿™ä¸ªè¯ä¹¦çš„æ‰€æœ‰è€…çš„ï¼Œæˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªæ•°å­—è¯ä¹¦ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­å‡ºè¿™ä¸ªæ•°å­—è¯ä¹¦åˆ°åº•æ˜¯è°çš„ã€‚</p>
<h3 id="0x03_æ€»ç»“">0x03 æ€»ç»“</h3><p><strong>æ•°å­—ç­¾åï¼š</strong>ä¸ºäº†è¯´æ˜è°ç¼–å†™çš„æŠ¥æ–‡ï¼ŒåŒæ—¶è¯æ˜æŠ¥æ–‡æœªè¢«ç¯¡æ”¹è¿‡ã€‚</p>
<p><strong>æ•°å­—è¯ä¹¦ï¼š</strong>ç”±æƒå¨çš„è®¤è¯æœºæ„è¯æ˜å…¬é’¥çš„æ­£ç¡®æ€§ã€‚</p>
<h3 id="0x04_å‚è€ƒæ–‡æ¡£">0x04 å‚è€ƒæ–‡æ¡£</h3><p><a href="http://wetest.qq.com/lab/view/110.html" target="_blank" rel="external">HTTPSä¸ºä»€ä¹ˆå®‰å…¨ &amp;åˆ†æ HTTPS è¿æ¥å»ºç«‹å…¨è¿‡ç¨‹</a></p>
<p><a href="https://www.cnblogs.com/franson-2016/p/5530671.html" target="_blank" rel="external">ä¸€ä¸ªæ•…äº‹æ•™ä½ çœ‹æ‡‚ä»€ä¹ˆæ˜¯æ•°å­—è¯ä¹¦ï¼Œå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆ?å®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;0x00_å‰è¨€&quot;&gt;0x00 å‰è¨€&lt;/h3&gt;&lt;p&gt;httpsä¸ºä»€ä¹ˆå®‰å…¨ï¼Ÿå› ä¸ºç›¸å¯¹httpçš„æ˜æ–‡ä¼ è¾“ï¼Œhttpså¼•å…¥äº†æ•°æ®åŠ å¯†å’Œèº«ä»½è®¤è¯ã€‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„æ¶ˆæ¯åªæœ‰æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯èƒ½å¤Ÿè¯»æ‡‚ï¼Œä¿è¯äº†æ•°æ®çš„ä¿å¯†æ€§ã€‚åŒæ—¶åœ¨äº¤æ¢æ•°æ®ä¹‹å‰ï¼ŒéªŒè¯äº†å¯¹æ–¹çš„åˆæ³•èº«ä»½ï¼Œä¿è¯äº†é€šä¿¡åŒæ–¹çš„å®‰å…¨ã€‚è¿™ç¯‡æ€»ç»“ä¸»è¦è®°å½•äº†åœ¨ç†è§£httpså®‰å…¨æ€§çš„è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&quot;0x01_ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†&quot;&gt;0x01 ä»€ä¹ˆæ˜¯å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†&lt;/h3&gt;&lt;p&gt;åœ¨httpsçš„åè®®ä¸­å¦‚ä½•å®ç°æ•°æ®åŠ å¯†å’Œèº«ä»½è®¤è¯å‘¢ï¼Ÿç®€å•æ¥è¯´æ˜¯å®¢æˆ·ç«¯å…ˆè·å–éå¯¹ç§°åŠ å¯†çš„å…¬é’¥ï¼Œé€šè¿‡å…¬é’¥å’ŒæœåŠ¡å™¨åå•†ç”Ÿæˆå¯¹ç§°åŠ å¯†çš„å¯¹ç§°å¯†é’¥ï¼Œå¹¶ä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†ä¼ è¾“æ•°æ®ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ç½‘ç»œ" scheme="https://ivonhoe.github.io/categories/%E7%BD%91%E7%BB%9C/"/>
    
    
      <category term="https" scheme="https://ivonhoe.github.io/tags/https/"/>
    
      <category term="å¯¹ç§°åŠ å¯†" scheme="https://ivonhoe.github.io/tags/%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/"/>
    
      <category term="æ•°å­—ç­¾åï¼Œæ•°å­—è¯ä¹¦" scheme="https://ivonhoe.github.io/tags/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%EF%BC%8C%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6/"/>
    
      <category term="éå¯¹ç§°åŠ å¯†" scheme="https://ivonhoe.github.io/tags/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>Androidæ’ä»¶åŒ–ä¹‹èµ„æºåŠ è½½</title>
    <link href="https://ivonhoe.github.io/2018/03/14/small-bug-555-fix/"/>
    <id>https://ivonhoe.github.io/2018/03/14/small-bug-555-fix/</id>
    <published>2018-03-14T09:23:27.000Z</published>
    <updated>2018-05-27T08:45:19.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00_å‰è¨€">0x00 å‰è¨€</h4><p>è¿™ç¯‡æ–‡ç« ä¸»è¦è®°å½•äº†åœ¨ä½¿ç”¨Smallæ’ä»¶åŒ–æ¡†æ¶ä¸­é‡åˆ°çš„èµ„æºåŠ è½½é—®é¢˜åŠç›¸åº”è§£å†³æ–¹æ¡ˆï¼Œå¹¶æ¢³ç†å‡ºAndroidçš„èµ„æºåŠ è½½æµç¨‹å’Œæ’ä»¶åŒ–æ¡†æ¶çš„èµ„æºåŠ è½½åŸç†ã€‚åœ¨å‰ä¸¤ç¯‡æ’ä»¶åŒ–æŠ€æœ¯ä»‹ç»çš„åŸºç¡€ä¸Šä¼šå…³æ³¨æ›´å¤šæŠ€æœ¯ç»†èŠ‚ï¼Œå¸Œæœ›èƒ½æœ‰æ‰€æ”¶è·ï¼</p>
<h4 id="0x01_Smallæ¡†æ¶çš„èµ„æºåŠ è½½å¼‚å¸¸">0x01 Smallæ¡†æ¶çš„èµ„æºåŠ è½½å¼‚å¸¸</h4><p>æœ€è¿‘æ”¶åˆ°ä¸€ä¸ªå®¢æˆ·åé¦ˆï¼Œåœ¨ä»–ä»¬çš„ä¸­å…´V0840æ‰‹æœºä¸Šæ‰“å¼€æˆ‘ä»¬çš„appä¼šæŒç»­å´©æºƒã€‚ç¬¬ä¸€æ—¶é—´åœ¨ç™¾åº¦ç§»åŠ¨è´¨é‡å¹³å°ä¸ŠçŸ­æ—¶ç§Ÿç”¨äº†è¯¥æœºå‹ï¼ŒæŠ“å–äº†logã€‚å‘ç°æ˜¯èµ„æºæŸ¥æ‰¾å¤±è´¥å¼‚å¸¸ã€‚å¹¶åœ¨Small github issuesä¸­æœç´¢<code>android.content.res.Resources$NotFoundException</code> å¯ä»¥å‘ç°å¾ˆå¤šç±»ä¼¼çš„é—®é¢˜ï¼Œè¯¦ç»†æ—¥å¿—å¯æŸ¥çœ‹ä¸‹å›¾ã€‚</p>
<a id="more"></a>
<p>Github issusé“¾æ¥ï¼š<a href="https://github.com/wequick/Small/issues/555" target="_blank" rel="external">#555 Small Sampleé¡¹ç›®æ‰“åŒ…ååœ¨ZTEä¸Šé—ªé€€</a></p>
<p><strong>é¡¹ç›®å´©æºƒæ—¥å¿—ï¼š</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">03-06 17:48:31.685 E/AndroidRuntime( 8189): FATAL EXCEPTION: main&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): Process: com.shandiangou.kaguanjia, PID: 8189&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): java.lang.RuntimeException: Unable to start activity ComponentInfo&#123;com.shandiangou.kaguanjia/com.shandiangou.kaguanjia.app.main.activity.GuideActivity&#125;: android.content.res.Resources$NotFoundException: Resource ID #0x2a030010&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2669)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2730)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at android.app.ActivityThread.-wrap12(ActivityThread.java)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1481)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at android.os.Handler.dispatchMessage(Handler.java:102)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at android.os.Looper.loop(Looper.java:154)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at android.app.ActivityThread.main(ActivityThread.java:6144)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at java.lang.reflect.Method.invoke(Native Method)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:886)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:776)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): Caused by: android.content.res.Resources$NotFoundException: Resource ID #0x2a030010&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at android.content.res.ResourcesImpl.getValue(ResourcesImpl.java:196)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at android.content.res.Resources.loadXmlResourceParser(Resources.java:2101)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at android.content.res.Resources.getLayout(Resources.java:1115)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at android.view.LayoutInflater.inflate(LayoutInflater.java:424)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at android.view.LayoutInflater.inflate(LayoutInflater.java:377)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at com.shandiangou.kaguanjia.common.base.CustomProgressDialog.init(CustomProgressDialog.java:38)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at com.shandiangou.kaguanjia.common.base.CustomProgressDialog.&#60;init&#62;(CustomProgressDialog.java:26)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at com.shandiangou.kaguanjia.common.base.BaseActivity.initProgressDialog(BaseActivity.java:27)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at com.shandiangou.kaguanjia.common.base.BaseActivity.onCreate(BaseActivity.java:22)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at com.shandiangou.kaguanjia.app.main.activity.GuideActivity.onCreate(GuideActivity.java:45)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at android.app.Activity.performCreate(Activity.java:6722)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1119)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at net.wequick.small.ApkBundleLauncher$InstrumentationWrapper.callActivityOnCreate(ApkBundleLauncher.java:334)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2622)&#10;03-06 17:48:31.685 E/AndroidRuntime( 8189): &#9;... 9 more&#10;03-06 17:48:31.688 W/ActivityManager( 1384):   Force finishing activity com.shandiangou.kaguanjia/net.wequick.small.A</span><br></pre></td></tr></table></figure>
<p><strong>Smallæ¡†æ¶å®˜æ–¹Sampleå´©æºƒæ—¥å¿—</strong></p>
<p><img src="/res/small/small-error.png" alt=""></p>
<h4 id="0x02_Androidèµ„æºåŠ è½½æµç¨‹">0x02 Androidèµ„æºåŠ è½½æµç¨‹</h4><p><strong>Androidæºç Resourcesåˆ›å»ºæµç¨‹å›¾ï¼š</strong></p>
<p><img src="/res/small/android-resources1.png" alt=""></p>
<p>ActivityThreadåœ¨æ¥æ”¶åˆ°LAUNCH_ACTIVITYæ¶ˆæ¯ä»¥åï¼Œåœ¨ <code>performLaunchActivity</code>æ–¹æ³•ä¸­ï¼Œä½¿ç”¨Instrumentationé€šè¿‡åå°„çš„æ–¹å¼åˆ›å»ºActivityå®ä¾‹ï¼Œå†åˆ›å»ºActivityçš„Base Context, å¹¶åœ¨åˆ›å»ºContextè¿‡ç¨‹ä¸­å®ä¾‹åŒ–AssetMangerå’ŒResourcesã€‚<br>ActivityThreadåœ¨LAUNCH_ACTIVITYæ¶ˆæ¯ä¸­ï¼Œå®Œæˆäº†Activityç”Ÿå‘½å‘¨æœŸä¸­çš„ä¸‰ä¸ªå›è°ƒï¼Œåˆ†åˆ«æ˜¯<code>onCreate</code> <code>onStart</code> <code>onRestoreInstanceState</code>ã€‚</p>
<p>Androidä¸­èµ„æºç®¡ç†ç±»åœ¨ä¸åŒsdkç‰ˆæœ¬ä¸­çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="/res/small/android-resources2.png" alt="Androidæºç èµ„æºç±»å›¾"></p>
<h4 id="0x03_Smallæ¡†æ¶æ’ä»¶èµ„æºåŠ è½½æ–¹æ¡ˆ">0x03 Smallæ¡†æ¶æ’ä»¶èµ„æºåŠ è½½æ–¹æ¡ˆ</h4><p>Smallæ¡†æ¶çš„èµ„æºåŠ è½½æµç¨‹åœ¨ApkBundleLauncherä¸­å®Œæˆï¼Œ<code>setup</code>æµç¨‹è·å–åˆ°æ‰€æœ‰æ’ä»¶soçš„ä¿¡æ¯ï¼Œåœ¨<code>postSetUp</code>ä¸­è·å–æ‰€æœ‰æ’ä»¶åŒ…çš„èµ„æºè·¯å¾„ï¼Œé€šè¿‡åå°„è°ƒç”¨AssetManagerçš„<code>addAssetPaths</code>æ–¹æ³•ï¼Œæ„é€ ä¸€ä¸ªåŒ…å«å®¿ä¸»åŒ…èµ„æºã€ç³»ç»Ÿèµ„æºå’Œæ’ä»¶åŒ…èµ„æºçš„AssetMangerã€‚æœ€åè¿˜æ˜¯é€šè¿‡åå°„ï¼Œä½¿ç”¨åŒ…å«æ‰€æœ‰èµ„æºçš„AssetManageræ›¿æ¢æ‰ResourcesManagerä¸­Resourcesçš„AssetMangerï¼Œæœ€ç»ˆè¾¾åˆ°åŠ è½½æ’ä»¶ä¸­èµ„æºçš„ç›®çš„ã€‚</p>
<p><strong>Smallæ¡†æ¶èµ„æºåŠ è½½æµç¨‹:</strong></p>
<p><img src="/res/small/android-resources4.png" alt="Androidæºç èµ„æºç±»å›¾"></p>
<h4 id="0x04_bugä¿®å¤æ–¹æ¡ˆ">0x04 bugä¿®å¤æ–¹æ¡ˆ</h4><p>çœ‹å®ŒSmallæ’ä»¶èµ„æºåŠ è½½æµç¨‹ï¼Œä½ æ˜¯å¦æœ‰ç–‘é—®ï¼ŸSmallåªåœ¨æ¡†æ¶åŠ è½½æ—¶å¯¹ResourcesManagerè¿›è¡Œäº†hookï¼Œå¥½åƒåœ¨åˆ›å»ºæ–°çš„Resourceså¹¶æ²¡æœ‰è¿›è¡Œhookæ“ä½œï¼Ÿé‚£ä¹ˆå½“ç³»ç»Ÿæ–°åˆ›å»ºResourceså®ä¾‹æ—¶ï¼Œæ–°çš„Resourcesä¸­åŒ…å«çš„èµ„æºè·¯å¾„å¹¶æ²¡æœ‰æ’ä»¶èµ„æºï¼Œè¿™å¥½åƒè¯´ä¸é€šå§ã€‚å…¶å®å…³æ³¨Smallçš„æºç ä¸­<code>ReflectAccelerator.ensureCacheResources</code>ï¼Œè¿™ä¸ªæ–¹æ³•æƒ³è¦çš„è¾¾åˆ°çš„ä½œç”¨æ˜¯å½“æ¯æ¬¡å¯åŠ¨Activityæ—¶éå†ç³»ç»Ÿç¼“å­˜çš„ResourceImplï¼Œå°†å®ƒçš„AssetManageræ›¿æ¢æˆåŒ…å«æ’ä»¶èµ„æºçš„AssetManagerã€‚å½“ç„¶è¿™ä¸ªæœºåˆ¶åªåœ¨SDK&gt;=24æ—¶ç”Ÿæ•ˆã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static void ensureCacheResources() &#123;&#10;    if (Build.VERSION.SDK_INT &#60; 24) return;&#10;    if (sResourceImpls == null || sMergedResourcesImpl == null) return;&#10;&#10;    Set&#60;?&#62; resourceKeys = sResourceImpls.keySet();&#10;    for (Object resourceKey : resourceKeys) &#123;&#10;        WeakReference resourceImpl = (WeakReference)sResourceImpls.get(resourceKey);&#10;        if (resourceImpl != null &#38;&#38; resourceImpl.get() != sMergedResourcesImpl) &#123;&#10;            // Sometimes? the weak reference for the key was released by what&#10;            // we can not find the cache resources we had merged before.&#10;            // And the system will recreate a new one which only build with host resources.&#10;            // So we needs to restore the cache. Fix #429.&#10;            // FIXME: we&#39;d better to find the way to KEEP the weak reference.&#10;            sResourceImpls.put(resourceKey, new WeakReference&#60;Object&#62;(sMergedResourcesImpl));&#10;        &#125;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜:</strong></p>
<ol>
<li>SDK&lt;24æ—¶ï¼Œåœ¨åŸç”Ÿçš„Androidç³»ç»Ÿä¸­å¹¶ä¸æ˜¯æ¯å¯åŠ¨ä¸€ä¸ªActivityéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Resourceså®ä¾‹ï¼ŒResourcesManagerä¼šä½¿ç”¨ç¼“å­˜çš„Resourceså®ä¾‹ï¼Œæ‰€ä»¥åªéœ€è¦Hookä¸€æ¬¡èµ„æºåŠ è½½ã€‚ä½†æ˜¯ä¸€æ—¦åˆ›å»ºå¤šä¸ªResourceså®ä¾‹æ—¶ï¼Œæ˜¯ä¸æ˜¯æ„å‘³ç€æ–°åˆ›å»ºçš„Resourceså¹¶ä¼šåŒ…å«æ’ä»¶çš„èµ„æºè·¯å¾„ã€‚ä¸ªäººç†è§£æ˜¯è¿™æ ·çš„ã€‚è¿™åº”è¯¥ä¹Ÿèƒ½è§£é‡Šä¸ºå•¥Smallæ¡†æ¶ä¼šåœ¨æŸäº›æ‰‹æœºçš„<strong>åˆ†å±æ¨¡å¼</strong>å’ŒæŸäº›<strong>æ¨ªç«–å±åˆ‡æ¢</strong>çš„æ—¶å€™ä¼šå‘ç”ŸCrashï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹<a href="https://github.com/wequick/Small/issues/356" target="_blank" rel="external">#356</a>å’Œ<a href="https://github.com/wequick/Small/issues/548" target="_blank" rel="external">#548</a></li>
<li>SDK&gt;24æ—¶ï¼ŒSmallä¼šæ‰§è¡Œ<code>ensureCacheResources</code>å¸Œæœ›å°†æ–°åˆ›å»ºçš„ResourcesImplçš„AssetsMangeræ›¿æ¢æ‰ã€‚ä½†æ˜¯çœ‹åˆ°æºç ä¸­çš„å®ç°æ–¹å¼æ˜¯ï¼Œé€šè¿‡åå°„ä¸ºActivityThreadçš„<code>mH</code>Handleræ³¨å…¥ä¸€ä¸ª<code>Handler.Callback</code>ã€‚å½“HandlerCallback handleMessage LAUNCH_ACTIVITYæ¶ˆæ¯æ—¶ï¼Œæ‰§è¡Œ<code>ensureCacheResources</code>æ–¹æ³•ã€‚æŸ¥çœ‹Handlerçš„<code>dispatchMessage</code>å‘ç°<code>mCallback.handleMessage</code>æ˜¯å…ˆäº<code>mHandler.handleMessage</code>çš„ã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10; * Handle system messages here.&#10; */&#10;public void dispatchMessage(Message msg) &#123;&#10;    if (msg.callback != null) &#123;&#10;        handleCallback(msg);&#10;    &#125; else &#123;&#10;        if (mCallback != null) &#123;&#10;            if (mCallback.handleMessage(msg)) &#123;&#10;                return;&#10;            &#125;&#10;        &#125;&#10;        handleMessage(msg);&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹ <strong>0x02 Androidèµ„æºåŠ è½½æµç¨‹</strong> çš„èµ„æºæµç¨‹ï¼Œä½ ä¼šå‘ç°Resourceså¯¹è±¡çš„å®ä¾‹åŒ–å¹¶å°†ResourcesImplæ·»åŠ åˆ°ResourcesMangerçš„ç¼“å­˜åˆ—è¡¨ä¸­æ˜¯åœ¨<code>Handler.handleMessage</code>ä¹‹åçš„ã€‚æ‰€ä»¥<code>ensureCacheResources</code>å¹¶ä¸èƒ½ä¿è¯å¯åŠ¨Activityæ—¶<strong>æ–°åˆ›å»ºçš„</strong>ResourcesImplå®ä¾‹èƒ½å¤Ÿè¢«æ­£å¸¸hookçš„ï¼ï¼</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™å°±æ˜¯æ–‡ç« å¼€å¤´ä¸­å…´æ‰‹æœºAndroid7.1ç³»ç»Ÿçš„æ‰‹æœºä¸Šä½¿ç”¨Smallæ¡†æ¶ä¼šå‘ç”ŸCrashé—®é¢˜çš„åŸå› ï¼Œå› ä¸º<strong>ä¸­å…´ç³»ç»Ÿæ¯æ¬¡æ‰“å¼€æ–°çš„Activityéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Resourceså’ŒResourcesImplå®ä¾‹ï¼Œè€Œè¿™äº›éƒ½æ˜¯æ²¡æœ‰è¢«hookçš„ï¼Œä¸åŒ…å«æ’ä»¶èµ„æºè·¯å¾„</strong>ï¼Œè‡ªç„¶å°±ä¼šå‘ç”Ÿèµ„æºæŸ¥æ‰¾å¤±è´¥çš„å¼‚å¸¸ã€‚è§£å†³æ–¹æ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå› ä¸ºæ˜¯SDK&gt;24çš„æœºå™¨ï¼Œåªéœ€è¦åœ¨Smallæ¡†æ¶çš„<code>InstrumentationWrapper.callActivityOnCreate</code>æ–¹æ³•ä¸­æ‰§è¡Œ<code>ReflectAccelerator.ensureCacheResources()</code>å°±å¯ä»¥è§£å†³ä¸Šé¢çš„é—®é¢˜äº†ã€‚</p>
<p>åŒæ—¶ä½ éœ€è¦æ³¨æ„å¦ä¸€ä¸ªé—®é¢˜ï¼ŒæŸ¥çœ‹ActivityThreadçš„æºç ï¼Œåœ¨å¯åŠ¨Activityæµç¨‹çš„<code>performLaunchActivity</code>æ–¹æ³•ä¸­ï¼Œåœ¨<code>mInstrumentation.callActivityOnCreate</code>ä¹‹å‰ç³»ç»Ÿä¼šä¸ºActivityè®¾ç½®ä¸»é¢˜ã€‚å¦‚æœä½ é€‰æ‹©åœ¨<code>mInstrumentation.callActivityOnCreate</code>ä¸­æ‰§è¡ŒResourcesçš„hookï¼Œå¹¶ä¸”æ­¤æ—¶éœ€è¦çš„ä¸»é¢˜èµ„æºæ°å¥½åœ¨æ’ä»¶ä¸­ï¼Œé‚£ä¾ç„¶ä¼šå‘ç”ŸCrashã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) &#123;&#10;    ....&#10;    ....&#30465;&#30053;&#20854;&#20182;&#20195;&#30721;&#10;    int theme = r.activityInfo.getThemeResource();&#10;    if (theme != 0) &#123;&#10;        activity.setTheme(theme);&#10;    &#125;&#10;&#10;    activity.mCalled = false;&#10;    if (r.isPersistable()) &#123;&#10;        mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);&#10;    &#125; else &#123;&#10;        mInstrumentation.callActivityOnCreate(activity, r.state);&#10;    &#125;&#10;    ....&#30465;&#30053;&#20854;&#20182;&#20195;&#30721;&#10;    ....&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘çš„å»ºè®®æ˜¯æŠŠä½ é¡¹ç›®ä¸­æ‰€æœ‰çš„ä¸»é¢˜å®šä¹‰éƒ½æ”¾åœ¨å®¿ä¸»ä¸­ï¼Œå¹¶ä¸”ä¿®æ”¹Smallçš„æ¡†æ¶ä»£ç åœ¨<code>InstrumentationWrapper.callActivityOnCreate</code>æ–¹æ³•ä¸­æ‰§è¡Œ<code>ReflectAccelerator.ensureCacheResources</code>æ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³Smallæ¡†æ¶åœ¨æŸäº›åœºæ™¯ä¸‹å‘ç”Ÿ<code>Resources$NotFoundException</code>å¼‚å¸¸çš„é—®é¢˜ã€‚</p>
<h4 id="0x05_å®Œ">0x05 å®Œ</h4><p>Smallæ’ä»¶åŒ–æ¡†æ¶æ˜¯æˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„æ¡†æ¶ï¼Œä»–çš„è®¾è®¡å’Œå®ç°æ€è·¯ä¸Šéƒ½éå¸¸ä¼˜é›…ï¼Œæ˜¯é¦–é€‰çš„è½»é‡çº§æ’ä»¶åŒ–æ¡†æ¶ã€‚ä»¥ä¸Šåˆ†æåªæ˜¯å¯¹Androidæºç å’ŒSmallæ¡†æ¶çš„ä¸ªäººç†è§£ï¼Œå¦‚æœ‰ç†è§£æœ‰è¯¯çš„åœ°æ–¹è¿˜æœ›æŒ‡å‡ºï¼Œä¸ªäººå¾®ä¿¡å·:tykYangï¼Œé‚®ç®±:yangfan3687@163.comã€‚ğŸ™ğŸ™ğŸ™</p>
<p><a href="https://ivonhoe.github.io/2018/01/18/Small%E6%A1%86%E6%9E%B6%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93/">Androidæ’ä»¶åŒ–ä¹‹Smallæ¡†æ¶å®è·µæ€»ç»“</a></p>
<p><a href="https://ivonhoe.github.io/2018/01/18/Small%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86/">Androidæ’ä»¶åŒ–ä¹‹Smallæ¡†æ¶åŸç†</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00_å‰è¨€&quot;&gt;0x00 å‰è¨€&lt;/h4&gt;&lt;p&gt;è¿™ç¯‡æ–‡ç« ä¸»è¦è®°å½•äº†åœ¨ä½¿ç”¨Smallæ’ä»¶åŒ–æ¡†æ¶ä¸­é‡åˆ°çš„èµ„æºåŠ è½½é—®é¢˜åŠç›¸åº”è§£å†³æ–¹æ¡ˆï¼Œå¹¶æ¢³ç†å‡ºAndroidçš„èµ„æºåŠ è½½æµç¨‹å’Œæ’ä»¶åŒ–æ¡†æ¶çš„èµ„æºåŠ è½½åŸç†ã€‚åœ¨å‰ä¸¤ç¯‡æ’ä»¶åŒ–æŠ€æœ¯ä»‹ç»çš„åŸºç¡€ä¸Šä¼šå…³æ³¨æ›´å¤šæŠ€æœ¯ç»†èŠ‚ï¼Œå¸Œæœ›èƒ½æœ‰æ‰€æ”¶è·ï¼&lt;/p&gt;
&lt;h4 id=&quot;0x01_Smallæ¡†æ¶çš„èµ„æºåŠ è½½å¼‚å¸¸&quot;&gt;0x01 Smallæ¡†æ¶çš„èµ„æºåŠ è½½å¼‚å¸¸&lt;/h4&gt;&lt;p&gt;æœ€è¿‘æ”¶åˆ°ä¸€ä¸ªå®¢æˆ·åé¦ˆï¼Œåœ¨ä»–ä»¬çš„ä¸­å…´V0840æ‰‹æœºä¸Šæ‰“å¼€æˆ‘ä»¬çš„appä¼šæŒç»­å´©æºƒã€‚ç¬¬ä¸€æ—¶é—´åœ¨ç™¾åº¦ç§»åŠ¨è´¨é‡å¹³å°ä¸ŠçŸ­æ—¶ç§Ÿç”¨äº†è¯¥æœºå‹ï¼ŒæŠ“å–äº†logã€‚å‘ç°æ˜¯èµ„æºæŸ¥æ‰¾å¤±è´¥å¼‚å¸¸ã€‚å¹¶åœ¨Small github issuesä¸­æœç´¢&lt;code&gt;android.content.res.Resources$NotFoundException&lt;/code&gt; å¯ä»¥å‘ç°å¾ˆå¤šç±»ä¼¼çš„é—®é¢˜ï¼Œè¯¦ç»†æ—¥å¿—å¯æŸ¥çœ‹ä¸‹å›¾ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å®‰å“æ’ä»¶åŒ–" scheme="https://ivonhoe.github.io/categories/%E5%AE%89%E5%8D%93%E6%8F%92%E4%BB%B6%E5%8C%96/"/>
    
    
      <category term="Android" scheme="https://ivonhoe.github.io/tags/Android/"/>
    
      <category term="Androidæºç " scheme="https://ivonhoe.github.io/tags/Android%E6%BA%90%E7%A0%81/"/>
    
      <category term="æ’ä»¶åŒ–" scheme="https://ivonhoe.github.io/tags/%E6%8F%92%E4%BB%B6%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>Androidæ’ä»¶åŒ–ä¹‹Smallæ¡†æ¶åŸç†</title>
    <link href="https://ivonhoe.github.io/2018/01/18/Small%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86/"/>
    <id>https://ivonhoe.github.io/2018/01/18/Smallæ¡†æ¶åŸç†/</id>
    <published>2018-01-18T09:54:19.000Z</published>
    <updated>2018-05-27T08:45:08.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00_å‰è¨€">0x00 å‰è¨€</h4><p>Smallæ˜¯ä¸€ä¸ªè½»é‡åŒ–çš„æ’ä»¶åŒ–æ¡†æ¶ï¼ŒSmallçš„ä½¿ç”¨ä»‹ç»å¯ä»¥æŸ¥çœ‹<a href="http://code.wequick.net/Small/cn/quickstart" target="_blank" rel="external">å®˜ç½‘æ–‡æ¡£</a>äº†è§£ï¼ŒSmallé¡¹ç›®æ¥å…¥æ€»ç»“å¯ä»¥æŸ¥çœ‹åšå®¢çš„å¦ä¸€ç¯‡<a href="https://ivonhoe.github.io/2018/01/18/Small%E6%A1%86%E6%9E%B6%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93/">ã€ŠSmallæ¡†æ¶å®è·µæ€»ç»“ã€‹</a>ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦ä»ä»¥ä¸‹å‡ ä¸ªè§’åº¦æ¥çœ‹Smallæ¡†æ¶çš„å®ç°åŸç†ã€‚</p>
<ol>
<li>Smallå¦‚ä½•å®ç°æ’ä»¶ä»£ç æ‰“åŒ…å’Œèµ„æºæ‰“åŒ…</li>
<li>SmallåŠ è½½æ’ä»¶ä»£ç å’Œèµ„æºçš„åŸç†</li>
<li>Smallä»£ç†æ’ä»¶activityç”Ÿå‘½å‘¨æœŸçš„åŸç†</li>
</ol>
<h4 id="0x01_Smallå¦‚ä½•æ‰“åŒ…moduleä»£ç ?">0x01 Smallå¦‚ä½•æ‰“åŒ…moduleä»£ç ?</h4><a id="more"></a>
<p>smallæ’ä»¶åŒ–ä¸­çš„ä¸‰ç§ç»„ä»¶è§’è‰²ï¼Œåˆ†åˆ«æ˜¯<code>app.*</code>ï¼Œ<code>lib.*</code>ï¼Œ<code>å®¿ä¸»</code>ã€‚smallåœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ä¼šæ ¹æ®ä¸åŒmoduleçš„ç±»å‹é’ˆå¯¹ä¸åŒç»„ä»¶ä½¿ç”¨ä¸åŒç¼–è¯‘æ’ä»¶åšå¤„ç†ï¼Œåˆ†åˆ«æ˜¯:</p>
<ol>
<li><code>AppPlugin</code> â€“&gt; <code>app.*</code></li>
<li><code>LibraryPlugin</code> â€“&gt; <code>lib.*</code></li>
<li><code>HostPlugin</code> â€“&gt; <code>app</code></li>
<li><code>AssetPlugin</code> â€“&gt; <code>å…¶ä»–</code> </li>
</ol>
<p>åœ¨å¤„ç†æ¨¡å—ä¾èµ–ä¸Šï¼Œé¦–å…ˆåŒºåˆ†gradleçš„ä¸¤ç§ä¾èµ–æ–¹å¼:</p>
<ol>
<li>Compile: compileæ˜¯å¯¹æ‰€æœ‰çš„build typeä»¥åŠflavorséƒ½ä¼šå‚ä¸ç¼–è¯‘å¹¶ä¸”æ‰“åŒ…åˆ°æœ€ç»ˆçš„apkæ–‡ä»¶ä¸­ã€‚</li>
<li>Provided: Providedæ˜¯å¯¹æ‰€æœ‰çš„build typeä»¥åŠflavorsåªåœ¨ç¼–è¯‘æ—¶ä½¿ç”¨ï¼Œåªå‚ä¸ç¼–è¯‘ï¼Œä¸æ‰“åŒ…åˆ°æœ€ç»ˆapkã€‚</li>
</ol>
<p>åœ¨æ‰“åŒ…<code>app.*</code>æ’ä»¶æ—¶ï¼Œå°†<code>app.*</code>å¯¹å…¶ä»–moduleçš„ä¾èµ–è½¬æ¢æˆ<code>provided</code>ä¾èµ–ã€‚å½“æ‰§è¡Œæ’ä»¶æ‰“åŒ…æ—¶å¯ä»¥çœ‹åšæ˜¯æ’ä»¶æ¨¡å—æ‰§è¡Œ<code>assembleRelease</code>ã€‚</p>
<p>åœ¨æ‰“åŒ…<code>lib.*</code>æ’ä»¶æ—¶ï¼Œ<code>LibraryPlugin</code>ä¼šä¿®æ”¹æ’ä»¶æ¨¡å—çš„<code>build.gradle</code>æ–‡ä»¶ï¼Œ<code>apply plugin:</code>ä»<code>&#39;com.android.library&#39;</code>ä¿®æ”¹æˆ<code>&#39;com.android.application&#39;</code>ï¼Œå°†å¯¹libçš„æ–¹å¼è½¬æ¢æˆappçš„æ‰“åŒ…ï¼Œå†æ‰§è¡Œ<code>assembleRelease</code>ä»»åŠ¡ã€‚</p>
<p>ğŸ‘ğŸ‘ğŸ‘</p>
<h4 id="0x02_Smallå¦‚ä½•è§£å†³èµ„æºidå†²çª?">0x02 Smallå¦‚ä½•è§£å†³èµ„æºidå†²çª?</h4><p>Android Appèµ„æºidçš„æ ¼å¼æ˜¯0xPPTTNNNNï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li>PP èµ„æºçš„package id</li>
<li>TT èµ„æºç±»å‹çš„idï¼Œç±»å‹æ˜¯attrã€layoutã€stringç­‰ç­‰</li>
<li>NNNN èµ„æºçš„entry id</li>
</ul>
<p>Android Appèµ„æºçš„é»˜è®¤packageIdæ˜¯0x7fï¼Œå½“åŒæ—¶åŠ è½½å¤šä¸ªæ’ä»¶apkæ—¶ã€‚å¿…ç„¶ä¼šæœ‰æ’ä»¶é—´èµ„æºidå†²çªçš„æƒ…å†µã€‚ä¸šç•Œè§£å†³èµ„æºidå†²çªä¸»è¦é€šè¿‡package idçš„åˆ†æ®µï¼Œå®ç°æ–¹å¼ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ–¹å¼æ˜¯ä¿®æ”¹aaptå·¥å…·æºç ï¼Œè®©aapté’ˆå¯¹æ’ä»¶æ‰“åŒ…æ—¶æ¯ä¸ªæ’ä»¶çš„packageIdéƒ½ä¸ç›¸åŒï¼Œé‡æ–°ç¼–è¯‘å‡ºaaptï¼Œè€Œè¾¾åˆ°è§£å†³èµ„æºidå†²çªçš„é—®é¢˜ã€‚smallæ¡†æ¶ä½¿ç”¨çš„æ˜¯å¦å¤–ä¸€ç§æ–¹å¼ï¼Œé‚£å°±æ˜¯è¯»å–å¹¶é‡å†™resources.arscæ–‡ä»¶ã€‚å¤§è‡´çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼ˆå‡ºè‡ªsmallåŸä½œè€…åœ¨github issuesçš„å›ç­”ï¼‰ï¼š</p>
<ol>
<li>ç¼–è¯‘å®Œæ•´çš„èµ„æºåŒ…ï¼Œåˆ©ç”¨symbol/R.txtæœé›†å®Œæ•´åŒ…entriesçš„èµ„æºä¿¡æ¯</li>
<li>æœé›†å½“å‰æ’ä»¶åŒ…resç›®å½•çš„entryä¿¡æ¯</li>
<li>æ ¹æ®(2)ï¼Œé€šè¿‡é‡æ–°æ’åºåˆ†é…å„ä¸ªentryçš„èµ„æºidï¼Œå¹¶ç»“åˆ(1),å½¢æˆæ—§idåˆ°æ–°idçš„æ˜ å°„</li>
<li>è§£æ(1)ç”Ÿæˆçš„resources.arscæ–‡ä»¶ï¼Œåˆ©ç”¨(3)è¿›è¡Œè¿‡æ»¤è¾“å‡º</li>
</ol>
<h4 id="0x03_Smallå¦‚ä½•åŠ è½½æ’ä»¶ä»£ç ï¼Ÿ">0x03 Smallå¦‚ä½•åŠ è½½æ’ä»¶ä»£ç ï¼Ÿ</h4><p>Smallçš„åŠ è½½æ’ä»¶ä»£ç çš„æ–¹å¼åŸºäºandroid dexåˆ†åŒ…æ–¹æ¡ˆçš„ï¼Œç®€å•çš„è¯´smallé€šè¿‡å°†å¤šä¸ªdexæ–‡ä»¶å¡å…¥åˆ°appçš„classloaderä¸­ï¼Œè¾¾åˆ°åŠ è½½æ’ä»¶ä»£ç çš„ç›®çš„ã€‚Smallå¹¶ä¸ä¼šæ›´æ¢ç³»ç»Ÿçš„classloaderï¼Œæ‰€ä»¥è¿™æ ·åœ¨é¢å¯¹å¤šç§ä¸åŒæœºå‹æ—¶å¯èƒ½å°±ä¸ä¼šé‡åˆ°çš„å…¼å®¹æ€§é—®é¢˜ã€‚</p>
<p>æ€æ ·æŠŠå¤šä¸ªdexæ–‡ä»¶å¡å…¥ç³»ç»Ÿclassloaderä¸­ï¼Œå¯ä»¥çœ‹ä¸‹<a href="https://mp.weixin.qq.com/s?__biz=MzI1MTA1MzM2Nw==&amp;mid=400118620&amp;idx=1&amp;sn=b4fdd5055731290eef12ad0d17f39d4a&amp;scene=0" target="_blank" rel="external">QQç©ºé—´çš„çƒ­ä¿®å¤æ–¹æ¡ˆ</a></p>
<h4 id="0x04_Smallå¦‚ä½•åŠ è½½æ’ä»¶èµ„æº?">0x04 Smallå¦‚ä½•åŠ è½½æ’ä»¶èµ„æº?</h4><p>Androidèµ„æºæ˜¯ç”± <a href="https://github.com/aosp-mirror/platform_frameworks_base/blob/master/core/java/android/content/res/AssetManager.java" target="_blank" rel="external">AssetManager</a> åŠ è½½çš„ã€‚åº”ç”¨å¯åŠ¨æ—¶ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªAssetManagerå®ä¾‹ï¼Œå¹¶é€šè¿‡<code>addAssetPath</code>æ–¹æ³•æ·»åŠ èµ„æºè·¯å¾„ï¼Œé»˜è®¤æ·»åŠ :</p>
<ul>
<li>â€œ/framework/base.apkâ€ - Android base resources (base)</li>
<li>â€œ/data/app/*.apkâ€ - The launching apk resources (host)</li>
</ul>
<p>é‚£ä¹ˆå¦‚ä½•è®©æ’ä»¶çš„èµ„æºèƒ½å¤Ÿè¢«ç³»ç»ŸåŠ è½½ï¼ŸSmallçš„æ–¹å¼æ˜¯è‡ªå·±åˆ›å»ºçš„AssetManagerï¼Œè°ƒç”¨AssetMangerçš„<code>addAssetPath</code>æ–¹æ³•æ·»åŠ æ’ä»¶èµ„æºè·¯å¾„ï¼Œå†å°†ç³»ç»Ÿåˆ›å»ºçš„AssetManageræ›¿æ¢æ‰ã€‚</p>
<p>Hook AssetManagerè·¯å¾„å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ActivityThread&#10;|&#10;|---ResourcesManager mResourcesManager&#10;    |&#10;    |--- ArrayList&#60;WeakReference&#60;Resources&#62;&#62; mResourceReferences&#10;         |&#10;         |--- ResourcesImpl mResourcesImpl&#10;              |&#10;              |--- AssetManager mAssets&#10;         &#10;    |--- ArrayMap&#60;ResourcesKey, WeakReference&#60;ResourcesImpl&#62;&#62; mResourceImpls&#10;         |&#10;         |--- ResourcesImpl mResourcesImpl&#10;              |&#10;              |--- AssetManager mAssets</span><br></pre></td></tr></table></figure>
<h4 id="0x05_Smallå¦‚ä½•ä»£ç†æ’ä»¶Activityçš„ç”Ÿå‘½å‘¨æœŸ?">0x05 Smallå¦‚ä½•ä»£ç†æ’ä»¶Activityçš„ç”Ÿå‘½å‘¨æœŸ?</h4><p>å…ˆçœ‹Andriodä¸­Activityæ˜¯å¦‚ä½•å¯åŠ¨çš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyActivity.startActivity()&#10;|&#10;|--&#62;Activity.startActivity() &#10;    |&#10;    |--&#62;Activity.startActivityForResult()&#10;        |&#10;        |--&#62;Instrumentation.execStartActivty()&#10;            |&#10;            |--&#62;ActivityManagerNative.getDefault().startActivityAsUser()</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ Activity çš„å¯åŠ¨æµç¨‹å¯ä»¥å‘ç°ï¼ŒActivityæ˜¯ç”± <a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/app/ActivityThread.java" target="_blank" rel="external">ActivityThread</a> å’Œ <a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/app/Instrumentation.java" target="_blank" rel="external">Instrumentation</a> å¯åŠ¨çš„ï¼ŒInstrumentationæœ‰å…³Activityå¯åŠ¨ç›¸å…³çš„æ–¹æ³•å¤§æ¦‚æœ‰ï¼šexecStartActivityã€newActivityç­‰ç­‰ã€‚Smallæ˜¯è¿™æ ·æ“ä½œçš„: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyActivity.startActivity()&#10;|&#10;|--&#62;Activity.startActivity() &#10;    |&#10;    |--&#62;Activity.startActivityForResult()&#10;        |&#10;        |--&#62;InstrumentationWrapper.execStartActivty()&#10;            |&#10;            |--&#62; InstrumentationWrapper.wrapIntent() &#23558; Intent &#123; cmp=net.wequick.example.small/.app.main.MainActivity &#125;&#10;            |--&#62; &#36716;&#25442;&#25104; Intent &#123; cat=[&#62;net.wequick.example.small.app.main.MainActivity] cmp=net.wequick.example.small/net.wequick.small.A &#125;&#10;                |&#10;                |--&#62;Instrumentation.execStartActivty()&#10;                    |&#10;                    |--&#62;ActivityManagerNative.getDefault().startActivityAsUser()</span><br></pre></td></tr></table></figure>
<p>Smallé¦–å…ˆåœ¨å®¿ä¸»manifestä¸­æ³¨å†Œä¸€ä¸ªå‘½åç‰¹æ®Šçš„å å‘activityæ¥æ¬ºéª—ç³»ç»Ÿè·å–ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨å°è£…ä¸€ä¸ªInstrumentationæ›¿æ¢æ‰å®¿ä¸»çš„ï¼Œç³»ç»Ÿå¯åŠ¨çš„æ˜¯Aè¿™ä¸ªactivityï¼Œä½†classloaderå®é™…åŠ è½½çš„ä»£ç å´æ˜¯ MainActivity.class è¿™ä¸ªç±»ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;!-- Stub Activities --&#62;&#10;&#60;activity android:name=&#34;.A&#34; android:launchMode=&#34;standard&#34;/&#62;</span><br></pre></td></tr></table></figure>
<p>ä¼ªä»£ç å¦‚ä¸‹: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ActivityThread thread = currentActivityThread();&#10;Instrumentation base = thread.@mInstrumentation;&#10;Instrumentation wrapper = new InstrumentationWrapper(base);&#10;thread.@mInstrumentation = wrapper;&#10;&#10;class InstrumentationWrapper extends Instrumentation &#123;&#10;    public ActivityResult execStartActivity(..., Intent intent, ...) &#123;&#10;        fakeToStub(intent);&#10;        base.execStartActivity(args);&#10;    &#125;&#10;&#10;    @Override&#10;    public Activity newActivity(ClassLoader cl, String className, Intent intent) &#123;&#10;        className = restoreToReal(intent, className);&#10;        return base.newActivity(cl, className, intent);&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="0x06_Smallå¦‚ä½•åŠ¨æ€æ›´æ–°æ’ä»¶æ¨¡å—?">0x06 Smallå¦‚ä½•åŠ¨æ€æ›´æ–°æ’ä»¶æ¨¡å—?</h4><p><a href="https://github.com/wequick/Small/blob/master/Android/Sample/app.home/src/main/java/net/wequick/example/small/app/home/MainFragment.java" target="_blank" rel="external">æŸ¥çœ‹github sampleå®ç°æ–¹å¼</a></p>
<h4 id="0x07_å‚è€ƒæ–‡æ¡£">0x07 å‚è€ƒæ–‡æ¡£</h4><p><a href="https://github.com/wequick/Small/wiki" target="_blank" rel="external">Small å®˜æ–¹ wiki</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzI1MTA1MzM2Nw==&amp;mid=400118620&amp;idx=1&amp;sn=b4fdd5055731290eef12ad0d17f39d4a&amp;scene=0" target="_blank" rel="external">QQç©ºé—´çƒ­è¡¥ä¸åŠ¨æ€ä¿®å¤æŠ€æœ¯ä»‹ç»</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00_å‰è¨€&quot;&gt;0x00 å‰è¨€&lt;/h4&gt;&lt;p&gt;Smallæ˜¯ä¸€ä¸ªè½»é‡åŒ–çš„æ’ä»¶åŒ–æ¡†æ¶ï¼ŒSmallçš„ä½¿ç”¨ä»‹ç»å¯ä»¥æŸ¥çœ‹&lt;a href=&quot;http://code.wequick.net/Small/cn/quickstart&quot;&gt;å®˜ç½‘æ–‡æ¡£&lt;/a&gt;äº†è§£ï¼ŒSmallé¡¹ç›®æ¥å…¥æ€»ç»“å¯ä»¥æŸ¥çœ‹åšå®¢çš„å¦ä¸€ç¯‡&lt;a href=&quot;https://ivonhoe.github.io/2018/01/18/Small%E6%A1%86%E6%9E%B6%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93/&quot;&gt;ã€ŠSmallæ¡†æ¶å®è·µæ€»ç»“ã€‹&lt;/a&gt;ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦ä»ä»¥ä¸‹å‡ ä¸ªè§’åº¦æ¥çœ‹Smallæ¡†æ¶çš„å®ç°åŸç†ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Smallå¦‚ä½•å®ç°æ’ä»¶ä»£ç æ‰“åŒ…å’Œèµ„æºæ‰“åŒ…&lt;/li&gt;
&lt;li&gt;SmallåŠ è½½æ’ä»¶ä»£ç å’Œèµ„æºçš„åŸç†&lt;/li&gt;
&lt;li&gt;Smallä»£ç†æ’ä»¶activityç”Ÿå‘½å‘¨æœŸçš„åŸç†&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&quot;0x01_Smallå¦‚ä½•æ‰“åŒ…moduleä»£ç ?&quot;&gt;0x01 Smallå¦‚ä½•æ‰“åŒ…moduleä»£ç ?&lt;/h4&gt;
    
    </summary>
    
      <category term="å®‰å“æ’ä»¶åŒ–" scheme="https://ivonhoe.github.io/categories/%E5%AE%89%E5%8D%93%E6%8F%92%E4%BB%B6%E5%8C%96/"/>
    
    
      <category term="Android" scheme="https://ivonhoe.github.io/tags/Android/"/>
    
      <category term="æ’ä»¶åŒ–" scheme="https://ivonhoe.github.io/tags/%E6%8F%92%E4%BB%B6%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>Androidæ’ä»¶åŒ–ä¹‹Smallæ¡†æ¶å®è·µæ€»ç»“</title>
    <link href="https://ivonhoe.github.io/2018/01/18/Small%E6%A1%86%E6%9E%B6%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93/"/>
    <id>https://ivonhoe.github.io/2018/01/18/Smallæ¡†æ¶å®è·µæ€»ç»“/</id>
    <published>2018-01-18T09:42:57.000Z</published>
    <updated>2018-05-27T08:45:14.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00_å‰è¨€">0x00 å‰è¨€</h4><p>è¿™ç¯‡æ–‡ç« ä¸»è¦æ€»ç»“äº†åœ¨ä½¿ç”¨Smallæ¡†æ¶æ”¹é€ è€é¡¹ç›®è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿæ€»ç»“äº†ä½¿ç”¨Smallæ¡†æ¶çš„åŸºç¡€çŸ¥è¯†ç‚¹ï¼Œå¹¶ä»ä¸€ä¸ªä½¿ç”¨è€…çš„è§’åº¦æ¥åˆ†æSmallæ¡†æ¶çš„ä¼˜ç¼ºç‚¹ã€‚å¦‚æœä½ çš„é¡¹ç›®ä¹Ÿé¢ä¸´ä¸šåŠ¡æ¨¡å—è€¦åˆï¼Œè¾¹ç•Œä¸æ¸…æ™°ï¼Œæ²¡æœ‰åŠ¨æ€éƒ¨ç½²æ–¹æ¡ˆç­‰ç­‰éœ€è¦æ’ä»¶åŒ–æ–¹æ¡ˆæ¥è§£å†³çš„é—®é¢˜ï¼Œä¸å¦¨å…ˆçœ‹ä¸‹è¿™ç¯‡æ–‡ç« å†è¯•ä¸€è¯•Smallæ¡†æ¶ï¼ŒSmallçš„åŠŸèƒ½æœªå¿…å…¨é¢ä½†ç»å¯¹èšç„¦äº†æ’ä»¶åŒ–æ¡†æ¶éœ€è¦è§£å†³çš„çš„æ ¸å¿ƒé—®é¢˜ã€‚</p>
<p>ä»€ä¹ˆæ˜¯Smallæ¡†æ¶ï¼Ÿ Smallæ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ’ä»¶åŒ–æ¡†æ¶ï¼ŒSmallä¹Ÿæ˜¯ä¸€ä¸ªdexåˆ†åŒ…æ–¹æ¡ˆï¼ŒSmallä¹Ÿæ˜¯ä¸€ä¸ªä¸šåŠ¡æ¨¡å—è§£è€¦æ–¹æ¡ˆï¼ŒåŒæ—¶Smallä¹Ÿæ˜¯ä¸€ä¸ªåŠ¨æ€åŒ–åŠ è½½å’Œæ›´æ–°æ–¹æ¡ˆã€‚å…ˆå»çœ‹å®˜ç½‘æ–‡æ¡£äº†è§£Smallçš„åŸºç¡€çŸ¥è¯†~~</p>
<p><a href="http://code.wequick.net/Small/cn/quickstart" target="_blank" rel="external">Smallå®˜ç½‘æ–‡æ¡£</a></p>
<a id="more"></a>
<h4 id="0x01_Smallå¿…çŸ¥å¿…ä¼š">0x01 Smallå¿…çŸ¥å¿…ä¼š</h4><p><img src="/res/small/small-1.png" alt="Smallè§’è‰²å…³ç³»"></p>
<ol>
<li>Smallæ¡†æ¶å°†å·¥ç¨‹æ¨¡å—åˆ†ä¸ºè¿™å‡ ä¸ªè§’è‰²ï¼Œå®¿ä¸»ï¼Œå®¿ä¸»åˆ†èº«ï¼Œappæ’ä»¶ï¼Œå…¬å…±libæ’ä»¶</li>
<li>å®¿ä¸»ä¸ä¾èµ–ä»»ä½•æ¨¡å—ï¼Œå®¿ä¸»åˆ†èº«è¢«æ‰€æœ‰appå’Œlibä¾èµ–ï¼Œä½†æ˜¯å®¿ä¸»å’Œå®¿ä¸»åˆ†èº«éƒ½è¢«æ‰“åŒ…åœ¨ä¸»åº”ç”¨çš„ä¸»dexä¸­ï¼Œappæ’ä»¶å’Œå…¬å…±libæ’ä»¶è¢«å•ç‹¬æ‰“åŒ…åœ¨è‡ªå·±çš„æ’ä»¶soä¸­</li>
<li>Smallå¦‚ä½•ç¼–è¯‘? <ul>
<li>./gradlew cleanLib </li>
<li><strong>ç¼–è¯‘å…¬å…±åº“:</strong> ./gradlew buildLib </li>
<li>./gradlew cleanBundle</li>
<li><strong>ç¼–è¯‘appæ’ä»¶:</strong> ./gradle buildBundle </li>
<li><strong>ç¼–è¯‘å®¿ä¸»app:</strong> ./gradle :app:assembleDaily  <strong>æ³¨æ„ï¼š</strong>è¿™é‡Œä¸æ˜¯assembleDaily è€Œæ˜¯:app:assembleDaily</li>
</ul>
</li>
<li>appæ’ä»¶çš„æ¨¡å—åç§°å¿…é¡»æ˜¯app.<em> , å…¬å…±åº“libæ’ä»¶çš„æ¨¡å—åç§°å¿…é¡»æ˜¯lib.</em>ã€‚</li>
<li>åœ¨å®¿ä¸»app assetsç›®å½•çš„bundle.jsonæ–‡ä»¶ä¸­å£°æ˜æ¯ä¸ªæ’ä»¶çš„åŒ…åã€ç±»å‹å’Œé¡µé¢è·¯ç”±ç­‰ä¿¡æ¯ã€‚å½“appæ’ä»¶çš„åŒ…åä¸º <code>**.app.*</code> æˆ– <code>**.app*</code>æ—¶, smallæ¡†æ¶ä¼šé»˜è®¤è¯¥æ’ä»¶æ¨¡å—ä¸ºappæ’ä»¶ã€‚</li>
<li>appæ’ä»¶å’Œappæ’ä»¶ä¹‹é—´æ— æ³•ç›¸äº’ä¾èµ–ï¼Œappæ’ä»¶ä¹‹é—´å¯ä»¥é€šè¿‡è·¯ç”±uriä¼ å‚ï¼Œæˆ–è€…LocalBroadcastã€Eventbusç­‰æ¶ˆæ¯æœºåˆ¶å®ç°é€šä¿¡ã€‚</li>
<li><p>Smallä¸­æ’ä»¶çš„packageIdæ˜¯è‡ªåŠ¨æ ¹æ®æ¨¡å—åç§°hashè®¡ç®—ç”Ÿæˆï¼Œæœ‰å¯èƒ½ä¼šé‡åˆ°æ’ä»¶æ¨¡å—packageIdå†²çªçš„æƒ…å†µï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹éœ€è¦åœ¨å‘ç”Ÿå†²çªæ¨¡å—çš„build.gradleé‡æ–°å£°æ˜packageId, å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ext &#123;&#10;  packageId = 0x33&#10;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç”Ÿæˆæ’ä»¶åˆ° x86 æ¶æ„ä¸‹./gradlew buildLib -q -Dbundle.arch=x86ï¼Œ<strong>éœ€è¦æ³¨æ„</strong> å®¿ä¸»çš„ndk abiFilters è¦å’Œ<code>bundle.arch</code>ä¸€è‡´å“¦ã€‚</p>
</li>
<li>å¦‚ä½•å¯åŠ¨å…¶ä»–æ’ä»¶æ¨¡å—çš„é¡µé¢ï¼Ÿé€šè¿‡<code>Small.openUri()</code>æ–¹æ³•æ‰“å¼€é¡µé¢çš„è·¯ç”±åœ°å€ã€‚</li>
<li>åŠ¨æ€æ›´æ–°æ’ä»¶æ—¶ï¼Œéœ€è¦å‡çº§æ’ä»¶çš„versionCodeæ‰ä¼šç”Ÿæ•ˆ</li>
<li>éActivityç»„ä»¶éœ€è¦å£°æ˜åœ¨å®¿ä¸»æˆ–è€…å®¿ä¸»åˆ†èº«çš„manifestä¸­</li>
</ol>
<h4 id="0x02_Smallæ¡†æ¶çš„ä¼˜ç¼ºç‚¹">0x02 Smallæ¡†æ¶çš„ä¼˜ç¼ºç‚¹</h4><p><strong>é€‰æ‹©smallæ¡†æ¶çš„åŸå› ï¼š</strong></p>
<ol>
<li>é›†æˆç®€å•</li>
<li>å¼€å‘æ–¹å¼éå¸¸æ¥è¿‘Android appçš„åŸç”Ÿå¼€å‘æ–¹å¼</li>
<li>ä¸éœ€è¦æ›´æ¢ç¼–è¯‘å·¥å…·ï¼Œå·²æœ‰é¡¹ç›®ä¸­é’ˆå¯¹ä¸šåŠ¡éœ€æ±‚å¼€å‘çš„ç¼–è¯‘å·¥å…·ä¾ç„¶å¯ä»¥ç»§ç»­ä½¿ç”¨</li>
<li>ä¼˜é›…ï¼Œç‰¹åˆ«æ˜¯å¯¹èµ„æºidå†²çªçš„å¤„ç†æ–¹å¼</li>
<li>è½»é‡åŒ–ï¼Œå°½å¯èƒ½å°‘çš„hookç³»ç»Ÿå˜é‡ï¼Œå…¼å®¹æ€§é—®é¢˜è¾ƒå°‘</li>
</ol>
<p><strong>ä¸é€‰æ‹©smallæ¡†æ¶çš„åŸå› ï¼š</strong></p>
<ol>
<li>æ’ä»¶çš„åŠ è½½å¹¶ä¸æ˜¯æŒ‰éœ€åŠ è½½</li>
<li>æ’ä»¶çš„æ›´æ–°å®ç°è¾ƒç®€å•ï¼Œä¸”æ²¡æœ‰å›æ»šæ–¹æ¡ˆ</li>
<li>æœ‰äº›éšè—bugè¿˜æœªè§£å†³ï¼Œä½†å¯ä»¥ç»•è¿‡</li>
<li>åŠŸèƒ½ç›¸å¯¹å…¶ä»–æ’ä»¶åŒ–æ¡†æ¶(æ¯”å¦‚atlas)æ¥è¯´è¿˜ä¸å¤Ÿå®Œå–„ï¼Œä½†è¶³å¤Ÿè§£å†³é¡¹ç›®æ’ä»¶åŒ–ç›®æ ‡ä¸­é‡åˆ°çš„80%é—®é¢˜</li>
</ol>
<h4 id="0x03_Smallæ’ä»¶åŒ–å®è·µè¸©è¿‡çš„é‚£äº›å‘">0x03 Smallæ’ä»¶åŒ–å®è·µè¸©è¿‡çš„é‚£äº›å‘</h4><p>é‡åˆ°é—®é¢˜æ€ä¹ˆåŠï¼Ÿåˆ°github issuesé‡ŒæŸ¥è¯¢ä½ é‡åˆ°çš„é—®é¢˜ï¼Œä¸€èˆ¬éƒ½å¯ä»¥æ‰¾åˆ°ç­”æ¡ˆã€‚è¿™é‡Œå¤§è‡´æ€»ç»“äº†æˆ‘ä»¬å›¢é˜Ÿåœ¨smallæ¡†æ¶ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°çš„å¸¸è§é—®é¢˜ã€‚</p>
<ol>
<li>libæ’ä»¶ä¸­å¢åŠ æˆ–å‡å°‘èµ„æºæ—¶ï¼Œéœ€è¦åˆ é™¤æ¨¡å—ç›®å½•ä¸‹public.xmlå†é‡æ–°ç¼–è¯‘ã€‚public.xmlæ˜¯ä¸ºäº†é”å®šlibä¸­èµ„æºid</li>
<li>å¢åŠ æˆ–ä¿®æ”¹æ’ä»¶ä¸­ndk moduleè¦†ç›–å®‰è£…ä¸ç”Ÿæ•ˆï¼Œéœ€è¦å°†native moduleç¼–è¯‘ç”Ÿæˆçš„soæ–‡ä»¶æ”¾åœ¨å®¿ä¸»ä¸­æ‰èƒ½å®ç°æ›´æ–°</li>
<li>é‡åˆ°ClassNotFoundExceptionå¼‚å¸¸æˆ–è€…æ— æ³•å¯åŠ¨æŸäº›activity companentInfoï¼Œæ’æŸ¥é—®é¢˜çš„æ–¹æ³•:<ul>
<li>æŸ¥çœ‹Fatal Runtime Exceptionæ—¥å¿—ï¼ŒæŸ¥çœ‹æ—¥å¿—ä¸­å·²ç»åŠ è½½çš„soæ˜¯å¦åŒ…å«ä½ çš„æ’ä»¶so</li>
<li>å¦‚æœæ’ä»¶soè¢«åŠ è½½ï¼Œå†ç¡®å®šç›¸åº”ä»£ç å·²ç»è¢«ç¼–è¯‘è¿›æ’ä»¶soä¸­ï¼ŒæŸ¥çœ‹æ–¹æ³•å¾ˆç®€å•ï¼Œå°†æ’ä»¶soé‡å‘½åä¸ºapkç›´æ¥åœ¨Android Studioä¸­æ‰“å¼€ </li>
<li>ç¡®è®¤æ˜¯å¦å°†æ’ä»¶soæ­£ç¡®å£°æ˜åœ¨bundle.jsonæ–‡ä»¶ä¸­</li>
<li>ç¡®è®¤è¯¥å¼‚å¸¸ç±»ç»§æ‰¿çš„çˆ¶ç±»æˆ–è€…æ¥å£æ»¡è¶³ä¸Šè¿°å‡ ä¸ªæ¡ä»¶</li>
</ul>
</li>
<li>Class ref in pre-verified class resolved to unexpected implementation ï¼Œä½¿ç”¨gradle smallLintå‘½ä»¤æŸ¥çœ‹æ˜¯å¦æœ‰classé‡å¤äº† <a href="https://github.com/wequick/Small/issues/423" target="_blank" rel="external">https://github.com/wequick/Small/issues/423</a></li>
<li>Activity launch modeä¸ºsingletopæ—¶åœ¨activity styleä¸­è®¾ç½®é€æ˜èƒŒæ™¯æ— æ•ˆ <a href="https://github.com/wequick/Small/issues/94" target="_blank" rel="external">https://github.com/wequick/Small/issues/94</a></li>
<li>æ— æ³•é€šè¿‡Small.openUri()æ–¹æ³•å¯åŠ¨é¡µé¢æ€ä¹ˆåŠï¼Ÿä¸€å®šæ˜¯ä½ ç”¨æ³•ä¸å¯¹ï¼Œdebugæ‰¾åŸå› ã€‚</li>
</ol>
<h4 id="0x04_Smallæ’ä»¶åŒ–è§„èŒƒ">0x04 Smallæ’ä»¶åŒ–è§„èŒƒ</h4><ol>
<li>ä¸è¦åœ¨å®¿ä¸»ä¸­æ·»åŠ ä¸šåŠ¡ä»£ç </li>
<li>native module soæ”¾åœ¨å®¿ä¸»ä¸­, åŸå› å…³æ³¨Github issue: <a href="https://github.com/wequick/Small/issues/560" target="_blank" rel="external">å¢åŠ æˆ–ä¿®æ”¹æ’ä»¶ä¸­ndk moduleè¦†ç›–å®‰è£…ä¸ç”Ÿæ•ˆ </a></li>
<li>ä¸åŒæ’ä»¶æ¨¡å—ä¸­ä¾èµ–ç›¸åŒç¬¬ä¸‰æ–¹aaræˆ–jarçš„ç‰ˆæœ¬å·è¦ç›¸åŒï¼Œå»ºè®®å°†aaræˆ–jarçš„ç‰ˆæœ¬å·ç»Ÿä¸€å£°æ˜åœ¨gradle.propertiesä¸­ï¼Œå°†å…±åŒä¾èµ–çš„ç¬¬ä¸‰æ–¹sdkå£°æ˜åœ¨å®¿ä¸»åˆ†èº«ä¸­</li>
<li>æ‰€æœ‰Themeçš„å®šä¹‰éƒ½æ”¾åœ¨å®¿ä¸»å’Œå®¿ä¸»åˆ†èº«ä¸­ï¼Œå…·ä½“åŸå› çœ‹æˆ‘çš„å¦ä¸€ç¯‡é—®é¢˜æ€»ç»“ï¼š<a href="https://ivonhoe.github.io/2018/03/14/small-bug-555-fix/">Androidæ’ä»¶åŒ–ä¹‹èµ„æºåŠ è½½</a></li>
</ol>
<p><strong>Smallæ’ä»¶åŒ–é¡¹ç›®çš„å®Œå…¨ä½“</strong></p>
<p><img src="/res/small/small-2.png" alt="Smallæ’ä»¶åŒ–å®Œå…¨ä½“"></p>
<h4 id="0x05_Smallæ¡†æ¶åŸç†">0x05 Smallæ¡†æ¶åŸç†</h4><p>è¯¦æƒ…æŸ¥çœ‹è¿™ç¯‡â€“&gt;&gt;</p>
<p><a href="https://ivonhoe.github.io/2018/01/18/Small%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86/">ã€ŠSmallæ¡†æ¶åŸç†æ€»ç»“ã€‹</a></p>
<p><a href="https://ivonhoe.github.io/2018/03/14/small-bug-555-fix/">ã€ŠAndroidæ’ä»¶åŒ–ä¹‹èµ„æºåŠ è½½ã€‹</a></p>
<h4 id="0x06_å‚è€ƒ">0x06 å‚è€ƒ</h4><p>Smallå®˜ç½‘æ–‡æ¡£ <a href="http://code.wequick.net/Small/cn/quickstart" target="_blank" rel="external">http://code.wequick.net/Small/cn/quickstart</a></p>
<p>Small githubä¸»é¡µ <a href="https://github.com/wequick/Small" target="_blank" rel="external">https://github.com/wequick/Small</a></p>
<p><a href="http://code.wequick.net/small/docs/ppt/gmtc-galen-small.ppsx" target="_blank" rel="external">GMTCæ¼”è®²PPT</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00_å‰è¨€&quot;&gt;0x00 å‰è¨€&lt;/h4&gt;&lt;p&gt;è¿™ç¯‡æ–‡ç« ä¸»è¦æ€»ç»“äº†åœ¨ä½¿ç”¨Smallæ¡†æ¶æ”¹é€ è€é¡¹ç›®è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿæ€»ç»“äº†ä½¿ç”¨Smallæ¡†æ¶çš„åŸºç¡€çŸ¥è¯†ç‚¹ï¼Œå¹¶ä»ä¸€ä¸ªä½¿ç”¨è€…çš„è§’åº¦æ¥åˆ†æSmallæ¡†æ¶çš„ä¼˜ç¼ºç‚¹ã€‚å¦‚æœä½ çš„é¡¹ç›®ä¹Ÿé¢ä¸´ä¸šåŠ¡æ¨¡å—è€¦åˆï¼Œè¾¹ç•Œä¸æ¸…æ™°ï¼Œæ²¡æœ‰åŠ¨æ€éƒ¨ç½²æ–¹æ¡ˆç­‰ç­‰éœ€è¦æ’ä»¶åŒ–æ–¹æ¡ˆæ¥è§£å†³çš„é—®é¢˜ï¼Œä¸å¦¨å…ˆçœ‹ä¸‹è¿™ç¯‡æ–‡ç« å†è¯•ä¸€è¯•Smallæ¡†æ¶ï¼ŒSmallçš„åŠŸèƒ½æœªå¿…å…¨é¢ä½†ç»å¯¹èšç„¦äº†æ’ä»¶åŒ–æ¡†æ¶éœ€è¦è§£å†³çš„çš„æ ¸å¿ƒé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯Smallæ¡†æ¶ï¼Ÿ Smallæ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ’ä»¶åŒ–æ¡†æ¶ï¼ŒSmallä¹Ÿæ˜¯ä¸€ä¸ªdexåˆ†åŒ…æ–¹æ¡ˆï¼ŒSmallä¹Ÿæ˜¯ä¸€ä¸ªä¸šåŠ¡æ¨¡å—è§£è€¦æ–¹æ¡ˆï¼ŒåŒæ—¶Smallä¹Ÿæ˜¯ä¸€ä¸ªåŠ¨æ€åŒ–åŠ è½½å’Œæ›´æ–°æ–¹æ¡ˆã€‚å…ˆå»çœ‹å®˜ç½‘æ–‡æ¡£äº†è§£Smallçš„åŸºç¡€çŸ¥è¯†~~&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://code.wequick.net/Small/cn/quickstart&quot;&gt;Smallå®˜ç½‘æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="å®‰å“æ’ä»¶åŒ–" scheme="https://ivonhoe.github.io/categories/%E5%AE%89%E5%8D%93%E6%8F%92%E4%BB%B6%E5%8C%96/"/>
    
    
      <category term="Android" scheme="https://ivonhoe.github.io/tags/Android/"/>
    
      <category term="æ’ä»¶åŒ–" scheme="https://ivonhoe.github.io/tags/%E6%8F%92%E4%BB%B6%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>Androidå®‰å…¨ä¹‹æŸå›¢è¯·æ±‚åŠ å¯†ç ´è§£</title>
    <link href="https://ivonhoe.github.io/2017/06/18/android-app-gold-flow-hack/"/>
    <id>https://ivonhoe.github.io/2017/06/18/android-app-gold-flow-hack/</id>
    <published>2017-06-18T10:13:19.000Z</published>
    <updated>2018-05-27T08:19:52.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="0x00_å‰è¨€">0x00 å‰è¨€</h3><p>æœ¬æ–‡è®°å½•äº†ç ´è§£æŸå¤–å–App httpè¯·æ±‚å‚æ•°åŠ å¯†è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ€è·¯ï¼Œå®ç°çš„ç›®æ ‡æ˜¯å¸Œæœ›æ˜¯èƒ½å¤Ÿé€šè¿‡ä¸€äº›æ‰‹æ®µå®ç°è‡ªç”±è°ƒç”¨å…¶æœåŠ¡æ¥å£ã€‚<br>è¿™ç¯‡æ–‡ç« ä¸»è¦è®²è¿°ä»€ä¹ˆï¼Ÿ</p>
<ol>
<li>é™æ€åˆ†æå’ŒåŠ¨æ€è°ƒè¯•çš„åŸºæœ¬æ–¹æ³•å’Œé‡åˆ°çš„é—®é¢˜</li>
<li>å¦‚ä½•å¬è¿‡ä¿®æ”¹androidæºç å®ç°å…¨å±€hook</li>
</ol>
<p><img src="/res/meituan_hack/meituan-1.png" alt="æƒ³è¦ç ´è§£çš„ç½‘ç»œè¯·æ±‚"></p>
<a id="more"></a>
<p>å¯ä»¥çœ‹åˆ°æ¯æ¬¡è¯·æ±‚éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆç›¸åº”çš„è¯·æ±‚å‚æ•°ï¼Œå¹¶è®¡ç®—å‡ºä¸€ä¸ªåŠ å¯†åçš„å‚æ•°<code>__skcy</code>ï¼ŒæœåŠ¡ç«¯æ ¹æ®è¿™äº›å‚æ•°ä¿¡æ¯å’Œè¯·æ±‚å†…å®¹åšæ ¡éªŒï¼Œæ ¡éªŒé€šè¿‡æœåŠ¡ç«¯æ‰ä¼šè¿”å›æ­£ç¡®çš„ç»“æœã€‚é€šè¿‡æŠ“åŒ…å’Œåç¼–è¯‘åçš„ä»£ç å¤§è‡´æ¢³ç†äº†ä¸Šå›¾è¯·æ±‚å‚æ•°çš„å«ä¹‰å’Œç”Ÿæˆæ–¹æ³•ï¼Œå…·ä½“å‚æ•°å¦‚ä¸‹æ‰€ç¤º:</p>
<ul>
<li><strong>__skck:</strong>Javaå±‚é¢<strong>å¸¸é‡</strong>ï¼Œ6a375bce8c66a0dc293860dfa83833ef</li>
<li><strong>__skts:</strong>ç³»ç»Ÿæ—¶é—´å€¼ï¼Œé€šè¿‡Sytem.currentTime()è·å–ï¼Œä¾‹å¦‚ï¼š1487054997740</li>
<li><strong>__skua:</strong>é€šè¿‡UserAgentæ–¹æ³•ï¼Œè·å–uaï¼Œå¹¶è®¡ç®—å‡ºmd5ï¼Œé€šè¿‡åŠ¨æ€è°ƒè¯•å‘ç°è¯¥UserAgentæ–¹æ³•è¿”å›ä¸ºç©ºï¼Œæ‰€ä»¥è¯¥å€¼ä¹Ÿä¸º<strong>å¸¸é‡</strong>ï¼Œd41d8cd98f00b204e9800998ecf8427e</li>
<li><strong>__skno:</strong>é€šè¿‡Java randomUUIDè·å–éšæœºæ•°ï¼Œä¾‹å¦‚ï¼šeccb0210-c86f-43bb-b12d-04927547b9ea</li>
<li><strong>__skcy:</strong>ä»¥ä¸Šå››ä¸ªå‚æ•°åŠ ä¸ŠPostContentï¼Œè°ƒç”¨nativeæ–¹æ³•è·å–åŠ å¯†åå¾—åˆ°è¯¥å€¼</li>
</ul>
<!-- more -->
<h3 id="0x01_å°è¯•é™æ€åˆ†æ">0x01 å°è¯•é™æ€åˆ†æ</h3><p>é¦–å…ˆä½¿ç”¨å¸¸ç”¨çš„é™æ€åˆ†æå·¥å…·ï¼Œå¦‚apkToolsã€dex2jaråšapkçš„åç¼–è¯‘å’Œè½¬Jarã€‚è™½ç„¶è¯¥Appå®‰è£…åŒ…æ²¡æœ‰åŠ å£³ï¼Œä½†åœ¨åç¼–è¯‘è¿‡ç¨‹ä¸­ä¾ç„¶é‡åˆ°ä¸€äº›é—®é¢˜ã€‚</p>
<h4 id="1-1ã€é‡åˆ°é—®é¢˜">1.1ã€é‡åˆ°é—®é¢˜</h4><p>è¯¥Appé’ˆå¯¹dex2jarå·¥å…·åšäº†é˜²èŒƒ. åŸç†åˆ†æè¯·çœ‹<a href="https://ivonhoe.github.io/2017/02/09/%E7%BE%8E%E5%9B%A2%E5%A6%82%E4%BD%95%E9%98%B2dex2jar/">Androidå®‰å…¨ä¹‹åº”ç”¨é˜²dex2jaråŸç†åŠå®ç°</a></p>
<h4 id="1-2ã€è§£å†³æ–¹æ¡ˆ">1.2ã€è§£å†³æ–¹æ¡ˆ</h4><ul>
<li>å°†æ’å…¥çš„Existä»£ç åˆ é™¤ï¼Œå†åšsmaliâ€“&gt;dexâ€“&gt;jarå¤„ç†ã€‚</li>
<li>æˆ–è€…ï¼Œç›´æ¥é˜…è¯»smaliä»£ç ã€‚</li>
</ul>
<h4 id="1-3ã€åˆ†æç»“æœ">1.3ã€åˆ†æç»“æœ</h4><ul>
<li>è¯¥Appåœ¨javaå±‚å¤„ç†Httpè¯·æ±‚çš„æ ¸å¿ƒç±»æ˜¯<code>CandyPreProcessor.java</code></li>
<li>è¯¥Appè°ƒç”¨åŠ å¯†soçš„JNIç±»æ˜¯ <code>CandyJni.java</code></li>
<li>è¯¥Appæ‰§è¡Œå‚æ•°åŠ å¯†çš„soæ˜¯<code>libmtguard.so</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class CandyJni&#10;&#123;&#10;  static&#10;  &#123;&#10;    System.loadLibrary(&#34;mtguard&#34;);&#10;  &#125;&#10;  &#10;  static native String getCandyDataWithKey(Object paramObject, byte[] paramArrayOfByte, String paramString);&#10;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="0x02_å°è¯•åŠ¨æ€è°ƒè¯•smali">0x02 å°è¯•åŠ¨æ€è°ƒè¯•smali</h3><p>è¿™é‡Œå…ˆä½¿ç”¨äº†æºapkåŒ…åœ¨rootæ‰‹æœºä¸Šè¿›è¡Œè°ƒè¯•ï¼Œä½†æ²¡æœ‰æˆåŠŸã€‚åªèƒ½å°è¯•é‡æ‰“åŒ…è°ƒè¯•ã€‚</p>
<h4 id="2-1ã€å¦‚ä½•ä½¿ç”¨ASåŠ¨æ€è°ƒè¯•">2.1ã€å¦‚ä½•ä½¿ç”¨ASåŠ¨æ€è°ƒè¯•</h4><p>å‚è€ƒ<a href="http://www.52pojie.cn/thread-502219-1-1.html" target="_blank" rel="external">å¾çˆ±ç ´è§£</a>è¿™ç¯‡æ–‡ç« ï¼Œéœ€è¦ä¸‹è½½AS baksmaliæ’ä»¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<ul>
<li>AS remote debugç«¯å£å·è®¾ç½®ä¸º8700</li>
<li>ASæ²¡æœ‰è¯†åˆ«å®‰å“ä»£ç æƒ…å†µä¸‹å·¥å…·æ æ²¡æœ‰Android Device monitorçš„æŒ‰é’®ï¼Œè¿™æ—¶å€™é€šè¿‡monitorå‘½ä»¤å¯åŠ¨monitor</li>
<li>å¦‚æœmonitorå¯åŠ¨æ—¶æç¤º8700ç«¯å£å·²ç»è¢«å ç”¨ï¼Œå¯ä»¥é€šè¿‡ <code>lsof -n -i4TCP:8700 | grep LISTEN</code> å‘½ä»¤æŸ¥çœ‹8700ç«¯å£ç›®å‰å¯¹åº”çš„è¿›ç¨‹å</li>
<li>attachå‰ä¸€å®šè¦å…ˆåœ¨monitoré‡Œé€‰ä¸­æƒ³è¦è°ƒè¯•çš„è¿›ç¨‹ï¼Œå†debug</li>
</ul>
<h4 id="2-2ã€é‡å†™Javaä»£ç ï¼Œç›´æ¥è°ƒç”¨åŠ å¯†so">2.2ã€é‡å†™Javaä»£ç ï¼Œç›´æ¥è°ƒç”¨åŠ å¯†so</h4><p>åŠ¨æ€è°ƒè¯•å¯ä»¥æ¯”è¾ƒæ¸…æ¥šçš„çœ‹åˆ°Javaå±‚çš„å†…éƒ¨è°ƒç”¨é€»è¾‘ï¼Œé€šè¿‡debug watchåŠŸèƒ½å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°å¯„å­˜å™¨å€¼ï¼Œç»“åˆåç¼–è¯‘å’Œé™æ€åˆ†æå¯ä»¥çŸ¥é“è°ƒç”¨nativeæ–¹æ³•çš„å…¥å‚æ ¼å¼ã€‚</p>
<p>ç°åœ¨çš„æ€è·¯æ˜¯è§£å‹å‡ºæºapkåŒ…ä¸­çš„soæ–‡ä»¶ï¼Œç¼–å†™javaä»£ç ç›´æ¥è°ƒç”¨soæ–‡ä»¶ä¸­çš„nativeæ–¹æ³•è·å–è®¡ç®—__skcyå‚æ•°ã€‚ä½†æµ‹è¯•çš„ç»“æœæ˜¯ä¸€ç›´è¿”å›<code>null</code>ã€‚è¿™é‡ŒçŒœæµ‹åœ¨nativeå±‚ä¸­å¯¹è¿è¡Œç¯å¢ƒåšäº†ç›‘æµ‹ï¼Œæ‰€ä»¥ä¸€ç›´è¿”å›ç©ºå€¼ã€‚</p>
<p>è¿™é‡Œè¯¥appçš„å‚æ•°ç­¾åè¯¦ç»†è¿‡ç¨‹æ˜¯ï¼Œé€šè¿‡<code>__skckã€__sktsã€__sknoã€__skua(è¯¦ç»†è§„åˆ™è§ä¸Š)</code>ï¼Œè°ƒç”¨<code>CandyPreprocessor.java</code>çš„<code>getParametersSignature()</code>æ–¹æ³•è·å–<code>__skcy</code>å‚æ•°ã€‚Javaå±‚æ ¸å¿ƒæ–¹æ³•<code>getParametersSignature()</code>å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10; * @param paramBuilder https://eapi.*****/api/poi/logon/acctdevice?__skck=6a375bce8c66a0dc293860dfa83833ef&#38;__skts=1486970558719&#38;__skua=d41d8cd98f00b204e9800998ecf8427e&#38;__skno=5ed4629c-098c-489c-b598-81841e0479e0&#10; */&#10;String getParametersSignature(Uri.Builder paramBuilder, Context paramContext) &#123;&#10;    if (paramBuilder == null) &#123;&#10;        throw new RuntimeException(&#34;CandyPreprocessor getParametersSignature builder is null&#34;);&#10;    &#125;&#10;    // &#33719;&#21462;&#32593;&#32476;&#25509;&#21475;&#21517;&#31216; https://eapi.waimai.meituan.com/api/poi/logon/acctdevice&#10;    Object localObject = baseString();&#10;    if (TextUtils.isEmpty((CharSequence) localObject)) &#123;&#10;        throw new RuntimeException(&#34;CandyPreprocessor getParametersSignature normalizedURI is null&#34;);&#10;    &#125;&#10;    ArrayList localArrayList = new ArrayList();&#10;    /**&#10;     * 0 = &#123;CandyPreprocessor$MyEntry@5016&#125; &#34;__skck&#34; -&#62; &#34;6a375bce8c66a0dc293860dfa83833ef&#34;&#10;     1 = &#123;CandyPreprocessor$MyEntry@5017&#125; &#34;__skts&#34; -&#62; &#34;1486970558719&#34;&#10;     2 = &#123;CandyPreprocessor$MyEntry@5018&#125; &#34;__skua&#34; -&#62; &#34;d41d8cd98f00b204e9800998ecf8427e&#34;&#10;     3 = &#123;CandyPreprocessor$MyEntry@5019&#125; &#34;__skno&#34; -&#62; &#34;5ed4629c-098c-489c-b598-81841e0479e0&#34;&#10;     */&#10;    // &#33719;&#21462;&#21442;&#25968;key&#21644;&#21442;&#25968;value&#25918;&#21040;&#25968;&#32452;&#20013;&#10;    appendList(localArrayList, paramBuilder, false);&#10;    // add &#34;__sksc&#34; -&#62; &#34;https&#34;&#10;    // &#33719;&#21462;scheme&#25918;&#20837;&#25968;&#32452;&#20013;&#10;    localArrayList.add(new CandyPreprocessor.MyEntry(&#34;__sksc&#34;, this.candyOriginalMaterial.getScheme()));&#10;    // &#23558;post content&#25918;&#20837;&#25968;&#32452;&#20013;&#10;    if (formURLEncoded()) &#123;&#10;        // /?dVersion=23_6.0&#38;utm_medium=android&#38;password=2222&#38;utm_content=867689027084732&#38;appCode=388&#38;acctId=&#38;wmPoiId=&#38;token=&#38;uuid=03EB35F2C93419DC64AFFBC9EF6BB6BADE4DD72DC1E2F4733198E91C91AEAF93&#38;logType=C&#38;appName=%E7%BE%8E%E5%9B%A2%E5%A4%96%E5%8D%96%E5%95%86%E5%AE%B6%E7%89%88&#38;appType=4&#38;dType=PLK-TL01H&#38;userName=1111&#38;utm_term=4.2.0.388&#38;utm_source=&#38;utm_campaign=&#38;wm_appversion=4.2.0.388&#38;&#10;        // post &#30340;&#20869;&#23481;&#20837;&#21442;&#10;        /**&#10;         * 5 = &#123;CandyPreprocessor$MyEntry@5071&#125; &#34;dVersion&#34; -&#62; &#34;23_6.0&#34;&#10;         6 = &#123;CandyPreprocessor$MyEntry@5072&#125; &#34;utm_medium&#34; -&#62; &#34;android&#34;&#10;         7 = &#123;CandyPreprocessor$MyEntry@5073&#125; &#34;password&#34; -&#62; &#34;123&#34;&#10;         8 = &#123;CandyPreprocessor$MyEntry@5074&#125; &#34;utm_content&#34; -&#62; &#34;867689027084732&#34;&#10;         9 = &#123;CandyPreprocessor$MyEntry@5075&#125; &#34;appCode&#34; -&#62; &#34;388&#34;&#10;         10 = &#123;CandyPreprocessor$MyEntry@5076&#125; &#34;acctId&#34; -&#62;&#10;         11 = &#123;CandyPreprocessor$MyEntry@5077&#125; &#34;wmPoiId&#34; -&#62;&#10;         12 = &#123;CandyPreprocessor$MyEntry@5078&#125; &#34;token&#34; -&#62;&#10;         13 = &#123;CandyPreprocessor$MyEntry@5079&#125; &#34;uuid&#34; -&#62; &#34;03EB35F2C93419DC64AFFBC9EF6BB6BADE4DD72DC1E2F4733198E91C91AEAF93&#34;&#10;         14 = &#123;CandyPreprocessor$MyEntry@5080&#125; &#34;logType&#34; -&#62; &#34;C&#34;&#10;         15 = &#123;CandyPreprocessor$MyEntry@5081&#125; &#34;appName&#34; -&#62; &#34;****&#34;&#10;         16 = &#123;CandyPreprocessor$MyEntry@5082&#125; &#34;appType&#34; -&#62; &#34;4&#34;&#10;         17 = &#123;CandyPreprocessor$MyEntry@5083&#125; &#34;dType&#34; -&#62; &#34;PLK-TL01H&#34;&#10;         18 = &#123;CandyPreprocessor$MyEntry@5084&#125; &#34;userName&#34; -&#62; &#34;***&#34;&#10;         19 = &#123;CandyPreprocessor$MyEntry@5085&#125; &#34;utm_term&#34; -&#62; &#34;4.2.0.388&#34;&#10;         20 = &#123;CandyPreprocessor$MyEntry@5086&#125; &#34;utm_source&#34; -&#62;&#10;         21 = &#123;CandyPreprocessor$MyEntry@5087&#125; &#34;utm_campaign&#34; -&#62;&#10;         22 = &#123;CandyPreprocessor$MyEntry@5088&#125; &#34;wm_appversion&#34; -&#62; &#34;4.2.0.388&#34;&#10;         */&#10;        appendList(localArrayList, Uri.parse(&#34;/?&#34; + new String(this.candyOriginalMaterial.getPostContent())).buildUpon(), true);&#10;    &#125;&#10;    // &#29305;&#27530;&#23383;&#31526;&#36716;&#30721;&#10;    List percentParamList = getPercentList(localArrayList);&#10;    // &#20998;&#21035;&#23545;Value&#21644;Key&#20570;&#21319;&#24207;&#25490;&#21015;&#10;    dictionarySort(percentParamList);&#10;    // &#23558;&#25490;&#24207;&#21518;&#30340;&#25968;&#32452;&#65292;&#25340;&#25509;&#25104;&#23383;&#31526;&#20018;__skck=6a375bce8c66a0dc293860dfa83833ef&#38;__skno=5ed4629c-098c-489c-b598-81841e0479e0&#38;__sksc=https&#38;__skts=1486970558719&#38;__skua=d41d8cd98f00b204e9800998ecf8427e&#38;acctId=&#38;appCode=388&#38;appName=%E7%BE%8E%E5%9B%A2%E5%A4%96%E5%8D%96%E5%95%86%E5%AE%B6%E7%89%88&#38;appType=4&#38;dType=PLK-TL01H&#38;dVersion=23_6.0&#38;logType=C&#38;password=2222&#38;token=&#38;userName=1111&#38;utm_campaign=&#38;utm_content=867689027084732&#38;utm_medium=android&#38;utm_source=&#38;utm_term=4.2.0.388&#38;uuid=03EB35F2C93419DC64AFFBC9EF6BB6BADE4DD72DC1E2F4733198E91C91AEAF93&#38;wmPoiId=&#38;wm_appversion=4.2.0.388&#10;    String paramBuilderString = getNormalizedParameters(percentParamList);&#10;    // POST+&#31354;&#26684;+&#34;&#25509;&#21475;&#21517;&#31216;&#34;+&#31354;&#26684;+&#34;&#21442;&#25968;&#20869;&#23481;&#34;&#10;    // POST http://eapi.waimai.meituan.com/api/poi/logon/acctdevice __skck=6a375bce8c66a0dc293860dfa83833ef&#38;__skno=57749130-26d4-4239-8abd-b99c16584908&#38;__sksc=http&#38;__skts=1486995346041&#38;__skua=d41d8cd98f00b204e9800998ecf8427e&#38;acctId=&#38;appCode=388&#38;appName=%E7%BE%8E%E5%9B%A2%E5%A4%96%E5%8D%96%E5%95%86%E5%AE%B6%E7%89%88&#38;appType=4&#38;dType=PLK-TL01H&#38;dVersion=23_6.0&#38;logType=C&#38;password=2222&#38;token=&#38;userName=1111&#38;utm_campaign=&#38;utm_content=867689027084732&#38;utm_medium=android&#38;utm_source=&#38;utm_term=4.2.0.388&#38;uuid=03EB35F2C93419DC64AFFBC9EF6BB6BADE4DD72DC1E2F4733198E91C91AEAF93&#38;wmPoiId=&#38;wm_appversion=4.2.0.388&#10;    paramBuilderString = this.candyOriginalMaterial.getHttpMethod() + &#34; &#34; + (String) localObject + &#34; &#34; + paramBuilderString;&#10;    // JV1EOT1VZGN8USskB3jZYnVGyyQ=&#10;    // &#35843;&#29992;jni&#33719;&#21462;&#21152;&#23494;&#21518;&#30340;&#21442;&#25968;&#20540;__skcy&#10;    localObject = CandyJni.getCandyDataWithKey(paramContext, paramBuilderString.getBytes(), &#34;candyKey&#34;);&#10;&#10;    // TODO for test&#10;    return (String) localObject;&#10; &#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3ã€ä¿®æ”¹appä»£ç ï¼Œé‡æ‰“åŒ…è°ƒç”¨so">2.3ã€ä¿®æ”¹appä»£ç ï¼Œé‡æ‰“åŒ…è°ƒç”¨so</h4><p>ç›´æ¥è°ƒç”¨soçš„æ–¹æ³•å¤±è´¥äº†ï¼Œç°åœ¨å°è¯•åç¼–è¯‘APKåï¼ŒåŠ å…¥åŒ…å«è‡ªå·±é€»è¾‘çš„smaliä»£ç ï¼Œè°ƒç”¨CandyJniçš„ç›®çš„ã€‚å…·ä½“çš„æ­¥éª¤æ˜¯ï¼š</p>
<ul>
<li>åˆ©ç”¨ä¸Š2.2çš„é¡¹ç›®ï¼Œæ‹·è´å’Œè¯¥App CandyJniå®Œå…¨ç›¸åŒçš„ç±»åï¼Œæ–¹æ³•åã€‚</li>
<li>ç¼–å†™CandyHackActivity.Javaå’ŒCandyHack.javaï¼Œå»è°ƒç”¨æ–°é¡¹ç›®ä¸­çš„CandyJniï¼Œå¹¶æ‰“åŒ…ã€‚</li>
<li>apktoolsåç¼–è¯‘æ–°é¡¹ç›®åŒ…ï¼Œè·å–CandyHack.smali å’ŒCandyHackActivity.smaliã€‚</li>
<li>ä¿®æ”¹åç¼–è¯‘åé¡¹ç›®çš„AndroidManifest.xmlæ–‡ä»¶ï¼Œå°†CandyHackActivityæ³¨å†Œåˆ°manifestä¸­è¿›å»ã€‚</li>
<li>é‡æ‰“åŒ…ï¼Œç­¾åï¼Œå®‰è£…ã€‚</li>
<li>é€šè¿‡adbå‘½ä»¤å¯åŠ¨CandyHackActivityã€‚</li>
</ul>
<p><img src="/res/meituan_hack/meituan_smali1.png" alt=""></p>
<p>ç»“æœä¸€ç‚¹ä¸æ„å¤–ï¼Œèƒ½å¤ŸæˆåŠŸè°ƒç”¨CandyJniä¸­çš„æ–¹æ³•å¹¶ä¸”æœ‰è¿”å›å€¼ï¼Œä½†æ˜¯ç»è¿‡æµ‹è¯•åœ¨ç›¸åŒå…¥å‚çš„æƒ…å†µä¸‹ï¼Œå’ŒæºAPKåŒ…çš„åŠ å¯†ç»“æœä¸ä¸€è‡´ã€‚é—®é¢˜åº”è¯¥å‡ºåœ¨ç­¾åã€‚çŒœæµ‹åº”è¯¥æ˜¯soä¸­çš„æ–¹æ³•å°†åº”ç”¨ç­¾åä½œä¸ºäº†ä¸€ä¸ªåŠ å¯†å‚æ•°ã€‚è™½ç„¶èƒ½æ­£å¸¸è°ƒç”¨ï¼Œä½†ç»“æœæ˜¯é”™çš„~~</p>
<h4 id="2-4ã€å°è¯•IDA_proåç¼–è¯‘so">2.4ã€å°è¯•IDA proåç¼–è¯‘so</h4><p>ä¸€å¥è¯ï¼ŒIDAåç¼–è¯‘åå‘ç°ï¼Œåœ¨functionçª—å£ä¸­æ‰¾ä¸åˆ°getCandyDataWithKeyæˆ–è€…getCandyDataè¿™äº›åœ¨Javaå±‚å£°æ˜çš„nativeæ–¹æ³•ã€‚åº”è¯¥æ˜¯ä½¿ç”¨äº†åŠ¨æ€æ³¨å†Œçš„æ–¹å¼æ³¨å†Œäº†nativeæ–¹æ³•ï¼Œåˆä¸€æ¬¡æŠŠä»£ç é˜…è¯»é—¨æ§›ä»Cå‡çº§åˆ°äº†æ±‡ç¼–ï¼Œæ³ªç›®~~~</p>
<p><img src="/res/meituan_hack/meituan_ida.jpeg" alt="nativeæ–¹æ³•æ··æ·†"></p>
<h4 id="2-5ã€æ€»ç»“é—®é¢˜">2.5ã€æ€»ç»“é—®é¢˜</h4><ul>
<li>æƒ³è¦åœ¨rootæœºå™¨ä¸ŠåŠ¨æ€è°ƒè¯•dexï¼Œä½†ä¸è¿›è¡Œé‡æ‰“åŒ…ï¼Œå°±éœ€è¦ç»•è¿‡ä»–çš„åè°ƒè¯•æ‰‹æ®µã€‚åè°ƒè¯•æ‰‹æ®µæ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆç»•è¿‡ï¼Ÿæˆ‘ä¸çŸ¥é“</li>
<li>æƒ³è¦é€šè¿‡é‡æ‰“åŒ…åŠ¨æ€è°ƒè¯•dexï¼Œé‡æ‰“åŒ…å¿…é¡»é‡æ–°ç­¾åï¼Œé‡æ–°ç­¾åä¼šå¯¼è‡´åŠ å¯†ç®—æ³•è®¡ç®—ç»“æœå‡ºé”™ã€‚</li>
<li>æƒ³è¦åç¼–è¯‘soï¼Œéœ€è¦é˜…è¯»åŠ å¯†åçš„Cè¯­è¨€å’Œæ±‡ç¼–è¯­è¨€ã€‚æ±—ï¼æˆ‘æ˜¯èœé¸Ÿæ±‡ç¼–é˜…è¯»ä¸æ¥</li>
</ul>
<h3 id="0x03_ä¸‡é‡‘æµç ´è§£æ€è·¯">0x03 ä¸‡é‡‘æµç ´è§£æ€è·¯</h3><p>æ ¹æ®ä»¥ä¸Šåˆ†æçš„è¿‡ç¨‹ï¼Œå‘ç°ä¸ç®¡æ˜¯é‡æ‰“åŒ…ã€å€Ÿç”¨soã€é™æ€åˆ†æã€åŠ¨æ€è°ƒè¯•ç­‰åŸºç¡€çš„ç ´è§£æ–¹å¼ï¼Œè¯¥appéƒ½åšäº†ç›¸åº”çš„é˜²æŠ¤æªæ–½ï¼Œæ€»çš„ç ´è§£æ€è·¯éƒ½æ˜¯ç ´åäº†appåŸæœ‰ç¯å¢ƒã€‚åœ¨ä¸€æ¬¡é€›å®‰å…¨è®ºå›çš„è¿‡ç¨‹ä¸­ï¼Œçœ‹åˆ°é€šè¿‡ä¿®æ”¹AndroidåŸç”Ÿä»£ç åŠ è½½ç‰¹å®šsoçš„æ€è·¯ï¼Œå…¶å®è¿™ç§ç ´è§£æ€è·¯ä¹Ÿé€‚ç”¨äºappçš„ç ´è§£ã€‚å¦‚æœåœ¨appå¯åŠ¨æ—¶ï¼Œè®©appè¿›ç¨‹çš„DexClassLoaderèƒ½å¤ŸåŠ è½½ä½ è‡ªå·±çš„ä»£ç ï¼Œé‚£ä¹ˆä¸ç®¡åœ¨ä»»ä½•çš„appè¿è¡Œç¯å¢ƒä¸­ï¼Œè¯¸å¦‚ä¿®æ”¹å†…å­˜å˜é‡ã€è°ƒç”¨æ–¹æ³•æˆ–è€…æ˜¯æ”¹å˜åŸæœ‰appç³»ç»Ÿçš„å¤„ç†æµç¨‹ç­‰ç›®çš„éƒ½èƒ½å¤Ÿè½»æ¾è¾¾åˆ°ã€‚å½“ç„¶å‰ææ˜¯è¿è¡Œåœ¨è‡ªå·±ç¼–è¯‘çš„Androidæºç æˆ–è€…æ˜¯å·²ç»rootçš„æœºå™¨ä¸Šã€‚ä¸‹é¢å°±ä»¥è¿™ä¸ªæ€è·¯é’ˆå¯¹è¯¥å¤–å–appåšå…·ä½“çš„ç ´è§£å®æ“ï¼Œç›®æ ‡æ˜¯åœ¨pcä¸Šèƒ½å¤Ÿè‡ªç”±è°ƒç”¨è¯¥appæœåŠ¡ç«¯çš„httpæ¥å£ã€‚</p>
<h4 id="3-1-_ä¸‹è½½å¹¶ä¿®æ”¹æºç ">3.1. ä¸‹è½½å¹¶ä¿®æ”¹æºç </h4><p>å¦‚ä½•ä¸‹è½½ç¼–è¯‘æºç è¿™é‡Œä¸åºŸè¯ï¼Œæ²¡æœ‰å°è¯•è¿‡çš„å¯ä»¥å‚è€ƒè¿™ç¯‡<a href="http://ivonhoe.github.io/2017/01/20/MacOS%E4%B8%8A%E7%BC%96%E8%AF%91Android%E6%BA%90%E7%A0%81/">ã€ŠMac OSä¸Šç¼–è¯‘Androidæºç ã€‹</a>ã€‚<br>åœ¨<code>ActivityThread.java</code>çš„<code>handleBindApplication()</code>æ–¹æ³•ä¸­å¢åŠ dexæ³¨å…¥çš„é€»è¾‘ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private void handleBindApplication(AppBindData data) &#123;&#10;    // &#30465;&#30053;&#28304;&#30721;...&#10;    &#10;    //=================&#20840;&#23616;&#27880;&#20837;&#20043;&#20462;&#25913;java&#23618;===================================================&#10;    checkFrameworkInject(data.processName);&#10;    //=============================================================================&#10;&#125;&#10;&#10;private void checkFrameworkInject(String processName) &#123;&#10;    //=================&#20840;&#23616;&#27880;&#20837;&#20043;&#20462;&#25913;java&#23618;===================================================&#10;    Log.e(&#34;frameworkInjector&#34;, &#34;--processName=&#34; + processName);&#10;    invokeJarLoader(processName);&#10;    //=============================================================================&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>ä»æŒ‡å®šè·¯å¾„åŠ è½½é…ç½®æ–‡ä»¶ï¼Œé…ç½®ä¿¡æ¯åŒ…æ‹¬è¦dexæ³¨å…¥çš„è¿›ç¨‹åï¼Œdexè·¯å¾„ï¼Œdexä¸­mainå‡½æ•°ä¿¡æ¯ã€‚<br>å½“ç›¸åº”çš„è¿›ç¨‹å¯åŠ¨æ—¶ï¼ŒåŠ è½½æŒ‡å®šè·¯å¾„çš„dexï¼Œå¹¶è¿ç”¨å…¶ä¸­çš„mainå‡½æ•°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10;     * &#26681;&#25454;&#37197;&#32622;&#21152;&#36733;jar&#65292;&#25191;&#34892;&#25351;&#23450;&#31867;&#30340;main&#26041;&#27861;&#10;     */&#10;    public void invokeJarLoader(String processName) &#123;&#10;        List&#60;String&#62; config = readHookConfig(&#34;/data/local/jarHookConfig.txt&#34;);&#10;&#10;        if (config == null || config.size() &#60; 3) &#123;&#10;            return;&#10;        &#125;&#10;&#10;        String configProcessName = config.get(0);&#10;        String configJarPath = config.get(1);&#10;        String configClassName = config.get(2);&#10;&#10;        if (processName.equals(configProcessName) &#38;&#38; !TextUtils.isEmpty(configJarPath)&#10;                &#38;&#38; !TextUtils.isEmpty(configClassName)) &#123;&#10;            Log.e(&#34;frameworkInjector&#34;, &#34;targetPackage:&#34; + configProcessName +&#10;                    &#34;,start-load-jarPath&#34; + configJarPath + &#34;, class name:&#34; + configClassName);&#10;            jarInvokeTest(configJarPath, configClassName);&#10;        &#125;&#10;    &#125;&#10;&#10;    public void jarInvokeTest(String jarPath, String className) &#123;&#10;        final File optimizedDexOutputPath = new File(jarPath);&#10;        Context context = getApplication();&#10;        File dexOutputDir = context.getDir(&#34;dex&#34;, 0);&#10;        DexClassLoader cl = new DexClassLoader(&#10;                optimizedDexOutputPath.getAbsolutePath(),&#10;                dexOutputDir.getAbsolutePath(), null, context.getClassLoader());&#10;        Class libProviderClazz = null;&#10;&#10;        try &#123;&#10;            libProviderClazz = cl.loadClass(className);&#10;            Method method = libProviderClazz.getMethod(&#34;main&#34;);&#10;            method.invoke(null, (Object[]) null);&#10;        &#125; catch (ClassNotFoundException e) &#123;&#10;            e.printStackTrace();&#10;        &#125; catch (IllegalAccessException e) &#123;&#10;            e.printStackTrace();&#10;        &#125; catch (NoSuchMethodException e) &#123;&#10;            e.printStackTrace();&#10;        &#125; catch (InvocationTargetException e) &#123;&#10;            e.printStackTrace();&#10;        &#125;&#10;    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-2_ç”Ÿæˆæ³¨å…¥çš„dex">3.2 ç”Ÿæˆæ³¨å…¥çš„dex</h4><p>åœ¨è¿™é‡Œå…·ä½“çš„æ³¨å…¥ä»£ç å°±ä¸å•°å—¦äº†ï¼Œæ€»çš„æ¥è¯´ä½ å¯ä»¥é’ˆå¯¹ä»»ä½•appä¸­çš„ä»»ä½•æ–¹æ³•å˜é‡ä»»æ„æ“ä½œã€‚å¦‚æœä½ æƒ³åœ¨pcä¸Šå®ç°è¯·æ±‚çš„è‡ªç”±æ”¶å‘è¦ç¨å¾®å¤æ‚äº›ï¼Œä½ éœ€è¦å®ç°ä¸€ä¸ªç®€å•çš„Hook socket serverï¼ˆç®€ç§°HSSï¼‰ï¼Œå°†HSSæ‰“åŒ…æˆdexåšæ³¨å…¥ï¼Œå°†å‚ä¸å‚æ•°åŠ å¯†çš„æ•°æ®å‘é€ç»™HSSï¼ŒHSSè°ƒç”¨appä¸­çš„åŠ å¯†æ–¹æ³•è·å–åŠ å¯†ç»“æœï¼Œå¹¶å°†æœ€ç»ˆçš„åŠ å¯†ç»“æœå‘é€å‡ºæ¥å°±å¯ä»¥å•¦ã€‚å…·ä½“çš„å®ç°å¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<p><img src="/res/meituan_hack/meituan_hook.png" alt="hookç»“æ„å›¾"></p>
<h3 id="0x04_ä¸¥é‡å£°æ˜">0x04 ä¸¥é‡å£°æ˜</h3><p><strong>æœ¬æ–‡çš„æ„å›¾åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯é€šè¿‡åˆ†æappå­¦ä¹ æ›´å¤šçš„é€†å‘æŠ€æœ¯ï¼Œå¦‚æœæœ‰äººåˆ©ç”¨æœ¬æ–‡çŸ¥è¯†å’ŒæŠ€æœ¯è¿›è¡Œéæ³•æ“ä½œè¿›è¡Œç‰Ÿåˆ©ï¼Œå¸¦æ¥çš„ä»»ä½•æ³•å¾‹è´£ä»»éƒ½å°†ç”±æ“ä½œè€…æœ¬äººæ‰¿æ‹…ï¼Œå’Œæœ¬æ–‡ä½œè€…æ— ä»»ä½•å…³ç³»ï¼Œæœ€ç»ˆè¿˜æ˜¯å¸Œæœ›å¤§å®¶èƒ½å¤Ÿç§‰ç€å­¦ä¹ çš„å¿ƒæ€é˜…è¯»æ­¤æ–‡ã€‚</strong></p>
<h3 id="0x05_å‚è€ƒæ–‡æ¡£">0x05 å‚è€ƒæ–‡æ¡£</h3><ul>
<li><a href="http://www.jianshu.com/p/730c6e3e21f6" target="_blank" rel="external">Smaliè¯­æ³•</a></li>
<li><a href="http://blog.csdn.net/niexinming/article/details/54318634" target="_blank" rel="external">é€†å‘åŠ å›ºçš„apkè¯¦ç»†æ•™ç¨‹</a></li>
<li><a href="http://www.52pojie.cn/thread-564459-1-1.html" target="_blank" rel="external">ä¿®æ”¹æºç å®ç°å…¨å±€(æ— éœ€root)æ³¨å…¥èº²å¼€æ³¨å…¥æ£€æµ‹</a></li>
<li><a href="http://www.jianshu.com/p/6438f161875a" target="_blank" rel="external">AndroidåŠ¨æ€åŠ è½½jar</a></li>
<li><a href="http://www.jianshu.com/p/61cfa1347894" target="_blank" rel="external">Javaä¹‹jaræ‰“åŒ…</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;0x00_å‰è¨€&quot;&gt;0x00 å‰è¨€&lt;/h3&gt;&lt;p&gt;æœ¬æ–‡è®°å½•äº†ç ´è§£æŸå¤–å–App httpè¯·æ±‚å‚æ•°åŠ å¯†è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ€è·¯ï¼Œå®ç°çš„ç›®æ ‡æ˜¯å¸Œæœ›æ˜¯èƒ½å¤Ÿé€šè¿‡ä¸€äº›æ‰‹æ®µå®ç°è‡ªç”±è°ƒç”¨å…¶æœåŠ¡æ¥å£ã€‚&lt;br&gt;è¿™ç¯‡æ–‡ç« ä¸»è¦è®²è¿°ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é™æ€åˆ†æå’ŒåŠ¨æ€è°ƒè¯•çš„åŸºæœ¬æ–¹æ³•å’Œé‡åˆ°çš„é—®é¢˜&lt;/li&gt;
&lt;li&gt;å¦‚ä½•å¬è¿‡ä¿®æ”¹androidæºç å®ç°å…¨å±€hook&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&quot;/res/meituan_hack/meituan-1.png&quot; alt=&quot;æƒ³è¦ç ´è§£çš„ç½‘ç»œè¯·æ±‚&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ç§»åŠ¨å®‰å…¨" scheme="https://ivonhoe.github.io/categories/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="Android" scheme="https://ivonhoe.github.io/tags/Android/"/>
    
      <category term="ç§»åŠ¨å®‰å…¨" scheme="https://ivonhoe.github.io/tags/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>æ•è·çº¿ç¨‹æ± ä»»åŠ¡å¼‚å¸¸å¼•å‘çš„è¡€æ¡ˆ</title>
    <link href="https://ivonhoe.github.io/2017/05/12/executor-eat-exception/"/>
    <id>https://ivonhoe.github.io/2017/05/12/executor-eat-exception/</id>
    <published>2017-05-12T08:41:53.000Z</published>
    <updated>2018-05-27T08:23:47.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€å‰è¨€">ä¸€ã€å‰è¨€</h3><p>ä»Šå¤©é‡åˆ°ä¸€ä¸ªå¾ˆè¯¡å¼‚çš„é—®é¢˜ï¼Œåœ¨å¤šæ¬¾Android 4.2.2ç‰ˆæœ¬çš„æ‰‹æœºä¸Šå‘ç°å¤„ç†åå°ä»»åŠ¡çš„æœåŠ¡å¯¹å‰å°è¯·æ±‚æ¯«æ— å“åº”ã€‚è¿™é‡Œçš„åå°æœåŠ¡æ˜¯ä¸€ä¸ªRemoteServiceï¼Œç›®çš„ä¸ºäº†å¤„ç†æ›´æ–°&amp;ä¸Šä¼ ç­‰ä»»åŠ¡ã€‚æœ¬æ¥ä»¥ä¸ºæ˜¯è·¨è¿›ç¨‹ç»„ä»¶é—´é€šè®¯å‡ºç°å…¼å®¹æ€§é—®é¢˜ï¼Œåæ¥æ ¹æ®åˆ†æå‘ç°é—®é¢˜æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œè¿™é‡Œè®°å½•ä¸‹é—®é¢˜åŸå› ã€‚</p>
<a id="more"></a>
<h3 id="äºŒã€ç¬¬ä¸€ä¸ªé”™è¯¯">äºŒã€ç¬¬ä¸€ä¸ªé”™è¯¯</h3><p>åœ¨åå°æœåŠ¡å¤„ç†ä»»åŠ¡è¯·æ±‚æ—¶ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± å¤„ç†å¼‚æ­¥æ›´æ–°ä»»åŠ¡ï¼Œè€ŒJava çº¿ç¨‹æ± java.util.concurrent.ThreadPoolExecutorä¼šæŠ“ä½æ‰€æœ‰çš„è¿è¡Œæ—¶å¼‚å¸¸ï¼Œå³ä¾¿æ˜¯ä½ è¿è¡Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç ä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Runnable runnable = new Runnable() &#123;&#10;    @Override&#10;    public void run() &#123;&#10;        Test test = null;&#10;        System.out.println(test.toString());&#10;    &#125;&#10;&#125;;&#10;&#10;mExecutor.submit(runnable);</span><br></pre></td></tr></table></figure>
<p>åœ¨å¤„ç†çº¿ç¨‹æ± å¼‚å¸¸æ•è·çš„é—®é¢˜æ—¶ï¼ŒçŠ¯ä¸‹äº†ç¬¬ä¸€ä¸ªé”™è¯¯ï¼Œä½¿ç”¨äº†ä¸‹é¢çš„submitæ–¹æ³•å®Œæˆå¤šçº¿ç¨‹ä»»åŠ¡æ—¶ä¼šé˜»å¡å½“å‰çº¿ç¨‹ä»¥æ‹¿åˆ°ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œå¯èƒ½é˜»å¡çš„æ–¹æ³•<code>future.get()</code>è·å–å¼‚å¸¸è®©çº¿ç¨‹æ± å˜å¾—æ²¡æœ‰æ„ä¹‰ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public Future&#60;?&#62; submit(Runnable task) &#123;&#10;    Future&#60;?&#62; future = mExecutor.submit(task);&#10;    try &#123;&#10;        future.get();&#10;    &#125; catch (InterruptedException e) &#123;&#10;        Thread.currentThread().interrupt(); // Reset interrupted status&#10;    &#125; catch (ExecutionException e) &#123;&#10;        Throwable exception = e.getCause();&#10;        // Forward to exception reporter&#10;        if (exception instanceof UncatchException) &#123;&#10;            throw (UncatchException) exception;&#10;        &#125;&#10;    &#125;&#10;&#10;    return future;&#10;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸‰ã€ç¬¬äºŒä¸ªé”™è¯¯">ä¸‰ã€ç¬¬äºŒä¸ªé”™è¯¯</h3><p>åœ¨é”™è¯¯ä¸€çš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨äº†ä¸€ä¸ªå¼€æºå¹¶å‘åº“<a href="https://github.com/litesuits/android-lite-go" target="_blank" rel="external">android-lite-go</a>ï¼Œå…ˆçœ‹å®ƒçš„å¼‚æ­¥ä»»åŠ¡æ˜¯å¦‚ä½•è°ƒåº¦çš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int coreSize = CPU_CORE;&#10;int queueSize = coreSize * 32;&#10;&#10;synchronized (lock) &#123;&#10;    if (runningList.size() &#60; coreSize) &#123;&#10;        runningList.add(scheduler);&#10;        threadPool.execute(scheduler);&#10;    &#125; else if (waitingList.size() &#60; queueSize) &#123;&#10;        waitingList.addLast(scheduler);&#10;    &#125; else &#123;&#10;       //...&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å½“æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡æ•°å°äºè®¾å®šçš„coreSizeæ—¶ï¼Œsubmitçš„ä»»åŠ¡ä¼šæäº¤åˆ°çº¿ç¨‹æ± ã€‚</li>
<li>coreSizeç”±ç³»ç»Ÿæ ¸å¿ƒæ•°ç¡®å®šã€‚</li>
<li>å½“æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡æ•°å°äºqueueSizeæ—¶ï¼Œsubmitçš„ä»»åŠ¡ä¼šæäº¤åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚</li>
<li>å½“ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œåï¼Œä¼šä»ç­‰å¾…é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± æ‰§è¡Œã€‚</li>
</ul>
<p>åœ¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ä¸­ä½¿ç”¨é˜»å¡å½“å‰çº¿ç¨‹çš„æ–¹æ³•ï¼ŒæŠŠå¦ä¸€ä¸ªä»»åŠ¡æäº¤ç»™äº†executorã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private void runTaskOne() &#123;&#10;    Runnable runnable = new Runnable() &#123;&#10;        @Override&#10;        public void run() &#123;&#10;            // do something&#10;            runTaskTwo();&#10;        &#125;&#10;    &#125;;&#10;&#10;    mTaskController.submit(runnable);&#10;&#125;&#10;&#10;private void runTaskTwo() &#123;&#10;    Runnable runnable = new Runnable() &#123;&#10;        @Override&#10;        public void run() &#123;&#10;            // do task2&#10;            // ......&#10;        &#125;&#10;    &#125;;&#10;&#10;    mTaskController.submit(runnable);&#10;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸‰ã€é—®é¢˜åŸå› åŠè§£å†³æ–¹æ¡ˆ">ä¸‰ã€é—®é¢˜åŸå› åŠè§£å†³æ–¹æ¡ˆ</h3><p>å½“æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ä½¿ç”¨é˜»å¡å½“å‰è¿›ç¨‹çš„submitæ–¹æ³•æäº¤å¦ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æ—¶ï¼Œåæäº¤çš„ä»»åŠ¡è¢«æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ç­‰å¾…çº¿ç¨‹æ± æ‰§è¡Œï¼Œä½†åœ¨Running listä¸­çš„ä»»åŠ¡åˆåœ¨ç­‰å¾…åä»»åŠ¡æ‰§è¡Œçš„ç»“æœï¼Œè¿™æ ·å°±é€ æˆäº†æ­»é”ï¼ï¼è¿™ä¸ªé—®é¢˜è·ŸAndroidç³»ç»Ÿç‰ˆæœ¬å¹¶æ²¡æœ‰å…³ç³»ï¼Œä½†å› ä¸ºAndroid 4.2.2ç‰ˆæœ¬çš„æ‰‹æœºä½ç«¯è¾ƒå¤šæ ¸å¿ƒæ•°è¾ƒå°‘ï¼Œæ‰€ä»¥runningListçš„å¤§å°å°±æ¯”è¾ƒå°ï¼ŒRunning Listå¾ˆå®¹æ˜“å°±è¢«å¡«æ»¡ã€‚</p>
<p><img src="/res/deadlock/deadlock.png" alt=""></p>
<h4 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h4><ol>
<li>ä½¿ç”¨éé˜»å¡çš„æ–¹æ³•æäº¤å¼‚æ­¥ä»»åŠ¡</li>
<li>è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œé‡å†™<code>afterExecute()</code>æ–¹æ³•ï¼Œåœ¨è¯¥ä¸­è·å–çº¿ç¨‹æ± è¿è¡Œçš„å¼‚æ­¥ä»»åŠ¡è¿è¡Œæ—¶å¼‚å¸¸ã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(11, 100, 1, TimeUnit.MINUTES, //&#10;        new ArrayBlockingQueue&#60;Runnable&#62;(10000),//&#10;        new DefaultThreadFactory()) &#123;&#10;&#10;    protected void afterExecute(Runnable r, Throwable t) &#123;&#10;        super.afterExecute(r, t);&#10;        printException(r, t);&#10;    &#125;&#10;&#125;;&#10;&#10;private static void printException(Runnable r, Throwable t) &#123;&#10;    if (t == null &#38;&#38; r instanceof Future&#60;?&#62;) &#123;&#10;        try &#123;&#10;            Future&#60;?&#62; future = (Future&#60;?&#62;) r;&#10;            if (future.isDone())&#10;                future.get();&#10;        &#125; catch (CancellationException ce) &#123;&#10;            t = ce;&#10;        &#125; catch (ExecutionException ee) &#123;&#10;            t = ee.getCause();&#10;        &#125; catch (InterruptedException ie) &#123;&#10;            Thread.currentThread().interrupt(); // ignore/reset&#10;        &#125;&#10;    &#125;&#10;    if (t != null)&#10;        log.error(t.getMessage(), t);&#10;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å››ã€å‚è€ƒæ–‡æ¡£">å››ã€å‚è€ƒæ–‡æ¡£</h3><ol>
<li><a href="http://imxylz.com/blog/2013/08/02/handling-the-uncaught-exception-of-java-thread-pool/" target="_blank" rel="external">æ•è·Javaçº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡æŠ›å‡ºçš„å¼‚å¸¸
</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä¸€ã€å‰è¨€&quot;&gt;ä¸€ã€å‰è¨€&lt;/h3&gt;&lt;p&gt;ä»Šå¤©é‡åˆ°ä¸€ä¸ªå¾ˆè¯¡å¼‚çš„é—®é¢˜ï¼Œåœ¨å¤šæ¬¾Android 4.2.2ç‰ˆæœ¬çš„æ‰‹æœºä¸Šå‘ç°å¤„ç†åå°ä»»åŠ¡çš„æœåŠ¡å¯¹å‰å°è¯·æ±‚æ¯«æ— å“åº”ã€‚è¿™é‡Œçš„åå°æœåŠ¡æ˜¯ä¸€ä¸ªRemoteServiceï¼Œç›®çš„ä¸ºäº†å¤„ç†æ›´æ–°&amp;amp;ä¸Šä¼ ç­‰ä»»åŠ¡ã€‚æœ¬æ¥ä»¥ä¸ºæ˜¯è·¨è¿›ç¨‹ç»„ä»¶é—´é€šè®¯å‡ºç°å…¼å®¹æ€§é—®é¢˜ï¼Œåæ¥æ ¹æ®åˆ†æå‘ç°é—®é¢˜æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œè¿™é‡Œè®°å½•ä¸‹é—®é¢˜åŸå› ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å…¶ä»–" scheme="https://ivonhoe.github.io/categories/%E5%85%B6%E4%BB%96/"/>
    
    
      <category term="å¤šçº¿ç¨‹" scheme="https://ivonhoe.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
      <category term="æ­»é”" scheme="https://ivonhoe.github.io/tags/%E6%AD%BB%E9%94%81/"/>
    
  </entry>
  
  <entry>
    <title>Androidæ€§èƒ½ä¼˜åŒ–ä¹‹ä¸€åˆ€æµä¼˜åŒ–[æŒç»­æ›´æ–°]</title>
    <link href="https://ivonhoe.github.io/2017/05/05/android-performance-tips/"/>
    <id>https://ivonhoe.github.io/2017/05/05/android-performance-tips/</id>
    <published>2017-05-05T14:59:14.000Z</published>
    <updated>2018-05-27T08:20:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä½¿ç”¨windowBackgroundå®ç°åº”ç”¨ç§’å¼€">ä½¿ç”¨windowBackgroundå®ç°åº”ç”¨ç§’å¼€</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;style name=&#34;SplashTheme&#34; parent=&#34;@android:style/Theme.Black.NoTitleBar.Fullscreen&#34;&#62;&#10;    &#60;item name=&#34;android:windowBackground&#34;&#62;@drawable/bg_splash_activity&#60;/item&#62;&#10;    &#60;item name=&#34;@android:windowAnimationStyle&#34;&#62;@style/myact&#60;/item&#62;&#10;&#60;/style&#62;</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨windowBackgroundå‡å°‘è¿‡åº¦ç»˜åˆ¶">ä½¿ç”¨windowBackgroundå‡å°‘è¿‡åº¦ç»˜åˆ¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;style name=&#34;AppMainTheme&#34; parent=&#34;@android:style/Theme.Holo.Light&#34;&#62;&#10;    &#60;item name=&#34;android:windowBackground&#34;&#62;@color/white&#60;/item&#62;&#10;    &#60;item name=&#34;android:windowNoTitle&#34;&#62;true&#60;/item&#62;&#10;    &#60;item name=&#34;@android:windowAnimationStyle&#34;&#62;@style/myact&#60;/item&#62;&#10;&#60;/style&#62;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p><img src="/res/performance-tips/overdraw.png" alt="ä½¿ç”¨windowBackgroundå‰åå¯¹æ¯”"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä½¿ç”¨windowBackgroundå®ç°åº”ç”¨ç§’å¼€&quot;&gt;ä½¿ç”¨windowBackgroundå®ç°åº”ç”¨ç§’å¼€&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#60;style name=&amp;#34;SplashTheme&amp;#34; parent=&amp;#34;@android:style/Theme.Black.NoTitleBar.Fullscreen&amp;#34;&amp;#62;&amp;#10;    &amp;#60;item name=&amp;#34;android:windowBackground&amp;#34;&amp;#62;@drawable/bg_splash_activity&amp;#60;/item&amp;#62;&amp;#10;    &amp;#60;item name=&amp;#34;@android:windowAnimationStyle&amp;#34;&amp;#62;@style/myact&amp;#60;/item&amp;#62;&amp;#10;&amp;#60;/style&amp;#62;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;ä½¿ç”¨windowBackgroundå‡å°‘è¿‡åº¦ç»˜åˆ¶&quot;&gt;ä½¿ç”¨windowBackgroundå‡å°‘è¿‡åº¦ç»˜åˆ¶&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#60;style name=&amp;#34;AppMainTheme&amp;#34; parent=&amp;#34;@android:style/Theme.Holo.Light&amp;#34;&amp;#62;&amp;#10;    &amp;#60;item name=&amp;#34;android:windowBackground&amp;#34;&amp;#62;@color/white&amp;#60;/item&amp;#62;&amp;#10;    &amp;#60;item name=&amp;#34;android:windowNoTitle&amp;#34;&amp;#62;true&amp;#60;/item&amp;#62;&amp;#10;    &amp;#60;item name=&amp;#34;@android:windowAnimationStyle&amp;#34;&amp;#62;@style/myact&amp;#60;/item&amp;#62;&amp;#10;&amp;#60;/style&amp;#62;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://ivonhoe.github.io/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://ivonhoe.github.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>Androidæ€§èƒ½ä¼˜åŒ–ä¹‹ç³»ç»Ÿèµ„æºé¢„åŠ è½½çš„æ€è€ƒ</title>
    <link href="https://ivonhoe.github.io/2017/04/26/Zygote-2/"/>
    <id>https://ivonhoe.github.io/2017/04/26/Zygote-2/</id>
    <published>2017-04-25T16:49:27.000Z</published>
    <updated>2018-05-27T08:21:22.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€åˆ†æä¸€ä¸ªHello_World_Appä¸­bitmapå¯¹è±¡çš„åˆ†å¸ƒ">ä¸€ã€åˆ†æä¸€ä¸ªHello World Appä¸­bitmapå¯¹è±¡çš„åˆ†å¸ƒ</h3><p>ä½¿ç”¨BitmapAnalyzeråˆ†æä¸€ä¸ªAndroid Hello World Appæ—¶ä½ ä¼šdumpå‡º400+å¼ å›¾ç‰‡ï¼Œä»€ä¹ˆæ˜¯BitmapAnalyzerï¼ŸBitmapAnalyzeræ˜¯ä¸€ä¸ªè‡ªåŠ¨åˆ†æAndroid dump heapä¸­bitmapå¯¹è±¡çš„å·¥å…·ï¼Œè¯¦ç»†è¯·çœ‹<a href="https://ivonhoe.github.io/2017/03/22/Bitmap&amp;Memory/">ã€ŠAndroid Bitmapçš„å†…å­˜å¤§å°æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿã€‹</a>è¿™ç¯‡æ–‡ç« çš„ä»‹ç»ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/695750-211010ed47103e96.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="hprof-3.png"></p>
<p>åˆ†æä»”ç»†çœ‹ä¸€ä¸‹å¯ä»¥å‘ç°ï¼Œä¸Šå›¾ä¸­sPreloadedDrawablesæ•°ç»„æ‰€å¼•ç”¨çš„é¢„åŠ è½½Drawableå°±ä¼šå ç”¨10Mä»¥ä¸Šçš„å†…å­˜ç©ºé—´ã€‚è¿™äº›éƒ½æ˜¯Androidç³»ç»Ÿçš„ä¸»é¢˜èµ„æºå›¾ç‰‡ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šä¸»é¢˜èµ„æºè¢«åŠ è½½ï¼Ÿä¸éœ€è¦çš„æ— ç”¨çš„ç³»ç»Ÿèµ„æºèƒ½å¦é¿å…è¢«åŠ è½½ï¼Ÿé‚£ä¹ˆè¦å¦‚ä½•åšåˆ°ï¼Ÿ</p>
<a id="more"></a>
<h3 id="äºŒã€ä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¤šç³»ç»Ÿèµ„æºè¢«åŠ è½½ï¼Ÿ">äºŒã€ä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¤šç³»ç»Ÿèµ„æºè¢«åŠ è½½ï¼Ÿ</h3><p>ä½¿ç”¨Android Studio(ç®€ç§°AS)çš„monitorå·¥å…·dumpå†…å­˜å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œhprofä¸­çš„å†…å­˜ä¿¡æ¯åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯App heapï¼ŒImage heapï¼ŒZygote heapã€‚App heapå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯åº”ç”¨è¿›ç¨‹ç‹¬å çš„å†…å­˜ç©ºé—´ï¼Œåœ¨åº”ç”¨ä¸­åˆ›å»ºçš„å¯¹è±¡éƒ½ä¼šåœ¨App heapä¸Šã€‚è€Œåœ¨Dalvikè™šæ‹Ÿæœºä¸Šè¿è¡Œçš„appï¼Œåªæœ‰App heapå’ŒZygote heapï¼Œå¹¶æ²¡æœ‰Image heapã€‚<a href="https://developer.android.com/studio/profile/am-hprof.html#why" target="_blank" rel="external">Androidå®˜ç½‘æ–‡æ¡£</a>çš„ä¸‰è€…çš„è§£é‡Šæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">App heap - The heap used by the current app.&#10;&#10;Image heap - The memory mapped copy of the current app on disk.&#10;&#10;Zygote heap - The common set of libraries and runtime classes and data that all apps are forked from. The zygote space is created during device startup and is never allocated into.</span><br></pre></td></tr></table></figure>
<p>Zygoteæœºåˆ¶æ€»çš„æ¥è¯´æ˜¯<code>app_process</code>å¯åŠ¨Zygoteå¹¶åˆ›å»ºç¬¬ä¸€ä¸ªè™šæ‹Ÿæœºè¿›ç¨‹ï¼ŒZygoteå¯åŠ¨æ—¶ä¼šé¢„åŠ è½½æ‰€æœ‰éœ€è¦çš„Java classeså’Œâ€å¿…è¦çš„â€èµ„æºæ–‡ä»¶ï¼Œè¿™äº›èµ„æºæ–‡ä»¶å°±åŒ…æ‹¬æˆ‘ä»¬åœ¨hprofæ–‡ä»¶ä¸­çœ‹åˆ°çš„è¢«sPreloadedDrawablesæ‰€ç›´æ¥å¼•ç”¨çš„Bitmapèµ„æºã€‚åº”ç”¨è¿›ç¨‹éƒ½æ˜¯ä»Zygoteä¸­forkå‡ºæ¥çš„ï¼Œæ‰€ä»¥æ‰€æœ‰çš„åº”ç”¨è¿›ç¨‹éƒ½ä¼šåŒ…å«ä¸Šé¢æåˆ°çš„èµ„æºæ–‡ä»¶ã€‚è¿™äº›èµ„æºçš„æ‹·è´å¯ä»¥çœ‹æˆæµ…æ‹·è´ï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„å†…å­˜copyï¼Œè€Œæ˜¯ä½œä¸ºè¿›ç¨‹é—´çš„å…±äº«å†…å­˜ä½¿ç”¨ã€‚è¯¦ç»†çš„å¯ä»¥æŸ¥çœ‹<a href="https://ivonhoe.github.io/2017/04/25/Zygote/">ã€ŠZygoteã€‹</a>è¿™ç¯‡æ–‡ç« ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/695750-8d0e4feb9a25e8b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="hprof-2.png"></p>
<h3 id="ä¸‰ã€å¼ºåˆ¶æ¸…é™¤æœªä½¿ç”¨çš„ç³»ç»Ÿèµ„æºå›¾ç‰‡ä¼šæ€æ ·ï¼Ÿ">ä¸‰ã€å¼ºåˆ¶æ¸…é™¤æœªä½¿ç”¨çš„ç³»ç»Ÿèµ„æºå›¾ç‰‡ä¼šæ€æ ·ï¼Ÿ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private void clearPreloadedDrawables() &#123;&#10;    try &#123;&#10;        Field mFieldPreloadedDrawables = getField(Resources.class, &#34;sPreloadedDrawables&#34;);&#10;        if (mFieldPreloadedDrawables != null) &#123;&#10;            mFieldPreloadedDrawables.setAccessible(true);&#10;&#10;            boolean access = mFieldPreloadedDrawables.isAccessible();&#10;            if (!access) &#123;&#10;                mFieldPreloadedDrawables.setAccessible(true);&#10;            &#125;&#10;&#10;            if (Build.VERSION.SDK_INT &#60;= 17) &#123;&#10;                LongSparseArray&#60;Drawable.ConstantState&#62; dArray = (LongSparseArray&#60;Drawable.ConstantState&#62;) mFieldPreloadedDrawables.get(getResources());&#10;                if (dArray != null) &#123;&#10;                    dArray.clear();&#10;                &#125;&#10;&#10;                // dArray.put(1, createDrawableConstant());&#10;            &#125; else if (Build.VERSION.SDK_INT &#62;= 18) &#123;&#10;                LongSparseArray&#60;Drawable.ConstantState&#62;[] dArray = (LongSparseArray&#60;Drawable.ConstantState&#62;[]) mFieldPreloadedDrawables.get(getResources());&#10;                if (dArray != null) &#123;&#10;                    for (int i = 0; i &#60; dArray.length; i++) &#123;&#10;                        if (dArray[i] != null) &#123;&#10;                            dArray[i].clear();&#10;                            // dArray[i].put(1, createDrawableConstant());&#10;                        &#125;&#10;                    &#125;&#10;                &#125;&#10;            &#125;&#10;&#10;            mFieldPreloadedDrawables.setAccessible(true);&#10;        &#125;&#10;    &#125; catch (Exception e) &#123;&#10;        e.printStackTrace();&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>å½“é€šè¿‡ä¸Šè¿°clearPreloadedDrawableså‡½æ•°æ¸…é™¤sPreloadDrawableå¯¹è¿™äº›èµ„æºçš„å¼ºå¼•ç”¨ï¼Œç„¶åä½¿ç”¨Android Studioçš„monitorå·¥å…·å‘ç°ï¼Œgcä»¥åApp heapå‘ç”Ÿäº†æ–­å´–å¼çš„å†…å­˜å›æ”¶ï¼Œå¹¶ä¸”ä½¿ç”¨<code>adb shell dumpsys meminfo</code>å‘½ä»¤å¯ä»¥å‘ç°Heap Allocå’ŒHeap Sizeéƒ½å‘ç”Ÿäº†æ˜¾è‘—çš„å‡å°ï¼Œä½†Pss totalå¹¶æ²¡æœ‰æ˜¾è‘—å˜åŒ–ã€‚è¿™é‡Œçš„ç†è§£æ˜¯PSS = Private RAM + æŒ‰æ¯”ä¾‹è®¡ç®—çš„Shared RAMï¼Œè¿™ä¸¤éƒ¨åˆ†éƒ½æ²¡æœ‰å‘ç”Ÿæ˜¾è‘—å˜åŒ–ï¼Œæ‰€ä»¥PSS Totalæ²¡æœ‰å˜åŒ–ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/695750-04d96b82a7dbce97.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="hprof-7.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/695750-4eebdbaf6e95eff4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="hprof-5.png"></p>
<p>é‚£è¯·é—®ï¼Œä¸Šé¢ğŸ‘†çš„å†…å­˜æ¸…ç†æœ‰æ„ä¹‰å—ï¼ŸHeap allocatedè¾ƒå°‘äº†10Mï¼Œä½†PSSå¹¶æ²¡æœ‰æ˜æ˜¾çš„å˜åŒ–ï¼Œç»™æˆ‘çš„æ„Ÿè§‰å°±åƒå¤§å®¶åœ¨åƒå¤§é”…é¥­ï¼Œæˆ‘åªåƒäº†1ç¢—ï¼Œåˆ«äººåƒäº†10ç¢—ï¼Œä»˜é’±çš„æ—¶å€™å´æ˜¯AAï¼Œç”šè‡³å¯èƒ½æˆ‘ä»˜çš„è¿˜æ›´å¤šä¸€äº›ã€‚ä½ è¯´ä½ æ˜¯ä¸æ˜¯è¨ï¼Ÿ</p>
<h3 id="å››ã€Copy-On-Write(COW)">å››ã€Copy-On-Write(COW)</h3><p>Zygote heapæ˜¯ç³»ç»Ÿå…±äº«å†…å­˜heapï¼Œè¿™é‡Œæˆ‘å°è¯•ä¿®æ”¹<code>sPreloadDrawable</code>å¯¹åº”æ•°æ®æ—¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç³»ç»Ÿé»˜è®¤é¢„åŠ è½½399å¼ èµ„æºå›¾ç‰‡ï¼Œå½“æ‰‹åŠ¨æ’å…¥ä¸€å¼ æ–°çš„å›¾ç‰‡åˆ°ç¼“å­˜åï¼Œç¼“å­˜å¤§å°å˜æˆäº†400ã€‚ä½†è®©æˆ‘è§‰å¾—è¯¡å¼‚çš„æ˜¯ï¼Œä¸æ˜¯è¯´Androidç³»ç»Ÿä½¿ç”¨COWæœºåˆ¶å—ï¼Ÿä¸ºå•¥æ’å…¥å‰åsPreloadDrawableç›¸å…³çš„å†…å­˜åœ°å€æ ¹æœ¬æ²¡æœ‰å˜åŒ–ï¼Ÿ<br><img src="http://upload-images.jianshu.io/upload_images/695750-14ca03d88be43c61.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="hprof-4.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/695750-5f0921dc8e336f51.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="hprof-8.jpg"></p>
<p>æˆ‘çš„ç†è§£æ˜¯åœ¨forkå­è¿›ç¨‹çš„æ—¶å€™å¹¶ä¸ä¼šçœŸæ­£æ‹·è´çˆ¶è¿›ç¨‹å†…å­˜æ•°æ®ï¼Œè€Œæ˜¯å­è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´æŒ‡å‘çˆ¶è¿›ç¨‹çš„ç‰©ç†å†…å­˜ç©ºé—´ã€‚å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹çš„è™šæ‹Ÿç©ºé—´ä¸åŒï¼Œä½†ç‰©ç†ç©ºé—´æ˜¯åŒä¸€ä¸ªã€‚å½“å­è¿›ç¨‹éœ€è¦é‡å†™å…±äº«å†…å­˜æ•°æ®æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šä¸ºå­è¿›ç¨‹åˆ†é…å“åº”çš„ç‰©ç†å†…å­˜ã€‚è¿™é‡Œçš„è™šæ‹Ÿå†…å­˜ç©ºé—´å¯¹åº”ç”¨ç¨‹åºæ¥è¯´å°±æ˜¯é€»è¾‘åœ°å€ï¼Œå¯¹äºCPUæ¥è¯´å°±æ˜¯çº¿æ€§åœ°å€ã€‚</p>
<h3 id="äº”ã€æ€»ç»“">äº”ã€æ€»ç»“</h3><p>å›åˆ°ä¹‹å‰æ€è€ƒçš„å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li><p>ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šä¸»é¢˜èµ„æºè¢«åŠ è½½ï¼Ÿ<br>è¿™äº›ä¸»é¢˜èµ„æºæ˜¯ç³»ç»Ÿå¯åŠ¨æ—¶Zygoteé¢„åŠ è½½çš„ç³»ç»Ÿèµ„æºï¼ŒZygoteè®¤ä¸ºè¿™äº›èµ„æºæ¯ä¸ªAppéƒ½ä¼šç”¨åˆ°ï¼Œç‰¹åˆ«æ˜¯5.0+çš„ç³»ç»Ÿä¼šè¾¾åˆ°400+çš„é»˜è®¤themeå›¾ç‰‡ï¼Œå ç”¨10M+çš„å†…å­˜ç©ºé—´ï¼Œä¸è¿‡è¿™äº›å†…å­˜æ˜¯ç³»ç»Ÿå…±äº«çš„ä½ ç”¨æˆ–ä¸ç”¨ä»–ä»¬éƒ½åœ¨é‚£é‡Œã€‚æ”¹å˜åº”ç”¨çš„ä¸»é¢˜æ ·å¼å¹¶ä¸ä¼šæ”¹å˜sPreloadDrawableçš„åŠ è½½å†…å®¹ã€‚</p>
</li>
<li><p>ä¸éœ€è¦çš„æ— ç”¨èµ„æºèƒ½å¦é¿å…è¢«åŠ è½½ï¼Ÿ<br>è¿™äº›é»˜è®¤ç³»ç»Ÿèµ„æºæ— æ³•é¿å…è¢«ç³»ç»Ÿé¢„åŠ è½½ï¼Œä½†æ˜¯ä¸åŒROMå‚å•†é’ˆå¯¹è¿™äº›èµ„æºçš„çœ‹æ³•å·®åˆ«è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œæ ¹æ®æµ‹è¯•çš„æƒ…å†µçœ‹ï¼Œä¸‰æ˜Ÿçš„é¢„åŠ è½½èµ„æºæ¯”æºç çš„è¿˜è¦å¤šï¼Œæ¸…ç©ºsPreloadDrawableä¹Ÿä¸èƒ½å‡å°‘Heap allocteçš„å¤§å°ã€‚ç›¸åé”¤å­æ‰‹æœºå¯¹è¿™äº›é¢„åŠ è½½èµ„æºçš„ä½œç”¨å€’æ˜¯ä¸å¤ªçœ‹å¥½ï¼Œåœ¨é”¤å­åšæœä¸Šçœ‹åˆ°çš„é¢„åŠ è½½èµ„æºå°±å¾ˆå°‘ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚è€Œåœ¨Android 5.0ä»¥ä¸‹çš„ç³»ç»Ÿç‰ˆæœ¬ï¼Œè¿™å—é¢„åŠ è½½çš„èµ„æºä¹Ÿä¸æ˜¯å¾ˆå¤¸å¼ ã€‚</p>
</li>
<li><p>æ¸…ç©ºé¢„åŠ è½½èµ„æºå¯¹åº”ç”¨å†…å­˜æœ‰æ— ä¼˜åŒ–ä½œç”¨ï¼Ÿ<br>è¯´ä¸‹ä¸ªäººçœ‹æ³•ï¼Œå¦‚æœä½ çš„åº”ç”¨åˆ†ä¸ºUIè¿›ç¨‹å’Œåå°æœåŠ¡è¿›ç¨‹ã€‚åœ¨UIè¿›ç¨‹æ¸…é™¤ç³»ç»Ÿé¢„åŠ è½½èµ„æºå¯èƒ½å¹¶ä¸æ˜¯æ˜æ™ºçš„é€‰æ‹©ï¼Œä¸ºå•¥ï¼Ÿå› ä¸ºè¿™æ˜¯ä¸€ä»¶åƒåŠ›æœªå¿…è®¨å¥½çš„äº‹æƒ…ï¼Œè™½ç„¶è¿™10Mç©ºé—´ä½ å¹¶æ²¡æœ‰ä½¿ç”¨ï¼Œä½†ç³»ç»Ÿå¹¶æ²¡æœ‰é¢†æƒ…ï¼Œåè€Œå½“ä½ æƒ³è¦åœ¨ä½¿ç”¨ç³»ç»Ÿèµ„æºçš„æ—¶å€™ï¼Œé‚£è¿™äº›èµ„æºå°±ä¼šå®Œå…¨ç®—åˆ°ä½ çš„å¤´ä¸Šã€‚é‚£æ ·åè€Œä¼šé€ æˆåº”ç”¨è¿›ç¨‹å†…å­˜çš„ä¸Šå‡ã€‚ä¸ºå•¥ï¼Ÿæ¸…é™¤ç³»ç»Ÿçš„å…±äº«å†…å­˜åï¼Œå†åŠ è½½ç³»ç»Ÿèµ„æºæ—¶åˆ†é…çš„å°±æ˜¯åº”ç”¨çš„ç§æœ‰å†…å­˜äº†ã€‚<br>å¦‚æœæ˜¯åå°æœåŠ¡è¿›ç¨‹ï¼Œæ‰“æ­»ä¹Ÿä¸ä¼šç”¨åˆ°ç³»ç»Ÿä¸»é¢˜èµ„æºçš„æƒ…å†µä¸‹ï¼Œæ¸…é™¤é¢„åŠ è½½èµ„æºä¸ºä»€ä¹ˆä¸æ˜¯å¯¹è‡ªå·±æœ‰åˆ©çš„äº‹æƒ…å‘¢ï¼Ÿå› ä¸ºè¿™æ ·åšç¡®å®è®©Heapå˜å°äº†å‘€ï¼</p>
<p>å½“ç„¶ä»¥ä¸Šéƒ½æ˜¯ä¸ªäººçš„ç†è§£ï¼Œå¦‚æœ‰ç†è§£é”™è¯¯ï¼Œæ³è¯·èƒ½å¤ŸæŒ‡å‡ºã€‚å¯¹äºå¦‚ä½•è·å–Javaå¯¹è±¡çš„ç‰©ç†åœ°å€ï¼Œæˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°æ›´å¥½çš„åŠæ³•ï¼Œæ‰€ä»¥æš‚æ—¶è¿˜æ²¡æœ‰å®è·µéªŒè¯COWã€‚</p>
</li>
</ul>
<p>ä¸´å¸–é¡¿é¦–ï¼Œä¸çŸ¥æ‰€è¨€ï¼Œ2017.4.26æ—¥å¤œã€‚</p>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3><p><a href="https://developer.android.com/studio/profile/investigate-ram.html" target="_blank" rel="external"></a></p>
<p><a href="https://developer.android.com/studio/profile/am-hprof.html#why" target="_blank" rel="external">HPROF Viewer and Analyzer</a></p>
<p><a href="http://www.jianshu.com/p/d061fa36a0d9" target="_blank" rel="external">Manage Your Appâ€™s Memory</a></p>
<p><a href="http://wiki.jikexueyuan.com/project/deep-android-v1/zygote.html" target="_blank" rel="external">æ·±å…¥ç†è§£ Zygote</a></p>
<p><a href="http://www.cnblogs.com/biyeymyhjob/archive/2012/07/20/2601655.html" target="_blank" rel="external">Linuxå†™æ—¶æ‹·è´æŠ€æœ¯(copy-on-write)</a></p>
<p><a href="http://luodw.cc/2016/02/17/address/" target="_blank" rel="external">linuxè™šæ‹Ÿåœ°å€è½¬ç‰©ç†åœ°å€</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä¸€ã€åˆ†æä¸€ä¸ªHello_World_Appä¸­bitmapå¯¹è±¡çš„åˆ†å¸ƒ&quot;&gt;ä¸€ã€åˆ†æä¸€ä¸ªHello World Appä¸­bitmapå¯¹è±¡çš„åˆ†å¸ƒ&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨BitmapAnalyzeråˆ†æä¸€ä¸ªAndroid Hello World Appæ—¶ä½ ä¼šdumpå‡º400+å¼ å›¾ç‰‡ï¼Œä»€ä¹ˆæ˜¯BitmapAnalyzerï¼ŸBitmapAnalyzeræ˜¯ä¸€ä¸ªè‡ªåŠ¨åˆ†æAndroid dump heapä¸­bitmapå¯¹è±¡çš„å·¥å…·ï¼Œè¯¦ç»†è¯·çœ‹&lt;a href=&quot;https://ivonhoe.github.io/2017/03/22/Bitmap&amp;amp;Memory/&quot;&gt;ã€ŠAndroid Bitmapçš„å†…å­˜å¤§å°æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿã€‹&lt;/a&gt;è¿™ç¯‡æ–‡ç« çš„ä»‹ç»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/695750-211010ed47103e96.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;hprof-3.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;åˆ†æä»”ç»†çœ‹ä¸€ä¸‹å¯ä»¥å‘ç°ï¼Œä¸Šå›¾ä¸­sPreloadedDrawablesæ•°ç»„æ‰€å¼•ç”¨çš„é¢„åŠ è½½Drawableå°±ä¼šå ç”¨10Mä»¥ä¸Šçš„å†…å­˜ç©ºé—´ã€‚è¿™äº›éƒ½æ˜¯Androidç³»ç»Ÿçš„ä¸»é¢˜èµ„æºå›¾ç‰‡ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šä¸»é¢˜èµ„æºè¢«åŠ è½½ï¼Ÿä¸éœ€è¦çš„æ— ç”¨çš„ç³»ç»Ÿèµ„æºèƒ½å¦é¿å…è¢«åŠ è½½ï¼Ÿé‚£ä¹ˆè¦å¦‚ä½•åšåˆ°ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://ivonhoe.github.io/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
    
      <category term="Copy-on-write" scheme="https://ivonhoe.github.io/tags/Copy-on-write/"/>
    
      <category term="Zygote" scheme="https://ivonhoe.github.io/tags/Zygote/"/>
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://ivonhoe.github.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>Androidæ€§èƒ½ä¼˜åŒ–ä¹‹å¦‚ä½•å†™å‡ºGCå‹å¥½çš„Androidåº”ç”¨</title>
    <link href="https://ivonhoe.github.io/2017/04/25/%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BAGC%E5%8F%8B%E5%A5%BD%E7%9A%84Android%E5%BA%94%E7%94%A8/"/>
    <id>https://ivonhoe.github.io/2017/04/25/å¦‚ä½•å†™å‡ºGCå‹å¥½çš„Androidåº”ç”¨/</id>
    <published>2017-04-25T13:21:23.000Z</published>
    <updated>2018-05-27T08:19:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä½œè€…ï¼šä¹è›™ç§‘æŠ€é«˜çº§ç ”å‘ç»ç† æ˜“å®</p>
<p>Androidåº”ç”¨æ™®éæ²¡æœ‰iOSåº”ç”¨æµç•…ï¼Œè¿™ä¸Androidåº”ç”¨æ˜¯è¿è¡Œåœ¨Javaè™šæ‹Ÿæœºä¸Šæœ‰å¾ˆå¤§çš„å…³ç³»ï¼Œè€Œå…³ç³»æœ€å¤§çš„ææ€•å°±æ˜¯Javaè™šæ‹Ÿæœºä¸Šçš„Garbage Collectionï¼ˆGCï¼‰äº†ã€‚Javaè¯­è¨€æä¾›äº†è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œåƒåœ¾å¯¹è±¡ä¼šåœ¨GCè¿‡ç¨‹ä¸­è‡ªåŠ¨è¢«é‡Šæ”¾ã€‚è¿™æä¾›äº†å¼€å‘æ•ˆç‡ï¼Œä½¿å¼€å‘è€…èƒ½é›†ä¸­ç²¾åŠ›åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šï¼›ä½†å¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ï¼Œä½ å†™çš„Androidåº”ç”¨çš„æŸäº›æ€§èƒ½ä¸Šçš„é—®é¢˜å¾ˆå¯èƒ½å°±æ˜¯GCå¯¼è‡´çš„ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€æ®µéå¸¸ç®€å•çš„Javaè¯­å¥ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] data = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span> * <span class="number">512</span> * <span class="number">4</span>];</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ¡è¯­å¥ç”³è¯·äº†ä¸€å—å¤§å°ç›¸ç­‰äº512*512å¤§å°å›¾ç‰‡çš„å†…å­˜ã€‚æ‰§è¡Œè¿™æ¡è¯­å¥ä¼šæ¶ˆè€—å¤šå°‘æ—¶é—´å‘¢ï¼Ÿ0+mså—ï¼ŸåŸºæœ¬æ²¡æœ‰æ€§èƒ½å½±å“å—ï¼Ÿ</p>
<a id="more"></a>
<p>å®é™…çš„æƒ…å†µæ˜¯ï¼š0~200msï¼Œç”šè‡³æ›´å¤šï¼è¿™å–å†³äºåº”ç”¨å½“å‰Heapä½¿ç”¨æƒ…å†µã€‚åœ¨ä¸€ä¸ªç±»ä¼¼Hello Worldçš„æµ‹è¯•ç¨‹åºé‡Œï¼Œæ‰§è¡Œè¿™æ¡è¯­å¥æœ‰æ—¶å€™åªéœ€è¦0+mså°±å®Œæˆäº†ï¼Œä½†ä¸€èˆ¬æƒ…å†µæ˜¯16+msï¼Œç”šè‡³æœ‰æ—¶å€™éœ€è¦30+msã€‚æˆ‘ä»¬çŸ¥é“ä¸€æ®µæµç•…çš„åŠ¨ç”»æ¯å¸§ç»˜å›¾æ¶ˆè€—çš„æ—¶é—´åº”è¯¥å°äº16msï¼Œå› ä¸ºè¿™æ ·æ‰èƒ½ä¿è¯åŠ¨ç”»æœ‰60FPSçš„å¸§ç‡ã€‚ä½†å¦‚æœæ‰§è¡Œä¸Šé¢é‚£å¥ç®€å•çš„è¯­å¥å°±è¦é”™è¿‡1~2å¸§ï¼Œé‚£å°±éš¾æ€ªåŠ¨ç”»ä¸æµç•…äº†ã€‚</p>
<p>ä¸è¿‡ï¼Œæœ‰äººå¯èƒ½è¦è¯´äº†ï¼šâ€œæ²¡äººä¼šå‚»åˆ°åœ¨æ¯å¸§ç»˜å›¾çš„æ—¶å€™å»ç”³è¯·ä¸€å—è¿™ä¹ˆå¤§çš„å†…å­˜ï¼Œå®é™…æƒ…å†µä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜â€ã€‚å®é™…çš„å·¥ç¨‹ä¸­çš„ç¡®ä¸ä¼šè¿™ä¹ˆå†™ï¼Œä½†é€ æˆæ‰§è¡Œè¿™æ¡è¯­å¥è€—æ—¶æ¯”è¾ƒé•¿çš„åŸå› ä¸æ˜¯å› ä¸ºç”³è¯·çš„å†…å­˜å¤ªå¤§ï¼Œè€Œæ˜¯ç”³è¯·è¿‡ç¨‹ä¸­äº§ç”Ÿäº†GCï¼Œå°±ç®—æ˜¯ä¸€ä¸ªByteçš„å†…å­˜ç”³è¯·ä¹Ÿå¯èƒ½æ¶ˆè€—æ¯”è¿™æ›´é•¿çš„æ—¶é—´ã€‚</p>
<h3 id="Dalvikä¸­GCçš„åŸç†">Dalvikä¸­GCçš„åŸç†</h3><p>åœ¨Dalvikè™šæ‹Ÿæœºä¸­å®šä¹‰äº†å››ç§è§¦å‘GCçš„æ¡ä»¶ï¼ˆå‚çœ‹<a href="http://androidxref.com/4.2.2_r1/xref/dalvik/vm/alloc/Heap.h" target="_blank" rel="external">Heap.h</a>ï¼‰ï¼š</p>
<blockquote>
<ul>
<li><code>GC_CONCURRENT</code>ï¼Œå½“Heapçš„ä½¿ç”¨ç‡è¾¾åˆ°æŸä¸€é˜ˆå€¼æ—¶è‡ªåŠ¨è§¦å‘ã€‚</li>
<li><code>GC_FOR_MALLOC</code>ï¼Œå½“Heapæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´ç”¨äºå®¹ä¸‹æ–°åˆ›å»ºçš„å¯¹è±¡æ—¶ã€‚</li>
<li><code>GC_EXPLICIT</code>ï¼Œç”¨æˆ·ä¸»åŠ¨è°ƒç”¨GCæ—¶ã€‚</li>
<li><code>GC_BEFORE_OOM</code>ï¼Œå½“è¦å‘ç”ŸOOMæ—¶ç³»ç»Ÿå°è¯•è¿›è¡Œæœ€åGCçš„åŠªåŠ›ã€‚</li>
</ul>
</blockquote>
<p><code>GC_CONCURRENT</code>å’Œ<code>GC_EXPLICIT</code>æ˜¯å¹¶è¡Œçš„ï¼ŒGCè¿‡ç¨‹ä¸­åº”ç”¨ä¸ä¼šè¢«æš‚åœï¼Œåªåœ¨GCå¼€å§‹å’Œç»“æŸæ—¶ä¼šæš‚åœåº”ç”¨ï¼Œæ¯æ¬¡æš‚åœçš„æ—¶é—´æ¯”è¾ƒçŸ­ï¼Œä¸€èˆ¬åªæœ‰3~4msã€‚<code>GC_FOR_MALLOC</code>æ˜¯éå¹¶è¡Œçš„ï¼ŒGCè¿‡ç¨‹ä¸­åº”ç”¨è¢«æš‚åœï¼Œè€—æ—¶æ¯”è¾ƒé•¿ï¼Œå¯èƒ½å‡ åæ¯«ç§’ä¹Ÿå¯èƒ½å‡ ç™¾æ¯«ç§’ã€‚åœ¨åº”ç”¨å‘Dalvikç”³è¯·å†…å­˜æ—¶ï¼ŒDalvikå…ˆæ£€æŸ¥å½“å‰Heapä¸­æœ‰æ— è¶³å¤Ÿçš„ç©ºä½™ç©ºé—´ç”¨æ¥å®‰æ’å¯¹è±¡ï¼Œå½“å‘ç°æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´çš„æ—¶å€™ä¼šå…ˆè¿›è¡Œ<code>GC_FOR_MALLOC</code>ä»¥è¯•å›¾é‡Šæ”¾åƒåœ¾å¯¹è±¡æ¥è·å–æ–°çš„ç©ºé—´ï¼Œå¦‚æœå‘ç°ç©ºé—´è¿˜ä¸å¤Ÿåˆ™è¿›è¡ŒHeapçš„å¢é•¿ã€‚åœ¨æ¯æ¬¡æˆåŠŸåˆ†é…å®Œæ–°çš„ç©ºé—´åï¼ŒDalvikä¼šæ£€æŸ¥å½“å‰Heapçš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœä½¿ç”¨ç©ºé—´è¶…è¿‡ä¸€å®šçš„é˜ˆå€¼çš„æ—¶å€™ï¼Œ<code>GC_CONCURRENT</code>å°±ä¼šè§¦å‘ã€‚</p>
<p>æ¯æ¬¡GCçš„æ—¶å€™ä¼šæ‰“å°å¦‚ä¸‹çš„Logä¿¡æ¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D/dalvikvm(10497): GC_CONCURRENT freed 2940K, 54% free 2885K/6204K, paused 1ms+4ms&#65292; total 38ms</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„Logä¿¡æ¯è¡¨æ˜ï¼šè¿™æ¬¡<code>GC_CONCURRENT</code>é‡Šæ”¾äº†2940Kçš„ç©ºé—´ï¼Œå½“å‰Heapä½¿ç”¨ç‡ä¸º54%ï¼Œæ€»çš„Heapå¤§å°æ˜¯6204Kï¼Œç©ºä½™2885Kï¼ŒGCå¼€å§‹æ—¶æš‚åœäº†1msï¼ŒGCç»“æŸæ—¶æš‚åœäº†4msï¼ŒGCæ€»å…±èŠ±äº†38msã€‚</p>
<p>Dalvikè™šæ‹Ÿæœºé€šè¿‡ä¸‹é¢å‡ ä¸ªä¸ªå±æ€§å€¼æ¥æ§åˆ¶Heapçš„ç©ºé—´é…ç½®ï¼š</p>
<blockquote>
<ul>
<li><code>targetUtilization</code>ï¼Œç†æƒ³çš„Heapåˆ©ç”¨ç‡ï¼Œæ¯å½“Heapå¢é•¿æ—¶Dalvikä¼šä½¿å¢é•¿åçš„Heapç»´æŒåœ¨è¿™ä¸ªåˆ©ç”¨ç‡é™„è¿‘ã€‚</li>
<li><code>minFree</code>ï¼Œç©ºä½™ç©ºé—´æœ€å°å€¼ã€‚</li>
<li><code>maxFree</code>ï¼Œç©ºä½™ç©ºé—´æœ€å¤§å€¼ã€‚</li>
<li><code>startSize</code>ï¼Œè™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆå§‹çš„Heapå¤§å°ã€‚</li>
<li><code>growthLimit</code>ï¼Œç”¨æˆ·è®¾ç½®çš„å…è®¸çš„æœ€å¤§Heapå¤§å°ã€‚</li>
<li><code>maximumSize</code>ï¼Œ Heapç©ºé—´æœ€å¤§æé™å€¼ã€‚</li>
</ul>
</blockquote>
<p>è¿™äº›å±æ€§å€¼éƒ½å¯ä»¥é€šè¿‡<code>system/build.prop</code>æ¥é…ç½®ï¼Œzygoteå¯åŠ¨dalvikè™šæ‹Ÿæœºæ—¶ä¼šä»è¯¥æ–‡ä»¶ä¸­è¯»å–è¿™äº›å‚æ•°ã€‚é€šå¸¸æ¥è¯´ï¼ŒHeapç©ºä½™ç©ºé—´è¶Šå¤§åº”ç”¨è¶Šæµç•…ï¼Œæ¶ˆè€—çš„å†…å­˜ä¹Ÿæ›´å¤šã€‚</p>
<p>ä¸‹å›¾ä¸ºä¸€æ¬¡â€œé¡ºåˆ©â€çš„4Må†…å­˜ç”³è¯·:<br><img src="/res/dalvik_gc/1.png" alt="Alt text"><br>å¯ä»¥çœ‹åˆ°åœ¨ç”³è¯·ä¹‹å‰ï¼Œç©ºä½™çš„ç©ºé—´è¾¾åˆ°8Mï¼Œç”³è¯·4Mçš„å†…å­˜å¾ˆé¡ºåˆ©æ²¡æœ‰ä»»ä½•GCå‘ç”Ÿã€‚</p>
<p>ä¸‹å›¾ä¸ºä¸€æ¬¡â€œä¸é¡ºåˆ©â€çš„8Må†…å­˜ç”³è¯·ï¼š<br><img src="/res/dalvik_gc/2.png" alt="Alt text"><br>è™½ç„¶ç©ºä½™çš„ç©ºé—´å·²ç»æœ‰8Mï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯æ­£å¸¸çš„Heapåˆ©ç”¨ç‡ï¼ŒHeapç©ºé—´è¿˜æ˜¯å¢é•¿äº†ï¼Œå¹¶ä¸”å¢é•¿Heapä¹‹å‰è¿›è¡Œäº†ä¸€æ¬¡<code>GC_FOR_MALLOC</code>ã€‚</p>
<p>ä¸‹å›¾ä¸ºç»§ç»­ç”³è¯·8Mçš„å†…å­˜ï¼š<br><img src="/res/dalvik_gc/3.png" alt="Alt text"><br>ç›¸åº”çš„è¾“å‡ºLogï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D/dalvikvm&#65109; GC_FOR_ALLOC freed 8195K, 34% free 16726K/24972K, paused 23ms, total 23ms</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šå›¾å’ŒLogæ›´åŠ æ¸…æ™°çš„è¡¨æ˜Heapç©ºé—´ä¸å¤Ÿæ—¶ä¼šå…ˆè¿›è¡Œä¸€æ¬¡GCï¼ŒGCçš„ç±»å‹å°±æ˜¯<code>GC_FOR_MALLOC</code>ã€‚</p>
<h3 id="Androidæµç•…çš„å…³é”®ï¼šGC_FOR_MALLOC">Androidæµç•…çš„å…³é”®ï¼š<code>GC_FOR_MALLOC</code></h3><p><code>GC_CONCURRENT</code>å’Œ<code>GC_FOR_MALLOC</code>è™½ç„¶éƒ½æ˜¯ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨çš„ï¼Œéƒ½æš‚åœäº†åº”ç”¨ï¼Œä½†å®ƒä»¬èŠ±è´¹çš„æ—¶é—´ä¸åœ¨ä¸€ä¸ªæ•°é‡çº§ã€‚é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬çŸ¥é“æ¯æ¬¡ç”³è¯·å†…å­˜ç©ºé—´ä¸å¤Ÿæ—¶å°±ä¼šäº§ç”Ÿ<code>GC_FOR_MALLOC</code>ï¼Œæˆ‘ä»¬ä¸å¯èƒ½ä¸ç”³è¯·å†…å­˜ï¼Œæ‰€ä»¥ä¹Ÿä¸å¯èƒ½å®Œå…¨é¿å…<code>GC_FOR_MALLOC</code>ï¼Œä½†è¿˜æ˜¯æœ‰äº›ç­–ç•¥èƒ½é™ä½<code>GC_FOR_MALLOC</code>çš„å½±å“ï¼š</p>
<ol>
<li><p>é¿å…ä¸å¿…è¦çš„<code>GC_FOR_MALLOC</code></p>
<blockquote>
<ul>
<li>Heapç©ºé—´éƒ½æœ‰å…¶ç†æƒ³çš„åˆ©ç”¨ç‡ï¼Œåœ¨ç†æƒ³çš„åˆ©ç”¨ç©ºé—´å†…ï¼Œç”³è¯·å†…å­˜æ˜¯ä¸ä¼šå‘ç”Ÿ<code>GC_FOR_MALLOC</code>ã€‚</li>
<li>åº”ç”¨åº”è¯¥é¿å…å†…å­˜å¼€é”€çš„æ³¢åŠ¨ï¼Œå°†å†…å­˜çš„æ³¢åŠ¨ç»´æŒåœ¨<code>maxFree</code>å’Œ<code>mixFree</code>ä¹‹é—´ã€‚</li>
<li>é¿å…å¤§çš„å†…å­˜éœ€æ±‚ã€‚æ¯”å¦‚ï¼Œä¸è¦è½»æ˜“å»ç”¨<code>WallpaperManager</code>ï¼Œå› ä¸ºå£çº¸å ç”¨å·¨å¤§çš„å†…å­˜ã€‚</li>
<li>åº”è¯¥å°½é‡å¤ç”¨å¯¹è±¡ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨<code>BitmapFactory</code>åŠ è½½å›¾ç‰‡æ—¶ä½¿ç”¨<code>BitmapFactory.Option.inBitmap</code>å¤ç”¨Bitmapï¼Œé¿å…ç”³è¯·å†…å­˜ã€‚</li>
<li>å¯¹äºå·²çŸ¥æœ‰åƒåœ¾å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œå…ˆè¿›è¡Œæ‰‹åŠ¨çš„<code>System.gc()</code>æ¥é‡Šæ”¾ç©ºé—´ï¼Œè€Œä¸æ˜¯ç­‰åˆ°ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨<code>GC_FOR_MALLOC</code>ã€‚å› ä¸º<code>GC_EXPLICIT</code>æ˜¯å¼‚æ­¥çš„ï¼Œæš‚åœåº”ç”¨çš„æ—¶é—´è¿œå°äº<code>GC_FOR_MALLOC</code>ã€‚</li>
<li>ä¸è¦åœ¨å¾ªç¯ä¸­ç”³è¯·åˆ›å»ºå¯¹è±¡ã€‚å¾ªç¯ä¸­ç”³è¯·çš„å¯¹è±¡ä¼šä¸æ–­ç´¯ç§¯ï¼Œç›´åˆ°ç©ºé—´ä¸å¤Ÿå‘ç”Ÿ<code>GC_FOR_MALLOC</code>ã€‚</li>
</ul>
</blockquote>
</li>
<li><p>å‡å°‘<code>GC_FOR_MALLOC</code>çš„å½±å“</p>
<blockquote>
<ul>
<li>ä¸è¦åœ¨Androidåº”ç”¨è¿è¡Œçš„å…³é”®é˜¶æ®µç”³è¯·å†…å­˜ã€‚æ¯”å¦‚ï¼Œä¸è¦åœ¨<code>onDraw</code>, <code>onLayout</code>, <code>onXXX</code>ä¸­åˆ›å»ºå¯¹è±¡ã€‚åœ¨å…³é”®é˜¶æ®µåˆ›å»ºå¯¹è±¡å¯èƒ½ä½¿åº”ç”¨å‡ºç°éšæœºæ€§å¡é¡¿ã€‚</li>
<li>å°½é‡åœ¨<code>onCreate</code>å’Œ<code>onStart</code>é˜¶æ®µåˆ›å»ºå¯¹è±¡ï¼ŒåŒæ—¶åœ¨<code>onStop</code>å’Œ<code>onDestroy</code>é˜¶æ®µé‡Šæ”¾å¯¹è±¡ã€‚</li>
<li>å°½é‡å¤ç”¨<code>ListView</code>ä¸­Itemï¼Œåœ¨<code>ListView</code>æ»‘åŠ¨æ—¶ä¸è¦åˆ›å»ºå¯¹è±¡ã€‚</li>
</ul>
</blockquote>
</li>
<li><p>é™ä½æ¯æ¬¡<code>GC_FOR_MALLOC</code>çš„æ—¶é—´æ¶ˆè€—</p>
<blockquote>
<ul>
<li>é¿å…å¤§é‡çš„ï¼Œç»†å°çš„å¯¹è±¡ã€‚è¿™äº›å¯¹è±¡ä¼šå¢åŠ Heapç©ºé—´çš„å¤æ‚åº¦ï¼Œåœ¨GCæ—¶ä¼šä¸¥é‡å½±å“GCçš„è€—æ—¶ã€‚</li>
<li>å¯¹äºä¸ç”¨çš„å¯¹è±¡è¿‘æ—©å°†å…¶å¼•ç”¨æ¶ˆé™¤ï¼Œå‡å°‘Heapç©ºé—´å ç”¨å’Œå¤æ‚åº¦ã€‚</li>
<li>å°½é‡ç”¨æ•°æ®ç»“æ„ï¼Œæ•°ç»„æ¥ç»„ç»‡å¯¹è±¡ã€‚</li>
<li>æ˜ç¡®å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œä½¿å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ç®€å•æ˜äº†ã€‚</li>
<li>å‡å°‘Viewçš„æ•°é‡ã€‚æ¯ä¸ªViewåŒ…å«å¤§é‡å±æ€§ï¼Œå¯¹äºæ²¡æœ‰äº¤äº’çš„Viewï¼Œå¤§å¤šæ•°çš„å±æ€§éƒ½æ˜¯æ²¡æœ‰ç”¨çš„ï¼Œå¯ä»¥ç”¨Drawableæ›¿ä»£ã€‚</li>
</ul>
</blockquote>
</li>
</ol>
<p><em>éœ€è¦æ³¨æ„çš„æ˜¯</em>ï¼šæœ¬æ–‡è®¨è®ºçš„åªé™äºDalvikè™šæ‹Ÿæœºã€‚å¯¹äºArtè™šæ‹Ÿæœºï¼Œ<a href="https://developer.android.com/guide/practices/verifying-apps-art.html#GC_Migration" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>å·²ç»è¡¨æ˜Artè™šæ‹Ÿæœºæœ‰æå¤§çš„æ”¹è¿›ï¼Œå…¶ä¸­å°±ç‰¹åˆ«æåˆ°<strong>ä¸ç”¨</strong>ä¸»åŠ¨è°ƒç”¨<code>System.gc()</code>æ¥é¿å…äº§ç”Ÿ<code>GC_FOR_MALLOC</code>ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œè€…ï¼šä¹è›™ç§‘æŠ€é«˜çº§ç ”å‘ç»ç† æ˜“å®&lt;/p&gt;
&lt;p&gt;Androidåº”ç”¨æ™®éæ²¡æœ‰iOSåº”ç”¨æµç•…ï¼Œè¿™ä¸Androidåº”ç”¨æ˜¯è¿è¡Œåœ¨Javaè™šæ‹Ÿæœºä¸Šæœ‰å¾ˆå¤§çš„å…³ç³»ï¼Œè€Œå…³ç³»æœ€å¤§çš„ææ€•å°±æ˜¯Javaè™šæ‹Ÿæœºä¸Šçš„Garbage Collectionï¼ˆGCï¼‰äº†ã€‚Javaè¯­è¨€æä¾›äº†è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œåƒåœ¾å¯¹è±¡ä¼šåœ¨GCè¿‡ç¨‹ä¸­è‡ªåŠ¨è¢«é‡Šæ”¾ã€‚è¿™æä¾›äº†å¼€å‘æ•ˆç‡ï¼Œä½¿å¼€å‘è€…èƒ½é›†ä¸­ç²¾åŠ›åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šï¼›ä½†å¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ï¼Œä½ å†™çš„Androidåº”ç”¨çš„æŸäº›æ€§èƒ½ä¸Šçš„é—®é¢˜å¾ˆå¯èƒ½å°±æ˜¯GCå¯¼è‡´çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€æ®µéå¸¸ç®€å•çš„Javaè¯­å¥ï¼š&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;byte&lt;/span&gt;[] data = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;byte&lt;/span&gt;[&lt;span class=&quot;number&quot;&gt;512&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;512&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ¡è¯­å¥ç”³è¯·äº†ä¸€å—å¤§å°ç›¸ç­‰äº512*512å¤§å°å›¾ç‰‡çš„å†…å­˜ã€‚æ‰§è¡Œè¿™æ¡è¯­å¥ä¼šæ¶ˆè€—å¤šå°‘æ—¶é—´å‘¢ï¼Ÿ0+mså—ï¼ŸåŸºæœ¬æ²¡æœ‰æ€§èƒ½å½±å“å—ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://ivonhoe.github.io/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
    
      <category term="Android" scheme="https://ivonhoe.github.io/tags/Android/"/>
    
      <category term="Delvik" scheme="https://ivonhoe.github.io/tags/Delvik/"/>
    
      <category term="GC" scheme="https://ivonhoe.github.io/tags/GC/"/>
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://ivonhoe.github.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
      <category term="è½¬è½½" scheme="https://ivonhoe.github.io/tags/%E8%BD%AC%E8%BD%BD/"/>
    
  </entry>
  
  <entry>
    <title>Zygote</title>
    <link href="https://ivonhoe.github.io/2017/04/15/Zygote/"/>
    <id>https://ivonhoe.github.io/2017/04/15/Zygote/</id>
    <published>2017-04-15T15:32:51.000Z</published>
    <updated>2018-05-27T08:21:41.000Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæ–‡åœ°å€ï¼š<a href="https://anatomyofandroid.com/2013/10/15/zygote/" target="_blank" rel="external">Zygote https://anatomyofandroid.com/2013/10/15/zygote/</a></p>
<p>Zygoteï¼ˆå—ç²¾åµï¼‰æ˜¯ä¸€ä¸ªå¯åŠ¨åº”ç”¨çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œåœ¨Server Managerä¹‹åè¢«init.rcè§¦å‘ï¼Œä½†å…¶å®ä»–æ˜¯çœŸæ­£è¢«app_processå¯åŠ¨çš„ï¼Œä¸‹é¢æ˜¯å¯åŠ¨è¿™ä¸ªç‰¹æ®Šè¿›ç¨‹çš„æµç¨‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service zygote /system/bin/app_process -Xzygote /system/bin --zygote --start-system-server&#10;class main&#10;socket zygote stream 660 root system&#10;onrestart write /sys/android_power/request_state wake&#10;onrestart write /sys/power/state on&#10;onrestart restart media&#10;onrestart restart netd</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥å‘ç°Zygoteæ˜¯å¦‚ä½•å½“åšç³»ç»ŸæœåŠ¡å¯åŠ¨çš„ï¼Œä½ ä¹Ÿå¯ä»¥çœ‹åˆ°app_processä¸ºä»€ä¹ˆè¯´app_processæ˜¯å¯åŠ¨Zygoteçš„çœŸæ­£å‘½ä»¤ã€‚å°±åƒä¹‹å‰è¯´çš„ï¼ŒZygoteæ˜¯ä¸€ä¸ªä»¥ä¸“é—¨å¯åŠ¨åº”ç”¨ä¸ºçš„å®ˆæŠ¤è¿›ç¨‹ã€‚è¿™æ„å‘³ç€Zygoteæ˜¯æ‰€æœ‰Appè¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚å½“app_processå¯åŠ¨Zygoteæ—¶ï¼Œå®ƒé€šè¿‡è°ƒç”¨Zygoteçš„main()æ–¹æ³•åˆ›å»ºäº†ç¬¬ä¸€ä¸ªDalvikè™šæ‹Ÿæœºã€‚å½“Zygoteå¯åŠ¨åï¼Œzygoteä¼šé¢„åŠ è½½æ‰€æœ‰å¿…é¡»çš„Javaç±»å’Œèµ„æºï¼Œå¯åŠ¨System Serverå¹¶æ‰“å¼€ä¸€ä¸ªåä¸º/dev/socket/zygoteçš„socketæœåŠ¡ï¼Œå»ç›‘å¬æ‰€æœ‰å¯åŠ¨åº”ç”¨çš„è¯·æ±‚ã€‚ æƒ³ä¹‹å‰çš„æ–‡ç« æ‰€è¯´ï¼ŒSystem Server æ˜¯ä¸€ä¸ªå’Œå®ƒçš„çˆ¶è¿›ç¨‹å®Œå…¨åˆ†ç¦»çš„è¿›ç¨‹ã€‚ä¸€æ—¦System Serveråˆ›å»ºå®Œæˆï¼Œå®ƒä¼šåˆå§‹åŒ–ä¸€ç³»åˆ—ä¸åŒçš„System Serviceså¹¶å¯åŠ¨Activity Managerã€‚é‚£Zygoteæ˜¯å¦‚ä½•å¯åŠ¨æ–°çš„åº”ç”¨çš„å‘¢ï¼Ÿ</p>
<a id="more"></a>
<p>Zygote é€šè¿‡/dev/socket/zygote(ä¸€ä¸ªsockete Socket Server)æ¥æ”¶å¯åŠ¨åº”ç”¨çš„è¯·æ±‚ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡fork()è°ƒç”¨ï¼Œä¼šåœ¨å¦ä¸€ä¸ªå­˜å‚¨ç©ºé—´åˆ›å»ºä¸€ä¸ªè‡ªèº«çš„æ‹·è´ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚å½“Zygoteæ‰§è¡Œforkæ—¶ï¼Œå®ƒä¼šç²¾å‡†åˆ›å»ºä¸€ä¸ªé¢„åŠ è½½äº†åº”ç”¨è¿›ç¨‹æ‰€éœ€çš„æ‰€æœ‰å¿…è¦ç±»å’Œèµ„æºçš„Dalvikè™šæ‹Ÿæœºï¼Œè¿™æ ·å°±ä¼šæŠŠåˆ›å»ºè™šæ‹Ÿæœºå’ŒåŠ è½½èµ„æºçš„è¿‡ç¨‹å˜å¾—å¾ˆé«˜æ•ˆã€‚ä½†è¿™ä¸ªè®¾è®¡ä¸ä»…ä»…æ˜¯è¿™æ ·ã€‚ç”±äºAndroidè¿è¡Œåœ¨Linuxå†…æ ¸ä¸Šï¼ŒLinux Kernalå®ç°äº†ä¸€ä¸ªå«åšCopy On Writeï¼ˆCOWï¼‰çš„ç­–ç•¥ï¼Œåœ¨forkè¿›ç¨‹çš„è¿‡ç¨‹ä¸­å¹¶ä¸ä¼šçœŸæ­£çš„æ‹·è´å†…å­˜ã€‚ä¸€ä¸ªè¿›ç¨‹æƒ³è¦ä¿®æ”¹è¿™ä¸ªå…±äº«çš„å†…å­˜æ˜¯ï¼Œkernelä¼šæ‹¦æˆªè¿™ä¸ªè¯·æ±‚ï¼Œå¹¶å¯¹è¦ä¿®æ”¹çš„å†…å­˜åšä¸€ä¸ªæ‹·è´ã€‚å½“ä¸€äº›Androidçš„ç±»åº“æ˜¯ä¸å¯å†™çš„æƒ…å†µä¸‹ï¼Œé‚£å°±æ„å‘³ç€æ‰€æœ‰ä»Zygote forkå‡ºæ¥çš„è¿›ç¨‹éƒ½åœ¨å…±äº«ä¸€ä»½ç³»ç»Ÿç±»æ–‡ä»¶å’Œèµ„æºã€‚å¦ä¸€ä¸ªå¥½å¤„å°±æ˜¯çœŸçš„èŠ‚çœå†…å­˜ã€‚ä¸ç®¡å¯åŠ¨å¤šå°‘åº”ç”¨è¿›ç¨‹åœ¨å†…å­˜çš„å¢é•¿ä¸Šéƒ½ä¼šå°å¾ˆå¤šã€‚</p>
<p>If you are in an early stage of a porting process, Zygote is another big process that you donâ€™t need to start. You can disable it by adding the keyword â€œdisabledâ€ at the end of the boot sequence in init.rc</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service zygote /system/bin/app_process -Xzygote /system/bin --zygote --start-system-server&#10;class main&#10;socket zygote stream 660 root system&#10;onrestart write /sys/android_power/request_state wake&#10;onrestart write /sys/power/state on&#10;onrestart restart media&#10;onrestart restart netd&#10;disabled</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯ä¸€å¼ è¯´æ˜Zygoteåœ¨Androidå¹³å°ä¸­ä½œç”¨çš„å…³ç³»å›¾(from Embedded Android)ã€‚</p>
<p><img src="/res/zygote/zygote-1.png" alt=""></p>
<p>zygoteçš„main()æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String argv[]) &#123;&#10; try &#123;&#10;     // Start profiling the zygote initialization.&#10;     SamplingProfilerIntegration.start();&#10;&#10;    registerZygoteSocket();&#10;    EventLog.writeEvent(LOG_BOOT_PROGRESS_PRELOAD_START,&#10;    SystemClock.uptimeMillis());&#10;    preload();&#10;    EventLog.writeEvent(LOG_BOOT_PROGRESS_PRELOAD_END,&#10;    SystemClock.uptimeMillis());&#10;&#10;    // Finish profiling the zygote initialization.&#10;    SamplingProfilerIntegration.writeZygoteSnapshot();&#10;&#10;    // Do an initial gc to clean up after startup&#10;    gc();&#10;&#10;    // Disable tracing so that forked processes do not inherit stale tracing tags from&#10;    // Zygote.&#10;    Trace.setTracingEnabled(false);&#10;&#10;    // If requested, start system server directly from Zygote&#10;    if (argv.length != 2) &#123;&#10;        throw new RuntimeException(argv[0] + USAGE_STRING);&#10;    &#125;&#10;&#10;    if (argv[1].equals(&#34;start-system-server&#34;)) &#123;&#10;        startSystemServer();&#10;    &#125; else if (!argv[1].equals(&#34;&#34;)) &#123;&#10;        throw new RuntimeException(argv[0] + USAGE_STRING);&#10;    &#125;&#10;&#10;    Log.i(TAG, &#34;Accepting command socket connections&#34;);&#10;&#10;    runSelectLoop();&#10;&#10;    closeServerSocket();&#10; &#125; catch (MethodAndArgsCaller caller) &#123;&#10;     caller.run();&#10; &#125; catch (RuntimeException ex) &#123;&#10;     Log.e(TAG, &#34;Zygote died with exception&#34;, ex);&#10;     closeServerSocket();&#10;     throw ex;&#10; &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸‹é¢ä»£ç å¯ä»¥çœ‹åˆ°Zygoteæ˜¯å¦‚ä½•å¯åŠ¨System Serverçš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10; * Prepare the arguments and fork for the system server process.&#10; */&#10;private static boolean startSystemServer()&#10;        throws MethodAndArgsCaller, RuntimeException &#123;&#10;    /* Hardcoded command line to start the system server */&#10;    String args[] = &#123;&#10;            &#34;--setuid=1000&#34;,&#10;            &#34;--setgid=1000&#34;,&#10;            &#34;--setgroups=1001,1002,1003,1004,1005,1006,1007,1008,1009,1010,1018,3001,3002,3003,3006,3007&#34;,&#10;            &#34;--capabilities=130104352,130104352&#34;,&#10;            &#34;--runtime-init&#34;,&#10;            &#34;--nice-name=system_server&#34;,&#10;            &#34;com.android.server.SystemServer&#34;,&#10;    &#125;;&#10;    ZygoteConnection.Arguments parsedArgs = null;&#10;&#10;    int pid;&#10;&#10;    try &#123;&#10;        parsedArgs = new ZygoteConnection.Arguments(args);&#10;        ZygoteConnection.applyDebuggerSystemProperty(parsedArgs);&#10;        ZygoteConnection.applyInvokeWithSystemProperty(parsedArgs);&#10;        &#10;        /* Request to fork the system server process */&#10;        pid = Zygote.forkSystemServer(&#10;                parsedArgs.uid, parsedArgs.gid,&#10;                parsedArgs.gids,&#10;                parsedArgs.debugFlags,&#10;                null,&#10;                parsedArgs.permittedCapabilities,&#10;                parsedArgs.effectiveCapabilities);&#10;    &#125; catch (IllegalArgumentException ex) &#123;&#10;        throw new RuntimeException(ex);&#10;    &#125;&#10;    &#10;    /* For child process */&#10;    if (pid == 0) &#123;&#10;        handleSystemServerProcess(parsedArgs);&#10;    &#125;&#10;&#10;    return true;&#10;&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åŸæ–‡åœ°å€ï¼š&lt;a href=&quot;https://anatomyofandroid.com/2013/10/15/zygote/&quot;&gt;Zygote https://anatomyofandroid.com/2013/10/15/zygote/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Zygoteï¼ˆå—ç²¾åµï¼‰æ˜¯ä¸€ä¸ªå¯åŠ¨åº”ç”¨çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œåœ¨Server Managerä¹‹åè¢«init.rcè§¦å‘ï¼Œä½†å…¶å®ä»–æ˜¯çœŸæ­£è¢«app_processå¯åŠ¨çš„ï¼Œä¸‹é¢æ˜¯å¯åŠ¨è¿™ä¸ªç‰¹æ®Šè¿›ç¨‹çš„æµç¨‹ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;service zygote /system/bin/app_process -Xzygote /system/bin --zygote --start-system-server&amp;#10;class main&amp;#10;socket zygote stream 660 root system&amp;#10;onrestart write /sys/android_power/request_state wake&amp;#10;onrestart write /sys/power/state on&amp;#10;onrestart restart media&amp;#10;onrestart restart netd&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä½ å¯ä»¥å‘ç°Zygoteæ˜¯å¦‚ä½•å½“åšç³»ç»ŸæœåŠ¡å¯åŠ¨çš„ï¼Œä½ ä¹Ÿå¯ä»¥çœ‹åˆ°app_processä¸ºä»€ä¹ˆè¯´app_processæ˜¯å¯åŠ¨Zygoteçš„çœŸæ­£å‘½ä»¤ã€‚å°±åƒä¹‹å‰è¯´çš„ï¼ŒZygoteæ˜¯ä¸€ä¸ªä»¥ä¸“é—¨å¯åŠ¨åº”ç”¨ä¸ºçš„å®ˆæŠ¤è¿›ç¨‹ã€‚è¿™æ„å‘³ç€Zygoteæ˜¯æ‰€æœ‰Appè¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚å½“app_processå¯åŠ¨Zygoteæ—¶ï¼Œå®ƒé€šè¿‡è°ƒç”¨Zygoteçš„main()æ–¹æ³•åˆ›å»ºäº†ç¬¬ä¸€ä¸ªDalvikè™šæ‹Ÿæœºã€‚å½“Zygoteå¯åŠ¨åï¼Œzygoteä¼šé¢„åŠ è½½æ‰€æœ‰å¿…é¡»çš„Javaç±»å’Œèµ„æºï¼Œå¯åŠ¨System Serverå¹¶æ‰“å¼€ä¸€ä¸ªåä¸º/dev/socket/zygoteçš„socketæœåŠ¡ï¼Œå»ç›‘å¬æ‰€æœ‰å¯åŠ¨åº”ç”¨çš„è¯·æ±‚ã€‚ æƒ³ä¹‹å‰çš„æ–‡ç« æ‰€è¯´ï¼ŒSystem Server æ˜¯ä¸€ä¸ªå’Œå®ƒçš„çˆ¶è¿›ç¨‹å®Œå…¨åˆ†ç¦»çš„è¿›ç¨‹ã€‚ä¸€æ—¦System Serveråˆ›å»ºå®Œæˆï¼Œå®ƒä¼šåˆå§‹åŒ–ä¸€ç³»åˆ—ä¸åŒçš„System Serviceså¹¶å¯åŠ¨Activity Managerã€‚é‚£Zygoteæ˜¯å¦‚ä½•å¯åŠ¨æ–°çš„åº”ç”¨çš„å‘¢ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="https://ivonhoe.github.io/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="Zygote" scheme="https://ivonhoe.github.io/tags/Zygote/"/>
    
      <category term="ç¿»è¯‘" scheme="https://ivonhoe.github.io/tags/%E7%BF%BB%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨ddmlib dumpå‡ºå †æ–‡ä»¶</title>
    <link href="https://ivonhoe.github.io/2017/04/09/how-to-dump-heap/"/>
    <id>https://ivonhoe.github.io/2017/04/09/how-to-dump-heap/</id>
    <published>2017-04-09T11:03:01.000Z</published>
    <updated>2018-05-27T08:20:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€èˆ¬æƒ…å†µä¸‹å¦‚æœæˆ‘æƒ³è¦è¾ƒè¯¦ç»†çš„åˆ†æå†…å­˜çŠ¶å†µï¼Œä¼šä½¿ç”¨android monitor(ä¸‹ç®€ç§°monitor)å’ŒMemory Analyzerå·¥å…·(ä¸‹ç®€ç§°MAT)ï¼Œä½†æ­¥éª¤æœ‰äº›éº»çƒ¦ã€‚</p>
<ol>
<li>ä½¿ç”¨monitor dumpå †æ–‡ä»¶</li>
<li>ä½¿ç”¨hprof-convå·¥å…·ï¼Œå°†hprofè½¬æ¢æˆMATèƒ½å¤Ÿè¯†åˆ«çš„æ ¼å¼</li>
<li>ä½¿ç”¨MATåˆ†æ</li>
</ol>
<p>éœ€è¦æ‰‹åŠ¨dump hprofå†ä½¿ç”¨hprof-convå·¥å…·æ‰‹åŠ¨è½¬ç ï¼Œä¸Šç¯‡<a href="https://ivonhoe.github.io/2017/03/22/Bitmap&amp;Memory/">Android Bitmapçš„å†…å­˜å¤§å°æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ</a>è¯´åˆ°ä½¿ç”¨squareçš„<a href="https://github.com/square/haha" target="_blank" rel="external">haha</a>æ¥åšå†…å­˜å †ä¸­Bitmapçš„åˆ†æã€‚æ‰€ä»¥åœ¨æ€è€ƒå¦‚ä½•ä¸€é”®å®Œæˆå†…å­˜dumpå’Œanalyzeçš„è¿‡ç¨‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä»»æ„å…¶ä»–Javaå¯¹è±¡åšåˆ†æã€‚<br>å¦‚ä½•å®Œæˆdumpå’Œè½¬ç ï¼Œæ€è·¯è¿˜æ˜¯Read the fucking source codeï¼Œçœ‹ä¸‹monitoræ˜¯å¦‚ä½•dump hprofæ–‡ä»¶çš„ã€‚æ‰“å¼€Android sdkç›®å½•ï¼Œmonitorå’Œå…¶ä¾èµ–çš„jaråˆ†åˆ«åœ¨<code>/tools</code>å’Œâ€™/tools/libâ€™ç›®å½•ï¼Œæ ¸å¿ƒä»£ç åœ¨<code>ddmlib.jar</code>ä¸­ï¼ŒJava swringä»£ç åœ¨<code>ddms.jar</code>å’Œ<code>ddmuilib.jar</code>ä¸­ï¼Œddmlibéœ€è¦ä¾èµ–<code>common.jar</code>å’Œ<code>guava.jar</code>ã€‚</p>
<a id="more"></a>
<p><img src="/res/hprof/hprof-1.png" alt=""></p>
<h3 id="å¦‚ä½•ä½¿ç”¨ddmlibè·å–adbè¿æ¥çš„è®¾å¤‡">å¦‚ä½•ä½¿ç”¨ddmlibè·å–adbè¿æ¥çš„è®¾å¤‡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;&#10;        IDevice device;&#10;        // &#36825;&#37324;&#38656;&#35201;&#20256;&#21442;true&#65292;&#19981;&#28982;&#24453;&#20250;&#20250;&#25343;&#19981;&#21040;&#25163;&#26426;&#19978;&#30340;client&#10;        AndroidDebugBridge.init(true);&#10;        AndroidDebugBridge bridge = AndroidDebugBridge.createBridge(&#10;                &#34;/Users/Ivonhoe/Library/Android/sdk/platform-tools/adb&#34;, false);&#10;        waitForDevice(bridge);&#10;        IDevice devices[] = bridge.getDevices();&#10;        device = devices[0];&#10;    &#125;&#10;&#10;    private static void waitForDevice(AndroidDebugBridge bridge) &#123;&#10;        int count = 0;&#10;        while (!bridge.hasInitialDeviceList()) &#123;&#10;            try &#123;&#10;                Thread.sleep(100);&#10;                count++;&#10;            &#125; catch (InterruptedException ignored) &#123;&#10;            &#125;&#10;            if (count &#62; 300) &#123;&#10;                System.err.print(&#34;Time out&#34;);&#10;                break;&#10;            &#125;&#10;        &#125;&#10;    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¦‚ä½•dump_hprof">å¦‚ä½•dump hprof</h3><p><strong>è¿™é‡Œä¸è¯´çœ‹ddmsæºç çš„è¿‡ç¨‹äº†ï¼Œä¸»è¦è¿˜æ˜¯é€šè¿‡å…³é”®å­—æœç´¢è·Ÿä¸€ä¸‹dumpæ“ä½œçš„å¤„ç†é€»è¾‘</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10; * &#35774;&#32622;HprofDumpHandler&#65292;&#23545;dump&#20107;&#20214;&#20570;&#30417;&#21548;&#22788;&#29702;dump&#25104;&#21151;&#25110;&#32773;&#22833;&#36133;&#30340;&#22238;&#35843;&#65292;&#10; * &#24182;&#20445;&#23384;hprof&#25991;&#20214;&#25968;&#25454;&#10; *&#10; * @param device&#10; */&#10;public HprofDump(Device device) &#123;&#10;    mDevice = device;&#10;&#10;    ClientData.IHprofDumpHandler hprofDumpHandler = new ClientData.IHprofDumpHandler() &#123;&#10;&#10;        @Override&#10;        public void onSuccess(String remoteFilePath, Client client) &#123;&#10;            String hprofPath = getHprofPath(client.getClientData().getClientDescription());&#10;            mDevice.pull(hprofPath, remoteFilePath);&#10;&#10;            conversionAndRemoveHprof(hprofPath);&#10;&#10;            isDumping = false;&#10;        &#125;&#10;&#10;        @Override&#10;        public void onSuccess(byte[] bytes, Client client) &#123;&#10;            String hprofPath = getHprofPath(client.getClientData().getClientDescription());&#10;            Utilities.saveFile(bytes, hprofPath);&#10;&#10;            conversionAndRemoveHprof(hprofPath);&#10;&#10;            isDumping = false;&#10;        &#125;&#10;&#10;        @Override&#10;        public void onEndFailure(Client client, String s) &#123;&#10;            isDumping = false;&#10;        &#125;&#10;    &#125;;&#10;    ClientData.setHprofDumpHandler(hprofDumpHandler);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è¿™é‡Œé»˜è®¤é€‰æ‹©æ ˆé¡¶è¿›ç¨‹åšdumpæ“ä½œï¼Œé€šè¿‡adb shell dumpsys activity topå‘½ä»¤è·å–æ ˆé¡¶TASKçš„ApplicationIdï¼Œé€šè¿‡IDeviceæ¥å£çš„getClientæ–¹æ³•è·å–Clientå¯¹è±¡ï¼Œæ‰§è¡ŒdumpHprofæ“ä½œ</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10; * dump&#26632;&#39030;&#36827;&#31243;&#30340;hprof&#10; */&#10;public void dumpTopTaskHprof() &#123;&#10;    if (isDumping) &#123;&#10;        return;&#10;    &#125;&#10;&#10;    IDevice iDevice = mDevice.getIDevice();&#10;&#10;    /**&#10;     * &#36825;&#37324;&#33258;&#21160;&#36873;&#25321;&#25163;&#26426;&#19978;&#26632;&#39030;&#36827;&#31243;&#20570;dump&#25805;&#20316;&#65292;&#33719;&#21462;applicationName&#10;     */&#10;    String topApp = getTopApplication();&#10;    Client client = iDevice.getClient(topApp);&#10;&#10;    if (client == null) &#123;&#10;        throw new RuntimeException(&#34;Can not dump app:&#34; + topApp);&#10;    &#125;&#10;    client.dumpHprof();&#10;    isDumping = true;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>åœ¨IHprofDumpHandlerçš„å›è°ƒä¸­, ä¿å­˜hprofæ–‡ä»¶ï¼Œåšæ ¼å¼è½¬æ¢ï¼Œåˆ†æBitmapå¯¹è±¡çš„çŠ¶å†µã€‚BitmapAnalyzer.javaçš„ä»£ç åœ¨ä¸Šæ–‡è¯´è¿‡ã€‚</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private void conversionAndRemoveHprof(String hprofPath) &#123;&#10;    String convHprofPath = getConvHprofPath(hprofPath);&#10;    hprofConv(hprofPath, convHprofPath);&#10;    removeFile(hprofPath);&#10;&#10;    analyzerBitmap(convHprofPath);&#10;&#125;&#10;&#10;private void hprofConv(String hprofPath, String convHprofPath) &#123;&#10;    String adbPath = Adb.instance().getAdbPath();&#10;    String hprofConvPath = adbPath.replace(&#34;adb&#34;, &#34;hprof-conv&#34;);&#10;    ShellCommand.exec(hprofConvPath + &#34; &#34; + hprofPath + &#34; &#34; + convHprofPath);&#10;&#125;&#10;&#10;private void analyzerBitmap(String hprofPath) &#123;&#10;    String[] args = new String[2];&#10;    args[0] = hprofPath;&#10;    args[1] = &#34;bitmap&#34;;&#10;    BitmapAnalyzer.main(args);&#10;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å…³äºBitmapAnalyzerçš„é‚£äº›å‘ç°">å…³äºBitmapAnalyzerçš„é‚£äº›å‘ç°</h3>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹å¦‚æœæˆ‘æƒ³è¦è¾ƒè¯¦ç»†çš„åˆ†æå†…å­˜çŠ¶å†µï¼Œä¼šä½¿ç”¨android monitor(ä¸‹ç®€ç§°monitor)å’ŒMemory Analyzerå·¥å…·(ä¸‹ç®€ç§°MAT)ï¼Œä½†æ­¥éª¤æœ‰äº›éº»çƒ¦ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨monitor dumpå †æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨hprof-convå·¥å…·ï¼Œå°†hprofè½¬æ¢æˆMATèƒ½å¤Ÿè¯†åˆ«çš„æ ¼å¼&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨MATåˆ†æ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;éœ€è¦æ‰‹åŠ¨dump hprofå†ä½¿ç”¨hprof-convå·¥å…·æ‰‹åŠ¨è½¬ç ï¼Œä¸Šç¯‡&lt;a href=&quot;https://ivonhoe.github.io/2017/03/22/Bitmap&amp;amp;Memory/&quot;&gt;Android Bitmapçš„å†…å­˜å¤§å°æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ&lt;/a&gt;è¯´åˆ°ä½¿ç”¨squareçš„&lt;a href=&quot;https://github.com/square/haha&quot;&gt;haha&lt;/a&gt;æ¥åšå†…å­˜å †ä¸­Bitmapçš„åˆ†æã€‚æ‰€ä»¥åœ¨æ€è€ƒå¦‚ä½•ä¸€é”®å®Œæˆå†…å­˜dumpå’Œanalyzeçš„è¿‡ç¨‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä»»æ„å…¶ä»–Javaå¯¹è±¡åšåˆ†æã€‚&lt;br&gt;å¦‚ä½•å®Œæˆdumpå’Œè½¬ç ï¼Œæ€è·¯è¿˜æ˜¯Read the fucking source codeï¼Œçœ‹ä¸‹monitoræ˜¯å¦‚ä½•dump hprofæ–‡ä»¶çš„ã€‚æ‰“å¼€Android sdkç›®å½•ï¼Œmonitorå’Œå…¶ä¾èµ–çš„jaråˆ†åˆ«åœ¨&lt;code&gt;/tools&lt;/code&gt;å’Œâ€™/tools/libâ€™ç›®å½•ï¼Œæ ¸å¿ƒä»£ç åœ¨&lt;code&gt;ddmlib.jar&lt;/code&gt;ä¸­ï¼ŒJava swringä»£ç åœ¨&lt;code&gt;ddms.jar&lt;/code&gt;å’Œ&lt;code&gt;ddmuilib.jar&lt;/code&gt;ä¸­ï¼Œddmlibéœ€è¦ä¾èµ–&lt;code&gt;common.jar&lt;/code&gt;å’Œ&lt;code&gt;guava.jar&lt;/code&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://ivonhoe.github.io/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
    
      <category term="dump heap" scheme="https://ivonhoe.github.io/tags/dump-heap/"/>
    
      <category term="å†…å­˜" scheme="https://ivonhoe.github.io/tags/%E5%86%85%E5%AD%98/"/>
    
  </entry>
  
  <entry>
    <title>Android Bitmapçš„å†…å­˜å¤§å°æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ</title>
    <link href="https://ivonhoe.github.io/2017/03/22/Bitmap&amp;Memory/"/>
    <id>https://ivonhoe.github.io/2017/03/22/Bitmap&amp;Memory/</id>
    <published>2017-03-22T11:35:36.000Z</published>
    <updated>2018-05-27T08:20:24.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€å‰è¨€">ä¸€ã€å‰è¨€</h3><p>æœ¬æ¥åªæƒ³è¯´ä¸‹Bitmapå’Œå†…å­˜çš„åŸºæœ¬å…³ç³»ï¼Œä½†å‘ç°å¦‚æœçœŸçš„æƒ³æŠŠè¿™çœ‹ä¼¼ç®€å•çš„äº‹æƒ…è¯´æ¸…æ¥šï¼Œå®é™…ä¸Šæœªå¿…é‚£ä¹ˆç®€å•ï¼Œä½ ä¸ä¿¡ï¼Ÿä¸å¦¨å…ˆå°è¯•ä¸‹å›ç­”ä¸‹é¢å‡ ä¸ªé—®é¢˜ï¼</p>
<ul>
<li>é—®1ï¼šä»€ä¹ˆæ˜¯dpiï¼Ÿä»€ä¹ˆæ˜¯dpï¼Ÿç­”ï¼šä½ åœ¨ä¾®è¾±æˆ‘ï¼Ÿæˆ‘æ‹’ç»å›ç­”ï¼ï¼ˆï¼šæ— è¾œè„¸</li>
<li>é—®2ï¼šä»¥Nexus6ä¸ºä¾‹ï¼Œåˆ†è¾¨ç‡1440*2560ï¼Œ5.96è‹±å¯¸ï¼Œppiæ˜¯ä»€ä¹ˆï¼Ÿdpiæ˜¯ä»€ä¹ˆï¼Ÿ1dpæ˜¯å¤šå°‘åƒç´ ï¼Ÿ</li>
<li>é—®3ï¼šè¿˜ä»¥Nexus6ä¸ºä¾‹ï¼Œä¸€å¼ 180*180çš„å›¾ç‰‡ï¼Œæ”¾ç½®åœ¨è®¾ç½®äº†<code>wrap_content</code>å±æ€§çš„ImageViewä¸­ï¼Œå½“è¿™å¼ å›¾ç‰‡ï¼Œåˆ†åˆ«æ”¾åœ¨<code>drawable-nodpi</code>,<code>drawable-mdpi</code>,<code>drawable-hdpi</code>, <code>drawable-xxhdpi</code>,<code>drawable-xxxhdpi</code>è¿™å‡ ä¸ªèµ„æºç›®å½•ä¸­ï¼Œåœ¨å±å¹•ä¸Šåˆ†åˆ«æ˜¾ç¤ºå¤šå¤§(åƒç´ )çš„å›¾ç‰‡ï¼Ÿ</li>
<li>é—®4ï¼šè¿™å¼ å›¾ç‰‡å ç”¨çš„å†…å­˜å¤§å°åˆ†åˆ«ä¸ºå¤šå°‘ï¼Ÿ</li>
<li>é—®5ï¼šå¦‚æœè®¾ç½®ImageViewçš„å®½å’Œé«˜ä¸ºå›ºå®šçš„å€¼ï¼Œå¦‚50pxï¼Œé‚£ä¹ˆä¸Šè¿°æƒ…å†µä¸‹ï¼ŒåŠ è½½çš„Bitmapå ç”¨å†…å­˜å¤§å°åˆ†åˆ«ä¸ºå¤šå¤§ï¼Ÿ</li>
</ul>
<p>æœ¬æ–‡ä¸»è¦å›´ç»•ä¸Šè¿°é—®é¢˜ï¼Œä»‹ç»Androidå›¾ç‰‡èµ„æºåŠ è½½çš„åŸºæœ¬æœºåˆ¶ï¼Œå›¾ç‰‡çš„å†…å­˜å¤§å°å¦‚ä½•è®¡ç®—ï¼Œä»¥åŠå†…å­˜å›¾ç‰‡åˆ†æå·¥å…·ã€‚</p>
<a id="more"></a>
<h3 id="äºŒã€åŸºç¡€æ¦‚å¿µ">äºŒã€åŸºç¡€æ¦‚å¿µ</h3><ul>
<li>pxï¼šåƒç´ (pixel)ï¼ŒæŒ‡çš„æ˜¯å±å¹•ä¸Šçš„ç‰©ç†ç‚¹ï¼Œæœ€å°çš„ç‹¬ç«‹æ˜¾ç¤ºå•ä½</li>
<li>ppiï¼šæ¯è‹±å¯¸åƒç´ ç‚¹(Pixels Per Inch)ï¼Œä¹‹å‰æˆ‘è‡ªå·±çš„ç†è§£å°±æ˜¯ä½¿ç”¨å‹¾è‚¡å®šç†ï¼Œé€šè¿‡å±å¹•é•¿å®½è®¡ç®—å‡ºå¯¹è§’çº¿çš„é•¿åº¦ï¼Œå†é™¤ä»¥å±å¹•å¯¹è§’çº¿è‹±å¯¸å€¼ã€‚</li>
<li>dpiï¼šæ¯è‹±å¯¸ç‚¹(Dots Per Inch)ï¼Œå’Œppiæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li>
<li>dpï¼šåƒç´ æ— å…³ç‚¹(Density-Independent pixel)ï¼Œè¿™ä¸ªAndroidå®šä¹‰çš„è™šæ‹Ÿå€¼ï¼Œå’Œpxå…³ç³»å¼æ˜¯<code>px = dp * (dpi / 160)</code>ï¼Œä¸ºå•¥ï¼Ÿ</li>
</ul>
<p><strong>ppi</strong></p>
<p>ppiæŒ‡çš„æ˜¯æ°´å¹³æ–¹å‘æˆ–è€…ç«–ç›´æ–¹å‘ä¸Šæ¯è‹±å¯¸çš„åƒç´ å€¼ï¼Œå…ˆè¯´ä¸ºå•¥å¾ˆå¤šå¯¹ppiçš„ç†è§£éƒ½æœ‰é—®é¢˜ã€‚å¾ˆå¤šæ–‡ç« åˆ©ç”¨å‹¾è‚¡å®šç†è®¡ç®—æ‰‹æœºå±å¹•å¯¹è§’çº¿åƒç´ ä¸ªæ•°ï¼ï¼ä½†æ˜¯æ‰‹æœºå±å¹•çš„åƒç´ åˆ†å¸ƒæ˜¯ç‚¹é˜µåˆ†å¸ƒï¼Œç‚¹é˜µçš„å¯¹è§’çº¿åƒç´ ç‚¹ä¸æ˜¯ç”¨å‹¾è‚¡å®šç†ç®—å‡ºæ¥çš„ï¼Œè€Œæ˜¯ç­‰äºå®ƒçš„è¡Œæ•°æˆ–è€…åˆ—æ•°ï¼Œä¸ºå•¥ç”¨å¯¹è§’çº¿è®¡ç®—ï¼Ÿå› ä¸ºä¸€èˆ¬æ‰‹æœºçš„å°ºå¯¸è¯´çš„å°±æ˜¯å¯¹è§’çº¿è‹±å¯¸å€¼ï¼Œè€Œä¸çŸ¥é“é•¿å®½çš„è‹±å¯¸å€¼ã€‚è¿™é‡Œæœ‰ä¸ªå…¬å¼æ¨å¯¼ï¼š<br>è®¾ X/x = Y/y = ppiï¼Œè¿™é‡ŒXä¸ºæ°´å¹³åƒç´ å€¼ï¼Œxä¸ºæ°´å¹³è‹±å¯¸å€¼ï¼ŒYä¸ºç«–ç›´åƒç´ å€¼ï¼Œyä¸ºç«–ç›´è‹±å¯¸å€¼ã€‚åˆ™(XÂ²+YÂ²ï¼‰/ï¼ˆxÂ²+yÂ²ï¼‰=ï¼ˆX/xï¼‰Â²=ï¼ˆY/yï¼‰Â²ï¼Œè¿™ä¸ªå…¬å¼å¯é€šè¿‡å‹¾è‚¡å®šç†å’Œç›¸ä¼¼ä¸‰è§’å½¢åŸç†è¯æ˜ã€‚ppiçš„è®¡ç®—åªæ˜¯å½¢å¼å’Œå‹¾è‚¡å®šç†ä¸€æ ·ä½†å¹¶ä¸æ˜¯å‹¾è‚¡å®šç†çš„æ„æ€ï¼Œåˆ†å­ä¹Ÿä¸æ˜¯å¯¹è§’çº¿çš„åƒç´ æ•°ï¼ï¼ppiçš„è®¡ç®—å…¬å¼å¯è¡¨ç¤ºä¸ºï¼šâˆš(XÂ²+YÂ²ï¼‰/å¯¹è§’çº¿è‹±å¯¸ã€‚ä½†ä¸æ„å‘³ç€ppiæ˜¯ä½¿ç”¨å‹¾è‚¡å®šç†è®¡ç®—å¯¹è§’çº¿åƒç´ å€¼è·å¾—çš„~~</p>
<p><img src="/res/bitmap/2.png" alt=""></p>
<p><a href="https://www.zhihu.com/question/21220154/answer/69672901" target="_blank" rel="external">DPIã€PPIã€DPã€PX çš„è¯¦ç»†è®¡ç®—æ–¹æ³•åŠç®—æ³•æ¥æºæ˜¯ä»€ä¹ˆï¼Ÿfskçš„å›ç­”</a></p>
<p><strong>dpi</strong></p>
<p>dpiæ˜¯ç”±ppiç¡®å®šçš„ï¼Œè¿˜æ˜¯ä»¥Nexue6ä¸ºä¾‹ï¼Œé€šè¿‡ppiçš„è®¡ç®—å…¬å¼ï¼Œå¯ä»¥è®¡ç®—å‡ºNexues6çš„ppiä¸º<code>492</code>,å‚ç…§ä¸‹è¡¨ï¼Œåº”è¯¥åœ¨xxxhdpiçš„èŒƒå›´å†…ï¼Œä½†å®ƒçš„dpiå¹¶ä¸æ˜¯<code>492</code>ã€‚å®é™…ä¸Šdpiåªæœ‰120(low)ã€160(medium)ã€240(high)ã€260ã€280ã€300ã€320(xhigh)ã€340ã€360ã€400ã€420ã€480ï¼ˆxxhpdiï¼‰ã€560ã€640ï¼ˆxxxhpiï¼‰è¿™å‡ ç§ï¼Œå¯ä»¥å‚ç…§<code>android.util.DisplayMetrics</code>çš„æºç ã€‚é€šè¿‡<code>getResources().getDisplayMetrics().densityDpi</code>å¯ä»¥è·å–æ‰‹æœºå®é™…çš„dpiã€‚</p>
<p><img src="/res/bitmap/dpi.png" alt=""></p>
<p><a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/util/DisplayMetrics.java" target="_blank" rel="external">DisplayMetrics.javaæºç é“¾æ¥</a></p>
<p><strong>dp</strong></p>
<p>1dpåœ¨Nexues6ä¸Šæ˜¯å¤šå°‘åƒç´ ï¼Ÿ<br><code>1dp * (560/160) = 3.5px</code></p>
<p><strong>å¦‚ä½•æ›´æ”¹æ‰‹æœºçš„dpi</strong></p>
<ul>
<li>éœ€è¦rootçš„æ‰‹æœº</li>
<li>æ›´æ”¹/system/build.propä¸­çš„ro.sf.lcd_densityå±æ€§ï¼Œè¿™ä¸ªå€¼è¶Šå°ï¼Œå±å¹•å¯†åº¦è¶Šé«˜</li>
<li>adb reboot é‡å¯æ‰‹æœº</li>
</ul>
<p><strong>å¦‚ä½•å¿«é€ŸæŸ¥çœ‹æ‰‹æœºå±å¹•ä¿¡æ¯</strong></p>
<p><code>adb shell dumpsys display | findstr DisplayDeviceInfo</code></p>
<h3 id="ä¸‰ã€å›åˆ°é—®é¢˜">ä¸‰ã€å›åˆ°é—®é¢˜</h3><p>ä»¥Nexus6ä¸ºä¾‹ï¼Œä¸€å¼ 180*180çš„å›¾ç‰‡ï¼Œæ”¾åœ¨è®¾ç½®äº†<code>wrap_content</code>å±æ€§çš„ImageViewä¸­ï¼Œå½“è¿™å¼ å›¾ç‰‡ï¼Œåˆ†åˆ«æ”¾ç½®åœ¨<code>drawable-nodpi</code>,<code>drawable-mdpi</code>,<code>drawable-hdpi</code>, <code>drawable-xxhdpi</code>,<code>drawable-xxxhdpi</code>è¿™å‡ ä¸ªèµ„æºç›®å½•ä¸­ï¼Œåœ¨å±å¹•ä¸Šåˆ†åˆ«æ˜¾ç¤ºå¤šå¤§(åƒç´ )çš„å›¾ç‰‡ï¼Ÿ</p>
<p>ç­”ï¼šæ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œå¯ä»¥çœ‹åˆ°nexus6ï¼Œæ˜¯å±äºxxxhpiçš„å±å¹•ï¼Œè·å–åˆ°dpiä¸º560ã€‚å¦‚æœæŠŠ180å¤§å°çš„å›¾ç‰‡åªæ”¾åœ¨xxxhdpiç›®å½•ä¸­ï¼Œæ˜¯ä¸æ˜¯å±å¹•å°±ä¼šæ˜¾ç¤º180pxçš„å¤§å°ï¼Ÿå…¶å®å¹¶ä¸æ˜¯ï¼Œdpi=640çš„æ‰æ˜¯çœŸæ­£çš„xxxhdpi(è¿™é‡Œéœ€è¦çœ‹DisplayMetricsçš„æºç )ï¼Œå½“Androidç³»ç»ŸåŠ è½½å›¾ç‰‡æ—¶ï¼Œä¼šé’ˆå¯¹å½“å‰ç³»ç»Ÿçš„dpiå’Œå›¾ç‰‡ç›®å½•çš„source dpiæ¯”è¾ƒåšç›¸åº”æ¯”ä¾‹çš„ç¼©æ”¾ï¼Œå¦‚æœä¸€å¼ å›¾ç‰‡æ”¾åœ¨drawable-xxxhdpiç›®å½•ï¼Œè¿™æ˜¯å‘Šè¯‰ç³»ç»Ÿï¼Œé’ˆå¯¹dpiä¸º640çš„æ‰‹æœºå±å¹•ä¸Šï¼Œè¿™å¼ å›¾ç‰‡æ˜¯åˆšåˆšå¥½çš„ï¼Œå®ƒçš„scaleä¸º1.0ï¼ŒåŒç†ï¼Œdrawable-xxhpiå¯¹åº”480dpiï¼Œdrawable-xhdpiå¯¹åº”çš„æ˜¯320dpiã€‚å¦‚æœå¸Œæœ›<code>180*180</code>åœ¨nexues6çš„å±å¹•ä¸ŠæŒ‰ç…§åŸæœ‰å°ºå¯¸æ˜¾ç¤ºï¼Œåªæœ‰å°†å…¶æ”¾åœ¨drawable-nodpiæˆ–è€…drawable-560dpiç›®å½•ä¸­æ‰å¯ä»¥ã€‚</p>
<p>å›åˆ°é—®é¢˜ï¼Œå¦‚æœå°†<code>180*180</code>æ”¾å…¥hdpiç›®å½•ä¸­ï¼Œé‚£å®é™…æ˜¾ç¤ºçš„å›¾ç‰‡å¤§å°åº”è¯¥ä¸ºï¼š<code>int (180 * (560 / 240) +0.5f ) = 420px</code>ï¼Œå®é™…å›¾ç‰‡çš„å¤§å°åº”è¯¥ä¸º420pxï¼åŒç†:<br>æ”¾å…¥xhdpiç›®å½•ä¸­ï¼Œå®é™…å¤§å°åº”è¯¥ä¸º<code>int (180 * (560 / 320) +0.5f ) = 315px</code><br>æ”¾å…¥xxhdpiç›®å½•ä¸­ï¼Œå®é™…å¤§å°åº”è¯¥ä¸º<code>int (180 * (560 / 480) +0.5f ) = 210px</code></p>
<p><a href="https://android.googlesource.com/platform/frameworks/base/+/7b2f8b8/core/jni/android/graphics/BitmapFactory.cpp" target="_blank" rel="external">BitmapFactory.cppæºç é“¾æ¥</a></p>
<p>å¦‚æœç”¨å°çš„Bitmapå®¹å™¨ï¼Œæ”¾ç½®è¾ƒå¤§çš„Bitmapï¼Œé‚£è¿™ä¸ªBitmapçš„å°ºå¯¸å¤§å°æ˜¯æŒ‰ç…§å®¹å™¨çš„å¤§å°è®¡ç®—ï¼Ÿè¿˜æ˜¯æŒ‰ç…§dpiç¼©æ”¾çš„è§„åˆ™è®¡ç®—ï¼Ÿ</p>
<h3 id="å››ã€ä¸€å¼ å›¾ç‰‡å å¤šå¤§å†…å­˜">å››ã€ä¸€å¼ å›¾ç‰‡å å¤šå¤§å†…å­˜</h3><p>ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“äº†ä¸€å¼ å›¾ç‰‡æ”¾ç½®åœ¨ä¸åŒçš„èµ„æºç›®å½•ä¸­ï¼Œç³»ç»Ÿdecodeçš„bitmapçš„å°ºå¯¸å¤§å°æ˜¯å¦‚ä½•è®¡ç®—çš„äº†ã€‚ä¸€å¼ å›¾ç‰‡å¤§æ¦‚å ç”¨å¤šå°‘å†…å­˜ï¼Œå…¶å®åªç”¨çœ‹ä¸€ä¸ªåƒç´ å ç”¨å¤šå°‘å†…å­˜å°±å¯ä»¥å–½ï¼Ÿæˆ‘ä»¬éƒ½çŸ¥é“å±å¹•ä¸Šçš„é¢œè‰²æ˜¯æœ‰Rï¼ŒGï¼ŒBåŠ é€æ˜åº¦è¡¨ç¤ºçš„ï¼ŒAndroidå®˜æ–¹æ”¯æŒçš„RGBæ ¼å¼ï¼Œä¸»è¦æ˜¯<code>ALPHA_8</code>ï¼Œ<code>RGB_565</code>ï¼Œ<code>ARGB_4444</code>ï¼Œ<code>ARGB_8888</code>è¿™å‡ ç§ã€‚</p>
<p>ä»¥ARGB_8888ä¸ºä¾‹ï¼Œè¡¨ç¤ºä¸€ä¸ªåƒç´ ç‚¹ï¼Œä½¿ç”¨8ä½è¡¨ç¤ºé€æ˜åº¦ï¼Œ8ä½è¡¨ç¤ºRedï¼Œ8ä½è¡¨ç¤ºGreenï¼Œ8ä½è¡¨ç¤ºBlueã€‚åŠ èµ·æ¥ï¼Œä¸€ä¸ªåƒç´ å°±éœ€è¦4byteï¼ŒåŒç†ï¼ŒRGB_565ä¸€ä¸ªåƒç´ éœ€è¦2byteã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public enum Config &#123;&#10;    ALPHA_8     (1),&#10;    RGB_565     (3),&#10;    @Deprecated&#10;    ARGB_4444   (4),&#10;    ARGB_8888   (5);&#10;    final int nativeInt;&#10;    Config(int ni) &#123;&#10;        this.nativeInt = ni;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>Android decodeèµ„æºå›¾ç‰‡æ—¶é»˜è®¤ä¼šé€‰æ‹©ARGB_8888ï¼Œå¦‚æœå°†<code>180*180</code>æ”¾å…¥hdpiç›®å½•ä¸­ï¼Œé‚£å®é™…å¤§å°åº”è¯¥ä¸º<code>int (180 * (560 / 240) +0.5f ) = 420px</code>ï¼Œåƒç´ å†…å­˜å¤§å°ä¸º <code>420 * 420 * 4 = 705600byte = 689kb</code>ã€‚åŒç†:<br>æ”¾å…¥xhdpiç›®å½•ä¸­ï¼Œå®é™…å¤§å°åº”è¯¥ä¸º<code>int (180 * (560 / 320) +0.5f ) = 315px</code>ï¼Œåƒç´ å†…å­˜å¤§å°ä¸º<code>315 * 315 * 4 = 396900byte = 387.6kb</code><br>æ”¾å…¥xxhdpiç›®å½•ä¸­ï¼Œå®é™…å¤§å°åº”è¯¥ä¸º<code>int (180 * (560 / 480) +0.5f ) = 210px</code>ï¼Œåƒç´ å†…å­˜å¤§å°ä¸º<code>210 * 210 * 4 = 176400byte = 172.2kb</code></p>
<h3 id="äº”ã€å¦‚ä½•åˆ†æå†…å­˜ä¸­çš„å›¾ç‰‡é—®é¢˜ï¼Ÿ">äº”ã€å¦‚ä½•åˆ†æå†…å­˜ä¸­çš„å›¾ç‰‡é—®é¢˜ï¼Ÿ</h3><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œç»ˆäºåˆ°äº†æˆ‘åŸæœ¬æƒ³è¯´çš„ã€‚Androidçš„å†…å­˜ä¼˜åŒ–éœ€è¦é‡ç‚¹å…³æ³¨çš„å‡ ä¸ªæ–¹é¢ï¼ŒBitmapçš„åŠ è½½ï¼ŒActivityçš„æ³„éœ²ï¼Œwebviewå†…å­˜ç­‰ã€‚å›¾ç‰‡çš„å†…å­˜é—®é¢˜ï¼Œæ˜¯å¾ˆå¤šAndroidåº”ç”¨ï¼Œç‰¹åˆ«æ˜¯ç”µå•†APPéœ€è¦é¦–è¦å…³æ³¨çš„é—®é¢˜ã€‚é‚£å¦‚ä½•ç®€å•çš„åˆ†æå‡ºå†…å­˜ä¸­Bitmapçš„æƒ…å†µï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªå·¥å…·ã€‚å€ŸåŠ©leakcanaryçš„æ€è·¯ï¼Œé€šè¿‡åˆ†æå†…å­˜å †dumpæ–‡ä»¶ä¸­<code>android.graphics.Bitmap</code>å¯¹è±¡çš„æƒ…å†µï¼Œ<strong>å°†å†…å­˜ä¸­Bitmapå¯¹è±¡æ‰¹é‡ä¿å­˜åˆ°å›¾ç‰‡æ–‡ä»¶ä¸­</strong>ï¼Œè¿™æ ·å°±å¯ä»¥ç›´è§‚çš„çœ‹åˆ°å†…å­˜ä¸­åŠ è½½çš„Bitmapä¸ªæ•°ã€å†…å®¹å’Œå¤§å°ï¼Œè¿›è€Œåˆ†æå¯èƒ½çš„å†…å­˜é—®é¢˜ã€‚</p>
<p><img src="/res/bitmap/bitmap_buffer.png" alt=""></p>
<p><img src="/res/bitmap/1.png" alt=""></p>
<p><strong>ç¤ºä¾‹</strong></p>
<p>ä»¥åˆ†æè˜‘è‡è¡—APPå†…å­˜ä¸­bitmapä¸ºä¾‹:</p>
<ul>
<li>å…ˆä½¿ç”¨Android monitor dump hprof</li>
<li>hprof-convåšæ ¼å¼è½¬æ¢</li>
<li><code>java -jar ./bitmap-analyzer-0.0.1-SNAPSHOT.jar /Users/Ivonhoe/hprof/com.mogujie-conv.hprof è˜‘è‡è¡—</code></li>
</ul>
<p><strong>å‚æ•°è¯´æ˜</strong>ï¼š</p>
<ul>
<li>å‚æ•°1ï¼šéœ€è¦å¤„ç†hprofæ–‡ä»¶çš„ç»å¯¹è·¯å¾„</li>
<li>å‚æ•°2ï¼šå›¾ç‰‡è¾“å‡ºçš„æ–‡ä»¶å¤¹åç§°ï¼Œåœ¨hprofæ–‡ä»¶ç›®å½•ä¸­åˆ›å»ºè¯¥æ–‡ä»¶å¤¹,ç¼ºçœæ—¶ç›´æ¥ä¼šåœ¨hprofæ–‡ä»¶ç›®å½•è¾“å‡ºæ–‡ä»¶</li>
</ul>
<p><strong>è¾“å‡ºè¯´æ˜</strong></p>
<p><img src="/res/bitmap/bitmap-analyzer.png" alt=""></p>
<ul>
<li>å¤§å°æ’åº.txt æŒ‰ç…§å›¾ç‰‡åƒç´ å°ºå¯¸ï¼Œä»å¤§åˆ°å°æ’åº</li>
<li>ä¸ªæ•°æ’åº.txt æŒ‰ç…§ç›¸åŒå°ºå¯¸å›¾ç‰‡ä¸ªæ•°ï¼Œä»å¤§åˆ°å°æ’åº</li>
<li>æ–‡ä»¶å width*height_index.png</li>
</ul>
<p><strong>JaråŒ…åœ°å€</strong></p>
<p><a href="https://raw.githubusercontent.com/Ivonhoe/mvn-repo/master/ivonhoe/java/heapanalyzer/bitmap-analyzer/0.0.1-SNAPSHOT/bitmap-analyzer-0.0.1-20170327.112600-1.jar" target="_blank" rel="external">https://raw.githubusercontent.com/Ivonhoe/mvn-repo/master/ivonhoe/java/heapanalyzer/bitmap-analyzer/0.0.1-SNAPSHOT/bitmap-analyzer-0.0.1-20170327.112600-1.jar</a></p>
<h3 id="å…­ã€å‚è€ƒæ–‡æ¡£">å…­ã€å‚è€ƒæ–‡æ¡£</h3><p><a href="http://blog.csdn.net/guolin_blog/article/details/50727753" target="_blank" rel="external">Android drawableå¾®æŠ€å·§ï¼Œä½ æ‰€ä¸çŸ¥é“çš„drawableçš„é‚£äº›ç»†èŠ‚</a></p>
<p><a href="http://www.10tiao.com/html/336/201703/2652262290/1.html" target="_blank" rel="external">å…³äºAndroidé€‚é…ï¼Œçœ‹å®Œè¿™ç¯‡æ–‡ç« å°±å¤Ÿäº†</a></p>
<p><a href="http://wangjunyan.github.io/2014/12/02/export-android-bitmap-from-dump-file/" target="_blank" rel="external">æ‰¹é‡å¯¼å‡ºdumpæ–‡ä»¶ä¸­çš„Bitmap</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzA3NTYzODYzMg==&amp;mid=403263974&amp;idx=1&amp;sn=b0315addbc47f3c38e65d9c633a12cd6&amp;scene=21#wechat_redirect" target="_blank" rel="external">Android å¼€å‘ç»•ä¸è¿‡çš„å‘ï¼šä½ çš„ Bitmap ç©¶ç«Ÿå å¤šå¤§å†…å­˜ï¼Ÿ</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä¸€ã€å‰è¨€&quot;&gt;ä¸€ã€å‰è¨€&lt;/h3&gt;&lt;p&gt;æœ¬æ¥åªæƒ³è¯´ä¸‹Bitmapå’Œå†…å­˜çš„åŸºæœ¬å…³ç³»ï¼Œä½†å‘ç°å¦‚æœçœŸçš„æƒ³æŠŠè¿™çœ‹ä¼¼ç®€å•çš„äº‹æƒ…è¯´æ¸…æ¥šï¼Œå®é™…ä¸Šæœªå¿…é‚£ä¹ˆç®€å•ï¼Œä½ ä¸ä¿¡ï¼Ÿä¸å¦¨å…ˆå°è¯•ä¸‹å›ç­”ä¸‹é¢å‡ ä¸ªé—®é¢˜ï¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é—®1ï¼šä»€ä¹ˆæ˜¯dpiï¼Ÿä»€ä¹ˆæ˜¯dpï¼Ÿç­”ï¼šä½ åœ¨ä¾®è¾±æˆ‘ï¼Ÿæˆ‘æ‹’ç»å›ç­”ï¼ï¼ˆï¼šæ— è¾œè„¸&lt;/li&gt;
&lt;li&gt;é—®2ï¼šä»¥Nexus6ä¸ºä¾‹ï¼Œåˆ†è¾¨ç‡1440*2560ï¼Œ5.96è‹±å¯¸ï¼Œppiæ˜¯ä»€ä¹ˆï¼Ÿdpiæ˜¯ä»€ä¹ˆï¼Ÿ1dpæ˜¯å¤šå°‘åƒç´ ï¼Ÿ&lt;/li&gt;
&lt;li&gt;é—®3ï¼šè¿˜ä»¥Nexus6ä¸ºä¾‹ï¼Œä¸€å¼ 180*180çš„å›¾ç‰‡ï¼Œæ”¾ç½®åœ¨è®¾ç½®äº†&lt;code&gt;wrap_content&lt;/code&gt;å±æ€§çš„ImageViewä¸­ï¼Œå½“è¿™å¼ å›¾ç‰‡ï¼Œåˆ†åˆ«æ”¾åœ¨&lt;code&gt;drawable-nodpi&lt;/code&gt;,&lt;code&gt;drawable-mdpi&lt;/code&gt;,&lt;code&gt;drawable-hdpi&lt;/code&gt;, &lt;code&gt;drawable-xxhdpi&lt;/code&gt;,&lt;code&gt;drawable-xxxhdpi&lt;/code&gt;è¿™å‡ ä¸ªèµ„æºç›®å½•ä¸­ï¼Œåœ¨å±å¹•ä¸Šåˆ†åˆ«æ˜¾ç¤ºå¤šå¤§(åƒç´ )çš„å›¾ç‰‡ï¼Ÿ&lt;/li&gt;
&lt;li&gt;é—®4ï¼šè¿™å¼ å›¾ç‰‡å ç”¨çš„å†…å­˜å¤§å°åˆ†åˆ«ä¸ºå¤šå°‘ï¼Ÿ&lt;/li&gt;
&lt;li&gt;é—®5ï¼šå¦‚æœè®¾ç½®ImageViewçš„å®½å’Œé«˜ä¸ºå›ºå®šçš„å€¼ï¼Œå¦‚50pxï¼Œé‚£ä¹ˆä¸Šè¿°æƒ…å†µä¸‹ï¼ŒåŠ è½½çš„Bitmapå ç”¨å†…å­˜å¤§å°åˆ†åˆ«ä¸ºå¤šå¤§ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦å›´ç»•ä¸Šè¿°é—®é¢˜ï¼Œä»‹ç»Androidå›¾ç‰‡èµ„æºåŠ è½½çš„åŸºæœ¬æœºåˆ¶ï¼Œå›¾ç‰‡çš„å†…å­˜å¤§å°å¦‚ä½•è®¡ç®—ï¼Œä»¥åŠå†…å­˜å›¾ç‰‡åˆ†æå·¥å…·ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://ivonhoe.github.io/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
    
      <category term="Bitmap" scheme="https://ivonhoe.github.io/tags/Bitmap/"/>
    
      <category term="Drawable" scheme="https://ivonhoe.github.io/tags/Drawable/"/>
    
      <category term="å†…å­˜" scheme="https://ivonhoe.github.io/tags/%E5%86%85%E5%AD%98/"/>
    
  </entry>
  
  <entry>
    <title>Androidå®‰å…¨ä¹‹åº”ç”¨é˜²dex2jaråŸç†åŠå®ç°</title>
    <link href="https://ivonhoe.github.io/2017/02/09/%E7%BE%8E%E5%9B%A2%E5%A6%82%E4%BD%95%E9%98%B2dex2jar/"/>
    <id>https://ivonhoe.github.io/2017/02/09/ç¾å›¢å¦‚ä½•é˜²dex2jar/</id>
    <published>2017-02-09T13:55:01.000Z</published>
    <updated>2018-05-27T08:19:27.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€åç¼–è¯‘æŸå¹³å°ä»£ç ">ä¸€ã€åç¼–è¯‘æŸå¹³å°ä»£ç </h3><p>æœ€è¿‘åœ¨çœ‹æŸå¤–å–å¹³å°çš„ä»£ç ï¼Œå‘ç°æŸå¤–å–å¹³å°æœ€æ–°ç‰ˆæœ¬ç‰ˆæœ¬æ— æ³•æ­£å¸¸çš„é€šè¿‡dex2jarå·¥å…·å°†dexè½¬æ¢å‡ºJavaæºä»£ç ï¼Œåœ¨è½¬æ¢è¿‡ç¨‹ä¸­ä¼šæç¤ºå‡ºé”™ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://ivonhoe.github.io/res/dex2jar_error/dex2jar_error1.png" alt="dex2jarå¼‚å¸¸å›¾"></p>
<p>æŸ¥çœ‹è½¬æ¢å‡ºçš„Javaæºä»£ç ï¼Œä¼šå‘ç°å¾ˆå¤šç±»æ–¹æ³•æç¤ºä¸‹å›¾æ‰€ç¤ºå¼‚å¸¸ï¼Œå¾ˆå¤šæ–¹æ³•ä¸­éƒ½ä¼šæŠ›å‡º<code>RuntimeExceptionï¼šcan not merge I and Z</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class AsyncTaskService extends IntentService &#123; &#10;  &#10;  protected void onHandleIntent(Intent paramIntent)&#123;&#10;    throw new RuntimeException(&#34;d2j fail translate: java.lang.RuntimeException: can not merge I and Z\n\tat...);&#10;  &#125;&#10;  &#10;  public int onStartCommand(Intent paramIntent, int paramInt1, int paramInt2)&#123;&#10;    throw new RuntimeException(&#34;d2j fail translate: java.lang.RuntimeException: can not merge I and Z\n\tat...&#34;);&#10;  &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ä¼šå‘ç°å¾ˆå¤šç±»ä¼¼çš„é”™è¯¯ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°æ–¹æ³•å†…<code>RuntimeException</code>æ ˆä¿¡æ¯å’Œåç¼–è¯‘çš„é”™è¯¯ä¿¡æ¯æ˜¯ç›¸åŒçš„ï¼Œéƒ½æç¤º<code>can not merge I and Z</code>ã€‚</p>
<p><img src="https://ivonhoe.github.io/res/dex2jar_error/dex2jar_error2.png" alt="dex2jaræ—¥å¿—"></p>
<h3 id="äºŒã€ä¸ºä»€ä¹ˆï¼Ÿ">äºŒã€ä¸ºä»€ä¹ˆï¼Ÿ</h3><p>æœ¬æ¥ä»¥ä¸ºè¿™æ˜¯dex2jarå·¥å…·ä½ç‰ˆæœ¬çš„ä¸€ä¸ªbugï¼Œä½†æ›´æ–°äº†dex2jarä»¥åï¼Œä¾ç„¶è¿˜æ˜¯ä¼šå‡ºç°ä¸Šè¿°é”™è¯¯ã€‚<br><code>java.lang.RuntimeException: can not merge I and Z</code>è¿™ä¸ªå¼‚å¸¸ï¼Œåœ¨<a href="https://sourceforge.net/p/dex2jar/tickets/238/" target="_blank" rel="external">sourceforge</a>ä¸Šè§£é‡Šçš„æ¯”è¾ƒæ¸…æ¥šï¼Œå…¶å®æ˜¯ä¸€ä¸ªdex2jarå·¥å…·æ£€æŸ¥å‡ºçš„ä¸€ä¸ªå‚æ•°å¼‚å¸¸â€ï¼Œ<strong>The problem is caused by strict type calculation, because in java syntaxt, a boolean can not assign to an inteager. so dex2jar forbid merge type Z and I.</strong> ä½ ç”¨å¸ƒå°”ç±»å‹å…¥å‚è°ƒç”¨ä¸€ä¸ªå‚æ•°ä¸ºæ•´å‹çš„å‡½æ•°ï¼Œå½“ç„¶ä¼šæ£€æŸ¥å‡ºé”™ï¼Œä¸ºå•¥è¿™ä¹ˆè¯´ï¼Œæˆ‘ä½¿ç”¨apktoolå·¥å…·ï¼Œçœ‹äº†ä¸€ä¸‹apkçš„smaliä»£ç ã€‚å‘ç°æŠ¥é”™çš„å‡½æ•°çš„æœ€å‰é¢éƒ½å«æœ‰ä¸€æ®µå¥‡æ€ªsmaliçš„ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invoke-static &#123;&#125;, Lpnf/this/object/does/not/Exist;-&#62;a()Z&#10;&#10;move-result v0&#10;&#10;invoke-static &#123;v0&#125;, Lpnf/this/object/does/not/Exist;-&#62;b(I)V</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸Šé¢çš„ä»£ç ï¼Œ<code>pnf.this.object.does.not.Exist.a()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªbooleanç±»å‹æ•°æ®ï¼Œæ”¾å…¥v0å¯„å­˜å™¨ï¼Œä½œä¸º<code>pnf.this.object.does.not.Exist.b(int)</code>å‡½æ•°çš„å…¥å‚ã€‚æ­£å¸¸æƒ…å†µä¸‹è¿™æ ·çš„è¯­æ³•é”™è¯¯åœ¨javaä»£ç ç¼–è¯‘æ—¶å°±ä¸ä¼šé€šè¿‡çš„ã€‚çœ‹åˆ°è¿™é‡Œä½ ä¼šä¸ä¼šæƒ³ï¼Œå¦‚æœæˆ‘ä¸æƒ³åˆ«äººç›´æ¥çœ‹åˆ°æˆ‘çš„Javaä»£ç ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡åœ¨æ ¸å¿ƒå‡½æ•°ä¸­æ’å…¥ä¸Šé¢è¿™æ®µæœ‰è¯­æ³•é”™è¯¯çš„ä»£ç ï¼Œä»¥è¾¾åˆ°dex2jarå·¥å…·æ£€æŸ¥å‡ºé”™çš„ç›®çš„å‘¢ï¼Ÿä»è€Œå°†ä»£ç è¢«é˜…è¯»çš„é—¨æ§›ä»javaæé«˜åˆ°smaliã€‚</p>
<h3 id="ä¸‰ã€æ‰‹åŠ¨ä»£ç æ³¨å…¥">ä¸‰ã€æ‰‹åŠ¨ä»£ç æ³¨å…¥</h3><p>ä¸ºäº†éªŒè¯ä¸Šé¢çš„çŒœæƒ³ï¼Œè¿™é‡Œæˆ‘é€šè¿‡åç¼–è¯‘ä¸€ä¸ªapkï¼Œæ‰‹åŠ¨æ’å…¥æœ‰è¯­æ³•é”™è¯¯çš„smaliä»£ç ï¼Œä»¥éªŒè¯é˜²dex2jarçš„æ€è·¯ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>1.åç¼–è¯‘ä¸€ä¸ªapkã€‚</li>
<li>2.ä¿®æ”¹smaliä»£ç ï¼Œæ’å…¥ä¸Šé¢è¿™ä¸‰å¥æœ‰è¯­æ³•é”™è¯¯çš„ä»£ç ã€‚</li>
<li>3.é‡æ‰“åŒ…ï¼Œä½¿ç”¨dex2jarå·¥å…·è½¬æ¢æ–°åŒ…çš„dexï¼Œçœ‹æ˜¯å¦èƒ½æ­£å¸¸è½¬æ¢å‡ºJavaæºä»£ç ã€‚å¹¶æ£€æŸ¥è¿è¡Œæ—¶æ˜¯å¦å‡ºé”™ã€‚</li>
</ul>
<p>æˆ‘è¿™é‡Œç”¨ä¸€ä¸ªHello Worldåº”ç”¨æ¥æµ‹è¯•ï¼Œä½¿ç”¨apktoolåç¼–è¯‘å‡ºsmaliä»£ç ï¼Œå¹¶åœ¨Applicationçš„onCreateæ–¹æ³•ä¸­æ’å…¥è¿™æ®µæœ‰è¯­æ³•é”™è¯¯çš„ä»£ç ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># virtual methods&#10;.method public onCreate()V&#10;    .locals 3&#10;&#10;    invoke-super &#123;p0&#125;, Lcn/trinea/android/lib/h/c;-&#62;onCreate()V&#10;&#10;    invoke-virtual &#123;p0&#125;, Lcn/trinea/android/developertools/MyApplication;-&#62;getApplicationContext()Landroid/content/Context;&#10;&#10;    move-result-object v0&#10;&#10;    invoke-static &#123;&#125;, Lpnf/object/does/not/Exist;-&#62;a()Z&#10;&#10;    move-result v3&#10;&#10;    invoke-static &#123;v3&#125;, Lpnf/object/does/not/Exist;-&#62;b(I)V&#10;&#10;    return-void&#10;.end method</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸è¦å¿˜äº†ï¼Œä½ å¯èƒ½éœ€è¦å¦å¤–ç¼–è¯‘å‡ºExist.smaliè¿™ä¸ªæ–‡ä»¶ï¼Œä¸ç„¶è¿è¡Œæ—¶ä¸€å®šä¼šçˆ†å‡ºClassNotFoundå¼‚å¸¸ã€‚å°†ä¸‹é¢çš„Exist.java<strong>ç¼–è¯‘å‡ºExist.smali</strong>æ”¾å…¥ç›¸åº”çš„åŒ…è·¯å¾„ï¼Œé‡æ‰“åŒ…å°±å¯ä»¥äº†ã€‚Javaä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class Exist &#123;&#10;    public static boolean a() &#123;&#10;        return false;&#10;    &#125;&#10;&#10;    public static void b(int test) &#123;&#10;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼ŒéªŒè¯ä¸‹æœç„¶é‡æ–°æ‰“åŒ…åçš„apkï¼Œç¡®å®ä¸èƒ½æ­£å¸¸è½¬æ¢å‡ºJavaæºä»£ç ï¼Œè¿™é‡Œå°±ä¸è´´å›¾äº†ï¼Œå› ä¸ºè½¬æ¢å‡ºé”™æ—¥å¿—æ˜¯ä¸€æ ·çš„ã€‚å¹¶ä¸”è¿è¡Œæ—¶ä¹Ÿä¸ä¼šå‡ºé”™ã€‚æ¥ä¸‹æ¥ä¼šå†™ä¸€ä¸ªGradleç¼–è¯‘æ’ä»¶ï¼Œé’ˆå¯¹ç‰¹å®šçš„å‡½æ•°ï¼Œæ’å…¥ä»£ç ï¼Œé˜²æ­¢dex2jarå·¥å…·æŸ¥çœ‹Javaæºä»£ç ã€‚</p>
<h3 id="å››ã€å®ç°æ€è·¯">å››ã€å®ç°æ€è·¯</h3><p>Androidå®¢æˆ·ç«¯åœ¨é˜²æ­¢å…¶Javaä»£ç è¢«dex2jarè½¬æ¢æ—¶å…¶å®å°±æ˜¯å€ŸåŠ©dex2jarçš„è¯­æ³•æ£€æŸ¥æœºåˆ¶ï¼Œå°†æœ‰è¯­æ³•é”™è¯¯çš„å­—èŠ‚ç æ’å…¥åˆ°æƒ³è¦ä¿æŠ¤çš„Javaå‡½æ•°ä¸­é‡Œé¢ï¼Œä»¥è¾¾åˆ°dex2jarè½¬æ¢å‡ºé”™çš„ç›®çš„ã€‚æ¥ä¸‹æ¥æˆ‘å°±å¤§è‡´è®°å½•ä¸‹å¦‚ä½•å¼€å‘Gradleç¼–è¯‘æ’ä»¶ï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å®ç°ä¸Šè¿°é˜²æŠ¤æ€è·¯ï¼Œå…ˆçœ‹ä¸‹Android APKæ‰“åŒ…æµç¨‹ï¼š</p>
<!--more-->
<p><img src="https://ivonhoe.github.io/res/dexguard/dexguard4.jpeg" alt="Android apkæ‰“åŒ…æµç¨‹"></p>
<p>Android APKæ‰“åŒ…æµç¨‹å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒJavaä»£ç å…ˆé€šè¿‡Java Compilerç”Ÿæˆ.classæ–‡ä»¶ï¼Œå†é€šè¿‡dxå·¥å…·ç”Ÿæˆdexæ–‡ä»¶ï¼Œæœ€åä½¿ç”¨apkbuilderå·¥å…·å®Œæˆä»£ç ä¸èµ„æºæ–‡ä»¶çš„æ‰“åŒ…ï¼Œå¹¶ä½¿ç”¨jarsignerç­¾åï¼Œæœ€åå¯èƒ½è¿˜æœ‰ä½¿ç”¨zipalignå¯¹ç­¾ååçš„apkåšå¯¹é½å¤„ç†ã€‚</p>
<p>å¦‚æœéœ€è¦å®Œæˆå¯¹ç‰¹å®šå‡½æ•°çš„ä»£ç æ³¨å…¥ï¼Œå¯ä»¥åœ¨Javaä»£ç ç¼–è¯‘ç”Ÿæˆclassæ–‡ä»¶åï¼Œåœ¨dexæ–‡ä»¶ç”Ÿæˆå‰ï¼Œé’ˆå¯¹classå­—èŠ‚ç è¿›è¡Œæ“ä½œï¼Œä»¥æœ¬ä¾‹ä¸ºä¾‹éœ€è¦åŠ¨æ€ç”ŸæˆExsitç±»æ–‡ä»¶çš„å­—èŠ‚ç ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#21160;&#24577;&#29983;&#25104;Exist.class&#10;public class Exist &#123;&#10;    public static boolean a() &#123;&#10;        return false;&#10;    &#125;&#10;&#10;    public static void b(int test) &#123;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>å°†ä¸‹åˆ—Javaä»£ç è½¬æ¢æˆå­—èŠ‚ç æ’å…¥éœ€è¦ä¿æŠ¤çš„å‡½æ•°ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#25554;&#20837;&#21040;&#29305;&#23450;&#30340;Java&#20989;&#25968;&#20869;&#10;Exist.b(Exist.a());</span><br></pre></td></tr></table></figure>
<p>å¹¶å°†ä¿®æ”¹åçš„.classæ–‡ä»¶æ”¾å…¥dexæ‰“åŒ…ç›®å½•ä¸­ï¼Œå®Œæˆdexæ‰“åŒ…ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://ivonhoe.github.io/res/dexguard/dexguard6.png" alt=""></p>
<p>Gradleæä¾›äº†å«<code>Transform</code>çš„APIï¼Œå…è®¸ä¸‰æ–¹æ’ä»¶åœ¨classæ–‡ä»¶è½¬æ¢ä¸ºdexæ–‡ä»¶å‰æ“ä½œç¼–è¯‘å¥½çš„classæ–‡ä»¶ï¼Œè¿™ä¸ªAPIçš„ç›®æ ‡å°±æ˜¯ç®€åŒ–classæ–‡ä»¶çš„è‡ªå®šä¹‰çš„æ“ä½œè€Œä¸ç”¨å¯¹Taskè¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å¯ä»¥æ›´åŠ çµæ´»åœ°è¿›è¡Œæ“ä½œã€‚è¯¦ç»†çš„å¯ä»¥å‚è€ƒ<a href="http://blog.csdn.net/sbsujjbcy/article/details/50839263" target="_blank" rel="external">åŒºé•¿çš„åšå®¢</a>ã€‚</p>
<h3 id="äº”ã€ä½¿ç”¨ASMæ“ä½œJavaå­—èŠ‚ç ">äº”ã€ä½¿ç”¨ASMæ“ä½œJavaå­—èŠ‚ç </h3><p>ASM æ˜¯ä¸€ä¸ª Java å­—èŠ‚ç æ“æ§æ¡†æ¶ã€‚å®ƒèƒ½è¢«ç”¨æ¥åŠ¨æ€ç”Ÿæˆç±»æˆ–è€…å¢å¼ºæ—¢æœ‰ç±»çš„åŠŸèƒ½ã€‚ASM å¯ä»¥ç›´<br>æ¥äº§ç”ŸäºŒè¿›åˆ¶ class æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»è¢«åŠ è½½å…¥ Java è™šæ‹Ÿæœºä¹‹å‰åŠ¨æ€æ”¹å˜ç±»è¡Œä¸ºã€‚è¿™é‡Œæ¨èä¸€ä¸ªIDEAæ’ä»¶:<code>ASM ByteCode Outline</code>ã€‚å¯ä»¥æŸ¥çœ‹.classæ–‡ä»¶çš„å­—èŠ‚ç ï¼Œå¹¶å¯ä»¥ç”ŸæˆæˆASMæ¡†æ¶ä»£ç ã€‚å®‰è£…<code>ASM Bytecode Outline</code>æ’ä»¶åï¼Œå¯ä»¥åœ¨<code>Intellij IDEA</code>-&gt;<code>Code</code>-&gt;<code>Show Bytecode Outline</code>æŸ¥çœ‹ç±»æ–‡ä»¶å¯¹åº”ä¸ªå­—èŠ‚ç å’ŒASMæ¡†æ¶ä»£ç ï¼Œåˆ©ç”¨ASMæ¡†æ¶ä»£ç å°±å¯ä»¥ç”Ÿæˆç›¸åº”çš„.classæ–‡ä»¶äº†ã€‚</p>
<p><img src="https://ivonhoe.github.io/res/dexguard/dexguard3.png" alt=""></p>
<p>ç”ŸæˆExistå­—èŠ‚ç çš„å…·ä½“å®ç°ï¼Œç”ŸæˆExist.javaçš„æ„é€ å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ClassWriter cw = new ClassWriter(0);&#10;FieldVisitor fv;&#10;MethodVisitor mv;&#10;AnnotationVisitor av0;&#10;&#10;cw.visit(51, ACC_PUBLIC + ACC_SUPER, &#34;ivonhoe/dexguard/java/Exist&#34;, null, &#34;java/lang/Object&#34;, null);&#10;&#10;cw.visitSource(&#34;Exist.java&#34;, null);&#10;&#10;mv = cw.visitMethod(ACC_PUBLIC, &#34;&#60;init&#62;&#34;, &#34;()V&#34;, null, null);&#10;mv.visitCode();&#10;Label l0 = new Label();&#10;mv.visitLabel(l0);&#10;mv.visitLineNumber(7, l0);&#10;mv.visitVarInsn(ALOAD, 0);&#10;mv.visitMethodInsn(INVOKESPECIAL, &#34;java/lang/Object&#34;, &#34;&#60;init&#62;&#34;, &#34;()V&#34;, false);&#10;mv.visitInsn(RETURN);&#10;Label l1 = new Label();&#10;mv.visitLabel(l1);&#10;mv.visitLocalVariable(&#34;this&#34;, &#34;Livonhoe/dexguard/java/Exist;&#34;, null, l0, l1, 0);&#10;mv.visitMaxs(1, 1);&#10;mv.visitEnd();</span><br></pre></td></tr></table></figure>
<p>å£°æ˜ä¸€ä¸ªå‡½æ•°åä¸ºaï¼Œè¿”å›å€¼ä¸ºbooleanç±»å‹çš„æ— å‚å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv = cw.visitMethod(ACC_PUBLIC + ACC_STATIC, &#34;a&#34;, &#34;()Z&#34;, null, null);&#10;mv.visitCode();&#10;l0 = new Label();&#10;mv.visitLabel(l0);&#10;mv.visitLineNumber(10, l0);&#10;mv.visitInsn(ICONST_0);&#10;mv.visitInsn(IRETURN);&#10;mv.visitMaxs(1, 0);&#10;mv.visitEnd();</span><br></pre></td></tr></table></figure>
<p>å£°æ˜ä¸€ä¸ªå‡½æ•°åä¸ºbï¼Œå‚æ•°ä¸ºintå‹ï¼Œè¿”å›ç±»å‹ä¸ºvoidçš„å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MV = CW.VISITmETHOD(acc_public + acc_static, &#34;b&#34;, &#34;(i)v&#34;, NULL, NULL);&#10;MV.VISITcODE();&#10;L0 = NEW lABEL();&#10;MV.VISITlABEL(L0);&#10;MV.VISITlINEnUMBER(14, L0);&#10;MV.VISITiNSN(return);&#10;L1 = NEW lABEL();&#10;MV.VISITlABEL(L1);&#10;MV.VISITlOCALvARIABLE(&#34;TEST&#34;, &#34;i&#34;, NULL, L0, L1, 0);&#10;MV.VISITmAXS(0, 1);&#10;MV.VISITeND();</span><br></pre></td></tr></table></figure>
<p>åœ¨æŒ‡å®šå‡½æ•°å†…ï¼Œæ’å…¥<code>Exist.b(Exist.a());</code>å¯¹åº”çš„å­—èŠ‚ç çš„å…·ä½“å®ç°ï¼Œç»•è¿‡Javaç¼–è¯‘å™¨çš„è¯­æ³•æ£€æŸ¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static class InjectClassVisitor extends ClassVisitor &#123;&#10;&#10;        private String methodName;&#10;&#10;        InjectClassVisitor(int i, ClassVisitor classVisitor, String method) &#123;&#10;            super(i, classVisitor)&#10;&#10;            this.methodName = method;&#10;        &#125;&#10;&#10;        @Override&#10;        public MethodVisitor visitMethod(int access, String name, String desc,&#10;                                         String signature, String[] exceptions) &#123;&#10;&#10;            MethodVisitor mv = super.visitMethod(access, name, desc, signature, exceptions);&#10;            mv = new MethodVisitor(Opcodes.ASM4, mv) &#123;&#10;&#10;                @Override&#10;                void visitCode() &#123;&#10;                    // &#22312;&#26041;&#27861;&#20307;&#24320;&#22987;&#35843;&#29992;&#26102;&#10;                    if (name.equals(methodName)) &#123;&#10;                        mv.visitMethodInsn(INVOKESTATIC, &#34;ivonhoe/dexguard/java/Exist&#34;, &#34;a&#34;, &#34;()Z&#34;, false);&#10;                        mv.visitMethodInsn(INVOKESTATIC, &#34;ivonhoe/dexguard/java/Exist&#34;, &#34;b&#34;, &#34;(I)V&#34;, false);&#10;                    &#125;&#10;                    super.visitCode()&#10;                &#125;&#10;&#10;                @Override&#10;                public void visitMaxs(int maxStack, int maxLocal) &#123;&#10;                    if (name.equals(methodName)) &#123;&#10;                        super.visitMaxs(maxStack + 1, maxLocal);&#10;                    &#125; else &#123;&#10;                        super.visitMaxs(maxStack, maxLocal);&#10;                    &#125;&#10;                &#125;&#10;            &#125;&#10;            return mv;&#10;        &#125;&#10;    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="å…­ã€æ€»ç»“">å…­ã€æ€»ç»“</h3><p>çœ‹åˆ°è¿™é‡Œå¯èƒ½ä½ ä¼šæœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆæœ‰è¯­æ³•é”™è¯¯çš„ä»£ç ï¼Œåœ¨è¿è¡Œæ—¶ä¸ä¼šå‡ºé”™ï¼Œä¸ªäººç†è§£ä¸å•å•æ˜¯å› ä¸ºboolç±»å‹åœ¨å†…å­˜ä¸­æ˜¯ä»¥<code>0æˆ–1</code>è¡¨ç¤ºï¼Œä¹Ÿå› ä¸º<code>int</code>å’Œ<code>bool</code>åœ¨Androidè™šæ‹Ÿæœºä¸­éƒ½å­˜å‚¨åœ¨32ä½å¯„å­˜å™¨ä¸­ï¼Œå¦‚æœä½¿ç”¨<code>int</code>å’Œ<code>long</code>ç±»å‹çš„å‚æ•°äº’æ¢ï¼Œåœ¨dxé˜¶æ®µçš„ç¼–è¯‘å°±ä¼šæŠ¥é”™ã€‚ä¸‹é¢æ˜¯æ’ä»¶æºç ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å°è¯•ä¸€ä¸‹~</p>
<h4 id="æ’ä»¶æºç ">æ’ä»¶æºç </h4><p>è¯¦ç»†çš„Gradleæºç å’Œå®ä¾‹å¯å‚è€ƒ<a href="https://github.com/Ivonhoe/dexguard" target="_blank" rel="external">https://github.com/Ivonhoe/dexguard</a></p>
<h4 id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</h4><ul>
<li>åœ¨root projectçš„build.gradleä¸­æ·»åŠ ä¾èµ–<code>classpath &#39;ivonhoe.gradle.dexguard:dexguard-gradle:0.0.2-SNAPSHOT&#39;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;&#10;    repositories &#123;&#10;        maven &#123; url &#39;https://raw.githubusercontent.com/Ivonhoe/mvn-repo/master/&#39; &#125;&#10;        mavenCentral()&#10;    &#125;&#10;    dependencies &#123;&#10;        classpath &#39;com.android.tools.build:gradle:2.3.0&#39;&#10;        classpath &#39;ivonhoe.gradle.dexguard:dexguard-gradle:0.0.2-SNAPSHOT&#39;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨appé¡¹ç›®çš„build.gradleä¸­æ·»åŠ æ’ä»¶ï¼Œmap.txtä¸­é…ç½®éœ€è¦ä¿æŠ¤çš„æ–¹æ³•å</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &#39;ivonhoe.dexguard&#39;&#10;dexguard &#123;&#10;    guardConfig = &#34;$&#123;rootDir&#125;/map.txt&#34;&#10;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ƒã€å‚è€ƒæ–‡æ¡£">ä¸ƒã€å‚è€ƒæ–‡æ¡£</h3><ul>
<li><a href="https://sourceforge.net/p/dex2jar/tickets/238/" target="_blank" rel="external">#238 java.lang.RuntimeException: can not merge I and Z</a></li>
<li><a href="http://www.jianshu.com/p/730c6e3e21f6" target="_blank" rel="external">Smaliè¯­æ³•</a></li>
<li><a href="http://blog.csdn.net/sbsujjbcy/article/details/50839263" target="_blank" rel="external">Android çƒ­ä¿®å¤ä½¿ç”¨Gradle Plugin1.5æ”¹é€ Nuwaæ’ä»¶</a></li>
<li><a href="http://www.wangyuwei.me/2017/01/20/ASM-%E6%93%8D%E4%BD%9C%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%9D%E6%8E%A2/" target="_blank" rel="external">ASM-æ“ä½œå­—èŠ‚ç åˆæ¢</a></li>
<li><a href="https://www.diycode.cc/topics/581" target="_blank" rel="external">æ‰‹æ‘¸æ‰‹å¢åŠ å­—èŠ‚ç å¾€æ–¹æ³•ä½“å†…æ’ä»£ç </a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä¸€ã€åç¼–è¯‘æŸå¹³å°ä»£ç &quot;&gt;ä¸€ã€åç¼–è¯‘æŸå¹³å°ä»£ç &lt;/h3&gt;&lt;p&gt;æœ€è¿‘åœ¨çœ‹æŸå¤–å–å¹³å°çš„ä»£ç ï¼Œå‘ç°æŸå¤–å–å¹³å°æœ€æ–°ç‰ˆæœ¬ç‰ˆæœ¬æ— æ³•æ­£å¸¸çš„é€šè¿‡dex2jarå·¥å…·å°†dexè½¬æ¢å‡ºJavaæºä»£ç ï¼Œåœ¨è½¬æ¢è¿‡ç¨‹ä¸­ä¼šæç¤ºå‡ºé”™ï¼Œå¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://ivonhoe.github.io/res/dex2jar_error/dex2jar_error1.png&quot; alt=&quot;dex2jarå¼‚å¸¸å›¾&quot;&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹è½¬æ¢å‡ºçš„Javaæºä»£ç ï¼Œä¼šå‘ç°å¾ˆå¤šç±»æ–¹æ³•æç¤ºä¸‹å›¾æ‰€ç¤ºå¼‚å¸¸ï¼Œå¾ˆå¤šæ–¹æ³•ä¸­éƒ½ä¼šæŠ›å‡º&lt;code&gt;RuntimeExceptionï¼šcan not merge I and Z&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public class AsyncTaskService extends IntentService &amp;#123; &amp;#10;  &amp;#10;  protected void onHandleIntent(Intent paramIntent)&amp;#123;&amp;#10;    throw new RuntimeException(&amp;#34;d2j fail translate: java.lang.RuntimeException: can not merge I and Z\n\tat...);&amp;#10;  &amp;#125;&amp;#10;  &amp;#10;  public int onStartCommand(Intent paramIntent, int paramInt1, int paramInt2)&amp;#123;&amp;#10;    throw new RuntimeException(&amp;#34;d2j fail translate: java.lang.RuntimeException: can not merge I and Z\n\tat...&amp;#34;);&amp;#10;  &amp;#125;&amp;#10;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="ç§»åŠ¨å®‰å…¨" scheme="https://ivonhoe.github.io/categories/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="Gradle" scheme="https://ivonhoe.github.io/tags/Gradle/"/>
    
      <category term="dex2jar" scheme="https://ivonhoe.github.io/tags/dex2jar/"/>
    
      <category term="ç§»åŠ¨å®‰å…¨" scheme="https://ivonhoe.github.io/tags/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>Androidå®‰å…¨ä¹‹APPå»å¹¿å‘Š</title>
    <link href="https://ivonhoe.github.io/2017/02/04/Android%E5%AE%89%E5%85%A8%E4%B9%8B---APP%E5%8E%BB%E5%B9%BF%E5%91%8A/"/>
    <id>https://ivonhoe.github.io/2017/02/04/Androidå®‰å…¨ä¹‹---APPå»å¹¿å‘Š/</id>
    <published>2017-02-04T05:27:20.000Z</published>
    <updated>2018-05-27T08:20:12.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€å·¥å…·ä»‹ç»">ä¸€ã€å·¥å…·ä»‹ç»</h3><ul>
<li><strong>apktoolï¼š</strong>googleæä¾›Android apkç¼–è¯‘ä¸åç¼–è¯‘å·¥å…·ï¼Œ<a href="https://ibotpeaches.github.io/Apktool/" target="_blank" rel="external">https://ibotpeaches.github.io/Apktool/</a></li>
<li><strong>dex2jarï¼š</strong>dexæ–‡ä»¶è½¬jaræ–‡ä»¶å·¥å…·ï¼Œ<a href="https://github.com/pxb1988/dex2jar" target="_blank" rel="external">https://github.com/pxb1988/dex2jar</a></li>
<li><strong>jd-guiï¼š</strong>æŸ¥çœ‹jaræ–‡ä»¶ï¼Œ<a href="http://jd.benow.ca/" target="_blank" rel="external">http://jd.benow.ca/</a></li>
<li><strong>keytoolï¼š</strong>åˆ¶ä½œå’Œç®¡ç†æ•°å­—è¯ä¹¦</li>
<li><strong>jarsignerï¼š</strong>ä½¿ç”¨æ•°å­—è¯ä¹¦å¯¹jarå’Œapkè¿›è¡Œç­¾å</li>
<li><strong>Android killerï¼š</strong>Windowç³»ç»Ÿä¸­ï¼Œä¸Šè¿°å·¥å…·çš„é›†æˆå·¥å…·</li>
</ul>
<p>æ›´å¤šåç¼–è¯‘å·¥å…·å¯æŸ¥çœ‹ï¼š<a href="http://unclechen.github.io/2016/09/07/Android%E5%8F%8D%E7%BC%96%E8%AF%91%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/" target="_blank" rel="external">Uncle Chenâ€”Androidåç¼–è¯‘æŠ€æœ¯æ€»ç»“</a></p>
<h3 id="äºŒã€å»é™¤åº”ç”¨å¼€å‘åŠ©æ‰‹çš„å¹¿å‘Š">äºŒã€å»é™¤åº”ç”¨å¼€å‘åŠ©æ‰‹çš„å¹¿å‘Š</h3><p>CodeKKå…¬ä¼—å·åœ¨17å¹´åˆæ¨å‡ºäº†ä¸€ä¸ª<a href="https://mp.weixin.qq.com/s?__biz=MzAxNjI3MDkzOQ==&amp;mid=2654472664&amp;idx=1&amp;sn=dfc2b5beb90daa8fd068d8064ce0dcce&amp;chksm=803bfaecb74c73fa9a9addfd4d8bce031186c34b7d7b59ee22df41799c7eaa71a34863890f56&amp;mpshare=1&amp;scene=1&amp;srcid=0220tEQNaL7PwIgfBT8sIITK&amp;key=776fc8cdd0b88c0d0b9a6c8e271e4cfe2b2363aeda110198d4250b0a422befd0f43f78e2a17d528112f757336e136c56f488bc174baa56c116045a9bdbb37dbccf508eb8c70e48a2d09ca1da1b4d92d3&amp;ascene=0&amp;uin=MTMzNzYxMDM2MQ%3D%3D&amp;devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12.1+build(16B2555" target="_blank" rel="external">åº”ç”¨å¼€å‘åŠ©æ‰‹</a>)ã€‚V1.0ç‰ˆæœ¬æ˜¯æœ‰å¹¿å‘Šç‰ˆæœ¬çš„ï¼Œä¸‹é¢ä»¥è¿™ä¸ªç‰ˆæœ¬ä¸ºä¾‹ï¼Œç®€å•çœ‹ä¸‹å»å¹¿å‘Šè¿‡ç¨‹ã€‚å®ƒçš„åç»­çš„V1.1.0å’ŒV1.2.0å·²ç»å»é™¤äº†å¹¿å‘ŠåŠŸèƒ½ã€‚</p>
<a id="more"></a>
<h4 id="2-1ã€åç¼–è¯‘">2.1ã€åç¼–è¯‘</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool.sh d -f ./dev-tools.apk</span><br></pre></td></tr></table></figure>
<p><img src="/res/dev-tool/dev-tool1.png" alt=""><br><img src="/res/dev-tool/dev-tool2.png" alt=""></p>
<h4 id="2-2ã€æ³¨é‡Šå¹¿å‘Šä»£ç ">2.2ã€æ³¨é‡Šå¹¿å‘Šä»£ç </h4><p>è¿™é‡Œå¯ä»¥å…ˆç”¨dex2jarè½¬jaråæŸ¥çœ‹ä¸‹æºç ï¼Œä¼šå‘ç°ä½¿ç”¨çš„æ˜¯Google AdMobä½œä¸ºå¹¿å‘Šå¹³å°ï¼Œç®€å•çœ‹ä¸‹ä»£ç å¯ä»¥å‘ç°åœ¨ä¸»é¡µé¢activty_main.xmlä¸­åŒ…å«å¹¿å‘Šè§†å›¾çš„å¸ƒå±€æ–‡ä»¶ã€‚æ‰€ä»¥åªéœ€è¦æ‰¾åˆ°<code>ad_layout.xml</code>å°†å…¶<code>android:visibility=&quot;gone&quot;</code>å±æ€§è®¾ç½®æˆ<code>gone</code>å°±å¯ä»¥äº†ã€‚</p>
<p><img src="/res/dev-tool/dev-tool3.png" alt=""></p>
<h4 id="2-3ã€é‡æ‰“åŒ…">2.3ã€é‡æ‰“åŒ…</h4><p>è¿™é‡Œé‡æ‰“åŒ…çš„è¿‡ç¨‹å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é”™è¯¯ï¼Œä¸è¿‡è®¤çœŸæŸ¥çœ‹æ—¥å¿—å¹¶ç»“åˆGoogleéƒ½æ˜¯å¯ä»¥æ‰¾åˆ°è§£å†³æ–¹æ¡ˆçš„ï¼Œè¿™é‡Œæš‚ä¸”ä¸è¡¨ã€‚ä½¿ç”¨apktool bå‘½ä»¤ï¼Œç”Ÿæˆçš„apké»˜è®¤è·¯å¾„ä¸º<code>/dist</code>è·¯å¾„ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool.sh b ./dev-tools</span><br></pre></td></tr></table></figure>
<p><img src="/res/dev-tool/dev-tool4.png" alt=""></p>
<h4 id="2-4ã€åˆ¶ä½œä¸€ä¸ªåä¸ºhackapk-keystoreçš„è¯ä¹¦,å¹¶é‡æ–°ç­¾ååº”ç”¨">2.4ã€åˆ¶ä½œä¸€ä¸ªåä¸ºhackapk.keystoreçš„è¯ä¹¦,å¹¶é‡æ–°ç­¾ååº”ç”¨</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#21046;&#20316;&#35777;&#20070;&#65306;&#10;keytool -genkey -keystore hackapk.keystore -keyalg RSA -validity 10000 -alias hackapk&#10;&#10;&#31614;&#21517;&#65306;&#10;jarsigner -verbose -keystore hackapk.keystore -signedjar dev-tools-no-ads.apk ./dev-tools/dist/dev-tools.apk hackapk</span><br></pre></td></tr></table></figure>
<p><img src="/res/dev-tool/dev-tool5.png" alt=""></p>
<p>è¯¦ç»†çš„å‚æ•°å¯ä»¥å‚è€ƒï¼š<br><a href="http://www.tttabc.com/android/keytool-keystore-jarsigner-apk.htm" target="_blank" rel="external">APKç­¾åä¹‹keytoolç”Ÿæˆkeystoreå’Œjarsignerç­¾åapk</a></p>
<h4 id="2-5ã€å®‰è£…">2.5ã€å®‰è£…</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb install -r dev-tools-no-ads.apk</span><br></pre></td></tr></table></figure>
<p><img src="/res/dev-tool/dev-tool6.png" alt=""></p>
<p><img src="/res/dev-tool/dev-tool11.png" alt="æœ‰å¹¿å‘Šç‰ˆæœ¬"></p>
<p><img src="/res/dev-tool/dev-tool10.png" alt="æ— å¹¿å‘Šç‰ˆæœ¬"></p>
<h4 id="2-6ã€ä¸‹è½½å»å¹¿å‘Šç‰ˆæœ¬çš„åº”ç”¨å¼€å‘åŠ©æ‰‹">2.6ã€ä¸‹è½½å»å¹¿å‘Šç‰ˆæœ¬çš„åº”ç”¨å¼€å‘åŠ©æ‰‹</h4><p><img src="/res/dev-tool/dev-tool7.png" alt=""></p>
<h3 id="ä¸‰ã€åç¼–è¯‘è„šæœ¬">ä¸‰ã€åç¼–è¯‘è„šæœ¬</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh&#10;workDir=./&#10;if [ &#34;$2&#34; ]&#10;then&#10;         mkdir $2&#10;         workDir=./$2/&#10;fi&#10;&#10;echo $workDir&#10;name=`basename $1 .apk`&#10;zipPath=$workDir$name.zip&#10;&#10;##apkTool&#21453;&#32534;&#35793;&#10;smaliDir=$workDir$name@smali&#10;apktool.sh d -f $1 -o $smaliDir&#10;&#10;## &#35299;&#21387;&#32553;&#65292;&#20351;&#29992;dex2jar&#22788;&#29702;&#10;unzipDir=$workDir$name@unzip&#10;cp $1 $zipPath&#10;unzip $zipPath -d $unzipDir&#10;&#10;d2j-dex2jar.sh -f $unzipDir/classes.dex -o $&#123;workDir&#125;dex2jar.jar&#10;d2j-dex2jar.sh -f $unzipDir/classes2.dex -o $&#123;workDir&#125;dex2jar2.jar&#10;d2j-dex2jar.sh -f $unzipDir/classes3.dex -o $&#123;workDir&#125;dex2jar3.jar&#10;open $workDir</span><br></pre></td></tr></table></figure>
<p>å°†ä¸Šè¿°å†…å®¹ä¿å­˜åˆ°æœ¬åœ°<code>hack.sh</code>æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°±ä¼šæŠŠapktoolå’Œdex2jarçš„ç»“æœè¾“å‡ºåˆ°<code>meipu</code>è¿™ä¸ªç›®å½•ä¸­ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¯æ¬¡æ”¶åˆ°æ•²å‘½ä»¤å–½ï¼Œåªè¦çŸ¥é“éœ€è¦åç¼–è¯‘çš„apkå’Œè¾“å‡ºçš„æ–‡ä»¶å¤¹åç§°å°±å¯ä»¥~</p>
<p><code>./hack.sh ./ç¾é“º_1487845975713.apk meipu</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä¸€ã€å·¥å…·ä»‹ç»&quot;&gt;ä¸€ã€å·¥å…·ä»‹ç»&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;apktoolï¼š&lt;/strong&gt;googleæä¾›Android apkç¼–è¯‘ä¸åç¼–è¯‘å·¥å…·ï¼Œ&lt;a href=&quot;https://ibotpeaches.github.io/Apktool/&quot;&gt;https://ibotpeaches.github.io/Apktool/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;dex2jarï¼š&lt;/strong&gt;dexæ–‡ä»¶è½¬jaræ–‡ä»¶å·¥å…·ï¼Œ&lt;a href=&quot;https://github.com/pxb1988/dex2jar&quot;&gt;https://github.com/pxb1988/dex2jar&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;jd-guiï¼š&lt;/strong&gt;æŸ¥çœ‹jaræ–‡ä»¶ï¼Œ&lt;a href=&quot;http://jd.benow.ca/&quot;&gt;http://jd.benow.ca/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;keytoolï¼š&lt;/strong&gt;åˆ¶ä½œå’Œç®¡ç†æ•°å­—è¯ä¹¦&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;jarsignerï¼š&lt;/strong&gt;ä½¿ç”¨æ•°å­—è¯ä¹¦å¯¹jarå’Œapkè¿›è¡Œç­¾å&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Android killerï¼š&lt;/strong&gt;Windowç³»ç»Ÿä¸­ï¼Œä¸Šè¿°å·¥å…·çš„é›†æˆå·¥å…·&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ›´å¤šåç¼–è¯‘å·¥å…·å¯æŸ¥çœ‹ï¼š&lt;a href=&quot;http://unclechen.github.io/2016/09/07/Android%E5%8F%8D%E7%BC%96%E8%AF%91%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/&quot;&gt;Uncle Chenâ€”Androidåç¼–è¯‘æŠ€æœ¯æ€»ç»“&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;äºŒã€å»é™¤åº”ç”¨å¼€å‘åŠ©æ‰‹çš„å¹¿å‘Š&quot;&gt;äºŒã€å»é™¤åº”ç”¨å¼€å‘åŠ©æ‰‹çš„å¹¿å‘Š&lt;/h3&gt;&lt;p&gt;CodeKKå…¬ä¼—å·åœ¨17å¹´åˆæ¨å‡ºäº†ä¸€ä¸ª&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzAxNjI3MDkzOQ==&amp;amp;mid=2654472664&amp;amp;idx=1&amp;amp;sn=dfc2b5beb90daa8fd068d8064ce0dcce&amp;amp;chksm=803bfaecb74c73fa9a9addfd4d8bce031186c34b7d7b59ee22df41799c7eaa71a34863890f56&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=0220tEQNaL7PwIgfBT8sIITK&amp;amp;key=776fc8cdd0b88c0d0b9a6c8e271e4cfe2b2363aeda110198d4250b0a422befd0f43f78e2a17d528112f757336e136c56f488bc174baa56c116045a9bdbb37dbccf508eb8c70e48a2d09ca1da1b4d92d3&amp;amp;ascene=0&amp;amp;uin=MTMzNzYxMDM2MQ%3D%3D&amp;amp;devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12.1+build(16B2555&quot;&gt;åº”ç”¨å¼€å‘åŠ©æ‰‹&lt;/a&gt;)ã€‚V1.0ç‰ˆæœ¬æ˜¯æœ‰å¹¿å‘Šç‰ˆæœ¬çš„ï¼Œä¸‹é¢ä»¥è¿™ä¸ªç‰ˆæœ¬ä¸ºä¾‹ï¼Œç®€å•çœ‹ä¸‹å»å¹¿å‘Šè¿‡ç¨‹ã€‚å®ƒçš„åç»­çš„V1.1.0å’ŒV1.2.0å·²ç»å»é™¤äº†å¹¿å‘ŠåŠŸèƒ½ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ç§»åŠ¨å®‰å…¨" scheme="https://ivonhoe.github.io/categories/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="Android" scheme="https://ivonhoe.github.io/tags/Android/"/>
    
      <category term="å»å¹¿å‘Š" scheme="https://ivonhoe.github.io/tags/%E5%8E%BB%E5%B9%BF%E5%91%8A/"/>
    
      <category term="ç§»åŠ¨å®‰å…¨" scheme="https://ivonhoe.github.io/tags/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>Mac OSä¸Šç¼–è¯‘Androidæºç </title>
    <link href="https://ivonhoe.github.io/2017/01/20/MacOS%E4%B8%8A%E7%BC%96%E8%AF%91Android%E6%BA%90%E7%A0%81/"/>
    <id>https://ivonhoe.github.io/2017/01/20/MacOSä¸Šç¼–è¯‘Androidæºç /</id>
    <published>2017-01-20T14:16:46.000Z</published>
    <updated>2018-05-27T08:24:07.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€åˆ¶ä½œä¸€ä¸ªå¤§å°å†™æ•æ„Ÿçš„ç£ç›˜åˆ†åŒº">ä¸€ã€åˆ¶ä½œä¸€ä¸ªå¤§å°å†™æ•æ„Ÿçš„ç£ç›˜åˆ†åŒº</h3><h4 id="1-1-Mac_OSç£ç›˜å·¥å…·">1.1.Mac OSç£ç›˜å·¥å…·</h4><p>è¿™é‡Œæˆ‘ä½¿ç”¨ä¸€å—ç§»åŠ¨ç¡¬ç›˜ï¼Œå°†ç§»åŠ¨ç¡¬ç›˜çš„ä¸€ä¸ªåˆ†åŒºä½¿ç”¨Mac OSçš„ç¡¬ç›˜å·¥å…·ï¼ŒæŠ¹æ‰æ•°æ®ï¼Œé€‰æ‹©MacOSæ‰©å±•(åŒºåˆ†å¤§å°å†™ï¼Œæ—¥å¿—å¼)ï¼Œåˆ›å»ºæˆå¤§å°å†™æ•æ„Ÿçš„åˆ†åŒºã€‚</p>
<p><img src="/res/compile_android_source/android-source-disk1.jpeg" alt=""></p>
<p>è¿™é‡Œä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼ŒæŠ¹æ‰åˆ†åŒºæ•°æ®çš„æ—¶å€™ï¼Œ<code>ä¼šæŠ¥é”™ï¼šâ€œMac OSX æŠ¹ç›˜å‘ç”Ÿé”™è¯¯:Mediakit æŠ¥å‘Šè®¾å¤‡ä¸Šç©ºé—´ä¸è¶³ä»¥æ‰§è¡Œæ­¤æ“ä½œâ€</code>ï¼Œè¿™é‡Œçš„åŸå› æ˜¯ç£ç›˜æ²¡æœ‰å¤§äº200Mçš„UEFIåˆ†åŒºã€‚</p>
<a id="more"></a>
<h4 id="1-2-åˆ¶ä½œUEFIåˆ†åŒº">1.2.åˆ¶ä½œUEFIåˆ†åŒº</h4><blockquote>
<p>æˆ‘æ˜¯åœ¨windowsä¸Šæ“ä½œçš„ï¼Œ<br>ä½¿ç”¨DiskGeniuså·¥å…·ï¼Œåœ¨ç§»åŠ¨ç¡¬ç›˜çš„ç¬¬ä¸€åˆ†åŒºå‰éƒ¨ï¼Œåˆ’åˆ†å‡º200MBçš„ç©ºé—´ã€‚<br>åœ¨cmdå‘½ä»¤è¡Œä¸‹è¿è¡Œä¸‹åˆ—å‘½ä»¤,è®°å¾—åˆ†æ­¥æ‰§è¡Œå•Šï¼Œå°å¿ƒå‡ºé”™ï¼Œæ•°æ®æ— ä»·ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diskpart&#10;list disk&#10;select disk 1 ###&#36825;&#37324;&#36873;&#20013;&#35201;&#20998;&#21306;&#30340;&#30913;&#30424;&#65292;&#22240;&#20026;&#25105;&#26159;&#31227;&#21160;&#30828;&#30424;&#65292;index&#26159;1&#65292;&#36825;&#37324;&#24212;&#35813;&#20250;&#30475;&#21040;&#36873;&#25321;&#20809;&#26631;&#19981;&#35201;&#36873;&#38169;&#20102;&#10;&#10;create partition efi size=200</span><br></pre></td></tr></table></figure>
<p>è¯¦ç»†çš„å›¾æ–‡è¯·å‚è€ƒ:</p>
<p><a href="https://blog.zzzmode.com/2016/05/02/osx-mediakit-reports-partition-map-too-small/" target="_blank" rel="external">Mac OSX æŠ¹ç›˜å‘ç”Ÿé”™è¯¯:Mediakit æŠ¥å‘Šè®¾å¤‡ä¸Šç©ºé—´ä¸è¶³ä»¥æ‰§è¡Œæ­¤æ“ä½œçš„è§£å†³åŠæ³•
</a></p>
<h3 id="äºŒã€ä¸‹è½½Androidæºç ">äºŒã€ä¸‹è½½Androidæºç </h3><h4 id="2-1-repo_sync_å‡ºé”™">2.1.repo sync å‡ºé”™</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error: RPC failed; result=56, HTTP code = 200&#60;br&#62;&#10;fatal: The remote end hung up unexpectedly&#60;br&#62;&#10;fatal: early EOF&#60;br&#62;&#10;fatal: index-pack failed</span><br></pre></td></tr></table></figure>
<p>repo syncæ—¶ä¼šå‡ºç°å¦‚ä¸Šé”™è¯¯ï¼Œå®‰è£…<code>gnutls</code>å’Œ<code>wget</code>å,<br>å¹¶å‚è€ƒ<a href="http://stackoverflow.com/questions/6842687/the-remote-end-hung-up-unexpectedly-while-git-cloning" target="_blank" rel="external">stackoverflow</a>è§£å†³ã€‚</p>
<h4 id="2-2-å¦‚ä½•é€‰æ‹©é©±åŠ¨">2.2.å¦‚ä½•é€‰æ‹©é©±åŠ¨</h4><p><a href="https://source.android.com/source/build-numbers.html#source-code-tags-and-builds" target="_blank" rel="external">Source Code Tags and Builds</a></p>
<p><img src="/res/compile_android_source/android-source2.jpeg" alt=""></p>
<p><a href="https://developers.google.com/android/drivers" target="_blank" rel="external">AndroidåŸç”Ÿè®¾å¤‡é©±åŠ¨</a><br><img src="/res/compile_android_source/android-source3.jpeg" alt=""></p>
<p>è¯¦ç»†çš„å›¾æ–‡è¯·å‚è€ƒ:</p>
<p><a href="http://wl9739.github.io/2016/05/09/Android%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%8B%E8%BD%BD%E3%80%81%E7%BC%96%E8%AF%91%E4%B8%8E%E5%AF%BC%E5%85%A5%E5%88%B0Android-Studio/" target="_blank" rel="external">Androidæºç çš„ä¸‹è½½ã€ç¼–è¯‘ä¸å¯¼å…¥åˆ°Android Studio</a></p>
<p><a href="http://www.jianshu.com/p/1c3d47b2031f" target="_blank" rel="external">Mac OS Xä¸‹ç¼–è¯‘Android Mæºç </a></p>
<h3 id="ä¸‰ã€ç¼–è¯‘">ä¸‰ã€ç¼–è¯‘</h3><p><code>ä¸€å®šè¦ä¸‹è½½å¹¶å®‰è£…é©±åŠ¨ï¼Œä¸‹è½½nexus5 6.0.1_r17ç‰ˆæœ¬ä¸ºä¾‹ï¼Œéœ€è¦ä¸‹è½½æ‰§è¡Œä¸‹å›¾ä¸‰ä¸ªsh</code></p>
<p><img src="/res/compile_android_source/android-source4.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$chmod a+x ./*****.sh&#10;$./*****.sh&#10;&#10;&#36755;&#20837;I ACCEPT&#23436;&#25104;&#23433;&#35013;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$source build/envsetup.sh&#10;&#10;$lunch&#10;&#10;$make -j16</span><br></pre></td></tr></table></figure>
<h3 id="å››ã€å¦‚ä½•å°†ç¼–è¯‘å¥½çš„Android_imgåˆ·å…¥æ¨¡æ‹Ÿå™¨">å››ã€å¦‚ä½•å°†ç¼–è¯‘å¥½çš„Android imgåˆ·å…¥æ¨¡æ‹Ÿå™¨</h3><p>éœ€è¦è®¾ç½®<code>ANDROID_PRODUCT_OUT</code>å˜é‡åˆ°<code>~/.bash_profile</code>æ–‡ä»¶ä¸­</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#Android &#28304;&#30721;&#32534;&#35793;&#30446;&#24405;&#10;export PATH=$PATH:/Volumes/AOSP/android-6.0.1_r17-x86_64/out/host/darwin-x86/bin&#10;export ANDROID_PRODUCT_OUT=/Volumes/AOSP/android-6.0.1_r17-x86_64/out/target/product/generic_x86_64&#10;export PATH=$PATH:$ANDROID_PRODUCT_OUT</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨å‘½ä»¤å¯åŠ¨emulatorï¼ŒåŠ è½½æŒ‡å®šçš„kernelå†…æ ¸å’Œimg</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kans-MacBook-Pro:android-6.0.1_r17-x86_64 Ivonhoe$&#10;emulator -kernel  /Volumes/AOSP/android-6.0.1_r17-x86_64/prebuilts/qemu-kernel/x86_64/kernel-qemu -sysdir ./out/target/product/generic_x86_64/ -system /Volumes/AOSP/android-6.0.1_r17-x86_64/out/target/product/generic_x86_64/system.img -data /Volumes/AOSP/android-6.0.1_r17-x86_64/out/target/product/generic_x86_64/userdata.img -ramdisk /Volumes/AOSP/android-6.0.1_r17-x86_64/out/target/product/generic_x86_64/ramdisk.img</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒè€ç½—çš„åšå®¢<a href="http://blog.csdn.net/luoshengyang/article/details/6559955" target="_blank" rel="external">åœ¨Ubuntuä¸Šä¸‹è½½ã€ç¼–è¯‘å’Œå®‰è£…Androidæœ€æ–°æºä»£ç </a></p>
<h3 id="äº”ã€åˆ·å…¥Nexus6çœŸæœº">äº”ã€åˆ·å…¥Nexus6çœŸæœº</h3><p>Nexus6å…³æœºçŠ¶æ€ä¸‹,é•¿æŒ‰éŸ³é‡ä¸‹+ç”µæº,è¿›å…¥recoveryæ¨¡å¼</p>
<p>ç„¶ååœ¨æºç æ ¹ç›®å½•ä¸‹(Androidæ ¹ç›®å½•ä¸‹)æ‰§è¡Œä¸‹é¢å‘½ä»¤:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastboot -w flashall</span><br></pre></td></tr></table></figure>
<p><img src="/res/compile_android_source/android-source5.png" alt=""></p>
<p>ä½¿ç”¨<code>mmm framework/base</code>å•ç‹¬ç¼–è¯‘frameworkä»£ç </p>
<p>adb pushå¯èƒ½ä¼šæç¤º <code>Read-only file system</code></p>
<p><code>failed to copy &#39;out/target/product/shamu/system/framework/framework.jar&#39;
 to &#39;/system/framework/framework.jar&#39;: Read-only file system</code></p>
<p>é€šè¿‡ä¸‹åˆ—å‘½ä»¤è§£å†³ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb root&#10;adb remount&#10;adb disable-verity&#10;adb reboot&#10;adb root&#10;adb remount</span><br></pre></td></tr></table></figure>
<h3 id="å…­ã€å‚è€ƒæ–‡æ¡£">å…­ã€å‚è€ƒæ–‡æ¡£</h3><p><a href="http://blog.csdn.net/ljphhj/article/details/51512263" target="_blank" rel="external">Androidç³»ç»Ÿæºç ä¸‹è½½ä¸ç¼–è¯‘ã€åˆ·æœºâ€“Nexus6å®æµ‹</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä¸€ã€åˆ¶ä½œä¸€ä¸ªå¤§å°å†™æ•æ„Ÿçš„ç£ç›˜åˆ†åŒº&quot;&gt;ä¸€ã€åˆ¶ä½œä¸€ä¸ªå¤§å°å†™æ•æ„Ÿçš„ç£ç›˜åˆ†åŒº&lt;/h3&gt;&lt;h4 id=&quot;1-1-Mac_OSç£ç›˜å·¥å…·&quot;&gt;1.1.Mac OSç£ç›˜å·¥å…·&lt;/h4&gt;&lt;p&gt;è¿™é‡Œæˆ‘ä½¿ç”¨ä¸€å—ç§»åŠ¨ç¡¬ç›˜ï¼Œå°†ç§»åŠ¨ç¡¬ç›˜çš„ä¸€ä¸ªåˆ†åŒºä½¿ç”¨Mac OSçš„ç¡¬ç›˜å·¥å…·ï¼ŒæŠ¹æ‰æ•°æ®ï¼Œé€‰æ‹©MacOSæ‰©å±•(åŒºåˆ†å¤§å°å†™ï¼Œæ—¥å¿—å¼)ï¼Œåˆ›å»ºæˆå¤§å°å†™æ•æ„Ÿçš„åˆ†åŒºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/res/compile_android_source/android-source-disk1.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼ŒæŠ¹æ‰åˆ†åŒºæ•°æ®çš„æ—¶å€™ï¼Œ&lt;code&gt;ä¼šæŠ¥é”™ï¼šâ€œMac OSX æŠ¹ç›˜å‘ç”Ÿé”™è¯¯:Mediakit æŠ¥å‘Šè®¾å¤‡ä¸Šç©ºé—´ä¸è¶³ä»¥æ‰§è¡Œæ­¤æ“ä½œâ€&lt;/code&gt;ï¼Œè¿™é‡Œçš„åŸå› æ˜¯ç£ç›˜æ²¡æœ‰å¤§äº200Mçš„UEFIåˆ†åŒºã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å…¶ä»–" scheme="https://ivonhoe.github.io/categories/%E5%85%B6%E4%BB%96/"/>
    
    
      <category term="æºç ç¼–è¯‘" scheme="https://ivonhoe.github.io/tags/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>Mac/Linuxä¸‹gccç¼–è¯‘åŠ¨æ€é“¾æ¥åº“[.soæ–‡ä»¶]</title>
    <link href="https://ivonhoe.github.io/2016/12/16/Mac-Linux%E4%B8%8Bgcc%E7%BC%96%E8%AF%91%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93-so%E6%96%87%E4%BB%B6/"/>
    <id>https://ivonhoe.github.io/2016/12/16/Mac-Linuxä¸‹gccç¼–è¯‘åŠ¨æ€é“¾æ¥åº“-soæ–‡ä»¶/</id>
    <published>2016-12-16T05:47:55.000Z</published>
    <updated>2018-05-27T08:24:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€ä»¥bsdiff-cå’Œbspatch-cä¸ºä¾‹ç¼–è¯‘bsdiff-so">ä¸€ã€ä»¥bsdiff.cå’Œbspatch.cä¸ºä¾‹ç¼–è¯‘bsdiff.so</h2><p>bsdiff.cå’Œbspatch.cåˆ†åˆ«ä¾èµ–bzip2</p>
<h3 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h3><h3 id="æ­¥éª¤">æ­¥éª¤</h3><ul>
<li><p>ä½¿ç”¨BsDiff.javaç”ŸæˆBsDiff.classæ–‡ä»¶</p>
<p><strong>javac</strong> ivonhoe/spring/wrcenter/jni/BsDiff.java</p>
</li>
<li><p>ç”ŸæˆBsDiff.hæ–‡ä»¶</p>
<p><strong>javah</strong> ivonhoe.spring.wrcenter.jni.BsDiff </p>
</li>
<li><p>ç”Ÿæˆbspatch.o</p>
<a id="more"></a>
<p><strong>gcc -fPIC -D_REENTRANT</strong> -I<strong>JAVA_INCLUDE1</strong> -I/JAVA_INCLUDE2/ -I/Users/Ivonhoe/Downloads/VelocityDemo/src/main/java/jni/bzip2 -I/Users/Ivonhoe/Downloads/VelocityDemo/src/main/java/jni -c ./jni/bspatch.c</p>
</li>
<li><p>ç”Ÿæˆbsdiff.o</p>
<p><strong>gcc -fPIC -D_REENTRANT</strong> -I/Library/Java/JavaVirtualMachines/jdk1.8.0_60.jdk/Contents/Home/include -I/Library/Java/JavaVirtualMachines/jdk1.8.0_60.jdk/Contents/Home/include/darwin -I/Users/Ivonhoe/Downloads/VelocityDemo/src/main/java/jni/bzip2 -I/Users/Ivonhoe/Downloads/VelocityDemo/src/main/java/jni -c ./jni/bsdiff.c</p>
</li>
<li><p>å°†bzip2ä¸‹çš„cæ–‡ä»¶ç”Ÿæˆç›¸åº”çš„.oæ–‡ä»¶</p>
<p><strong>gcc -fPIC -D_REENTRANT</strong> -I/Library/Java/JavaVirtualMachines/jdk1.8.0_60.jdk/Contents/Home/include -I/Library/Java/JavaVirtualMachines/jdk1.8.0_60.jdk/Contents/Home/include/darwin -I/Users/Ivonhoe/Downloads/VelocityDemo/src/main/java/jni/bzip2 -c ./jni/bzip2/*.c</p>
</li>
<li><p>ç”Ÿæˆsoæ–‡ä»¶</p>
<p><strong>gcc *.o -o bsdiff.so -shared  -v</strong></p>
</li>
</ul>
<ul>
<li>æ³¨:</li>
</ul>
<p>  JAVA_INCLUDE1:/usr/local/java/jdk1.7.0_40/include<br>  JAVA_INCLUDE2:/usr/local/java/jdk1.7.0_40/include/linux<br>  æ˜¯ jdk ä¸­çš„ jni.h æ–‡ä»¶çš„æ‰€åœ¨ç›®å½•ï¼Œè¿™ä¸¤ä¸ªç›®å½•éœ€è¦å¤§å®¶æ›¿æ¢ä¸ºè‡ªå·±çš„å¯¹åº”è·¯å¾„</p>
<p>  BZIP2_INCLUDE:</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š<br><a href="http://www.cppblog.com/deane/articles/165216.html" target="_blank" rel="external">http://www.cppblog.com/deane/articles/165216.html</a><br><a href="http://blog.csdn.net/hongquan1991/article/details/12426615" target="_blank" rel="external">http://blog.csdn.net/hongquan1991/article/details/12426615</a><br><a href="http://codepub.cn/2015/05/19/How-to-load-dll-file-in-Java-Web-Project/" target="_blank" rel="external">http://codepub.cn/2015/05/19/How-to-load-dll-file-in-Java-Web-Project/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸€ã€ä»¥bsdiff-cå’Œbspatch-cä¸ºä¾‹ç¼–è¯‘bsdiff-so&quot;&gt;ä¸€ã€ä»¥bsdiff.cå’Œbspatch.cä¸ºä¾‹ç¼–è¯‘bsdiff.so&lt;/h2&gt;&lt;p&gt;bsdiff.cå’Œbspatch.cåˆ†åˆ«ä¾èµ–bzip2&lt;/p&gt;
&lt;h3 id=&quot;é¡¹ç›®ç»“æ„&quot;&gt;é¡¹ç›®ç»“æ„&lt;/h3&gt;&lt;h3 id=&quot;æ­¥éª¤&quot;&gt;æ­¥éª¤&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ä½¿ç”¨BsDiff.javaç”ŸæˆBsDiff.classæ–‡ä»¶&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;javac&lt;/strong&gt; ivonhoe/spring/wrcenter/jni/BsDiff.java&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ç”ŸæˆBsDiff.hæ–‡ä»¶&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;javah&lt;/strong&gt; ivonhoe.spring.wrcenter.jni.BsDiff &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ç”Ÿæˆbspatch.o&lt;/p&gt;
    
    </summary>
    
      <category term="å…¶ä»–" scheme="https://ivonhoe.github.io/categories/%E5%85%B6%E4%BB%96/"/>
    
    
      <category term="åŠ¨æ€é“¾æ¥åº“" scheme="https://ivonhoe.github.io/tags/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>AndroidåŠ¨ç”»æ€»ç»“ä¹‹æœ‰èµã€é‚®ç®±å¤§å¸ˆè¿›åº¦æ¡å®ç°åŸç†</title>
    <link href="https://ivonhoe.github.io/2015/09/01/Android%E5%8A%A8%E7%94%BB%E6%80%BB%E7%BB%93%E4%B9%8B%E6%9C%89%E8%B5%9E%E3%80%81%E9%82%AE%E7%AE%B1%E5%A4%A7%E5%B8%88%E8%BF%9B%E5%BA%A6%E6%9D%A1%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/"/>
    <id>https://ivonhoe.github.io/2015/09/01/AndroidåŠ¨ç”»æ€»ç»“ä¹‹æœ‰èµã€é‚®ç®±å¤§å¸ˆè¿›åº¦æ¡å®ç°åŸç†/</id>
    <published>2015-09-01T15:17:29.000Z</published>
    <updated>2018-05-27T08:23:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€æ•ˆæœ">ä¸€ã€æ•ˆæœ</h2><p><img src="/res/android_animation2/xiaoguo.gif" alt=" "></p>
<h2 id="äºŒã€æœ‰èµåŠ è½½è¿›åº¦æ¡">äºŒã€æœ‰èµåŠ è½½è¿›åº¦æ¡</h2><p>å››ä¸ªæ­£æ–¹å½¢çš„è¿åŠ¨å¯ä»¥åˆ†è§£æˆä¸¤ä¸ªåˆ†è¿åŠ¨ï¼Œä¸€ä¸ªæ˜¯å¹³ç§»è¿åŠ¨ï¼Œä¸€ä¸ªæ˜¯è‡ªèº«çš„æ—‹è½¬è¿åŠ¨ã€‚åœ¨å®ç°è¿™ä¸ªåŠ¨ç”»ä¸Šæœ‰ä¸¤ä¸ªæ€è·¯ï¼š</p>
<ul>
<li>ä¸€ä¸ªæ˜¯é€šè¿‡Androidæä¾›çš„Animationæˆ–è€…Animatoræ“ä½œè§†å›¾ï¼Œè®©ä¸€ä¸ªæ­£æ–¹å½¢çš„è§†å›¾åœ¨translateåŠ¨ç”»çš„åŒæ—¶è¿›è¡ŒrotateåŠ¨ç”»ï¼Œåªéœ€è¦è®¾ç½®rotateåŠ¨ç”»çš„pivotåæ ‡ä¸ºè§†å›¾çš„ä¸­å¿ƒç‚¹å°±å¯ä»¥äº†ã€‚</li>
<li>å¦ä¸€ä¸ªæ˜¯ç›´æ¥åœ¨canvasä¸Šç»˜åˆ¶æ­£æ–¹å½¢ï¼Œé€šè¿‡canvasçš„åæ ‡å˜æ¢å®ç°åŠ¨ç”»ã€‚</li>
</ul>
<a id="more"></a>
<p>ä¸‹é¢ä¸»è¦è¯´ç¬¬äºŒç§æ–¹å¼çš„åŸç†ï¼š</p>
<ul>
<li><p>å¹³ç§»ï¼šå¹³ç§»canvasï¼Œåœ¨å¹³è¡Œä¸æ‰‹æœºå±å¹•çš„å¹³é¢åæ ‡ç³»ä¸­ï¼Œæ°´å¹³å‘å³æ–¹å‘ä¸ºXè½´ï¼Œç«–ç›´å‘ä¸‹æ–¹å‘ä¸ºYè½´ï¼ŒæŠŠåŸç‚¹å¹³ç§»åˆ°è§†å›¾çš„ä¸­å¿ƒç‚¹ï¼Œåªéœ€è¦åœ¨æ°´å¹³å’Œç«–ç›´çš„æ­£æ–¹å‘å¹³ç§»å°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">canvas.translate(mBounds.width() / 2, mBounds.height() / 2);</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ—‹è½¬ï¼šæƒ³è¦å®Œæˆä¸€ä¸ªçŸ©å½¢å›´ç»•å…¶ä¸­å¿ƒç‚¹é¡ºæ—¶é’ˆæ—‹è½¬ä¸€ä¸ªè§’åº¦ï¼Œé¦–å…ˆè¦æ„è¯†åˆ°æ—‹è½¬çš„è¿‡ç¨‹ä¸­ï¼Œåªæ”¹å˜äº†åæ ‡ç³»çš„æ–¹å‘å¹¶æ²¡æœ‰æ”¹å˜åæ ‡ç³»çš„åŸç‚¹ä½ç½®ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ éœ€è¦å›´ç»•åæ ‡ç³»åŸç‚¹åšæ—‹è½¬ï¼Œé‚£ä¹ˆä½ åªéœ€è¦æ—‹è½¬æ“ä½œï¼Œå¦‚æœä½ éœ€è¦å›´ç»•é™¤äº†åŸç‚¹ä»¥å¤–çš„å¦å¤–ä¸€ä¸ªç‚¹ï¼ˆæ¯”å¦‚å½“å‰ç°åœ¨æ­£æ–¹å½¢çš„ä¸­å¿ƒç‚¹ï¼‰ï¼Œé‚£ä¹ˆä½ éœ€è¦å…ˆåšå¹³ç§»æ“ä½œï¼Œå…ˆæŠŠåæ ‡ç³»å¹³ç§»åˆ°ä¸€ä¸ªæ­£ç¡®çš„ç‚¹åœ¨åšæ—‹è½¬æ“ä½œã€‚å¦‚å›¾æ‰€ç¤ºï¼š<br><img src="/res/android_animation2/xuanzhuanzuobiao.png" alt=" "></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">canvas.translate((float) (x + (1 - 1.414f * Math.sin((45 - degree) / 180f * Math.PI)) * halfLength),(float) (y - (1.414f * Math.cos((45 - degree) / 180f * Math.PI) - 1) * halfLength));&#10;canvas.rotate(degree);&#10;drawable.draw(canvas);</span><br></pre></td></tr></table></figure>
<ul>
<li>åŠ¨ç”»æ’å€¼ï¼šå¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªæ­£æ–¹å½¢çš„å¹³ç§»è¿åŠ¨å‘¨æœŸæ˜¯ä»èµ·å§‹ç‚¹å›åˆ°èµ·å§‹ç‚¹ï¼Œåœ¨æ—¶é—´çš„ä¸­ç‚¹ä¸Šè¾¾åˆ°å¹³ç§»çš„æœ€å¤§å€¼ã€‚ååº”åœ¨å¹³é¢åæ ‡ä¸­çš„æƒ…å†µå°±æ˜¯ï¼Œä¸€æ¡é€šè¿‡(0, 0), (0.5, 1),(1, 0)ä¸‰ç‚¹ï¼Œåœ¨(0.5, 1)è¾¾åˆ°æœ€å¤§å€¼çš„ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ã€‚å¯ä»¥é—´æ¥å¾—åˆ°è¿™ä¸ªæ’å€¼å™¨æ˜¯ï¼š<br><img src="/res/android_animation2/chazhiqi.jpg" alt=" "></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#36807;&#65288;0,0&#65289;&#65292;&#65288;0.5,1&#65289;&#65292;&#65288;1,0&#65289;&#30340;&#19968;&#20803;&#20108;&#27425;&#26041;&#31243;&#10;Interpolator mInterpolator = new Interpolator() &#123;&#10;    @Override&#10;    public float getInterpolation(float input) &#123;&#10;        return -4 * input * input + 4 * input;&#10;    &#125;&#10;&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰ã€ç½‘æ˜“é‚®ç®±å¤§å¸ˆåŠ è½½è¿›åº¦æ¡">ä¸‰ã€ç½‘æ˜“é‚®ç®±å¤§å¸ˆåŠ è½½è¿›åº¦æ¡</h2><p>åœ†å¼§çš„åŠ¨ç”»éœ€è¦åˆ†è§£æˆå››ä¸ªåˆ†åŠ¨ç”»ï¼š</p>
<ul>
<li>ç”»ç¬”å®½åº¦å˜åŒ–ï¼šç»˜åˆ¶åœ†å¼§çš„ç”»ç¬”å®½åº¦åœ¨åŠ¨ç”»</li>
<li>åœ†å¼§é•¿åº¦å˜åŒ–ï¼šç»˜åˆ¶åœ†å¼§çš„é•¿åº¦åœ¨åŠ¨ç”»</li>
<li>æ—‹è½¬å˜åŒ–ï¼šç»˜åˆ¶æ¯æ®µåœ†å¼§çš„èµ·ç‚¹åœ¨åŠ¨ç”»</li>
<li>åœ†å¼§åŠå¾„å˜åŒ–ï¼šç»˜åˆ¶åœ†å¼§çš„åŠå¾„åœ¨åŠ¨ç”»</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public ObjectAnimator[] getAtomAnimator(Atom atom, Rect bound) &#123;&#10;    ObjectAnimator[] result = new ObjectAnimator[4];&#10;    result[0] = ObjectAnimator.ofFloat(atom, &#34;delta&#34;, 4f, 9f);&#10;    result[0].setInterpolator(mPaintInterpolator);&#10;    switch (atom.getId()) &#123;&#10;        case 0:&#10;            result[1] = ObjectAnimator.ofInt(atom, &#34;rotate&#34;, 0, 360);&#10;            break;&#10;        case 1:&#10;            result[1] = ObjectAnimator.ofInt(atom, &#34;rotate&#34;, 120, 480);&#10;            break;&#10;        case 2:&#10;            result[1] = ObjectAnimator.ofInt(atom, &#34;rotate&#34;, 240, 600);&#10;            break;&#10;        default:&#10;            throw new RuntimeException();&#10;    &#125;&#10;    result[1].setInterpolator(mRotateInterpolator);&#10;    result[2] = ObjectAnimator.ofFloat(atom, &#34;length&#34;, 80f, 59f);&#10;    result[2].setInterpolator(mPaintInterpolator);&#10;    result[3] = ObjectAnimator.ofFloat(atom, &#34;r&#34;, 0, mScaleFactor * getIntrinsicWidth());&#10;    result[3].setInterpolator(mPaintInterpolator);&#10;    return result;&#10;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å››ã€Canvaså›¾å½¢å˜æ¢åŸç†">å››ã€Canvaså›¾å½¢å˜æ¢åŸç†</h2><h3 id="2-1ã€å¹³ç§»">2.1ã€å¹³ç§»</h3><p>è®¾å›¾å½¢ä¸Šç‚¹P(x, y)ï¼Œåœ¨xè½´å’Œyè½´æ–¹å‘åˆ†åˆ«ç§»åŠ¨Txå’ŒTyï¼Œç»“æœç”Ÿæˆæ–°çš„ç‚¹Pâ€™(xâ€™, yâ€™)ï¼Œåˆ™:<br> <img src="/res/android_animation2/pingy0.png" alt=" "></p>
<p>ç”¨çŸ©é˜µå½¢å¼å¯è¡¨ç¤ºä¸º:<br><img src="/res/android_animation2/pingyi.png" alt=" "><br>å¹³ç§»å˜æ¢çŸ©é˜µä¸ºï¼š<br><img src="/res/android_animation2/pingyi2.png" alt=" "><br><img src="/res/android_animation2/pingyimatrix_å‰¯æœ¬.png" alt=" "></p>
<h3 id="2-2ã€ç¼©æ”¾">2.2ã€ç¼©æ”¾</h3><p>è®¾å›¾å½¢ä¸Šçš„ç‚¹P(x, y)åœ¨xè½´å’Œyè½´æ–¹å‘åˆ†åˆ«ä½œSxå€å’ŒSyå€çš„ç¼©æ”¾ï¼Œç»“æœç”Ÿæˆæ–°çš„ç‚¹åæ ‡Pâ€™(xâ€™, yâ€™)ï¼Œåˆ™:<br><img src="/res/android_animation2/suofang.png" alt=" "><br>ç”¨çŸ©é˜µè¡¨ç¤ºä¸ºï¼š<br><img src="/res/android_animation2/suofang2.png" alt=" "><br>æ¯”ä¾‹å˜æ¢çŸ©é˜µä¸ºï¼š<br><img src="/res/android_animation2/suofang 3.png" alt=" "><br><img src="/res/android_animation2/suofangMatrix_å‰¯æœ¬.png" alt=" "></p>
<h3 id="2-3ã€æ—‹è½¬">2.3ã€æ—‹è½¬</h3><p>è®¾ç‚¹P(x, y)ç»•åŸç‚¹æ—‹è½¬å˜æ¢Î¸è§’åº¦(å‡è®¾æŒ‰é€†æ—¶é’ˆæ—‹è½¬ä¸ºæ­£è§’)ï¼Œç”Ÿæˆçš„æ–°çš„ç‚¹åæ ‡Pâ€™(xâ€™, yâ€™)ï¼Œåˆ™ï¼š<br><img src="/res/android_animation2/xuanzhuan1.png" alt=" "><br>ç”¨çŸ©é˜µè¡¨ç¤ºä¸ºï¼š<br><img src="/res/android_animation2/xuanzhuan2.png" alt=" "><br>æ—‹è½¬å˜æ¢çŸ©é˜µä¸ºï¼š<br><img src="/res/android_animation2/xuanzhuan3.png" alt=" "><br><img src="/res/android_animation2/xuanzhuanMatrix_å‰¯æœ¬.png" alt=" "></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸€ã€æ•ˆæœ&quot;&gt;ä¸€ã€æ•ˆæœ&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/res/android_animation2/xiaoguo.gif&quot; alt=&quot; &quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;äºŒã€æœ‰èµåŠ è½½è¿›åº¦æ¡&quot;&gt;äºŒã€æœ‰èµåŠ è½½è¿›åº¦æ¡&lt;/h2&gt;&lt;p&gt;å››ä¸ªæ­£æ–¹å½¢çš„è¿åŠ¨å¯ä»¥åˆ†è§£æˆä¸¤ä¸ªåˆ†è¿åŠ¨ï¼Œä¸€ä¸ªæ˜¯å¹³ç§»è¿åŠ¨ï¼Œä¸€ä¸ªæ˜¯è‡ªèº«çš„æ—‹è½¬è¿åŠ¨ã€‚åœ¨å®ç°è¿™ä¸ªåŠ¨ç”»ä¸Šæœ‰ä¸¤ä¸ªæ€è·¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªæ˜¯é€šè¿‡Androidæä¾›çš„Animationæˆ–è€…Animatoræ“ä½œè§†å›¾ï¼Œè®©ä¸€ä¸ªæ­£æ–¹å½¢çš„è§†å›¾åœ¨translateåŠ¨ç”»çš„åŒæ—¶è¿›è¡ŒrotateåŠ¨ç”»ï¼Œåªéœ€è¦è®¾ç½®rotateåŠ¨ç”»çš„pivotåæ ‡ä¸ºè§†å›¾çš„ä¸­å¿ƒç‚¹å°±å¯ä»¥äº†ã€‚&lt;/li&gt;
&lt;li&gt;å¦ä¸€ä¸ªæ˜¯ç›´æ¥åœ¨canvasä¸Šç»˜åˆ¶æ­£æ–¹å½¢ï¼Œé€šè¿‡canvasçš„åæ ‡å˜æ¢å®ç°åŠ¨ç”»ã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="å…¶ä»–" scheme="https://ivonhoe.github.io/categories/%E5%85%B6%E4%BB%96/"/>
    
    
      <category term="Android" scheme="https://ivonhoe.github.io/tags/Android/"/>
    
      <category term="åŠ¨ç”»" scheme="https://ivonhoe.github.io/tags/%E5%8A%A8%E7%94%BB/"/>
    
      <category term="è¿›åº¦æ¡" scheme="https://ivonhoe.github.io/tags/%E8%BF%9B%E5%BA%A6%E6%9D%A1/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®è§£æå·¥å…·</title>
    <link href="https://ivonhoe.github.io/2015/08/19/%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/"/>
    <id>https://ivonhoe.github.io/2015/08/19/æ•°æ®è§£æå·¥å…·è®¾è®¡æ–‡æ¡£/</id>
    <published>2015-08-19T13:49:49.000Z</published>
    <updated>2018-05-27T08:22:53.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€è®¾è®¡ç›®æ ‡">ä¸€ã€è®¾è®¡ç›®æ ‡</h2><ul>
<li>è®¾è®¡ä¸€ä¸ªç›¸å¯¹é€šç”¨çš„æ•°æ®è§£æå·¥å…·ï¼Œé«˜æ•ˆè§£æé€šè¿‡æŠ“åŒ…å·¥å…·æŠ“å–çš„ç½‘ç»œæ•°æ®å†…å®¹</li>
<li>åªéœ€è¦æ·»åŠ å°‘é‡ä»£ç ï¼Œå®ç°ä¸åŒæ•°æ®æ ¼å¼çš„è§£æï¼Œå¹¶æ”¯æŒä¸åŒæ–‡ä»¶æ ¼å¼ä¿å­˜</li>
</ul>
<h2 id="äºŒã€å®æ–½æ­¥éª¤">äºŒã€å®æ–½æ­¥éª¤</h2><p>æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯ä½¿ç”¨MonkeyRunnerè‡ªåŠ¨æµ‹è¯•è„šæœ¬å¯¹æ‰‹æœºè¿›è¡ŒæŸä¸€äº›å…·ä½“çš„æ“ä½œæ—¶ï¼Œé€šè¿‡Fiddlerå·¥å…·æˆªå–æ‰‹æœºAppçš„Httpé€šè®¯æ•°æ®ï¼Œé€šè¿‡å¯¹è¿™äº›æ•°æ®è¿›è¡Œè§£æä»è€Œè¾¾åˆ°è·å–åº”ç”¨æ•°æ®çš„è¿‡ç¨‹ã€‚</p>
<h3 id="2-1ã€ç¼–å†™MonkeyRunnerè‡ªåŠ¨è„šæœ¬">2.1ã€ç¼–å†™MonkeyRunnerè‡ªåŠ¨è„šæœ¬</h3><ul>
<li>ç¯å¢ƒå’Œå·¥å…·ï¼šPythonï¼ŒAndroid SDKå¼€å‘ç¯å¢ƒï¼Œ Androidæ‰‹æœºä¸€å°ï¼ˆdebugé€‰é¡¹è¿æ¥PCï¼‰</li>
<li>è„šæœ¬ç›®æ ‡ï¼šå¾ªç¯å¯¹æ‰‹æœºå±å¹•è¿›è¡Œä¸Šåˆ’æ“ä½œ</li>
<li>ä»£ç ï¼š<a id="more"></a>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8&#10;from com.android.monkeyrunner import MonkeyRunner,MonkeyDevice,MonkeyImage&#10;device = MonkeyRunner.waitForConnection(5,&#39;351BBJHUHDPU&#39;)&#10;sleepTime = 0.2&#10;for x in xrange(1,10000):&#10;&#9;MonkeyRunner.sleep(sleepTime)&#10;&#9;device.drag((436,1234),(378,346),1,10)</span><br></pre></td></tr></table></figure>
<ul>
<li>æ³¨ï¼šMonkeyRunner.waitForConnectionæ–¹æ³•å‚æ•°ä¸ºadb devices ä¸‹çš„æ‰‹æœºè®¾å¤‡å</li>
</ul>
<h3 id="2-2ã€æŠ“å–åº”ç”¨æµé‡ä¿¡æ¯">2.2ã€æŠ“å–åº”ç”¨æµé‡ä¿¡æ¯</h3><ul>
<li>ä¸‹è½½å¹¶å®‰è£…éœ€è¦æŠ“å–æ•°æ®çš„Androidåº”ç”¨</li>
<li>Googleæœç´¢è·å¾—<a href="http://jingyan.baidu.com/article/fd8044faebfaa85030137a72.html" target="_blank" rel="external">Androidæ‰‹æœºè®¾ç½®ä»£ç†ä¸Šç½‘</a>æ–¹æ³•ï¼Œå¹¶æˆåŠŸè®¾ç½®æ‰‹æœºé€šè¿‡PCä»£ç†ä¸Šç½‘åŠŸèƒ½</li>
<li>å®‰è£…Fiddlerï¼Œé€šè¿‡è®¾ç½®Fiddler hostè¿‡æ»¤å¯ä»¥è·å–å›ºå®šhostçš„HTTP Requestå’ŒResponse</li>
<li>ä½¿ç”¨MonkeyRunneræµ‹è¯•è„šæœ¬ï¼Œå¾ªç¯è§¦å‘æ‰‹æœºä¸Šåˆ’æ“ä½œï¼Œè‡ªåŠ¨æµè§ˆæ‰‹æœºåº”ç”¨å•†åº—çš„åº”ç”¨åˆ†ç±»ç•Œé¢ï¼Œé€šè¿‡FiddleræŠ“å–æ‰‹æœºçš„HTTPè¯·æ±‚å’Œå“åº”æ¶ˆæ¯å†…å®¹ï¼Œå¹¶å¯¼å‡º</li>
</ul>
<h3 id="2-3ã€æ•°æ®è§£æå®ç°">2.3ã€æ•°æ®è§£æå®ç°</h3><h4 id="2-3-1ã€æ•°æ®å¤„ç†æµç¨‹">2.3.1ã€æ•°æ®å¤„ç†æµç¨‹</h4><p><img src="/res/parser/liuchentu.png" alt="Alt text"></p>
<h4 id="2-3-2ã€ä½¿ç”¨ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼å¤„ç†æ•°æ®">2.3.2ã€ä½¿ç”¨ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼å¤„ç†æ•°æ®</h4><p>ç”Ÿäº§è€…çº¿ç¨‹è¯»å–æºæ•°æ®æ–‡ä»¶ï¼Œç”Ÿäº§å‡ºå¾…è§£æçš„å­—ç¬¦ä¸²æ•°æ®æ”¾å…¥æ•°æ®æ± ä¸­ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10;  * &#29983;&#20135;&#32773;&#30340;&#29983;&#20135;&#23481;&#22120;&#10;  */&#10;private LinkedList&#60;Object&#62; mProductPool = new LinkedList&#60;Object&#62;();&#10;&#10;private void addProduct(List&#60;Object&#62; data) &#123;&#10;    while (!data.isEmpty()) &#123;&#10;        synchronized (mProductPool) &#123;&#10;             while (mProductPool.size() &#62;= MAX_SIZE) &#123;&#10;                try &#123;&#10;                    mProductPool.wait();&#10;                &#125; catch (InterruptedException e) &#123;&#10;                    e.printStackTrace();&#10;                &#125;&#10;            &#125;&#10;&#10;        getDataProducer().startProduce();&#10;&#10;        for (int i = 0; i &#60; Math.min(MAX_SIZE, data.size()) &#38;&#38;&#10;                mProductPool.size() &#60; MAX_SIZE; i++) &#123;&#10;                if (!data.isEmpty()) &#123;&#10;                    mProductPool.add(data.get(0));&#10;                    data.remove(0);&#10;                &#125;&#10;            &#125;&#10;            mProductPool.notifyAll();&#10;        &#125;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¤šä¸ªæ¶ˆè´¹è€…çº¿ç¨‹æ¯æ¬¡ä»æ•°æ®æ± ä¸­è·å–ä¸€å®šæ•°é‡çš„æ•°æ®å†…å®¹ç”¨æ¥è§£æï¼Œå¹¶æŠŠè§£æç»“æœæ”¾å…¥æœ€ç»ˆçš„å¤„ç†ç»“æœæ± ä¸­ã€‚è¿™é‡Œå¹¶æ²¡æœ‰ä½¿ç”¨äºŒçº§çš„æ¶ˆè´¹è€…å»åšæ•°æ®ä¿å­˜æ“ä½œï¼Œå› ä¸ºå¯èƒ½éœ€è¦æŠŠæ‰€æœ‰æ•°æ®è§£æå®Œæˆååšç»Ÿä¸€çš„åˆ†ç±»ã€ç»Ÿè®¡ã€ç­›é€‰æ“ä½œã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10;  * &#28040;&#36153;&#32773;&#22788;&#29702;&#25968;&#25454;&#21518;&#30340;&#23481;&#22120;&#10;  */&#10;private List&#60;Unit&#62; mConsumedPool = new ArrayList&#60;Unit&#62;()&#65307;&#10;&#10;public class Consumer implements Runnable &#123;&#10;&#10;    @Override&#10;    public void run() &#123;&#10;        while (true) &#123;&#10;            List&#60;Object&#62; queue = mEngine.getProductPool();&#10;            if (queue == null) &#123;&#10;                return;&#10;            &#125;&#10;&#10;            List&#60;Object&#62; temp = new ArrayList&#60;Object&#62;();&#10;            synchronized (queue) &#123;&#10;                while (queue.size() == 0 &#38;&#38; !mEngine.isProduceComplete()) &#123;&#10;                    try &#123;&#10;                        queue.wait();&#10;                    &#125; catch (InterruptedException e) &#123;&#10;                        e.printStackTrace();&#10;                        queue.notify();&#10;                    &#125;&#10;                &#125;&#10;&#10;                int size = queue.size();&#10;                int k = Math.max(0, size - NUM_PER_CONSUME);&#10;                for (int i = size - 1; i &#62;= k; i--) &#123;&#10;                    temp.add(queue.get(i));&#10;                    queue.remove(i);&#10;                &#125;&#10;&#10;                queue.notifyAll();&#10;            &#125;&#10;&#10;            for (Object str : temp) &#123;&#10;                ArrayList&#60;Unit&#62; result = onParse((String) str);&#10;                if (result != null) &#123;&#10;                    mEngine.addParsedUnit(result);&#10;                &#125;&#10;            &#125;&#10;&#10;            if (mEngine.isProduceComplete() &#38;&#38; queue.isEmpty()) &#123;&#10;                complete(this);&#10;                Thread t = Thread.currentThread();&#10;                t.interrupt();&#10;                return;&#10;            &#125;&#10;        &#125;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>Engine.javaä½œä¸ºæ•´ä¸ªè§£æè¿‡ç¨‹çš„å¼•æ“ï¼Œä¸åŒçš„æ•°æ®éœ€è¦ä¸åŒçš„è§£æå®ç°å’Œä¿å­˜æ ¼å¼å®ç°,ä½¿ç”¨Readerè¯»å–æ•°æ®çš„æ•°æ®ï¼Œå°†è¯»å–çš„æ•°æ®å¡«å……åˆ°æ•°æ®æ± ä¸­ï¼Œå½“æ± æ»¡æ—¶ï¼ŒReaderçº¿ç¨‹é˜»å¡å½“æ± ç©ºæ—¶ï¼Œè§£æçº¿ç¨‹é˜»å¡ã€‚åœ¨æ•°æ®å…¨éƒ¨è¯»å–å¹¶è§£æå®Œæˆä¹‹åï¼Œé€šè¿‡IWriterå°†ç»“æœä¿å­˜åˆ°æ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class Engine implements IParser.ParseListener &#123;&#10;    // &#25351;&#23450;&#35299;&#26512;&#30340;&#25968;&#25454;&#36335;&#24452;&#10;    public void setSourcePath(String path) &#123;&#125;&#10;    // &#35774;&#32622;Reader&#10;    public void setReader(IReader reader) &#123;&#125;&#10;    // &#35774;&#32622;&#35299;&#26512;&#22120;&#10;    public void setParser(IParser parser) &#123;&#125;&#10;    // &#35774;&#32622;Writer&#10;    public void setWriter(IWriter writer) &#123;&#125;&#10;    // &#35299;&#26512;&#22120;&#35299;&#26512;&#23436;&#25104;&#30340;&#22238;&#35843;&#10;    public void onParseComplete() &#123;&#125;&#10;    // &#21551;&#21160;&#65292;&#24320;&#22987;&#22788;&#29702;&#25968;&#25454;&#10;    public void start()&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="ä¸‰ã€é’ˆå¯¹ç¬¬ä¸‰æ–¹åº”ç”¨å•†åº—åˆ†ç±»æ•°æ®çš„è§£æ">ä¸‰ã€é’ˆå¯¹ç¬¬ä¸‰æ–¹åº”ç”¨å•†åº—åˆ†ç±»æ•°æ®çš„è§£æ</h2><h3 id="2-1ã€å®šä¹‰ä¸åŒç±»å‹çš„è§£æå™¨">2.1ã€å®šä¹‰ä¸åŒç±»å‹çš„è§£æå™¨</h3><p>åœ¨åˆ†æç¬¬ä¸‰æ–¹å•†åº—æ•°æ®çš„è¿‡ç¨‹ä¸­å‘ç°ï¼Œæ¯ä¸ªåº”ç”¨å¸‚åœºéƒ½ä¼šé€‰æ‹©æ€§çš„å±è”½ç«å“ä¿¡æ¯çš„è¡Œä¸ºï¼Œä¾‹å¦‚é™¤éé€šè¿‡æœç´¢åŠŸèƒ½ï¼Œä½ å¾ˆéš¾åœ¨360åº”ç”¨å•†åº—çœ‹åˆ°ç›´æ¥ç™¾åº¦çš„åº”ç”¨ã€‚æ·˜å®åº”ç”¨å•†åº—çš„å±è”½è¡Œä¸ºç›¸å¯¹è¾ƒå°‘ï¼Œä½†æ˜¯ä¼šåˆ»æ„æé«˜ä¸€äº›æ¨å¹¿åº”ç”¨çš„ä¸‹è½½æ’åã€‚å¾ˆéš¾åœ¨åº”ç”¨å•†åº—ä¸­æŠ“å–å®Œå…¨çš„åº”ç”¨ä¿¡æ¯ï¼Œå¯èƒ½éœ€è¦è§£æä¸€äº›è‡ªå·±æ‰‹åŠ¨æ”¶é›†çš„åº”ç”¨åˆ†ç±»ä¿¡æ¯ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#20570;&#20855;&#20307;&#38024;&#23545;&#28120;&#23453;&#25968;&#25454;&#30340;JSON&#23383;&#31526;&#20018;&#36827;&#34892;&#25968;&#25454;&#35299;&#26512;&#10;public class TBParser extends IParser &#123;&#10;    @Override&#10;    public ArrayList&#60;Unit&#62; onParse(String source) &#123;&#10;    &#125;&#10;&#125;&#10;//&#20570;&#20855;&#20307;&#38024;&#23545;360&#30340;JSON&#23383;&#31526;&#20018;&#36827;&#34892;&#25968;&#25454;&#35299;&#26512;&#10;public class QHParser extends IParser &#123;&#10;    @Override&#10;    public ArrayList&#60;Unit&#62; onParse(String source) &#123;&#10;    &#125;&#10;&#125;&#10;// &#38024;&#23545;&#33258;&#24049;&#23450;&#20041;&#30340;&#25968;&#25454;&#36827;&#34892;&#35299;&#26512;&#10;public class CustomParser extends IParser &#123;&#10;    @Override&#10;    public ArrayList&#60;Unit&#62; onParse(String source) &#123;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="2-2ã€Zipå‹ç¼©å’ŒHuffmanç¼–ç æ•°æ®å‹ç¼©çš„æ¯”è¾ƒ">2.2ã€Zipå‹ç¼©å’ŒHuffmanç¼–ç æ•°æ®å‹ç¼©çš„æ¯”è¾ƒ</h3><p>é’ˆå¯¹ZIPå‹ç¼©ï¼Œjavaæä¾›äº†æ ‡å‡†çš„æ¥å£<br>é’ˆå¯¹Huffmanç¼–ç å‹ç¼©æ–‡æœ¬çš„åŸç†ï¼Œå¯ä»¥å‚ç…§<a href="http://coolshell.cn/articles/7459.html" target="_blank" rel="external">è¿™é‡Œ</a>,å…·ä½“å®ç°åœ¨å·¥ç¨‹ä»£ç åœ¨ï¼šcom.ivonhoe.parser.huffman.HuffmanCode.javaçš„å®ç°<br>æ¯”è¾ƒå‘ç°é’ˆå¯¹å­—ç¬¦çš„å‹ç¼©ï¼Œç›´æ¥ZIPå‹ç¼©æ¯”å…ˆHuffmanå‹ç¼©åZIPå‹ç¼©çš„å‹ç¼©æ¯”ç‡é«˜ã€‚</p>
<h3 id="2-3ã€ä¿å­˜æ–‡æœ¬æ ¼å¼">2.3ã€ä¿å­˜æ–‡æœ¬æ ¼å¼</h3><p>ä¿å­˜çš„æ•°æ®æ–‡ä»¶åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†</p>
<ul>
<li>ç¬¬ä¸€éƒ¨åˆ†è¡¨ç¤ºå„ç§åˆ†ç±»æ•°æ®çš„æ¡ç›®æ•°é‡<br>{å¥åº·è¿åŠ¨:81}<br>{é€šè®¯ç¤¾äº¤:326}<br>{ç”Ÿæ´»ä¼‘é—²:485}<br>â€¦â€¦</li>
<li>ç¬¬äºŒéƒ¨åˆ†è¡¨ç¤ºæ‰€æœ‰çš„åŒ…åï¼ŒæŒ‰ç…§æ–‡ä»¶å¼€å§‹éƒ¨åˆ†çš„åˆ†ç±»é¡ºåºå’Œæ¡ç›®æ•°ä¾æ¬¡ä¿å­˜<br>com.hk515.patient<br>com.guokr.zhixing<br>com.yidian.health<br>â€¦â€¦</li>
<li>å¦‚ä¸Šæ‰€ç¤ºï¼Œå¥åº·è¿åŠ¨åº”ç”¨æ•°é‡81ä¸ªï¼Œåˆ†åˆ«æ˜¯ç¬¬äºŒéƒ¨åˆ†çš„1~81æ¡ç›®ï¼Œé€šè®¯ç¤¾äº¤åº”ç”¨æœ‰326ä¸ªï¼Œåˆ†åˆ«æ˜¯ç¬¬äºŒéƒ¨åˆ†çš„82~408æ¡ç›®ï¼Œä¾æ¬¡ç±»æ¨ã€‚</li>
</ul>
<h2 id="å››ã€é’ˆå¯¹äº¬ä¸œå•†å“è¯„è®ºæ•°æ®çš„è§£æ">å››ã€é’ˆå¯¹äº¬ä¸œå•†å“è¯„è®ºæ•°æ®çš„è§£æ</h2><p>é’ˆå¯¹äº¬ä¸œçš„è¯„è®ºæ•°æ®ä¿¡æ¯ï¼Œé€šè¿‡ç»§æ‰¿IParserçš„æ¥å£å®ç°å…·ä½“é’ˆå¯¹äº¬ä¸œæ•°æ®çš„è§£ææ–¹å¼ã€‚<br>é’ˆå¯¹è§£ææ•°æ®çš„ä¿å­˜ï¼Œé€šè¿‡ç»§æ‰¿IWriterçš„ä¿å­˜æ¥å£ï¼Œå®ç°é’ˆå¯¹Excelæ–‡ä»¶æ ¼å¼çš„ä¿å­˜<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">**&#10; * &#38024;&#23545;JD&#30340;&#35780;&#35770;&#25968;&#25454;&#35299;&#26512;&#10; *&#10; * @author ivonhoe&#10; */&#10;public class JDWebParser extends IParser &#123;&#10;    @Override&#10;    public ArrayList&#60;Unit&#62; onParse(String source) &#123;&#10;    &#125;&#10;&#125;&#10;&#10;**&#10; * &#36890;&#36807;&#25509;&#21475;&#20445;&#23384;&#21040;Excel&#34920;&#26684;&#20013;&#10; *&#10; * @author ivonhoe&#10; */&#10;public class JDCommentWriter extends ExlWriter &#123;&#10;    @Override&#10;    public void onWrite(List&#60;Unit&#62; list) &#123;&#10;        // TODO Auto-generated method stub&#10;        exportToSheet(&#34;comments&#34;, TITLE_STRINGS, list);&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="äº”ã€æ€»ç»“">äº”ã€æ€»ç»“</h2><ul>
<li>åœ¨pythonéƒ¨åˆ†ï¼Œåœ¨å®ç°ä¸Šåªéœ€è¦é€šè¿‡ç®€å•çš„å¾ªç¯è®©æ‰‹æœºå±å¹•ä¸åœçš„æ»‘åŠ¨å°±å¯ä»¥äº†ã€‚é’ˆå¯¹ç§»åŠ¨ç«¯æ•°æ®ä¼ è¾“çš„ç‰¹ç‚¹ï¼Œç»å¤§å¤šæ•°çš„å®¢æˆ·ç«¯åº”ç”¨å’ŒæœåŠ¡å™¨æ•°æ®ä¼ è¾“çš„æ ¼å¼éƒ½æ˜¯é€šè¿‡JSONæˆ–è€…XMLã€‚ä½ ä¸å†éœ€è¦æƒ³åŠæ³•åœ¨çˆ¬å–ç½‘ç«™é¡µé¢çš„åŸºç¡€ä¸Šè¿›è¡Œæ•°æ®æ”¶é›†ï¼Œä¸å†éœ€è¦è€ƒè™‘å¦‚ä½•ä»ç¹æ‚çš„ç½‘é¡µä¸Šç­›é€‰ä½ æƒ³è¦çš„æ­£æ–‡ã€‚é€šè¿‡æŠ“åŒ…åˆ†æçš„æ–¹å¼ï¼Œè¿™å°±åƒä¸€ä¸ªæ¼æ–—ï¼Œä½ ä¸éœ€è¦å†å»ç­›é€‰æ•°æ®ã€‚ä½ æ‹¿åˆ°çš„éƒ½æ˜¯æ ¼å¼åŒ–çš„æ•°æ®äº†ã€‚</li>
<li>å¦‚æœèƒ½å¤Ÿé›†åˆä¸€äº›æ›´æ™ºèƒ½çš„è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·å¦‚ç™¾åº¦çš„MTCæµ‹è¯•å·¥å…·ï¼Œå½•åˆ¶ä¸€äº›ç‰¹æ®Šçš„æ“ä½œè„šæœ¬ï¼Œé‚£åº”è¯¥å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ã€‚</li>
<li>å¦‚æœé’ˆå¯¹å¤æ‚çš„ä¸šåŠ¡éœ€æ±‚ï¼Œå¯ä»¥å¢åŠ äºŒçº§çš„æ¶ˆè´¹è€…é’ˆå¯¹æ•°æ®è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ã€‚</li>
<li>é’ˆå¯¹åº”ç”¨åˆ†ç±»æ•°æ®çš„ç­›é€‰ï¼Œå› ä¸ºä¸åŒæ•°æ®æºçš„ä¿¡æ¯ï¼ˆå¦‚ä¸‹è½½é‡ï¼‰ä¹Ÿå¹¶ä¸æ˜¯å®Œå…¨å¯ä¿¡çš„ã€‚è¿˜éœ€è¦åšè¿›ä¸€æ­¥çš„ç­›é€‰ã€‚ç›®å‰çš„åšæ³•æ˜¯æ ¹æ®ä¸åŒæ•°æ®æºè¿›è¡ŒåŠ æƒå¹³å‡å–æ’åçš„æ–¹å¼ï¼ˆæµ‹è¯•æ•ˆæœå¹¶ä¸å¥½ï¼‰ï¼Œæˆ–è€…æ ¹æ®æ•°æ®æºçš„å¹¶é›†å’Œåº”ç”¨ä¸‹è½½é‡çš„æ’åç»¼åˆç­›é€‰ï¼Œåº”è¯¥å¯ä»¥æœ‰æ›´å¥½çš„æ–¹å¼ã€‚</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸€ã€è®¾è®¡ç›®æ ‡&quot;&gt;ä¸€ã€è®¾è®¡ç›®æ ‡&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;è®¾è®¡ä¸€ä¸ªç›¸å¯¹é€šç”¨çš„æ•°æ®è§£æå·¥å…·ï¼Œé«˜æ•ˆè§£æé€šè¿‡æŠ“åŒ…å·¥å…·æŠ“å–çš„ç½‘ç»œæ•°æ®å†…å®¹&lt;/li&gt;
&lt;li&gt;åªéœ€è¦æ·»åŠ å°‘é‡ä»£ç ï¼Œå®ç°ä¸åŒæ•°æ®æ ¼å¼çš„è§£æï¼Œå¹¶æ”¯æŒä¸åŒæ–‡ä»¶æ ¼å¼ä¿å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;äºŒã€å®æ–½æ­¥éª¤&quot;&gt;äºŒã€å®æ–½æ­¥éª¤&lt;/h2&gt;&lt;p&gt;æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯ä½¿ç”¨MonkeyRunnerè‡ªåŠ¨æµ‹è¯•è„šæœ¬å¯¹æ‰‹æœºè¿›è¡ŒæŸä¸€äº›å…·ä½“çš„æ“ä½œæ—¶ï¼Œé€šè¿‡Fiddlerå·¥å…·æˆªå–æ‰‹æœºAppçš„Httpé€šè®¯æ•°æ®ï¼Œé€šè¿‡å¯¹è¿™äº›æ•°æ®è¿›è¡Œè§£æä»è€Œè¾¾åˆ°è·å–åº”ç”¨æ•°æ®çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id=&quot;2-1ã€ç¼–å†™MonkeyRunnerè‡ªåŠ¨è„šæœ¬&quot;&gt;2.1ã€ç¼–å†™MonkeyRunnerè‡ªåŠ¨è„šæœ¬&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;ç¯å¢ƒå’Œå·¥å…·ï¼šPythonï¼ŒAndroid SDKå¼€å‘ç¯å¢ƒï¼Œ Androidæ‰‹æœºä¸€å°ï¼ˆdebugé€‰é¡¹è¿æ¥PCï¼‰&lt;/li&gt;
&lt;li&gt;è„šæœ¬ç›®æ ‡ï¼šå¾ªç¯å¯¹æ‰‹æœºå±å¹•è¿›è¡Œä¸Šåˆ’æ“ä½œ&lt;/li&gt;
&lt;li&gt;ä»£ç ï¼š
    
    </summary>
    
      <category term="å…¶ä»–" scheme="https://ivonhoe.github.io/categories/%E5%85%B6%E4%BB%96/"/>
    
    
      <category term="æ•°æ®è§£æ" scheme="https://ivonhoe.github.io/tags/%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90/"/>
    
      <category term="ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼" scheme="https://ivonhoe.github.io/tags/%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Drawable,ä»ç®€åŒ–å¸ƒå±€è°ˆèµ·</title>
    <link href="https://ivonhoe.github.io/2015/04/28/Drawable-%E4%BB%8E%E7%AE%80%E5%8C%96%E5%B8%83%E5%B1%80%E8%B0%88%E8%B5%B7/"/>
    <id>https://ivonhoe.github.io/2015/04/28/Drawable-ä»ç®€åŒ–å¸ƒå±€è°ˆèµ·/</id>
    <published>2015-04-28T15:31:29.000Z</published>
    <updated>2018-05-27T08:23:40.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€Drawbleæ˜¯å¹²å˜›çš„ï¼Ÿ">ä¸€ã€Drawbleæ˜¯å¹²å˜›çš„ï¼Ÿ</h2><p>è¯´åˆ°Drawableè‚¯å®šä¼šç¬¬ä¸€æ—¶é—´æƒ³åˆ°å›¾ç‰‡èµ„æºï¼Œå¯èƒ½æœ‰äººä¼šè®¤ä¸ºDrawableå°±æ˜¯å›¾ç‰‡ã€‚Drawbleä»å­—é¢ä¸Šè¯´å°±æ˜¯â€œå¯ç»˜åˆ¶çš„â€ï¼Œgoogleæ–‡æ¡£çš„æè¿°:â€œA Drawable is a general abstraction for â€œsomething that can be drawn.â€â€ï¼ŒDrawableå…¶å®å°±æ˜¯ä¸ºé‚£äº›â€å¯ä»¥è¢«ç»˜åˆ¶çš„â€™â€™æä¾›çš„æŠ½è±¡ç±»ã€‚</p>
<ul>
<li><strong>å“ªäº›ä¸œè¥¿æ˜¯â€can be drawnâ€ï¼Ÿ</strong></li>
<li><strong>ç»˜åˆ¶åœ¨å“ªé‡Œçš„ï¼Ÿ</strong></li>
</ul>
<p>çœ‹ä¸‹androidåŸç”Ÿçš„Drawableå’ŒCanvasæä¾›äº†çš„ç»˜å›¾çš„æ¥å£ï¼š<a href="http://developer.android.com/reference/android/graphics/drawable/package-summary.html" target="_blank" rel="external">android.graphics.drawable</a><br><a href="http://developer.android.com/reference/android/graphics/Canvas.html" target="_blank" rel="external">android.graphics.Canvas</a>ã€‚Canvasæä¾›äº†ä¸€ç³»åˆ—çš„æ¥å£å»å®ç°ç»˜åˆ¶æƒ³è¦çš„å›¾å½¢ã€å›¾ç‰‡ã€é¢œè‰²æˆ–è€…å…¶ä»–somethingï¼ŒDrawableå°±æ˜¯ä¸ºäº†è¿™äº›â€somethingâ€æä¾›çš„ã€‚</p>
<a id="more"></a>
<h2 id="äºŒã€å¦‚ä½•è‡ªå®šä¹‰Drawableï¼Ÿå¦‚ä½•ç®€åŒ–å¸ƒå±€ï¼Ÿ">äºŒã€å¦‚ä½•è‡ªå®šä¹‰Drawableï¼Ÿå¦‚ä½•ç®€åŒ–å¸ƒå±€ï¼Ÿ</h2><p><img src="/res/drawable/1.jpg" alt="Canvaså’Œå¸ƒå±€å®ç°"></p>
<p>ç›¸ä¿¡ä¸€å®šè§è¿‡ç±»ä¼¼è¿™æ ·çš„å¸ƒå±€ï¼Œåœ¨Androidç³»ç»Ÿä¸­å¦‚ä½•æŠŠæƒ³è¦çš„å›¾å½¢ç»˜åˆ¶å¤„ç†ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>æŠŠä½ æƒ³è¦çš„è§†å›¾ç®€å•çš„å®šä¹‰åˆ°å¸ƒå±€æ–‡ä»¶ä¸­ï¼Œç³»ç»Ÿè¯»å–å¸ƒå±€æ–‡ä»¶ç»˜åˆ¶è§†å›¾</li>
<li>æŠŠæƒ³è¦çš„å›¾å½¢é€šè¿‡canvasçš„ç»˜å›¾æ¥å£ç›´æ¥è¿›è¡Œç»˜åˆ¶<br>åœ¨ç¬¬äºŒç§æ–¹å¼ä¸­ï¼Œä½ éœ€è¦é€šè¿‡æ¯”å¦‚Drawableï¼Œæ¯”å¦‚è‡ªå®šä¹‰çš„Viewçš„onDraw()æ–¹æ³•ï¼Œæˆ–è€…è°ƒç”¨Canvasçš„drawâ€¦()æ–¹æ³•ï¼Œè€ŒViewçš„æ–¹å¼å®é™…ä¸Šä¹Ÿæ˜¯Canvasç»˜åˆ¶çš„æ–¹å¼ï¼ŒViewä¹Ÿå¯ä»¥çœ‹åšæ˜¯å¯¹Canvasç»˜å›¾æ¥å£çš„åŒ…è£…ã€‚è€Œç›´æ¥ç»˜åˆ¶åˆ°Canvasä¸Šçš„æ–¹å¼ä¹Ÿå•å•æ˜¯è¿™äº›ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸Šä½ å¯ä»¥é€šè¿‡è°ƒç”¨Viewçš„invalidate()æ–¹æ³•è§¦å‘ç»˜åˆ¶ï¼Œåœ¨onDraw()æ–¹æ³•å¤„ç†ç»˜å›¾çš„å›è°ƒã€‚å¦ä¸€ç§éä¸»çº¿ç¨‹ç»˜åˆ¶çš„æ–¹å¼å°±æ˜¯SurfaceViewäº†ã€‚</li>
</ul>
<p>é€šè¿‡Drawableç»˜åˆ¶æƒ³è¦çš„å›¾å½¢æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼ŒDrawableæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œdraw()æ–¹æ³•æä¾›äº†ç»˜åˆ¶çš„Canvasï¼ŒinvalidateSelf()æ–¹æ³•æä¾›äº†é‡ç»˜çš„å¯èƒ½ã€‚Drawableçš„æŠ½è±¡æ–¹æ³•åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><p><strong>draw(Canvas canvas)</strong>å°†æƒ³è¦çš„ä¸œè¥¿ç»˜åˆ¶åˆ°è¿™ä¸ªcanvaså¯¹è±¡ä¸Š</p>
</li>
<li><p><strong>setAlpha(int alpha)</strong> ä¸ºdrawableæŒ‡å®šä¸€ä¸ªalphaå€¼ï¼Œ0ä»£è¡¨å…¨é€æ˜ï¼Œ255ä»£è¡¨å…¨ä¸é€æ˜ã€‚</p>
</li>
<li><p><strong>setColorFilter(ColorFilter cf)</strong> ä¸ºdrawableæŒ‡å®šä¸€ä¸ªé¢œè‰²è¿‡æ»¤å™¨</p>
</li>
<li><p><strong>getOpacity()</strong> è·å–é€æ˜åº¦</p>
</li>
</ul>
<p>å®ç°è‡ªå®šä¹‰çš„Drawableåªéœ€è¦ç»§æ‰¿Drawable.javaï¼Œå¹¶ä¸”åœ¨drawæ–¹æ³•é‡Œé€šè¿‡canvasç»˜åˆ¶éœ€è¦çš„å›¾å½¢å°±å¯ä»¥äº†ï¼Œå¬èµ·æ¥å¾ˆç®€å•ã€‚æ— è®ºæ˜¯ä¸€ç»„å›¾ç‰‡ã€ä¸€æ¡æ›²çº¿è¿˜æ˜¯ä¸€ä¸ªè‰²å—ï¼Œæ‰€æœ‰ä½ æƒ³è¦çš„å›¾å½¢éƒ½å¯é€šè¿‡canvaså‚æ•°ç»˜åˆ¶ä¸Šå»ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ä½•ä½¿ç”¨Drawableç®€åŒ–ä¸Šå›¾æ‰€ç¤ºçš„ç½‘æ ¼å¸ƒå±€ï¼Ÿå‡è®¾ä½ éœ€è¦åœ¨ç½‘æ ¼å¸ƒå±€é‡Œæ˜¾ç¤ºä¸åŒçš„å›¾ç‰‡ï¼Œå°±å¯ä»¥æŠŠåœºæ™¯å¾®ä¿¡æœ‹å‹ç¾¤ç»„çš„å›¾æ ‡ã€‚å½“ç„¶ä½ å¯ä»¥ä½¿ç”¨viewå¸ƒå±€æ¥åšï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨canvasæ–¹å¼ã€‚æ ¹æ®Drawableæ·»åŠ çš„é¡ºåºä¾æ¬¡ç¡®å®šæ¯ä¸ªå›¾ç‰‡çš„åæ ‡ä½ç½®ï¼Œåœ¨draw()æ–¹æ³•é‡Œæ ¹æ®æ¯ä¸ªå›¾ç‰‡çš„åæ ‡ä½ç½®å’Œå›¾ç‰‡æ˜¾ç¤ºä½ç½®ç»˜åˆ¶åˆ°canvasä¸Šã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Override&#10;public void draw(Canvas canvas) &#123;&#10;    final int N = Math.min(mChildDrawable.size(), mRowCount * mColumnCount);&#10;    for (int i = 0; i &#60; N; i++) &#123;&#10;        ChildDrawable itemToDraw = mChildDrawable.get(i);&#10;        Drawable drawable = itemToDraw.mDrawable;&#10;        if (drawable != null) &#123;&#10;            itemToDraw.mDrawable.setBounds(itemToDraw.mInsetL, itemToDraw.mInsetT, itemToDraw.mInsetR, itemToDraw.mInsetB);&#10;            drawable.draw(canvas);&#10;        &#125;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="ä¸‰ã€è®©DrawableåŠ¨èµ·æ¥æ€ä¹ˆæ ·ï¼Ÿ">ä¸‰ã€è®©DrawableåŠ¨èµ·æ¥æ€ä¹ˆæ ·ï¼Ÿ</h2><ul>
<li><strong>é¦–å…ˆçœ‹ä¸‹Drawableçš„Canvasä»å“ªé‡Œæ¥</strong></li>
</ul>
<p>ä¸€èˆ¬ä½¿ç”¨ImageViewæ˜¾ç¤ºdrawableï¼Œçœ‹ä¸‹ImageViewçš„onDraw(Canvas canvas)ï¼Œå¯ä»¥çœ‹åˆ°Drawableåœ¨ImageViewé‡Œçš„ç»˜åˆ¶å‘ç”Ÿåœ¨Viewçš„onDrawå›è°ƒé‡Œï¼Œæ ¹æ®scaleTypeå’Œpaddingç¡®å®šç»˜åˆ¶çš„æ–¹å¼å’Œä½ç½®ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protected void onDraw(Canvas canvas) &#123;&#10;    super.onDraw(canvas);&#10;    ....&#10;&#10;    // mDrawMatrix&#26681;&#25454;ImageView&#30340;ScaleType&#26469;&#30830;&#23450;&#30340;&#10;    if (mDrawMatrix == null &#38;&#38; mPaddingTop == 0 &#38;&#38; mPaddingLeft == 0) &#123;&#10;        mDrawable.draw(canvas);&#10;    &#125; else &#123;&#10;        ......&#10;        mDrawable.draw(canvas);&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>Viewç»˜åˆ¶Background Drawableåœ¨draw(Canvas canvas)æ–¹æ³•ï¼Œå¹¶åœ¨setBackgroundDrawableæ—¶ä¼šæ‰§è¡Œbackground.setCallback(this)æ“ä½œã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// Step 1, draw the background, if needed&#10;if (background != null) &#123;&#10;     ......&#10;     if ((scrollX | scrollY) == 0) &#123;&#10;         background.draw(canvas);&#10;     &#125; else &#123;&#10;         ......&#10;         background.draw(canvas);&#10;         ......&#10;     &#125;&#10; &#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>å†çœ‹Drawableå¦‚ä½•é‡ç»˜</strong>ï¼Œ<br>Drawableæ˜¯ä¾èµ–Canvasç»˜åˆ¶çš„ï¼ŒæŸ¥çœ‹Drawableæºç å‘ç°è°ƒç”¨invalidateSelf()æ–¹æ³•éœ€è¦è·å–Callbackï¼Œåœ¨Callbackæ˜¯ç©ºçš„æƒ…å†µä¸‹æ— æ³•é‡ç»˜Drawableã€‚é‚£ä¹ˆåœ¨Viewé‡Œå¦‚ä½•å®ç°Drawableçš„é‡ç»˜ï¼Œæ˜¾ç„¶éœ€è¦å…ˆè®¾ç½®Drawableçš„é‡ç»˜å›è°ƒï¼ŒView.javaå®ç°äº†Drawable.Callbackæ¥å£ï¼Œåœ¨Viewé‡Œè°ƒç”¨setImageDrawable()æ–¹æ³•é‡Œä¼šé¦–å…ˆè®¾ç½®å½“å‰Viewä¸ºDrawableçš„å›è°ƒã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public void invalidateSelf() &#123;&#10;    final Callback callback = getCallback();&#10;    if (callback != null) &#123;&#10;        callback.invalidateDrawable(this);&#10;    &#125;&#10;&#125;&#10;&#10;public static interface Callback &#123;&#10;    public void invalidateDrawable(Drawable who);&#10;    public void scheduleDrawable(Drawable who, Runnable what, long when);&#10;    public void unscheduleDrawable(Drawable who, Runnable what);&#10;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ImageViewè°ƒç”¨invalidateè§¦å‘é‡ç»˜ï¼Œå›è°ƒImageViewçš„onDraw()æ–¹æ³•ï¼Œå®ŒæˆDrawableçš„é‡ç»˜ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Override&#10;public void invalidateDrawable(Drawable dr) &#123;&#10;    if (dr == mDrawable) &#123;&#10;        /* we invalidate the whole view in this case because it&#39;s very&#10;         * hard to know where the drawable actually is. This is made&#10;         * complicated because of the offsets and transformations that&#10;         * can be applied. In theory we could get the drawable&#39;s bounds&#10;         * and run them through the transformation and offsets, but this&#10;         * is probably not worth the effort.&#10;         */&#10;        invalidate();&#10;    &#125; else &#123;&#10;        super.invalidateDrawable(dr);&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>äº†è§£äº†Drawableç»˜åˆ¶çš„ç”»å¸ƒå’Œé‡ç»˜çš„æ–¹æ³•ï¼Œå¦‚ä½•å®ç°åŠ¨ç”»çš„Drawableåªéœ€è¦æŒ‰æ—¶é‡ç»˜Drawableå°±å¯ä»¥äº†ï¼Œç”¨åŠ¨ç”»æ§åˆ¶é‡ç»˜æ•ˆæœã€‚å…·ä½“å®ç°å¯ä»¥çœ‹<a href="https://github.com/Ivonhoe/FancyDrawable" target="_blank" rel="external">https://github.com/Ivonhoe/FancyDrawable</a>ï¼Œç°åœ¨çœ‹å¦‚ä½•å®ç°æˆ‘åœ¨<a href="https://ivonhoe.github.io/2015/04/17/%E5%9F%BA%E4%BA%8E%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF%E7%9A%84Android%E5%8A%A8%E7%94%BB%E5%B7%AE%E5%80%BC%E5%99%A8/">è´èµ›å°”æ’å€¼å™¨</a>é‡Œè¯´è¿‡çš„BallsLineè¿›åº¦æ¡æ•ˆæœï¼Œåªéœ€è¦åœ¨æ¯æ¬¡é‡ç»˜çš„å›è°ƒé‡ŒåŠ¨æ€çš„æ§åˆ¶æ¯ä¸ªå°çƒç‚¹çš„ä½ç½®å°±å¯ä»¥äº†ï¼Œéœ€è¦çš„åŠ¨ç”»æ’å€¼å™¨å‚æ•°å¯ä»¥å‚è€ƒ<a href="http://thecodeplayer.com/walkthrough/windows-phone-loading-animation" target="_blank" rel="external">Webä»£ç </a>ã€‚</p>
<p><img src="/res/drawable/2.jpg" alt="åŠ¨æ€Drawableå’ŒGridDrawable"></p>
<pre><code><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> FRAME_DURATION = <span class="number">1000</span> / <span class="number">60</span>;

<span class="keyword">protected</span> Runnable mUpdater = <span class="keyword">new</span> Runnable() {
    <span class="annotation">@Override</span>
    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{
        onFrame();

        scheduleSelf(mUpdater, SystemClock.uptimeMillis() + FRAME_DURATION);
        invalidateSelf();
    }
};

<span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>{
    <span class="keyword">if</span> (!isRunning()) {
        mIsRunning = <span class="keyword">true</span>;

        <span class="comment">// start</span>
        onStart();
        scheduleSelf(mUpdater, SystemClock.uptimeMillis() + FRAME_DURATION);
        invalidateSelf();
    }
}

<span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>{
    <span class="keyword">if</span> (isRunning()) {
        mIsRunning = <span class="keyword">false</span>;
        unscheduleSelf(mUpdater);

        <span class="comment">//stop</span>
        onStop();
    }
}
</code></pre><h1 id="äº”ã€å‚è€ƒæ–‡æ¡£">äº”ã€å‚è€ƒæ–‡æ¡£</h1><p><a href="http://developer.android.com/reference/android/graphics/drawable/Drawable.html" target="_blank" rel="external">http://developer.android.com/reference/android/graphics/drawable/Drawable.html</a></p>
<p><a href="http://developer.android.com/guide/topics/graphics/2d-graphics.html" target="_blank" rel="external">http://developer.android.com/guide/topics/graphics/2d-graphics.html</a></p>
<p><a href="http://wiresareobsolete.com/2012/12/textdrawable-draw-some-text/" target="_blank" rel="external">http://wiresareobsolete.com/2012/12/textdrawable-draw-some-text/</a></p>
<p><a href="http://cyrilmottier.com/2012/11/27/actionbar-on-the-move/" target="_blank" rel="external">http://cyrilmottier.com/2012/11/27/actionbar-on-the-move/</a></p>
<p><a href="http://antoine-merle.com/blog/2013/11/12/make-your-progressbar-more-smooth/" target="_blank" rel="external">http://antoine-merle.com/blog/2013/11/12/make-your-progressbar-more-smooth/</a></p>
<h2 id="å…­ã€Github">å…­ã€Github</h2><p><a href="https://github.com/Ivonhoe/FancyDrawable" target="_blank" rel="external">https://github.com/Ivonhoe/FancyDrawable</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸€ã€Drawbleæ˜¯å¹²å˜›çš„ï¼Ÿ&quot;&gt;ä¸€ã€Drawbleæ˜¯å¹²å˜›çš„ï¼Ÿ&lt;/h2&gt;&lt;p&gt;è¯´åˆ°Drawableè‚¯å®šä¼šç¬¬ä¸€æ—¶é—´æƒ³åˆ°å›¾ç‰‡èµ„æºï¼Œå¯èƒ½æœ‰äººä¼šè®¤ä¸ºDrawableå°±æ˜¯å›¾ç‰‡ã€‚Drawbleä»å­—é¢ä¸Šè¯´å°±æ˜¯â€œå¯ç»˜åˆ¶çš„â€ï¼Œgoogleæ–‡æ¡£çš„æè¿°:â€œA Drawable is a general abstraction for â€œsomething that can be drawn.â€â€ï¼ŒDrawableå…¶å®å°±æ˜¯ä¸ºé‚£äº›â€å¯ä»¥è¢«ç»˜åˆ¶çš„â€™â€™æä¾›çš„æŠ½è±¡ç±»ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å“ªäº›ä¸œè¥¿æ˜¯â€can be drawnâ€ï¼Ÿ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»˜åˆ¶åœ¨å“ªé‡Œçš„ï¼Ÿ&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çœ‹ä¸‹androidåŸç”Ÿçš„Drawableå’ŒCanvasæä¾›äº†çš„ç»˜å›¾çš„æ¥å£ï¼š&lt;a href=&quot;http://developer.android.com/reference/android/graphics/drawable/package-summary.html&quot;&gt;android.graphics.drawable&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://developer.android.com/reference/android/graphics/Canvas.html&quot;&gt;android.graphics.Canvas&lt;/a&gt;ã€‚Canvasæä¾›äº†ä¸€ç³»åˆ—çš„æ¥å£å»å®ç°ç»˜åˆ¶æƒ³è¦çš„å›¾å½¢ã€å›¾ç‰‡ã€é¢œè‰²æˆ–è€…å…¶ä»–somethingï¼ŒDrawableå°±æ˜¯ä¸ºäº†è¿™äº›â€somethingâ€æä¾›çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://ivonhoe.github.io/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
    
      <category term="Android" scheme="https://ivonhoe.github.io/tags/Android/"/>
    
      <category term="Drawable" scheme="https://ivonhoe.github.io/tags/Drawable/"/>
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://ivonhoe.github.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>ColorOSå’ŒAPEXæ¡Œé¢äº§å“åˆ†æ</title>
    <link href="https://ivonhoe.github.io/2015/04/23/ColorOS%E5%92%8CAPEX%E6%A1%8C%E9%9D%A2%E4%BA%A7%E5%93%81%E5%88%86%E6%9E%90/"/>
    <id>https://ivonhoe.github.io/2015/04/23/ColorOSå’ŒAPEXæ¡Œé¢äº§å“åˆ†æ/</id>
    <published>2015-04-23T13:30:35.000Z</published>
    <updated>2018-05-27T08:23:26.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€æ¡Œé¢åŸºæœ¬æ“ä½œ">ä¸€ã€æ¡Œé¢åŸºæœ¬æ“ä½œ</h2><h3 id="1-1_å®‰è£…åˆä½“éªŒ">1.1 å®‰è£…åˆä½“éªŒ</h3><ul>
<li><p><strong>å®‰è£…åŒ…å¤§å°</strong><br>ColorOSæ¡Œé¢å«æœ‰ä¸¤ä¸ªå®‰è£…åŒ…ï¼ŒOppoLauncher.apk(2.8M)å’ŒOppoLauncherSystem.apk(8.5KB)<br>APEXæ¡Œé¢å®‰è£…åŒ…å¤§å°4.36Mï¼Œå¹¶ä¸”è¿›è¡Œäº†ä»£ç æ··æ·†</p>
</li>
<li><p><strong>é»˜è®¤æ¡Œé¢</strong><br>ColorOSæ¡Œé¢ï¼Œå‰ä¸¤ä¸ªå±å¹•æ˜¯ç³»ç»Ÿåº”ç”¨ï¼ŒåŒ…å«ä¸€ä¸ªå°å·¥å…·çš„æ–‡ä»¶å¤¹ï¼Œå…¶ä»–æ‰€æœ‰åº”ç”¨å¹³é“ºæ¡Œé¢ï¼Œç”¨æˆ·è‡ªå·±å®‰è£…çš„åº”ç”¨ä»ç¬¬ä¸‰å±å¼€å§‹å¹³é“ºã€‚<br>APEXæ¡Œé¢ï¼Œé»˜è®¤çš„åº”ç”¨æ’åˆ—å°±å¾ˆéšæ„ï¼Œåœ¨ä¸åŒçš„æ‰‹æœºä¸Šçš„è¡¨ç°æœ‰å·®åˆ«ï¼Œåº”è¯¥æ˜¯ä¸åŒæ‰‹æœºçš„ç³»ç»Ÿåº”ç”¨çš„åŒ…åä¸åŒï¼Œé€ æˆAPEXçš„é¢„åˆ¶æ¡Œé¢å¹¶ä¸æ˜¯é¡ºåºç´§å¯†åœ¨æ¡Œé¢æ˜¾ç¤ºåº”ç”¨å›¾æ ‡ã€‚</p>
<a id="more"></a>
</li>
</ul>
<h3 id="1-2_æ‰“å¼€åº”ç”¨">1.2 æ‰“å¼€åº”ç”¨</h3><p>   æ¡Œé¢çš„æœ¬åˆ†æ— éå°±æ˜¯å¸®åŠ©ç”¨æˆ·æ‰“å¼€å…¶ä»–åº”ç”¨äº†ï¼Œä½“éªŒColorOSå’ŒAPEXçš„æ‰“å¼€åº”ç”¨æ“ä½œè¿‡ç¨‹æ²¡æœ‰å·®åˆ«ï¼Œé¦–å…ˆæ˜¯ç”¨æˆ·æ‰¾åˆ°ç›¸åº”çš„åº”ç”¨ï¼Œé€šè¿‡å•å‡»å›¾æ ‡æ‰“å¼€åº”ç”¨ã€‚APEXåŸºäºAndroidåŸç”Ÿæ¡Œé¢ï¼Œä¿ç•™äº†æŠ½å±‰åŠŸèƒ½ï¼Œæ‰€ä»¥é’ˆå¯¹è¿˜æ²¡æœ‰æ·»åŠ åˆ°æ¡Œé¢çš„å›¾æ ‡è¿˜éœ€è¦å…ˆè¿›å…¥æŠ½å±‰ç•Œé¢ã€‚ColorOSçš„å¦ä¸€ä¸ªç»†èŠ‚æ˜¯æ–°å®‰è£…çš„åº”ç”¨å›¾æ ‡åœ¨å›¾æ ‡ä¸Šä¼šæœ‰ç±»ä¼¼IOSçš„æç¤ºï¼Œæé†’ç”¨æˆ·è¿™æ˜¯ä¸€ä¸ªæ–°å®‰è£…çš„åº”ç”¨ï¼Œæ‰“å¼€æ–°å®‰è£…åº”ç”¨åæç¤ºå°±æ¶ˆå¤±ã€‚</p>
<h3 id="1-3_ç§»åŠ¨å›¾æ ‡å’Œå½’çº³æ–‡ä»¶å¤¹">1.3 ç§»åŠ¨å›¾æ ‡å’Œå½’çº³æ–‡ä»¶å¤¹</h3><ul>
<li><p><strong>é•¿æŒ‰å’Œæ‹–åŠ¨</strong><br>å‡ ä¹æ‰€æœ‰çš„æ¡Œé¢äº§å“ç§»åŠ¨å›¾æ ‡çš„æ“ä½œéƒ½æ˜¯é•¿æŒ‰å›¾æ ‡æ‹–æ‹½å³å¯ç§»åŠ¨ï¼ŒColorOSåœ¨é•¿æŒ‰æ—¶æ‰€æœ‰å›¾æ ‡ä¼šè¿›å…¥æŠ–åŠ¨çš„æ¨¡å¼ï¼Œè¿™ç‚¹åˆå’ŒIOSçš„è¡¨ç°ä¸€ç›´ï¼ŒåŒæ—¶å¯å¸è½½çš„åº”ç”¨å·¦ä¸Šè§’ä¼šå‡ºç°å¯åˆ é™¤çš„æç¤ºã€‚åœ¨æŠ–åŠ¨æ¨¡å¼ä¸‹å¯ç›´æ¥å¸è½½åº”ç”¨ã€‚<br>ç›¸æ¯”APEXåœ¨é•¿æŒ‰æ¡Œé¢å›¾æ ‡åä¼šå‡ºç°ä¸€ä¸ªå¼¹å‡ºçš„è§†å›¾ï¼Œä¸Šé¢å¯ä»¥è¿›è¡Œåˆ é™¤ã€ç¼–è¾‘å›¾æ ‡åç§°ã€å¢åŠ æ‰‹åŠ¿ç­‰æ“ä½œã€‚åœ¨æ‹–åŠ¨è¿‡ç¨‹ä¸­ï¼ŒColorOSçš„å›¾æ ‡ä¼šæ ¹æ®æ‹–åŠ¨åå“æœ‰å€¾æ–œçš„æ•ˆæœã€‚</p>
</li>
<li><p><strong>å½’çº³åº”ç”¨åˆ°æ–‡ä»¶å¤¹</strong><br>ColorOSã€APEXçš„æ¡Œé¢å›¾æ ‡åˆå¹¶éƒ½æ˜¯åŸºäºåŸç”ŸLauncherçš„ï¼Œæ²¡æœ‰æœ¬è´¨çš„å·®åˆ«ï¼Œéƒ½ä¸æ”¯æŒåŒæ—¶åˆå¹¶ä¸¤ä¸ªæ–‡ä»¶å¤¹ã€‚ä½†åƒæ¯”è¾ƒä¹‹ä¸‹ï¼ŒColorOSåœ¨æ‹–åŠ¨å›¾æ ‡æ›´æ¢ä½ç½®ä¸Šæ”¯æŒè·¨å±æŸ¥æ‰¾ä½ç½®ï¼Œå³å½“ä»Dockä½ç½®æ‹–å‘ä¸€ä¸ªæ’æ»¡å›¾æ ‡çš„å±å¹•æ—¶ï¼Œå›¾æ ‡ä¼šè‡ªåŠ¨å‘åä¸€ä¸ªå±å¹•å¯»æ‰¾ä½ç½®ã€‚ç›¸æ¯”å…¶ä»–æ¡Œé¢äº§å“å¾ˆå°‘æœ‰å…³æ³¨è¿™ä¸ªç»†èŠ‚çš„ã€‚åŒæ—¶ColorOSçš„æ–‡ä»¶å¤¹ä¸­æä¾›äº†ä¸€ä¸ªâ€œ+â€æ“ä½œï¼Œå¯ä»¥æ‰¹é‡é€‰æ‹©æ¡Œé¢ä¸Šçš„å›¾æ ‡åŠ å…¥å½“å‰æ–‡ä»¶å¤¹ä¸­ï¼Œé’ˆå¯¹ç”¨æˆ·å½’çº³åº”ç”¨è¡Œä¸ºé¿å…äº†åå¤æ‹–åŠ¨å’Œé€‰æ‹©çš„æ“ä½œï¼Œä½†æ˜¯â€œ+â€æ“ä½œåªèƒ½é’ˆå¯¹æ¡Œé¢å›¾æ ‡ï¼Œå·²ç»æ”¾å…¥å…¶ä»–æ–‡ä»¶å¤¹çš„å›¾æ ‡ä¸åœ¨è¢«é€‰åˆ—è¡¨ä¸­ï¼ŒåŒæ—¶â€œ+â€æ”¯æŒæŠŠå½“å‰æ–‡ä»¶å¤¹ä¸­çš„å›¾æ ‡ç§»å‡ºæ–‡ä»¶å¤¹çš„æ“ä½œï¼Œç§»å‡ºçš„å›¾æ ‡è‡ªåŠ¨æ”¾åˆ°æ¡Œé¢æœ€åçš„ä½ç½®ã€‚</p>
</li>
</ul>
<h3 id="1-4_å¸è½½åº”ç”¨">1.4 å¸è½½åº”ç”¨</h3><p>ColorOSåœ¨é•¿æŒ‰å›¾æ ‡è¿›å…¥è·³åŠ¨æ¨¡å¼åï¼Œå¯å¸è½½å›¾æ ‡å·¦ä¸Šè§’éƒ½ä¼šå‡ºç°åˆ é™¤æç¤ºï¼Œåˆæ˜¯IOSçš„ç—•è¿¹ã€‚<br>APEXå¸è½½æ“ä½œç›¸å¯¹åŸç”ŸLauncheråŒæ ·æ²¡æœ‰å·®åˆ«ã€‚å¥½æ‡’å•Šï¼åœ¨æ¡Œé¢ä¸Šçš„å›¾æ ‡åªæä¾›åˆ é™¤æ¥å£ï¼Œä»æŠ½å±‰ä¸­é•¿æŒ‰çš„å›¾æ ‡æ‰å¯ä»¥åˆ é™¤ã€‚åˆ é™¤åº”ç”¨åŒæ ·ä¼šå¼¹å‡ºæ¡†ç¡®è®¤ã€‚</p>
<h2 id="äºŒã€ç”¨æˆ·æ„ŸçŸ¥">äºŒã€ç”¨æˆ·æ„ŸçŸ¥</h2><h3 id="2-1_å›¾æ ‡é£æ ¼å’Œæ¡Œé¢ä¸»é¢˜èŒƒå›´">2.1 å›¾æ ‡é£æ ¼å’Œæ¡Œé¢ä¸»é¢˜èŒƒå›´</h3><ul>
<li><p><strong>å›¾æ ‡é£æ ¼</strong><br>ColorOSçš„é»˜è®¤å›¾æ ‡å¹¶æ²¡æœ‰å®šä¹‰åº”ç”¨å›¾æ ‡çš„å½¢çŠ¶ä¹Ÿæ²¡æœ‰åŠ åœ†è§’ï¼Œä½†æ˜¯å°½é‡ä¿è¯äº†å›¾æ ‡å¤§å°çš„ç»Ÿä¸€ï¼ŒåŒæ—¶é»˜è®¤ç³»ç»Ÿå›¾æ ‡åŠ äº†é˜´å½±ï¼Œåœ¨è‰²å½©ä¸Šç³»ç»Ÿé»˜è®¤å›¾æ ‡ä»¥ç»¿è‰²å’Œç™½è‰²è‰²è°ƒå±…å¤šï¼Œå› ä¸ºå¹¶æ²¡æœ‰ç»™æ‰€æœ‰çš„å›¾æ ‡åŠ èƒŒæ¿ï¼Œæ‰€ä»¥æ•´ä½“çš„æ„Ÿè§‰æ˜¯è¾¨è¯†åº¦å¾ˆå¥½ï¼Œå°½é‡ä¿æŒäº†åº”ç”¨å›¾æ ‡çš„æœ¬è‰²ã€‚ä½†æ˜¯ç»Ÿä¸€åº¦ä¸å¤Ÿï¼Œä¸è¿‡å› ä¸ºæœ‰æ¢ä¸»é¢˜åŠŸèƒ½è¿™ç‚¹ä¹Ÿå¹¶æ²¡æœ‰ä»€ä¹ˆä¸å¥½ï¼Œä¸å–œæ¬¢é»˜è®¤å›¾æ ‡ï¼Ÿé—´æ¥çš„æŠŠç”¨æˆ·èµ¶å‘äº†ä¸»é¢˜å•†åº—ã€‚ç›¸æ¯”APEXçš„å›¾æ ‡é£æ ¼ï¼Œè¿˜æ˜¯ä¸€ä¸ªå­—ï¼Œâ€œæ‡’æƒ°â€ã€‚å’ŒåŸç”ŸLauncherå‡ ä¹æ²¡æœ‰åŒºåˆ«ï¼Œå¯¼è‡´ä¸‰æ–¹åº”ç”¨çš„æ˜¾ç¤ºæ•ˆæœå¾ˆå·®ã€‚</p>
</li>
<li><p><strong>æ¡Œé¢ä¸»é¢˜èŒƒå›´</strong><br>ColorOSçš„ä¸»é¢˜èŒƒå›´</p>
</li>
<li>å›¾æ ‡ï¼ŒåŒ…å«èƒŒæ¿ã€åœ†è§’ã€å¤§å°ã€å›¾æ ‡å†…å®¹<br>l å£çº¸ï¼ŒåŒ…æ‹¬åŠ¨æ€å£çº¸(ColorOSçš„ä¸€å¤§ç‰¹è‰²)ã€é™æ€å£çº¸<br>l æ–‡ä»¶å¤¹å›¾æ ‡èƒŒæ™¯<br>l é¡µé¢æŒ‡ç¤ºæŒ‡ç¤ºæ ·å¼</li>
</ul>
<p>APEX:éœ€è¦åˆ°google playä¸‹è½½</p>
<h3 id="2-2_åŠ¨ç”»å’Œå£°æ•ˆ">2.2 åŠ¨ç”»å’Œå£°æ•ˆ</h3><p>ColorOSæ¡Œé¢çš„åŠ¨ç”»åªè¦é›†ä¸­åœ¨ç¼–è¾‘æ¨¡å¼ä¸­ï¼Œé•¿æŒ‰å›¾æ ‡çš„è·³åŠ¨æ¨¡å¼å’Œä¸‹ä¾§ç¼–è¾‘æ¡†ç©ºé—´çš„è¿›åœºåŠ¨ç”»ã€‚æœ€æœ‰äº®ç‚¹çš„åŠ¨ç”»å¤©æ°”æ•ˆæœå’Œå…¶ä»–çš„åŠ¨æ€å£çº¸ï¼Œæ¯”å¦‚é»˜è®¤çš„è’²å…¬è‹±ä¼šéšç€æ»‘åŠ¨æ–¹å‘é£˜åŠ¨ã€‚åœ¨éŸ³æ•ˆæ–¹é¢ï¼ŒColorOSåœ¨ç”¨æˆ·çš„æ“ä½œåé¦ˆä¸Šä¹Ÿå¾ˆæœ‰ç‰¹ç‚¹ï¼Œç”šè‡³åœ¨å¤©æ°”åŠ¨ç”»å’ŒéŸ³æ•ˆçš„æ¥åˆä¸Šï¼Œä¸‹é›¨çš„å£°éŸ³ï¼Œé—ªç”µçš„æ•ˆæœï¼Œåšçš„éƒ½å¾ˆåˆ°ä½ã€‚æ›´å¯è´µçš„æ˜¯ï¼Œé’ˆå¯¹é›¾éœ¾å¤©æ°”çš„æ˜¾ç¤ºå¹¶ä¸æ˜¯ç°è’™è’™çš„ä¸€ç‰‡å¹¶ä¸ä¼šç»™äººå¤ªå¤šå¾ˆå‹æŠ‘æˆ–è€…æ¶ˆæçš„æš—ç¤ºã€‚</p>
<p>APEXçš„åŠ¨ç”»å’Œå£°æ•ˆè¿˜æ˜¯ç”¨ä¸€ä¸ªå­—å½¢å®¹ã€‚</p>
<h3 id="2-3_ç”¨æˆ·ç¼–è¾‘å’Œè®¾ç½®">2.3 ç”¨æˆ·ç¼–è¾‘å’Œè®¾ç½®</h3><p>é’ˆå¯¹ç”¨æˆ·ç¼–è¾‘å’Œè®¾ç½®åœ¨ä¸Šé¢ä¹Ÿå·²ç»æåˆ°ï¼ŒåŒ…æ‹¬å›¾æ ‡å’Œæ–‡ä»¶å¤¹çš„äº¤äº’ã€‚è¿˜æœ‰æ–°å»ºå±å¹•æ–¹é¢ï¼ŒColorOSä¾ç„¶æ˜¯åœ¨ç¼–è¾‘æ¨¡å¼è‡ªåŠ¨å‘åæ–°åŠ ä¸€ä¸ªå±å¹•ï¼Œå¯¹äºAPEXæˆ‘è¡¨ç¤ºè®¾ç½®é¡¹å¤ªå¤šæˆ‘è¿˜æ²¡æ‰¾åˆ°ã€‚ColorOSé’ˆå¯¹ç”¨æˆ·çš„è®¾ç½®ï¼Œä¸ç®¡æ˜¯æ¢å£çº¸æ¢ä¸»é¢˜è¿˜æ˜¯æ·»åŠ å°éƒ¨ä»¶ï¼Œæ¡Œé¢éƒ½ä¼šé©¬ä¸Šç¨‹åºå‡ºç”¨æˆ·è®¾ç½®åçš„æ•ˆæœï¼Œå¹¶ä¸æ˜¯é€šè¿‡èœå•é¡¹çš„é€‰æ‹©æˆ–è€…å…¶ä»–è®¾ç½®é¡µé¢çš„è·³è½¬æ¥å®Œæˆï¼Œæ‰€æœ‰çš„è®¾ç½®éƒ½åœ¨æ¡Œé¢ä¸Šå®Œæˆï¼Œå¹¶ä¸”å‡ ä¹æ–‡å­—çš„æè¿°ï¼Œå› ä¸ºä¸éœ€è¦ã€‚<br>è€Œç›¸æ¯”è¾ƒAPEXï¼Œå‡ ä¹æ‰€æœ‰çš„è®¾ç½®éƒ½æ˜¯é€šè¿‡èœå•çš„é€‰æ‹©æ¥è®¾ç½®å®Œæˆçš„ï¼Œå› ä¸ºéœ€è¦åŒæ—¶é’ˆå¯¹æ¡Œé¢å’Œåº”ç”¨æŠ½å±‰ä¸¤ä¸ªç•Œé¢ï¼ŒAPEXæ¡Œé¢çš„è®¾ç½®èŒƒå›´å’ŒåŠŸèƒ½ä¸èƒ½è¯´ä¸å¼ºå¤§ã€‚å‡ ä¹é’ˆå¯¹æ¡Œé¢æ‰€æœ‰èƒ½æƒ³åˆ°çš„è®¾ç½®é¡¹å®ƒéƒ½è¦†ç›–åˆ°äº†ã€‚ç”šè‡³å¾ˆå¤šåŠŸèƒ½ï¼Œé€šè¿‡åå­—ä¹Ÿæ— æ³•ç†è§£åˆ°åº•æ˜¯æœ‰ä»€ä¹ˆä½œç”¨ï¼Œåªè¦è¯•è¯•æ‰ä¼šçŸ¥é“ï¼Œè€Œè®¾ç½®çš„è¿‡ç¨‹å¯èƒ½éœ€è¦2~3ä¸ªç•Œé¢çš„è·³è½¬æ‰èƒ½è®¾ç½®æˆåŠŸï¼Œé¢„è§ˆè®¾ç½®æ•ˆæœè¿˜éœ€è¦è¿”å›æ¡Œé¢æ‰èƒ½çœ‹åˆ°ï¼Œåœ¨ä½“éªŒä¸Šç¡®å®å¤ªå¤šç¹çã€‚æ‰€æœ‰é’ˆå¯¹è¿™ä¹ˆå¤šè®¾ç½®é¡¹ï¼Œä¸€ä¸ªå¤‡ä»½å’Œæ¢å¤è®¾ç½®é¡¹æ˜¾å¾—æœ‰å¤šä¹ˆé‡è¦ï¼ŒAPEXåšåˆ°äº†ã€‚ä½†æ˜¯ä¸å¾—ä¸æ‰¿è®¤ï¼ŒAPEXæ¡Œé¢çš„è®¾ç½®çœŸçš„æ˜¯åº”æœ‰å°½æœ‰ï¼Œæ¯ä¸€å—è§†å›¾åŒºåŸŸéƒ½å¯¹åº”ä¸€ç³»åˆ—çš„è®¾ç½®é¡¹ï¼ŒåŒ…æ‹¬ä¸»å±å¹•è®¾ç½®ã€æŠ½å±‰è®¾ç½®(è¿™é‡Œè¿˜åŒ…æ‹¬æŠ½å±‰åº”æœ‰çš„åˆ†ç»„åˆ†ç±»åŠŸèƒ½)ã€æ‰˜ç›˜åŒºåŸŸçš„è®¾ç½®ã€æ–‡ä»¶å¤¹æ ·å¼çš„è®¾ç½®ã€é€šçŸ¥è®¾ç½®ç­‰ã€‚ç«Ÿç„¶è¿˜æ„çŠ¹æœªå°½åŠ ä¸Šäº†æ‰€è°“é«˜çº§è®¾ç½®ã€‚æˆ‘æƒ³æ”¶å›ä¸Šé¢å¯¹APEXçš„è¯„ä»·ã€‚APEXæ¡Œé¢çœŸæ˜¯å¤ªå‹¤å¥‹äº†â€¦<br>ç®€å•çœ‹ä¸‹é«˜çº§è®¾ç½®ï¼Œå°±åŒ…æ‹¬å›¾æ ‡å°ºå¯¸è®¾ç½®ã€å›¾æ ‡æ–‡å­—å¤§å°è®¾ç½®ã€å›¾æ ‡å­—ä½“è®¾ç½®ã€è¯­è¨€è®¾ç½®ã€‚ç”šè‡³è¿˜æœ‰ä¸»å±å¹•å’ŒæŠ½å±‰é¡µé¢çš„æ»šåŠ¨é€Ÿåº¦è®¾ç½®ã€‚æƒ³è±¡åŠ›ä¸å¯è°“ä¸ä¸°å¯Œã€‚(è¿™é‡Œæˆ‘å°±ä¸åˆ—ä¸¾äº†ï¼Œè¯¦ç»†äº†è§£è¯·ä¸‹è½½ä½“éªŒã€‚)</p>
<h2 id="ä¸‰ã€ç”¨æˆ·ä½“éªŒ">ä¸‰ã€ç”¨æˆ·ä½“éªŒ</h2><h3 id="3-1_ç‰¹è‰²å’Œé™„åŠ åŠŸèƒ½">3.1 ç‰¹è‰²å’Œé™„åŠ åŠŸèƒ½</h3><p>è¯´åˆ°ç‰¹è‰²ï¼Œå¦‚æœé’ˆå¯¹æ²¡æœ‰æ¥è§¦è¿‡IOSçš„æ™®é€šä½ç«¯ç”¨æˆ·ï¼Œç…§æ¬IOSçš„æ¨¡å¼æ˜¯ä¸€ä¸ªå¾ˆè®¨å·§çš„æ–¹å¼ï¼Œåœ¨å›¾æ ‡çš„ç¼–è¾‘ç­‰å¾ˆå¤šæ–¹é¢ColorOSéƒ½æœ‰ç€IOSçš„çƒ™å°ã€‚è¿™æ ·ä¹Ÿæ²¡æœ‰é”™ï¼Œä¼˜ç§€çš„äº‹ç‰©éƒ½æ˜¯ç›¸ä¼¼çš„ã€‚å½“ç„¶ColorOSç§°å¾—ä¸Šç‰¹è‰²çš„ä¸ä»…ä»…æ˜¯è¿™äº›ï¼Œå¤©æ°”å£çº¸å’ŒåŠ¨æ€å£çº¸ç»“åˆå›¾æ ‡çš„æ•ˆæœä¸å¯è°“ä¸æƒŠè‰³ã€‚åœ¨ä¸‹é›¨çš„æ—¶å€™å›¾æ ‡ä¸Šéƒ½æœ‰é›¨ç çš„æ•ˆæœï¼Œä¸å•å•æ˜¯äº§å“è®¾ç½®çš„æƒ³è±¡åŠ›ï¼Œåœ¨ç¨‹åºè®¾è®¡ä¸Šä¹Ÿæ˜¯å¾ˆæœ‰éš¾åº¦çš„ã€‚ç»“åˆä¸»é¢˜çš„æ¢è‚¤åŠŸèƒ½ï¼Œè™½ç„¶æ²¡æœ‰å¤ªå¤šçš„äº®ç‚¹ï¼ŒåŠŸèƒ½ä¸Šä¹Ÿæ˜¯ä¸­è§„ä¸­çŸ©ï¼Œä½†æ˜¯åœ¨ç´ æå’Œèµ„æºçš„è´¨é‡ä¸Šä¹Ÿä¸é”™ï¼Œå•ç‹¬å°±æ‹¿å›¾æ ‡æ¥è¯´ï¼Œå…è´¹çš„ä¸»é¢˜ç»™äººçš„æ„Ÿè§‰ä¹Ÿä¸æ˜¯æ°´å‹éšä¾¿å¼„å¼„çš„æ„Ÿè§‰ã€‚åŒæ—¶åœ¨ä¸»é¢˜åŠŸèƒ½ä¸Šå®ç°äº†å¤šè¿è¥ç®¡é“çš„æ¥å…¥ï¼Œä¸ºæ›´å¤šæ›´ä¼˜è´¨çš„èµ„æºæä¾›äº†å¯èƒ½ã€‚</p>
<p>ç›¸å¯¹APEXæ¡Œé¢ï¼Œæœ€å¤§çš„ç‰¹è‰²åº”è¯¥å°±æ˜¯ï¼Œâ€œä½ çœ‹åˆ°çš„ä¸œè¥¿å‡ ä¹éƒ½èƒ½æ”¹å˜â€ï¼Œä¸Šé¢å·²ç»ç®€å•åˆ—ä¸¾è¿‡äº†ã€‚æŠ›å¼€ç”¨æˆ·çš„æ“ä½œä½“éªŒä¸è¯´ï¼Œå•åœ¨ç¨‹åºè®¾è®¡çš„è§’åº¦ä¸Šè¯´ï¼Œå¦‚ä½•ç»„ç»‡å¦‚æ­¤å¤šçš„è®¾ç½®åŠŸèƒ½ï¼Œå…‰æ˜¯æƒ³æƒ³éƒ½æœ‰ç‚¹å¤´çš®å‘éº»ï¼Œè€Œç›¸å¯¹ä¸APEXæ¡Œé¢çš„æµç•…å’Œç¨³å®šæ€§ï¼Œå®ƒçš„è½¯ä»¶æ¶æ„ä¸€å®šæœ‰å¾ˆå¤šèƒ½å¤Ÿå­¦ä¹ çš„åœ°æ–¹ã€‚å¯æƒœä»£ç è¢«æ··æ·†äº†ã€‚</p>
<h3 id="3-2_æµç¨‹åº¦å’Œå†…å­˜">3.2 æµç¨‹åº¦å’Œå†…å­˜</h3><ul>
<li><p><strong>æµç•…åº¦</strong><br>ColorOSåœ¨æ¡Œé¢æ»‘åŠ¨ç‰¹æ•ˆä¸Šï¼Œå¼€å§‹æ»‘åŠ¨çš„å‡ å¸§å¯èƒ½ä¼šæœ‰æ‰å¸§çš„ç°è±¡ï¼Œè€Œä¸”å°±è’²å…¬è‹±åŠ¨æ€å£çº¸ï¼Œåœ¨æ»‘åŠ¨æ¡Œé¢æ˜¯è’²å…¬è‹±çš„é£åŠ¨æ•ˆæœä¹Ÿç¨æœ‰æ‰å¸§çš„æ„Ÿè§‰ï¼Œå¯èƒ½æ˜¯åˆ·æ–°é¢‘ç‡çš„é—®é¢˜ã€‚<br>APEXæ¡Œé¢çš„æµç•…æ€§ä¸Šä¹Ÿæ˜¯è¡¨ç°ä¸é”™ï¼ŒAPEXåœ¨åŸç”Ÿæ¡Œé¢çš„äº¤äº’åŸºç¡€ä¸Šè¿›è¡Œçš„å¼€å‘ï¼Œäº¤äº’å¹¶ä¸å¤æ‚ï¼Œè§†å›¾çš„å±‚æ¬¡å’Œå¤æ‚åº¦ä¹Ÿå¹¶ä¸å¤æ‚ã€‚</p>
</li>
<li><p><strong>å†…å­˜</strong><br>ColorOSæ¡Œé¢åœ¨ä¸€èˆ¬æƒ…å†µå†…å­˜åœ¨100Mä»¥ä¸Šï¼Œå¢åŠ å¤šä¸ªä¸“å±ç©ºé—´ç©ºé—´å¯èƒ½ä¼šè¾¾åˆ°150Mã€‚æ­£å¸¸æƒ…å†µä¸‹ä¼šåœ¨150Mä»¥ä¸‹ã€‚<br>APEXæ¡Œé¢å¯åŠ¨ä¹‹åçš„å†…å­˜å æœ‰åœ¨40Må·¦å³ï¼Œæ­£å¸¸ä½¿ç”¨æƒ…å†µä¸‹åœ¨60Må·¦å³ã€‚ç›¸æ¯”è¾ƒä¸€ä¸ªhello worldéƒ½å¯èƒ½åˆ†é…10Mçš„å†…å­˜ï¼Œè¿™æ ·çš„å†…å­˜å ç”¨ç‡å·²ç»å¾ˆä¸é”™äº†ã€‚ä¸è¿‡æ¯•ç«ŸAPEXæ¡Œé¢çš„åŠ¨ç”»å’Œè§†å›¾å¹¶ä¸ç®—å¤æ‚ï¼Œè¿™æ ·çš„å æœ‰ç‡ä¹Ÿåœ¨æƒ…ç†ä¹‹ä¸­ã€‚</p>
</li>
</ul>
<h2 id="å››ã€åç¼–è¯‘åˆ†æ">å››ã€åç¼–è¯‘åˆ†æ</h2><p>åˆ†æç»“æœæš‚æ— ã€‚</p>
<h2 id="äº”ã€æˆ‘çš„çœ‹æ³•">äº”ã€æˆ‘çš„çœ‹æ³•</h2><p>ColorOSæ¡Œé¢å’ŒAPEXæ¡Œé¢åœ¨äº§å“æ€è·¯ä¸Šæ˜¯å®Œå…¨ä¸åŒçš„æ–¹å‘ã€‚ä¸€ä¸ªåœ¨å°½åŠ›è®¨å¥½ç”¨æˆ·ï¼Œå°½åŠ›æŠŠç‰¹æ•ˆå’Œäº¤äº’åšç‚«ï¼Œå®ƒå°½åŠ›å‘Šè¯‰ç”¨æˆ·ä»€ä¹ˆæ ·æ˜¯æ¯”è¾ƒå¥½çš„ï¼Œé’ˆå¯¹å›½å†…å¸‚åœºç¡®å®ç®—å¾ˆæœ‰ç‰¹è‰²ä¹Ÿå¾ˆæœ‰å–ç‚¹ã€‚è€Œå¯¹æ¯”å…¶ä»–ä¼˜ç§€æ¡Œé¢äº§å“åœ¨å¾ˆå¤šäº¤äº’ä¸Šä¹Ÿéš¾å…æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œå½“ç„¶è¿™å¹¶ä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯åˆ«äººæœ‰çš„æˆ‘ä¹Ÿæœ‰ï¼Œåˆ«äººæœ‰çš„æˆ‘æ²¡æœ‰ã€‚è¿˜å¥½ColorOSè¿ˆè¿‡äº†è¿™é“åï¼ŒåŠ¨æ€å£çº¸çš„æ•ˆæœä¹Ÿè¯æ˜äº†ColorOSæ¡Œé¢è¶³å¤Ÿä¼˜ç§€ã€‚é‚£è¿™ä¹ˆå¥½çš„æ•ˆæœä¸ºä»€ä¹ˆæ²¡æœ‰å¼•èµ·åˆ«äººè·Ÿé£ï¼Ÿï¼ˆäº‹å®ä¸Šä¹Ÿä¸æ˜¯æ²¡æœ‰ï¼ŒTCLå°±è·Ÿè¿‡ï¼‰ã€‚ä»£ç éƒ½æ²¡æœ‰åŠ æ··æ·†ï¼Œæè¿‡æ¥åº”è¯¥ä¸éš¾ã€‚ä½†æ˜¯ä¼´éšç€é…·ç‚«çš„è§†è§‰æ•ˆæœèƒŒåï¼Œèº²ä¸å¼€çš„å°±æ˜¯å†…å­˜å’ŒåŠŸè€—é—®é¢˜ï¼Œè¿™ä¸ªå¯æƒ³è€ŒçŸ¥ï¼Œåœ¨ä½“éªŒOPPOæ‰‹æœºçš„è¿‡ç¨‹ä¸­ï¼Œæœ€å¤§çš„æ„Ÿå—å°±æ˜¯å……ç”µå¤ªæ…¢äº†ï¼Œç”µæ± å¤ªä¸å¤Ÿç”¨ã€‚é¢å¯¹å¼€æ”¾å¸‚åœºçš„æ¡Œé¢åŠŸè€—å’Œå†…å­˜æ˜¯å¿…ä¸å¯å°‘çš„è€ƒæ ¸æ¡ä»¶ã€‚ï¼ˆæ­¤å¤„çœç•¥ä¸€ä¸‡å­—ï¼‰ã€‚<br>åœ¨å¦ä¸€æ–¹é¢ï¼ŒAPEXæ¡Œé¢ï¼Œå°½é‡åšçš„è®¨å·§ï¼Œæœ¬èº«åŸç”ŸLauncherçš„äº¤äº’å’Œç¨³å®šæ€§å¹¶ä¸å·®ã€‚å›½å†…æ¡Œé¢äº§å“ä¹‹æ‰€ä»¥æ‹¼çš„ä½ æ­»æˆ‘æ´»ï¼Œæ— æ³•å°±æ˜¯é¿å…åŒè´¨åŒ–ã€‚é¿å…å’Œåˆ«äººä¸€æ ·ï¼Œä¿æŒè‡ªå·±çš„ç‰¹ç‚¹æˆäº†å¾ˆå¤§çš„ä¸€ä¸ªå› ç´ ã€‚è€ŒAPEXä¹ŸåŒæ ·æ‡‚å¾—è¿™ä¸ªé“ç†ï¼Œä½†æ˜¯å®ƒçš„æ–¹å¼ä¸å¤ªä¸€æ ·ï¼Œå®ƒåœ¨é¿å…å’Œåˆ«äººç›¸åŒçš„é“è·¯ä¸ŠæŠŠæ›´å¤šçš„é€‰æ‹©æƒäº¤ç»™äº†ç”¨æˆ·ï¼Œç»™ç”¨æˆ·æä¾›äº†å„å¼çš„è®¾ç½®æ¥å£ï¼Œå¹¶ä¸”æä¾›äº†è®¾ç½®å¤‡ä»½çš„åŠŸèƒ½ã€‚ä¹Ÿæ˜¯ç”¨å¿ƒè‰¯è‹¦ï¼Œä½†æ˜¯åœ¨ç»„ç»‡å¦‚æ­¤å¤šè®¾ç½®æ¥å£çš„æ–¹å¼ä¸Šä¹Ÿæ˜¯è®©äººå¾ˆç—›çš„ï¼Œå¤ªç´¯ï¼Œæˆ‘å¤ªæ‡’ï¼Œæ¥ä¸åŠå»æ¢ç´¢å±äºè‡ªå·±æ›´å¤šçš„å¯èƒ½ã€‚</p>
<h2 id="å…­ã€å¯¹äºæ¡Œé¢äº§å“çš„å¯å‘">å…­ã€å¯¹äºæ¡Œé¢äº§å“çš„å¯å‘</h2><ul>
<li><p><strong>åšå¥½ç¬¬ä¸€æ„Ÿè§‰</strong><br>ç¬¬ä¸€æ„Ÿè§‰ï¼Œå®‰è£…åŒ…çš„å¤§å°ï¼Œé»˜è®¤æ¡Œé¢å›¾æ ‡çš„è®¾ç½®ã€‚èƒ½å¦çœŸæ­£é€‚é…ä¸åŒå‚å•†æ‰‹æœºï¼Œå°±æ‹¿Phoneè¿™ä¸ªåº”ç”¨æ¥è¯´ï¼Œä¸åŒå‚å•†çš„åŒ…åå¯èƒ½åƒå·®ä¸‡åˆ«ï¼Œèƒ½å¦æœ‰åˆé€‚çš„æ–¹æ³•ï¼Œè®©å®ƒåœ¨æ¯ä¸€å°æ‰‹æœºä¸Šéƒ½æ”¾åœ¨æ­£ç¡®çš„ä½ç½®ã€‚ä»ç”¨æˆ·å·²æœ‰çš„æ¡Œé¢ä¸­è·å–ç”¨æˆ·å·²æœ‰çš„æ¡Œé¢é…ç½®æ˜¯ä¸æ˜¯æ›´å¥½ï¼Ÿå¦‚ä½•åšåˆ°ï¼Ÿåœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™æ˜¯å¦åº”è¯¥ç»™ç±»ä¼¼åˆ†ç±»å’Œç›¸å…³å†·å¯åŠ¨çš„å‘å¯¼ï¼Œè¿™æ ·ä¼šä¸ä¼šæ›´å¥½ï¼Ÿè¿˜æœ‰å¾ˆå¤šæœªçŸ¥ï¼ï¼</p>
</li>
<li><p><strong>æµç•…å’Œæ€§èƒ½æ°¸è¿œæ˜¯é‡ç‚¹,è½»</strong></p>
</li>
<li><p><strong>æˆ‘ä»¬çš„äº®ç‚¹åœ¨å“ªï¼Ÿæˆ‘ä»¬çš„ç—›ç‚¹åœ¨å“ªï¼Ÿæˆ‘ä»¬äº§å“çš„è®¾è®¡åŸåˆ™æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
</li>
<li><p><strong>å¦‚æœæˆ‘ä»¬æƒ³è¦åšä¸€ä¸ªä¼˜ç§€çš„äº§å“ï¼Œé‚£è¯·å…ˆè¯´æœè‡ªå·±ï¼Œå…ˆè®©è‡ªå·±äººéƒ½å–œæ¬¢ä¸Šæˆ‘ä»¬çš„äº§å“</strong></p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸€ã€æ¡Œé¢åŸºæœ¬æ“ä½œ&quot;&gt;ä¸€ã€æ¡Œé¢åŸºæœ¬æ“ä½œ&lt;/h2&gt;&lt;h3 id=&quot;1-1_å®‰è£…åˆä½“éªŒ&quot;&gt;1.1 å®‰è£…åˆä½“éªŒ&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;å®‰è£…åŒ…å¤§å°&lt;/strong&gt;&lt;br&gt;ColorOSæ¡Œé¢å«æœ‰ä¸¤ä¸ªå®‰è£…åŒ…ï¼ŒOppoLauncher.apk(2.8M)å’ŒOppoLauncherSystem.apk(8.5KB)&lt;br&gt;APEXæ¡Œé¢å®‰è£…åŒ…å¤§å°4.36Mï¼Œå¹¶ä¸”è¿›è¡Œäº†ä»£ç æ··æ·†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;é»˜è®¤æ¡Œé¢&lt;/strong&gt;&lt;br&gt;ColorOSæ¡Œé¢ï¼Œå‰ä¸¤ä¸ªå±å¹•æ˜¯ç³»ç»Ÿåº”ç”¨ï¼ŒåŒ…å«ä¸€ä¸ªå°å·¥å…·çš„æ–‡ä»¶å¤¹ï¼Œå…¶ä»–æ‰€æœ‰åº”ç”¨å¹³é“ºæ¡Œé¢ï¼Œç”¨æˆ·è‡ªå·±å®‰è£…çš„åº”ç”¨ä»ç¬¬ä¸‰å±å¼€å§‹å¹³é“ºã€‚&lt;br&gt;APEXæ¡Œé¢ï¼Œé»˜è®¤çš„åº”ç”¨æ’åˆ—å°±å¾ˆéšæ„ï¼Œåœ¨ä¸åŒçš„æ‰‹æœºä¸Šçš„è¡¨ç°æœ‰å·®åˆ«ï¼Œåº”è¯¥æ˜¯ä¸åŒæ‰‹æœºçš„ç³»ç»Ÿåº”ç”¨çš„åŒ…åä¸åŒï¼Œé€ æˆAPEXçš„é¢„åˆ¶æ¡Œé¢å¹¶ä¸æ˜¯é¡ºåºç´§å¯†åœ¨æ¡Œé¢æ˜¾ç¤ºåº”ç”¨å›¾æ ‡ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å…¶ä»–" scheme="https://ivonhoe.github.io/categories/%E5%85%B6%E4%BB%96/"/>
    
    
      <category term="äº§å“åˆ†æ" scheme="https://ivonhoe.github.io/tags/%E4%BA%A7%E5%93%81%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
</feed>
