<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>åˆ«è¾œè´Ÿè‡ªå·±</title>
  <subtitle>Read The Fucking Source Code</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://ivonhoe.github.io/"/>
  <updated>2017-04-27T08:09:49.000Z</updated>
  <id>https://ivonhoe.github.io/</id>
  
  <author>
    <name>ç—…å·²</name>
    <email>yangfan3687@163.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Zygoteä¸å†…å­˜</title>
    <link href="https://ivonhoe.github.io/2017/04/26/Zygote-2/"/>
    <id>https://ivonhoe.github.io/2017/04/26/Zygote-2/</id>
    <published>2017-04-25T16:49:27.000Z</published>
    <updated>2017-04-27T08:09:49.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="BitmapAnalyerçœ‹Hello_World">BitmapAnalyerçœ‹Hello World</h3><p>å½“ä½¿ç”¨BitmapAnalyzeråˆ†æä¸€ä¸ªAndroid5.0+çš„Hello World Appæ—¶ä½ ä¼šdumpå‡º400+å¼ å›¾ç‰‡ï¼Œåˆ†æä»”ç»†çœ‹ä¸€ä¸‹å¯ä»¥å‘ç°ï¼Œè¿™äº›éƒ½æ˜¯Androidç³»ç»Ÿçš„ä¸»é¢˜èµ„æºå›¾ç‰‡ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šä¸»é¢˜èµ„æºè¢«åŠ è½½ï¼Ÿæ˜¯ä¸æ˜¯é€‰æ‹©å…¶ä»–çš„themeè¿™äº›èµ„æºæ˜¯ä¼šæ”¹å˜ï¼Ÿä¸éœ€è¦çš„æ— ç”¨èµ„æºèƒ½å¦é¿å…è¢«åŠ è½½ï¼ŸHowï¼Ÿæ¯•ç«Ÿå•å•Resourcesä¸­sPreloadedDrawablesæ‰€å¼•ç”¨çš„Drawableå°±ä¼šå ç”¨10Mä»¥ä¸Šçš„å†…å­˜ç©ºé—´ã€‚</p>
<p><img src="/res/hprof/hprof-3.png" alt=""></p>
<p>ä½¿ç”¨Android Studioçš„monitorå·¥å…·dumpå†…å­˜å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒASå°†hprofä¸­çš„å†…å­˜ä¿¡æ¯åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯App heapï¼ŒImage heapï¼ŒZygote heapã€‚App heapå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯åº”ç”¨è¿›ç¨‹ç‹¬å çš„å†…å­˜ç©ºé—´ï¼Œåœ¨åº”ç”¨ä¸­åˆ›å»ºçš„å¯¹è±¡éƒ½ä¼šåœ¨App heapä¸Šã€‚è€Œåœ¨ä½¿ç”¨Dalvikè™šæ‹Ÿæœºçš„æ‰‹æœºä¸Šï¼Œå¹¶æ²¡æœ‰Image heapï¼Œåªæœ‰App heapå’ŒZygote heapã€‚<a href="https://developer.android.com/studio/profile/am-hprof.html#why" target="_blank" rel="external">Androidå®˜ç½‘æ–‡æ¡£</a>çš„ä¸‰è€…çš„è§£é‡Šæ˜¯ï¼š</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">App heap - The heap used by the current app.&#10;&#10;Image heap - The memory mapped copy of the current app on disk.&#10;&#10;Zygote heap - The common set of libraries and runtime classes and data that all apps are forked from. The zygote space is created during device startup and is never allocated into.</span><br></pre></td></tr></table></figure>
<p>è¾ƒè¯¦ç»†çš„Zygoteæœºåˆ¶å¯ä»¥çœ‹ç¿»è¯‘çš„<a href="https://ivonhoe.github.io/2017/04/25/Zygote/">Zygote</a>,æ€»çš„æ¥è¯´æ˜¯<code>app_process</code>è°ƒç”¨Zygoteçš„main()æ–¹æ³•å¯åŠ¨Zygoteå¹¶åˆ›å»ºç¬¬ä¸€ä¸ªè™šæ‹Ÿæœºè¿›ç¨‹ï¼ŒZygoteå¯åŠ¨æ—¶ä¼šé¢„åŠ è½½æ‰€æœ‰éœ€è¦çš„Java classeså’Œâ€å¿…è¦çš„â€èµ„æºæ–‡ä»¶ï¼Œè¿™äº›èµ„æºæ–‡ä»¶å°±åŒ…æ‹¬æˆ‘ä»¬åœ¨hprofæ–‡ä»¶ä¸­çœ‹åˆ°çš„è¢«sPreloadedDrawablesæ‰€ç›´æ¥å¼•ç”¨çš„Bitmapèµ„æºã€‚æ‰€ä»¥åº”ç”¨è¿›ç¨‹éƒ½æ˜¯ä»Zygoteä¸­forkå‡ºæ¥çš„ï¼Œæ‰€ä»¥æ‰€æœ‰çš„åº”ç”¨è¿›ç¨‹éƒ½ä¼šåŒ…å«ä¸Šé¢æåˆ°çš„èµ„æºæ–‡ä»¶ã€‚è€Œè¿™äº›èµ„æºçš„æ‹·è´å¯ä»¥çœ‹æˆæµ…æ‹·è´ï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„å†…å­˜copyï¼Œè€Œæ˜¯ä½œä¸ºè¿›ç¨‹é—´çš„å…±äº«å†…å­˜ä½¿ç”¨ã€‚</p>
<p><img src="/res/hprof/hprof-2.png" alt=""></p>
<p>å½“é€šè¿‡åå°„æ‰‹åŠ¨æ¸…é™¤sPreloadDrawableå¯¹è¿™äº›èµ„æºçš„å¼ºå¼•ç”¨ï¼Œé€šè¿‡Android Studioçš„monitorå·¥å…·å‘ç°ï¼Œgcä»¥åApp heapå‘ç”Ÿäº†æ–­å´–å¼çš„å†…å­˜å›æ”¶ï¼Œ<code>adb shell dumpsys meminfo</code>å‘ç°Heap Allocå’ŒHeap Sizeéƒ½å‘ç”Ÿäº†æ˜¾è‘—çš„å‡å°ï¼Œä½†Pss totalå¹¶æ²¡æœ‰æ˜¾è‘—å˜åŒ–ã€‚è¿™é‡Œçš„ç†è§£æ˜¯PSS = Private RAM + æŒ‰æ¯”ä¾‹è®¡ç®—çš„Shared RAMï¼Œè¿™ä¸¤éƒ¨åˆ†éƒ½æ²¡æœ‰å‘ç”Ÿæ˜¾è‘—å˜åŒ–ï¼Œæ‰€ä»¥PSS Totalæ²¡æœ‰å˜åŒ–ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private void clearPreloadedDrawables() &#123;&#10;    try &#123;&#10;        Field mFieldPreloadedDrawables = getField(Resources.class, &#34;sPreloadedDrawables&#34;);&#10;        if (mFieldPreloadedDrawables != null) &#123;&#10;            mFieldPreloadedDrawables.setAccessible(true);&#10;&#10;            boolean access = mFieldPreloadedDrawables.isAccessible();&#10;            if (!access) &#123;&#10;                mFieldPreloadedDrawables.setAccessible(true);&#10;            &#125;&#10;&#10;            if (Build.VERSION.SDK_INT &#60;= 17) &#123;&#10;                LongSparseArray&#60;Drawable.ConstantState&#62; dArray = (LongSparseArray&#60;Drawable.ConstantState&#62;) mFieldPreloadedDrawables.get(getResources());&#10;                if (dArray != null) &#123;&#10;                    dArray.clear();&#10;                &#125;&#10;&#10;                // dArray.put(1, createDrawableConstant());&#10;            &#125; else if (Build.VERSION.SDK_INT &#62;= 18) &#123;&#10;                LongSparseArray&#60;Drawable.ConstantState&#62;[] dArray = (LongSparseArray&#60;Drawable.ConstantState&#62;[]) mFieldPreloadedDrawables.get(getResources());&#10;                if (dArray != null) &#123;&#10;                    for (int i = 0; i &#60; dArray.length; i++) &#123;&#10;                        if (dArray[i] != null) &#123;&#10;                            dArray[i].clear();&#10;                            // dArray[i].put(1, createDrawableConstant());&#10;                        &#125;&#10;                    &#125;&#10;                &#125;&#10;            &#125;&#10;&#10;            mFieldPreloadedDrawables.setAccessible(true);&#10;        &#125;&#10;    &#125; catch (Exception e) &#123;&#10;        e.printStackTrace();&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/res/hprof/hprof-7.png" alt=""></p>
<p><img src="/res/hprof/hprof-5.png" alt=""></p>
<p>é‚£è¯·é—®ï¼Œä¸Šé¢ğŸ‘†çš„å†…å­˜æ¸…ç†æœ‰æ„ä¹‰å—ï¼ŸHeap allocatedè¾ƒå°‘äº†10Mï¼Œä½†PSSå¹¶æ²¡æœ‰æ˜æ˜¾çš„å˜åŒ–ï¼Œç»™æˆ‘çš„æ„Ÿè§‰å°±åƒå¤§å®¶åœ¨åƒå¤§é”…é¥­ï¼Œæˆ‘åªåƒäº†1ç¢—ï¼Œåˆ«äººåƒäº†10ç¢—ï¼Œä»˜é’±çš„æ—¶å€™å´æ˜¯AAã€‚</p>
<h3 id="Copy-On-Write(COW)">Copy-On-Write(COW)</h3><p>Zygote heapæ˜¯ç³»ç»Ÿå…±äº«å†…å­˜heapï¼Œè¿™é‡Œæˆ‘å°è¯•ä¿®æ”¹<code>sPreloadDrawable</code>å¯¹åº”æ•°æ®æ—¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç³»ç»Ÿé»˜è®¤é¢„åŠ è½½399å¼ èµ„æºå›¾ç‰‡ï¼Œå½“æ‰‹åŠ¨æ’å…¥ä¸€å¼ æ–°çš„å›¾ç‰‡åˆ°ç¼“å­˜åï¼Œç¼“å­˜å¤§å°å˜æˆäº†400ã€‚ä½†è®©æˆ‘è§‰å¾—è¯¡å¼‚çš„æ˜¯ï¼Œä¸æ˜¯è¯´Androidç³»ç»Ÿä½¿ç”¨COWæœºåˆ¶å—ï¼Ÿä¸ºå•¥æ’å…¥å‰åsPreloadDrawableç›¸å…³çš„å†…å­˜åœ°å€æ ¹æœ¬æ²¡æœ‰å˜åŒ–ï¼Ÿéš¾é“æˆ‘æŠŠå…±äº«å†…å­˜çš„æ•°æ®ä¹Ÿæ”¹æ‰äº†ï¼Ÿå…¶å®å¹¶æ²¡æœ‰ã€‚</p>
<p><img src="/res/hprof/hprof-4.png" alt=""></p>
<p><img src="/res/hprof/hprof-8.jpg" alt=""></p>
<p>linuxæ²¡æœ‰é‚£ä¹ˆå‚»ï¼Œåœ¨forkå­è¿›ç¨‹çš„æ—¶å€™å¹¶ä¸ä¼šçœŸæ­£æ‹·è´çˆ¶è¿›ç¨‹å†…å­˜æ•°æ®ï¼Œè€Œæ˜¯å­è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´æŒ‡å‘çˆ¶è¿›ç¨‹çš„ç‰©ç†å†…å­˜ç©ºé—´ã€‚å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹çš„è™šæ‹Ÿç©ºé—´ä¸åŒï¼Œä½†ç‰©ç†ç©ºé—´æ˜¯åŒä¸€ä¸ªã€‚å½“å­è¿›ç¨‹éœ€è¦é‡å†™å…±äº«å†…å­˜æ•°æ®æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šä¸ºå­è¿›ç¨‹åˆ†é…å“åº”çš„ç‰©ç†å†…å­˜ã€‚è¿™é‡Œçš„è™šæ‹Ÿå†…å­˜ç©ºé—´å¯¹åº”ç”¨ç¨‹åºæ¥è¯´å°±æ˜¯é€»è¾‘åœ°å€ï¼Œå¯¹äºCPUæ¥è¯´å°±æ˜¯çº¿æ€§åœ°å€ã€‚</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3><p>å›åˆ°ä¹‹å‰æ€è€ƒçš„å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li><p>ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šä¸»é¢˜èµ„æºè¢«åŠ è½½ï¼Ÿæ˜¯ä¸æ˜¯é€‰æ‹©å…¶ä»–çš„themeè¿™äº›èµ„æºæ˜¯ä¼šæ”¹å˜ï¼Ÿ<br>è¿™äº›ä¸»é¢˜èµ„æºæ˜¯ç³»ç»Ÿå¯åŠ¨æ—¶Zygoteé¢„åŠ è½½çš„ç³»ç»Ÿèµ„æºï¼ŒZygoteä»»åŠ¡è¿™äº›èµ„æºæ¯ä¸ªAppéƒ½ä¼šç”¨åˆ°ï¼Œç‰¹åˆ«æ˜¯5.0+çš„ç³»ç»Ÿä¼šè¾¾åˆ°400+çš„é»˜è®¤themeå›¾ç‰‡ï¼Œå ç”¨10M+çš„å†…å­˜ç©ºé—´ï¼Œä¸è¿‡è¿™äº›å†…å­˜æ˜¯ç³»ç»Ÿå…±äº«çš„ä½ ç”¨æˆ–ä¸ç”¨ä»–ä»¬éƒ½åœ¨é‚£é‡Œã€‚æ”¹å˜åº”ç”¨çš„ä¸»é¢˜æ ·å¼å¹¶ä¸ä¼šæ”¹å˜sPreloadDrawableçš„åŠ è½½å†…å®¹ã€‚</p>
</li>
<li><p>ä¸éœ€è¦çš„æ— ç”¨èµ„æºèƒ½å¦é¿å…è¢«åŠ è½½ï¼Ÿ<br>è¿™äº›é»˜è®¤ç³»ç»Ÿèµ„æºæ— æ³•é¿å…è¢«ç³»ç»Ÿé¢„åŠ è½½ï¼Œä½†æ˜¯ä¸åŒROMå‚å•†é’ˆå¯¹è¿™äº›èµ„æºçš„çœ‹æ³•å·®åˆ«è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œæ ¹æ®æµ‹è¯•çš„æƒ…å†µçœ‹ï¼Œä¸‰æ˜Ÿçš„é¢„åŠ è½½èµ„æºæ¯”æºç çš„è¿˜è¦å¤šï¼Œå¹¶ä¸”æ¸…ç©ºsPreloadDrawableä¹Ÿä¸èƒ½å‡å°‘Heap allocteçš„å¤§å°ã€‚ç›¸åé”¤å­æ‰‹æœºå¯¹è¿™äº›é¢„åŠ è½½èµ„æºçš„ä½œç”¨å€’æ˜¯ä¸å¤ªçœ‹å¥½ï¼Œåœ¨é”¤å­åšæœä¸Šçœ‹åˆ°çš„é¢„åŠ è½½èµ„æºå°±å¾ˆå°‘ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚è€Œåœ¨Android 5.0ä»¥ä¸‹çš„ç³»ç»Ÿç‰ˆæœ¬ï¼Œè¿™å—é¢„åŠ è½½çš„èµ„æºä¹Ÿä¸æ˜¯å¾ˆå¤¸å¼ ã€‚</p>
</li>
<li><p>æ¸…ç©ºé¢„åŠ è½½èµ„æºå¯¹åº”ç”¨å†…å­˜æœ‰æ— ä¼˜åŒ–ä½œç”¨ï¼Ÿ<br>è¯´ä¸‹ä¸ªäººçœ‹æ³•ï¼Œå¦‚æœä½ çš„åº”ç”¨åˆ†ä¸ºUIè¿›ç¨‹å’Œåå°æœåŠ¡è¿›ç¨‹ã€‚åœ¨UIè¿›ç¨‹æ¸…é™¤ç³»ç»Ÿé¢„åŠ è½½èµ„æºå¯èƒ½å¹¶ä¸æ˜¯æ˜æ™ºçš„é€‰æ‹©ï¼Œä¸ºå•¥ï¼Ÿå› ä¸ºè¿™æ˜¯ä¸€ä»¶åƒåŠ›æœªå¿…è®¨å¥½çš„äº‹æƒ…ï¼Œè™½ç„¶è¿™10Mç©ºé—´ä½ å¹¶æ²¡æœ‰ä½¿ç”¨ï¼Œä½†ç³»ç»Ÿå¹¶æ²¡æœ‰é¢†æƒ…ï¼Œåè€Œå½“ä½ æƒ³è¦åœ¨ä½¿ç”¨ç³»ç»Ÿèµ„æºçš„æ—¶å€™ï¼Œé‚£è¿™äº›èµ„æºå°±ä¼šå®Œå…¨ç®—åˆ°ä½ çš„å¤´ä¸Šã€‚åè€Œä¼šé€ æˆåº”ç”¨è¿›ç¨‹å†…å­˜çš„ä¸Šå‡ã€‚<br>å¦‚æœæ˜¯åå°æœåŠ¡è¿›ç¨‹ï¼Œæ‰“æ­»ä¹Ÿä¸ä¼šç”¨åˆ°ç³»ç»Ÿä¸»é¢˜èµ„æºï¼Œæ¸…é™¤é¢„åŠ è½½èµ„æºä¸ºä»€ä¹ˆä¸æ˜¯å¯¹è‡ªå·±æœ‰åˆ©çš„äº‹æƒ…å‘¢ï¼Ÿå› ä¸ºè¿™æ ·ç¡®å®è®©Heapå˜å°äº†å‘€ï¼</p>
<p>å½“ç„¶ä»¥ä¸Šéƒ½æ˜¯ä¸ªäººçš„ç†è§£ï¼Œå¦‚æœ‰ç†è§£é”™è¯¯ï¼Œæ³è¯·èƒ½å¤ŸæŒ‡å‡ºã€‚å¯¹äºå¦‚ä½•è·å–Javaå¯¹è±¡çš„ç‰©ç†åœ°å€ï¼Œæˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°æ›´å¥½çš„åŠæ³•ï¼Œæ‰€ä»¥æš‚æ—¶è¿˜æ²¡æœ‰å®è·µéªŒè¯COWã€‚</p>
</li>
</ul>
<p>ä¸´å¸–é¡¿é¦–ï¼Œä¸çŸ¥æ‰€è¨€ï¼Œ2017.4.26æ—¥å¤œã€‚</p>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3><p><a href="https://developer.android.com/studio/profile/investigate-ram.html" target="_blank" rel="external"></a></p>
<p><a href="https://developer.android.com/studio/profile/am-hprof.html#why" target="_blank" rel="external">HPROF Viewer and Analyzer</a></p>
<p><a href="http://www.jianshu.com/p/d061fa36a0d9" target="_blank" rel="external">Manage Your Appâ€™s Memory</a></p>
<p><a href="http://wiki.jikexueyuan.com/project/deep-android-v1/zygote.html" target="_blank" rel="external">æ·±å…¥ç†è§£ Zygote</a></p>
<p><a href="http://www.cnblogs.com/biyeymyhjob/archive/2012/07/20/2601655.html" target="_blank" rel="external">Linuxå†™æ—¶æ‹·è´æŠ€æœ¯(copy-on-write)</a></p>
<p><a href="http://luodw.cc/2016/02/17/address/" target="_blank" rel="external">linuxè™šæ‹Ÿåœ°å€è½¬ç‰©ç†åœ°å€</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;BitmapAnalyerçœ‹Hello_World&quot;&gt;BitmapAnalyerçœ‹Hello World&lt;/h3&gt;&lt;p&gt;å½“ä½¿ç”¨BitmapAnalyzeråˆ†æä¸€ä¸ªAndroid5.0+çš„Hello World Appæ—¶ä½ ä¼šdumpå‡º400+å¼ å›¾ç‰‡ï¼Œåˆ†æä»”ç»†çœ‹ä¸€ä¸‹å¯ä»¥å‘ç°ï¼Œè¿™äº›éƒ½æ˜¯Androidç³»ç»Ÿçš„ä¸»é¢˜èµ„æºå›¾ç‰‡ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šä¸»é¢˜èµ„æºè¢«åŠ è½½ï¼Ÿæ˜¯ä¸æ˜¯é€‰æ‹©å…¶ä»–çš„themeè¿™äº›èµ„æºæ˜¯ä¼šæ”¹å˜ï¼Ÿä¸éœ€è¦çš„æ— ç”¨èµ„æºèƒ½å¦é¿å…è¢«åŠ è½½ï¼ŸHowï¼Ÿæ¯•ç«Ÿå•å•Resourcesä¸­sPreloadedDrawablesæ‰€å¼•ç”¨çš„Drawableå°±ä¼šå ç”¨10Mä»¥ä¸Šçš„å†…å­˜ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/res/hprof/hprof-3.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨Android Studioçš„monitorå·¥å…·dumpå†…å­˜å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒASå°†hprofä¸­çš„å†…å­˜ä¿¡æ¯åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯App heapï¼ŒImage heapï¼ŒZygote heapã€‚App heapå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯åº”ç”¨è¿›ç¨‹ç‹¬å çš„å†…å­˜ç©ºé—´ï¼Œåœ¨åº”ç”¨ä¸­åˆ›å»ºçš„å¯¹è±¡éƒ½ä¼šåœ¨App heapä¸Šã€‚è€Œåœ¨ä½¿ç”¨Dalvikè™šæ‹Ÿæœºçš„æ‰‹æœºä¸Šï¼Œå¹¶æ²¡æœ‰Image heapï¼Œåªæœ‰App heapå’ŒZygote heapã€‚&lt;a href=&quot;https://developer.android.com/studio/profile/am-hprof.html#why&quot;&gt;Androidå®˜ç½‘æ–‡æ¡£&lt;/a&gt;çš„ä¸‰è€…çš„è§£é‡Šæ˜¯ï¼š&lt;/p&gt;
    
    </summary>
    
    
      <category term="Copy-on-wirte" scheme="https://ivonhoe.github.io/tags/Copy-on-wirte/"/>
    
      <category term="Zygote" scheme="https://ivonhoe.github.io/tags/Zygote/"/>
    
  </entry>
  
  <entry>
    <title>Zygote</title>
    <link href="https://ivonhoe.github.io/2017/04/15/Zygote/"/>
    <id>https://ivonhoe.github.io/2017/04/15/Zygote/</id>
    <published>2017-04-15T15:32:51.000Z</published>
    <updated>2017-04-25T16:50:35.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="[è¯‘]Zygote">[è¯‘]Zygote</h2><p>åŸæ–‡åœ°å€ï¼š<a href="https://anatomyofandroid.com/2013/10/15/zygote/" target="_blank" rel="external">Zygote https://anatomyofandroid.com/2013/10/15/zygote/</a></p>
<p>Zygoteï¼ˆå—ç²¾åµï¼‰æ˜¯ä¸€ä¸ªå¯åŠ¨åº”ç”¨çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œåœ¨Server Managerä¹‹åè¢«init.rcè§¦å‘ï¼Œä½†å…¶å®ä»–æ˜¯çœŸæ­£è¢«app_processå¯åŠ¨çš„ï¼Œä¸‹é¢æ˜¯å¯åŠ¨è¿™ä¸ªç‰¹æ®Šè¿›ç¨‹çš„æµç¨‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service zygote /system/bin/app_process -Xzygote /system/bin --zygote --start-system-server&#10;class main&#10;socket zygote stream 660 root system&#10;onrestart write /sys/android_power/request_state wake&#10;onrestart write /sys/power/state on&#10;onrestart restart media&#10;onrestart restart netd</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥å‘ç°Zygoteæ˜¯å¦‚ä½•å½“åšç³»ç»ŸæœåŠ¡å¯åŠ¨çš„ï¼Œä½ ä¹Ÿå¯ä»¥çœ‹åˆ°app_processä¸ºä»€ä¹ˆè¯´app_processæ˜¯å¯åŠ¨Zygoteçš„çœŸæ­£å‘½ä»¤ã€‚å°±åƒä¹‹å‰è¯´çš„ï¼ŒZygoteæ˜¯ä¸€ä¸ªä»¥ä¸“é—¨å¯åŠ¨åº”ç”¨ä¸ºçš„å®ˆæŠ¤è¿›ç¨‹ã€‚è¿™æ„å‘³ç€Zygoteæ˜¯æ‰€æœ‰Appè¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚å½“app_processå¯åŠ¨Zygoteæ—¶ï¼Œå®ƒé€šè¿‡è°ƒç”¨Zygoteçš„main()æ–¹æ³•åˆ›å»ºäº†ç¬¬ä¸€ä¸ªDalvikè™šæ‹Ÿæœºã€‚å½“Zygoteå¯åŠ¨åï¼Œzygoteä¼šé¢„åŠ è½½æ‰€æœ‰å¿…é¡»çš„Javaç±»å’Œèµ„æºï¼Œå¯åŠ¨System Serverå¹¶æ‰“å¼€ä¸€ä¸ªåä¸º/dev/socket/zygoteçš„socketæœåŠ¡ï¼Œå»ç›‘å¬æ‰€æœ‰å¯åŠ¨åº”ç”¨çš„è¯·æ±‚ã€‚ æƒ³ä¹‹å‰çš„æ–‡ç« æ‰€è¯´ï¼ŒSystem Server æ˜¯ä¸€ä¸ªå’Œå®ƒçš„çˆ¶è¿›ç¨‹å®Œå…¨åˆ†ç¦»çš„è¿›ç¨‹ã€‚ä¸€æ—¦System Serveråˆ›å»ºå®Œæˆï¼Œå®ƒä¼šåˆå§‹åŒ–ä¸€ç³»åˆ—ä¸åŒçš„System Serviceså¹¶å¯åŠ¨Activity Managerã€‚é‚£Zygoteæ˜¯å¦‚ä½•å¯åŠ¨æ–°çš„åº”ç”¨çš„å‘¢ï¼Ÿ</p>
<a id="more"></a>
<p>Zygote é€šè¿‡/dev/socket/zygote(ä¸€ä¸ªsockete Socket Server)æ¥æ”¶å¯åŠ¨åº”ç”¨çš„è¯·æ±‚ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡fork()è°ƒç”¨ï¼Œä¼šåœ¨å¦ä¸€ä¸ªå­˜å‚¨ç©ºé—´åˆ›å»ºä¸€ä¸ªè‡ªèº«çš„æ‹·è´ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚å½“Zygoteæ‰§è¡Œforkæ—¶ï¼Œå®ƒä¼šç²¾å‡†åˆ›å»ºä¸€ä¸ªé¢„åŠ è½½äº†åº”ç”¨è¿›ç¨‹æ‰€éœ€çš„æ‰€æœ‰å¿…è¦ç±»å’Œèµ„æºçš„Dalvikè™šæ‹Ÿæœºï¼Œè¿™æ ·å°±ä¼šæŠŠåˆ›å»ºè™šæ‹Ÿæœºå’ŒåŠ è½½èµ„æºçš„è¿‡ç¨‹å˜å¾—å¾ˆé«˜æ•ˆã€‚ä½†è¿™ä¸ªè®¾è®¡ä¸ä»…ä»…æ˜¯è¿™æ ·ã€‚ç”±äºAndroidè¿è¡Œåœ¨Linuxå†…æ ¸ä¸Šï¼ŒLinux Kernalå®ç°äº†ä¸€ä¸ªå«åšCopy On Writeï¼ˆCOWï¼‰çš„ç­–ç•¥ï¼Œåœ¨forkè¿›ç¨‹çš„è¿‡ç¨‹ä¸­å¹¶ä¸ä¼šçœŸæ­£çš„æ‹·è´å†…å­˜ã€‚ä¸€ä¸ªè¿›ç¨‹æƒ³è¦ä¿®æ”¹è¿™ä¸ªå…±äº«çš„å†…å­˜æ˜¯ï¼Œkernelä¼šæ‹¦æˆªè¿™ä¸ªè¯·æ±‚ï¼Œå¹¶å¯¹è¦ä¿®æ”¹çš„å†…å­˜åšä¸€ä¸ªæ‹·è´ã€‚å½“ä¸€äº›Androidçš„ç±»åº“æ˜¯ä¸å¯å†™çš„æƒ…å†µä¸‹ï¼Œé‚£å°±æ„å‘³ç€æ‰€æœ‰ä»Zygote forkå‡ºæ¥çš„è¿›ç¨‹éƒ½åœ¨å…±äº«ä¸€ä»½ç³»ç»Ÿç±»æ–‡ä»¶å’Œèµ„æºã€‚å¦ä¸€ä¸ªå¥½å¤„å°±æ˜¯çœŸçš„èŠ‚çœå†…å­˜ã€‚ä¸ç®¡å¯åŠ¨å¤šå°‘åº”ç”¨è¿›ç¨‹åœ¨å†…å­˜çš„å¢é•¿ä¸Šéƒ½ä¼šå°å¾ˆå¤šã€‚</p>
<p>If you are in an early stage of a porting process, Zygote is another big process that you donâ€™t need to start. You can disable it by adding the keyword â€œdisabledâ€ at the end of the boot sequence in init.rc</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service zygote /system/bin/app_process -Xzygote /system/bin --zygote --start-system-server&#10;class main&#10;socket zygote stream 660 root system&#10;onrestart write /sys/android_power/request_state wake&#10;onrestart write /sys/power/state on&#10;onrestart restart media&#10;onrestart restart netd&#10;disabled</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯ä¸€å¼ è¯´æ˜Zygoteåœ¨Androidå¹³å°ä¸­ä½œç”¨çš„å…³ç³»å›¾(from Embedded Android)ã€‚</p>
<p><img src="/res/zygote/zygote-1.png" alt=""></p>
<p>zygoteçš„main()æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String argv[]) &#123;&#10; try &#123;&#10;     // Start profiling the zygote initialization.&#10;     SamplingProfilerIntegration.start();&#10;&#10;    registerZygoteSocket();&#10;    EventLog.writeEvent(LOG_BOOT_PROGRESS_PRELOAD_START,&#10;    SystemClock.uptimeMillis());&#10;    preload();&#10;    EventLog.writeEvent(LOG_BOOT_PROGRESS_PRELOAD_END,&#10;    SystemClock.uptimeMillis());&#10;&#10;    // Finish profiling the zygote initialization.&#10;    SamplingProfilerIntegration.writeZygoteSnapshot();&#10;&#10;    // Do an initial gc to clean up after startup&#10;    gc();&#10;&#10;    // Disable tracing so that forked processes do not inherit stale tracing tags from&#10;    // Zygote.&#10;    Trace.setTracingEnabled(false);&#10;&#10;    // If requested, start system server directly from Zygote&#10;    if (argv.length != 2) &#123;&#10;        throw new RuntimeException(argv[0] + USAGE_STRING);&#10;    &#125;&#10;&#10;    if (argv[1].equals(&#34;start-system-server&#34;)) &#123;&#10;        startSystemServer();&#10;    &#125; else if (!argv[1].equals(&#34;&#34;)) &#123;&#10;        throw new RuntimeException(argv[0] + USAGE_STRING);&#10;    &#125;&#10;&#10;    Log.i(TAG, &#34;Accepting command socket connections&#34;);&#10;&#10;    runSelectLoop();&#10;&#10;    closeServerSocket();&#10; &#125; catch (MethodAndArgsCaller caller) &#123;&#10;     caller.run();&#10; &#125; catch (RuntimeException ex) &#123;&#10;     Log.e(TAG, &#34;Zygote died with exception&#34;, ex);&#10;     closeServerSocket();&#10;     throw ex;&#10; &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸‹é¢ä»£ç å¯ä»¥çœ‹åˆ°Zygoteæ˜¯å¦‚ä½•å¯åŠ¨System Serverçš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10; * Prepare the arguments and fork for the system server process.&#10; */&#10;private static boolean startSystemServer()&#10;        throws MethodAndArgsCaller, RuntimeException &#123;&#10;    /* Hardcoded command line to start the system server */&#10;    String args[] = &#123;&#10;            &#34;--setuid=1000&#34;,&#10;            &#34;--setgid=1000&#34;,&#10;            &#34;--setgroups=1001,1002,1003,1004,1005,1006,1007,1008,1009,1010,1018,3001,3002,3003,3006,3007&#34;,&#10;            &#34;--capabilities=130104352,130104352&#34;,&#10;            &#34;--runtime-init&#34;,&#10;            &#34;--nice-name=system_server&#34;,&#10;            &#34;com.android.server.SystemServer&#34;,&#10;    &#125;;&#10;    ZygoteConnection.Arguments parsedArgs = null;&#10;&#10;    int pid;&#10;&#10;    try &#123;&#10;        parsedArgs = new ZygoteConnection.Arguments(args);&#10;        ZygoteConnection.applyDebuggerSystemProperty(parsedArgs);&#10;        ZygoteConnection.applyInvokeWithSystemProperty(parsedArgs);&#10;        &#10;        /* Request to fork the system server process */&#10;        pid = Zygote.forkSystemServer(&#10;                parsedArgs.uid, parsedArgs.gid,&#10;                parsedArgs.gids,&#10;                parsedArgs.debugFlags,&#10;                null,&#10;                parsedArgs.permittedCapabilities,&#10;                parsedArgs.effectiveCapabilities);&#10;    &#125; catch (IllegalArgumentException ex) &#123;&#10;        throw new RuntimeException(ex);&#10;    &#125;&#10;    &#10;    /* For child process */&#10;    if (pid == 0) &#123;&#10;        handleSystemServerProcess(parsedArgs);&#10;    &#125;&#10;&#10;    return true;&#10;&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;[è¯‘]Zygote&quot;&gt;[è¯‘]Zygote&lt;/h2&gt;&lt;p&gt;åŸæ–‡åœ°å€ï¼š&lt;a href=&quot;https://anatomyofandroid.com/2013/10/15/zygote/&quot;&gt;Zygote https://anatomyofandroid.com/2013/10/15/zygote/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Zygoteï¼ˆå—ç²¾åµï¼‰æ˜¯ä¸€ä¸ªå¯åŠ¨åº”ç”¨çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œåœ¨Server Managerä¹‹åè¢«init.rcè§¦å‘ï¼Œä½†å…¶å®ä»–æ˜¯çœŸæ­£è¢«app_processå¯åŠ¨çš„ï¼Œä¸‹é¢æ˜¯å¯åŠ¨è¿™ä¸ªç‰¹æ®Šè¿›ç¨‹çš„æµç¨‹ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;service zygote /system/bin/app_process -Xzygote /system/bin --zygote --start-system-server&amp;#10;class main&amp;#10;socket zygote stream 660 root system&amp;#10;onrestart write /sys/android_power/request_state wake&amp;#10;onrestart write /sys/power/state on&amp;#10;onrestart restart media&amp;#10;onrestart restart netd&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ä½ å¯ä»¥å‘ç°Zygoteæ˜¯å¦‚ä½•å½“åšç³»ç»ŸæœåŠ¡å¯åŠ¨çš„ï¼Œä½ ä¹Ÿå¯ä»¥çœ‹åˆ°app_processä¸ºä»€ä¹ˆè¯´app_processæ˜¯å¯åŠ¨Zygoteçš„çœŸæ­£å‘½ä»¤ã€‚å°±åƒä¹‹å‰è¯´çš„ï¼ŒZygoteæ˜¯ä¸€ä¸ªä»¥ä¸“é—¨å¯åŠ¨åº”ç”¨ä¸ºçš„å®ˆæŠ¤è¿›ç¨‹ã€‚è¿™æ„å‘³ç€Zygoteæ˜¯æ‰€æœ‰Appè¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚å½“app_processå¯åŠ¨Zygoteæ—¶ï¼Œå®ƒé€šè¿‡è°ƒç”¨Zygoteçš„main()æ–¹æ³•åˆ›å»ºäº†ç¬¬ä¸€ä¸ªDalvikè™šæ‹Ÿæœºã€‚å½“Zygoteå¯åŠ¨åï¼Œzygoteä¼šé¢„åŠ è½½æ‰€æœ‰å¿…é¡»çš„Javaç±»å’Œèµ„æºï¼Œå¯åŠ¨System Serverå¹¶æ‰“å¼€ä¸€ä¸ªåä¸º/dev/socket/zygoteçš„socketæœåŠ¡ï¼Œå»ç›‘å¬æ‰€æœ‰å¯åŠ¨åº”ç”¨çš„è¯·æ±‚ã€‚ æƒ³ä¹‹å‰çš„æ–‡ç« æ‰€è¯´ï¼ŒSystem Server æ˜¯ä¸€ä¸ªå’Œå®ƒçš„çˆ¶è¿›ç¨‹å®Œå…¨åˆ†ç¦»çš„è¿›ç¨‹ã€‚ä¸€æ—¦System Serveråˆ›å»ºå®Œæˆï¼Œå®ƒä¼šåˆå§‹åŒ–ä¸€ç³»åˆ—ä¸åŒçš„System Serviceså¹¶å¯åŠ¨Activity Managerã€‚é‚£Zygoteæ˜¯å¦‚ä½•å¯åŠ¨æ–°çš„åº”ç”¨çš„å‘¢ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
    
      <category term="Zygote" scheme="https://ivonhoe.github.io/tags/Zygote/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨ddmlib dumpå‡ºå †æ–‡ä»¶</title>
    <link href="https://ivonhoe.github.io/2017/04/09/how-to-dump-heap/"/>
    <id>https://ivonhoe.github.io/2017/04/09/how-to-dump-heap/</id>
    <published>2017-04-09T11:03:01.000Z</published>
    <updated>2017-04-26T02:08:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€èˆ¬æƒ…å†µä¸‹å¦‚æœæˆ‘æƒ³è¦è¾ƒè¯¦ç»†çš„åˆ†æå†…å­˜çŠ¶å†µï¼Œä¼šä½¿ç”¨android monitor(ä¸‹ç®€ç§°monitor)å’ŒMemory Analyzerå·¥å…·(ä¸‹ç®€ç§°MAT)ï¼Œä½†æ­¥éª¤æœ‰äº›éº»çƒ¦ã€‚</p>
<ol>
<li>ä½¿ç”¨monitor dumpå †æ–‡ä»¶</li>
<li>ä½¿ç”¨hprof-convå·¥å…·ï¼Œå°†hprofè½¬æ¢æˆMATèƒ½å¤Ÿè¯†åˆ«çš„æ ¼å¼</li>
<li>ä½¿ç”¨MATåˆ†æ</li>
</ol>
<p>éœ€è¦æ‰‹åŠ¨dump hprofå†ä½¿ç”¨hprof-convå·¥å…·æ‰‹åŠ¨è½¬ç ï¼Œä¸Šç¯‡<a href="https://ivonhoe.github.io/2017/03/22/Bitmap&amp;Memory/">Android Bitmapçš„å†…å­˜å¤§å°æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ</a>è¯´åˆ°ä½¿ç”¨squareçš„<a href="https://github.com/square/haha" target="_blank" rel="external">haha</a>æ¥åšå†…å­˜å †ä¸­Bitmapçš„åˆ†æã€‚æ‰€ä»¥åœ¨æ€è€ƒå¦‚ä½•ä¸€é”®å®Œæˆå†…å­˜dumpå’Œanalyzeçš„è¿‡ç¨‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä»»æ„å…¶ä»–Javaå¯¹è±¡åšåˆ†æã€‚<br>å¦‚ä½•å®Œæˆdumpå’Œè½¬ç ï¼Œæ€è·¯è¿˜æ˜¯Read the fucking source codeï¼Œçœ‹ä¸‹monitoræ˜¯å¦‚ä½•dump hprofæ–‡ä»¶çš„ã€‚æ‰“å¼€Android sdkç›®å½•ï¼Œmonitorå’Œå…¶ä¾èµ–çš„jaråˆ†åˆ«åœ¨<code>/tools</code>å’Œâ€™/tools/libâ€™ç›®å½•ï¼Œæ ¸å¿ƒä»£ç åœ¨<code>ddmlib.jar</code>ä¸­ï¼ŒJava swringä»£ç åœ¨<code>ddms.jar</code>å’Œ<code>ddmuilib.jar</code>ä¸­ï¼Œddmlibéœ€è¦ä¾èµ–<code>common.jar</code>å’Œ<code>guava.jar</code>ã€‚</p>
<a id="more"></a>
<p><img src="/res/hprof/hprof-1.png" alt=""></p>
<h3 id="å¦‚ä½•ä½¿ç”¨ddmlibè·å–adbè¿æ¥çš„è®¾å¤‡">å¦‚ä½•ä½¿ç”¨ddmlibè·å–adbè¿æ¥çš„è®¾å¤‡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;&#10;        IDevice device;&#10;        // &#36825;&#37324;&#38656;&#35201;&#20256;&#21442;true&#65292;&#19981;&#28982;&#24453;&#20250;&#20250;&#25343;&#19981;&#21040;&#25163;&#26426;&#19978;&#30340;client&#10;        AndroidDebugBridge.init(true);&#10;        AndroidDebugBridge bridge = AndroidDebugBridge.createBridge(&#10;                &#34;/Users/Ivonhoe/Library/Android/sdk/platform-tools/adb&#34;, false);&#10;        waitForDevice(bridge);&#10;        IDevice devices[] = bridge.getDevices();&#10;        device = devices[0];&#10;    &#125;&#10;&#10;    private static void waitForDevice(AndroidDebugBridge bridge) &#123;&#10;        int count = 0;&#10;        while (!bridge.hasInitialDeviceList()) &#123;&#10;            try &#123;&#10;                Thread.sleep(100);&#10;                count++;&#10;            &#125; catch (InterruptedException ignored) &#123;&#10;            &#125;&#10;            if (count &#62; 300) &#123;&#10;                System.err.print(&#34;Time out&#34;);&#10;                break;&#10;            &#125;&#10;        &#125;&#10;    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¦‚ä½•dump_hprof">å¦‚ä½•dump hprof</h3><p><strong>è¿™é‡Œä¸è¯´çœ‹ddmsæºç çš„è¿‡ç¨‹äº†ï¼Œä¸»è¦è¿˜æ˜¯é€šè¿‡å…³é”®å­—æœç´¢è·Ÿä¸€ä¸‹dumpæ“ä½œçš„å¤„ç†é€»è¾‘</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10; * &#35774;&#32622;HprofDumpHandler&#65292;&#23545;dump&#20107;&#20214;&#20570;&#30417;&#21548;&#22788;&#29702;dump&#25104;&#21151;&#25110;&#32773;&#22833;&#36133;&#30340;&#22238;&#35843;&#65292;&#10; * &#24182;&#20445;&#23384;hprof&#25991;&#20214;&#25968;&#25454;&#10; *&#10; * @param device&#10; */&#10;public HprofDump(Device device) &#123;&#10;    mDevice = device;&#10;&#10;    ClientData.IHprofDumpHandler hprofDumpHandler = new ClientData.IHprofDumpHandler() &#123;&#10;&#10;        @Override&#10;        public void onSuccess(String remoteFilePath, Client client) &#123;&#10;            String hprofPath = getHprofPath(client.getClientData().getClientDescription());&#10;            mDevice.pull(hprofPath, remoteFilePath);&#10;&#10;            conversionAndRemoveHprof(hprofPath);&#10;&#10;            isDumping = false;&#10;        &#125;&#10;&#10;        @Override&#10;        public void onSuccess(byte[] bytes, Client client) &#123;&#10;            String hprofPath = getHprofPath(client.getClientData().getClientDescription());&#10;            Utilities.saveFile(bytes, hprofPath);&#10;&#10;            conversionAndRemoveHprof(hprofPath);&#10;&#10;            isDumping = false;&#10;        &#125;&#10;&#10;        @Override&#10;        public void onEndFailure(Client client, String s) &#123;&#10;            isDumping = false;&#10;        &#125;&#10;    &#125;;&#10;    ClientData.setHprofDumpHandler(hprofDumpHandler);&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è¿™é‡Œé»˜è®¤é€‰æ‹©æ ˆé¡¶è¿›ç¨‹åšdumpæ“ä½œï¼Œé€šè¿‡adb shell dumpsys activity topå‘½ä»¤è·å–æ ˆé¡¶TASKçš„ApplicationIdï¼Œé€šè¿‡IDeviceæ¥å£çš„getClientæ–¹æ³•è·å–Clientå¯¹è±¡ï¼Œæ‰§è¡ŒdumpHprofæ“ä½œ</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10; * dump&#26632;&#39030;&#36827;&#31243;&#30340;hprof&#10; */&#10;public void dumpTopTaskHprof() &#123;&#10;    if (isDumping) &#123;&#10;        return;&#10;    &#125;&#10;&#10;    IDevice iDevice = mDevice.getIDevice();&#10;&#10;    /**&#10;     * &#36825;&#37324;&#33258;&#21160;&#36873;&#25321;&#25163;&#26426;&#19978;&#26632;&#39030;&#36827;&#31243;&#20570;dump&#25805;&#20316;&#65292;&#33719;&#21462;applicationName&#10;     */&#10;    String topApp = getTopApplication();&#10;    Client client = iDevice.getClient(topApp);&#10;&#10;    if (client == null) &#123;&#10;        throw new RuntimeException(&#34;Can not dump app:&#34; + topApp);&#10;    &#125;&#10;    client.dumpHprof();&#10;    isDumping = true;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>åœ¨IHprofDumpHandlerçš„å›è°ƒä¸­, ä¿å­˜hprofæ–‡ä»¶ï¼Œåšæ ¼å¼è½¬æ¢ï¼Œåˆ†æBitmapå¯¹è±¡çš„çŠ¶å†µã€‚BitmapAnalyzer.javaçš„ä»£ç åœ¨ä¸Šæ–‡è¯´è¿‡ã€‚</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private void conversionAndRemoveHprof(String hprofPath) &#123;&#10;    String convHprofPath = getConvHprofPath(hprofPath);&#10;    hprofConv(hprofPath, convHprofPath);&#10;    removeFile(hprofPath);&#10;&#10;    analyzerBitmap(convHprofPath);&#10;&#125;&#10;&#10;private void hprofConv(String hprofPath, String convHprofPath) &#123;&#10;    String adbPath = Adb.instance().getAdbPath();&#10;    String hprofConvPath = adbPath.replace(&#34;adb&#34;, &#34;hprof-conv&#34;);&#10;    ShellCommand.exec(hprofConvPath + &#34; &#34; + hprofPath + &#34; &#34; + convHprofPath);&#10;&#125;&#10;&#10;private void analyzerBitmap(String hprofPath) &#123;&#10;    String[] args = new String[2];&#10;    args[0] = hprofPath;&#10;    args[1] = &#34;bitmap&#34;;&#10;    BitmapAnalyzer.main(args);&#10;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å…³äºBitmapAnalyzerçš„é‚£äº›å‘ç°">å…³äºBitmapAnalyzerçš„é‚£äº›å‘ç°</h3>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹å¦‚æœæˆ‘æƒ³è¦è¾ƒè¯¦ç»†çš„åˆ†æå†…å­˜çŠ¶å†µï¼Œä¼šä½¿ç”¨android monitor(ä¸‹ç®€ç§°monitor)å’ŒMemory Analyzerå·¥å…·(ä¸‹ç®€ç§°MAT)ï¼Œä½†æ­¥éª¤æœ‰äº›éº»çƒ¦ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨monitor dumpå †æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨hprof-convå·¥å…·ï¼Œå°†hprofè½¬æ¢æˆMATèƒ½å¤Ÿè¯†åˆ«çš„æ ¼å¼&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨MATåˆ†æ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;éœ€è¦æ‰‹åŠ¨dump hprofå†ä½¿ç”¨hprof-convå·¥å…·æ‰‹åŠ¨è½¬ç ï¼Œä¸Šç¯‡&lt;a href=&quot;https://ivonhoe.github.io/2017/03/22/Bitmap&amp;amp;Memory/&quot;&gt;Android Bitmapçš„å†…å­˜å¤§å°æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ&lt;/a&gt;è¯´åˆ°ä½¿ç”¨squareçš„&lt;a href=&quot;https://github.com/square/haha&quot;&gt;haha&lt;/a&gt;æ¥åšå†…å­˜å †ä¸­Bitmapçš„åˆ†æã€‚æ‰€ä»¥åœ¨æ€è€ƒå¦‚ä½•ä¸€é”®å®Œæˆå†…å­˜dumpå’Œanalyzeçš„è¿‡ç¨‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä»»æ„å…¶ä»–Javaå¯¹è±¡åšåˆ†æã€‚&lt;br&gt;å¦‚ä½•å®Œæˆdumpå’Œè½¬ç ï¼Œæ€è·¯è¿˜æ˜¯Read the fucking source codeï¼Œçœ‹ä¸‹monitoræ˜¯å¦‚ä½•dump hprofæ–‡ä»¶çš„ã€‚æ‰“å¼€Android sdkç›®å½•ï¼Œmonitorå’Œå…¶ä¾èµ–çš„jaråˆ†åˆ«åœ¨&lt;code&gt;/tools&lt;/code&gt;å’Œâ€™/tools/libâ€™ç›®å½•ï¼Œæ ¸å¿ƒä»£ç åœ¨&lt;code&gt;ddmlib.jar&lt;/code&gt;ä¸­ï¼ŒJava swringä»£ç åœ¨&lt;code&gt;ddms.jar&lt;/code&gt;å’Œ&lt;code&gt;ddmuilib.jar&lt;/code&gt;ä¸­ï¼Œddmlibéœ€è¦ä¾èµ–&lt;code&gt;common.jar&lt;/code&gt;å’Œ&lt;code&gt;guava.jar&lt;/code&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="dump heap" scheme="https://ivonhoe.github.io/tags/dump-heap/"/>
    
      <category term="å†…å­˜" scheme="https://ivonhoe.github.io/tags/%E5%86%85%E5%AD%98/"/>
    
  </entry>
  
  <entry>
    <title>Android Bitmapçš„å†…å­˜å¤§å°æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ</title>
    <link href="https://ivonhoe.github.io/2017/03/22/Bitmap&amp;Memory/"/>
    <id>https://ivonhoe.github.io/2017/03/22/Bitmap&amp;Memory/</id>
    <published>2017-03-22T11:35:36.000Z</published>
    <updated>2017-04-24T07:02:14.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€å‰è¨€">ä¸€ã€å‰è¨€</h3><p>æœ¬æ¥åªæƒ³è¯´ä¸‹Bitmapå’Œå†…å­˜çš„åŸºæœ¬å…³ç³»ï¼Œä½†å‘ç°å¦‚æœçœŸçš„æƒ³æŠŠè¿™çœ‹ä¼¼ç®€å•çš„äº‹æƒ…è¯´æ¸…æ¥šï¼Œå®é™…ä¸Šæœªå¿…é‚£ä¹ˆç®€å•ï¼Œä½ ä¸ä¿¡ï¼Ÿä¸å¦¨å…ˆå°è¯•ä¸‹å›ç­”ä¸‹é¢å‡ ä¸ªé—®é¢˜ï¼</p>
<ul>
<li>é—®1ï¼šä»€ä¹ˆæ˜¯dpiï¼Ÿä»€ä¹ˆæ˜¯dpï¼Ÿç­”ï¼šä½ åœ¨ä¾®è¾±æˆ‘ï¼Ÿæˆ‘æ‹’ç»å›ç­”ï¼ï¼ˆï¼šæ— è¾œè„¸</li>
<li>é—®2ï¼šä»¥Nexus6ä¸ºä¾‹ï¼Œåˆ†è¾¨ç‡1440*2560ï¼Œ5.96è‹±å¯¸ï¼Œppiæ˜¯ä»€ä¹ˆï¼Ÿdpiæ˜¯ä»€ä¹ˆï¼Ÿ1dpæ˜¯å¤šå°‘åƒç´ ï¼Ÿ</li>
<li>é—®3ï¼šè¿˜ä»¥Nexus6ä¸ºä¾‹ï¼Œä¸€å¼ 180*180çš„å›¾ç‰‡ï¼Œæ”¾ç½®åœ¨è®¾ç½®äº†<code>wrap_content</code>å±æ€§çš„ImageViewä¸­ï¼Œå½“è¿™å¼ å›¾ç‰‡ï¼Œåˆ†åˆ«æ”¾åœ¨<code>drawable-nodpi</code>,<code>drawable-mdpi</code>,<code>drawable-hdpi</code>, <code>drawable-xxhdpi</code>,<code>drawable-xxxhdpi</code>è¿™å‡ ä¸ªèµ„æºç›®å½•ä¸­ï¼Œåœ¨å±å¹•ä¸Šåˆ†åˆ«æ˜¾ç¤ºå¤šå¤§(åƒç´ )çš„å›¾ç‰‡ï¼Ÿ</li>
<li>é—®4ï¼šè¿™å¼ å›¾ç‰‡å ç”¨çš„å†…å­˜å¤§å°åˆ†åˆ«ä¸ºå¤šå°‘ï¼Ÿ</li>
<li>é—®5ï¼šå¦‚æœè®¾ç½®ImageViewçš„å®½å’Œé«˜ä¸ºå›ºå®šçš„å€¼ï¼Œå¦‚50pxï¼Œé‚£ä¹ˆä¸Šè¿°æƒ…å†µä¸‹ï¼ŒåŠ è½½çš„Bitmapå ç”¨å†…å­˜å¤§å°åˆ†åˆ«ä¸ºå¤šå¤§ï¼Ÿ</li>
</ul>
<p>æœ¬æ–‡ä¸»è¦å›´ç»•ä¸Šè¿°é—®é¢˜ï¼Œä»‹ç»Androidå›¾ç‰‡èµ„æºåŠ è½½çš„åŸºæœ¬æœºåˆ¶ï¼Œå›¾ç‰‡çš„å†…å­˜å¤§å°å¦‚ä½•è®¡ç®—ï¼Œä»¥åŠå†…å­˜å›¾ç‰‡åˆ†æå·¥å…·ã€‚</p>
<a id="more"></a>
<h3 id="äºŒã€åŸºç¡€æ¦‚å¿µ">äºŒã€åŸºç¡€æ¦‚å¿µ</h3><ul>
<li>pxï¼šåƒç´ (pixel)ï¼ŒæŒ‡çš„æ˜¯å±å¹•ä¸Šçš„ç‰©ç†ç‚¹ï¼Œæœ€å°çš„ç‹¬ç«‹æ˜¾ç¤ºå•ä½</li>
<li>ppiï¼šæ¯è‹±å¯¸åƒç´ ç‚¹(Pixels Per Inch)ï¼Œä¹‹å‰æˆ‘è‡ªå·±çš„ç†è§£å°±æ˜¯ä½¿ç”¨å‹¾è‚¡å®šç†ï¼Œé€šè¿‡å±å¹•é•¿å®½è®¡ç®—å‡ºå¯¹è§’çº¿çš„é•¿åº¦ï¼Œå†é™¤ä»¥å±å¹•å¯¹è§’çº¿è‹±å¯¸å€¼ã€‚</li>
<li>dpiï¼šæ¯è‹±å¯¸ç‚¹(Dots Per Inch)ï¼Œå’Œppiæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li>
<li>dpï¼šåƒç´ æ— å…³ç‚¹(Density-Independent pixel)ï¼Œè¿™ä¸ªAndroidå®šä¹‰çš„è™šæ‹Ÿå€¼ï¼Œå’Œpxå…³ç³»å¼æ˜¯<code>px = dp * (dpi / 160)</code>ï¼Œä¸ºå•¥ï¼Ÿ</li>
</ul>
<p><strong>ppi</strong></p>
<p>ppiæŒ‡çš„æ˜¯æ°´å¹³æ–¹å‘æˆ–è€…ç«–ç›´æ–¹å‘ä¸Šæ¯è‹±å¯¸çš„åƒç´ å€¼ï¼Œå…ˆè¯´ä¸ºå•¥å¾ˆå¤šå¯¹ppiçš„ç†è§£éƒ½æœ‰é—®é¢˜ã€‚å¾ˆå¤šæ–‡ç« åˆ©ç”¨å‹¾è‚¡å®šç†è®¡ç®—æ‰‹æœºå±å¹•å¯¹è§’çº¿åƒç´ ä¸ªæ•°ï¼ï¼ä½†æ˜¯æ‰‹æœºå±å¹•çš„åƒç´ åˆ†å¸ƒæ˜¯ç‚¹é˜µåˆ†å¸ƒï¼Œç‚¹é˜µçš„å¯¹è§’çº¿åƒç´ ç‚¹ä¸æ˜¯ç”¨å‹¾è‚¡å®šç†ç®—å‡ºæ¥çš„ï¼Œè€Œæ˜¯ç­‰äºå®ƒçš„è¡Œæ•°æˆ–è€…åˆ—æ•°ï¼Œä¸ºå•¥ç”¨å¯¹è§’çº¿è®¡ç®—ï¼Ÿå› ä¸ºä¸€èˆ¬æ‰‹æœºçš„å°ºå¯¸è¯´çš„å°±æ˜¯å¯¹è§’çº¿è‹±å¯¸å€¼ï¼Œè€Œä¸çŸ¥é“é•¿å®½çš„è‹±å¯¸å€¼ã€‚è¿™é‡Œæœ‰ä¸ªå…¬å¼æ¨å¯¼ï¼š<br>è®¾ X/x = Y/y = ppiï¼Œè¿™é‡ŒXä¸ºæ°´å¹³åƒç´ å€¼ï¼Œxä¸ºæ°´å¹³è‹±å¯¸å€¼ï¼ŒYä¸ºç«–ç›´åƒç´ å€¼ï¼Œyä¸ºç«–ç›´è‹±å¯¸å€¼ã€‚åˆ™(XÂ²+YÂ²ï¼‰/ï¼ˆxÂ²+yÂ²ï¼‰=ï¼ˆX/xï¼‰Â²=ï¼ˆY/yï¼‰Â²ï¼Œè¿™ä¸ªå…¬å¼å¯é€šè¿‡å‹¾è‚¡å®šç†å’Œç›¸ä¼¼ä¸‰è§’å½¢åŸç†è¯æ˜ã€‚ppiçš„è®¡ç®—åªæ˜¯å½¢å¼å’Œå‹¾è‚¡å®šç†ä¸€æ ·ä½†å¹¶ä¸æ˜¯å‹¾è‚¡å®šç†çš„æ„æ€ï¼Œåˆ†å­ä¹Ÿä¸æ˜¯å¯¹è§’çº¿çš„åƒç´ æ•°ï¼ï¼ppiçš„è®¡ç®—å…¬å¼å¯è¡¨ç¤ºä¸ºï¼šâˆš(XÂ²+YÂ²ï¼‰/å¯¹è§’çº¿è‹±å¯¸ã€‚ä½†ä¸æ„å‘³ç€ppiæ˜¯ä½¿ç”¨å‹¾è‚¡å®šç†è®¡ç®—å¯¹è§’çº¿åƒç´ å€¼è·å¾—çš„~~</p>
<p><img src="/res/bitmap/2.png" alt=""></p>
<p><a href="https://www.zhihu.com/question/21220154/answer/69672901" target="_blank" rel="external">DPIã€PPIã€DPã€PX çš„è¯¦ç»†è®¡ç®—æ–¹æ³•åŠç®—æ³•æ¥æºæ˜¯ä»€ä¹ˆï¼Ÿfskçš„å›ç­”</a></p>
<p><strong>dpi</strong></p>
<p>dpiæ˜¯ç”±ppiç¡®å®šçš„ï¼Œè¿˜æ˜¯ä»¥Nexue6ä¸ºä¾‹ï¼Œé€šè¿‡ppiçš„è®¡ç®—å…¬å¼ï¼Œå¯ä»¥è®¡ç®—å‡ºNexues6çš„ppiä¸º<code>492</code>,å‚ç…§ä¸‹è¡¨ï¼Œåº”è¯¥åœ¨xxxhdpiçš„èŒƒå›´å†…ï¼Œä½†å®ƒçš„dpiå¹¶ä¸æ˜¯<code>492</code>ã€‚å®é™…ä¸Šdpiåªæœ‰120(low)ã€160(medium)ã€240(high)ã€260ã€280ã€300ã€320(xhigh)ã€340ã€360ã€400ã€420ã€480ï¼ˆxxhpdiï¼‰ã€560ã€640ï¼ˆxxxhpiï¼‰è¿™å‡ ç§ï¼Œå¯ä»¥å‚ç…§<code>android.util.DisplayMetrics</code>çš„æºç ã€‚é€šè¿‡<code>getResources().getDisplayMetrics().densityDpi</code>å¯ä»¥è·å–æ‰‹æœºå®é™…çš„dpiã€‚</p>
<p><img src="/res/bitmap/dpi.png" alt=""></p>
<p><a href="https://android.googlesource.com/platform/frameworks/base/+/master/core/java/android/util/DisplayMetrics.java" target="_blank" rel="external">DisplayMetrics.javaæºç é“¾æ¥</a></p>
<p><strong>dp</strong></p>
<p>1dpåœ¨Nexues6ä¸Šæ˜¯å¤šå°‘åƒç´ ï¼Ÿ<br><code>1dp * (560/160) = 3.5px</code></p>
<p><strong>å¦‚ä½•æ›´æ”¹æ‰‹æœºçš„dpi</strong></p>
<ul>
<li>éœ€è¦rootçš„æ‰‹æœº</li>
<li>æ›´æ”¹/system/build.propä¸­çš„ro.sf.lcd_densityå±æ€§ï¼Œè¿™ä¸ªå€¼è¶Šå°ï¼Œå±å¹•å¯†åº¦è¶Šé«˜</li>
<li>adb reboot é‡å¯æ‰‹æœº</li>
</ul>
<p><strong>å¦‚ä½•å¿«é€ŸæŸ¥çœ‹æ‰‹æœºå±å¹•ä¿¡æ¯</strong></p>
<p><code>adb shell dumpsys display | findstr DisplayDeviceInfo</code></p>
<h3 id="ä¸‰ã€å›åˆ°é—®é¢˜">ä¸‰ã€å›åˆ°é—®é¢˜</h3><p>ä»¥Nexus6ä¸ºä¾‹ï¼Œä¸€å¼ 180*180çš„å›¾ç‰‡ï¼Œæ”¾åœ¨è®¾ç½®äº†<code>wrap_content</code>å±æ€§çš„ImageViewä¸­ï¼Œå½“è¿™å¼ å›¾ç‰‡ï¼Œåˆ†åˆ«æ”¾ç½®åœ¨<code>drawable-nodpi</code>,<code>drawable-mdpi</code>,<code>drawable-hdpi</code>, <code>drawable-xxhdpi</code>,<code>drawable-xxxhdpi</code>è¿™å‡ ä¸ªèµ„æºç›®å½•ä¸­ï¼Œåœ¨å±å¹•ä¸Šåˆ†åˆ«æ˜¾ç¤ºå¤šå¤§(åƒç´ )çš„å›¾ç‰‡ï¼Ÿ</p>
<p>ç­”ï¼šæ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œå¯ä»¥çœ‹åˆ°nexus6ï¼Œæ˜¯å±äºxxxhpiçš„å±å¹•ï¼Œè·å–åˆ°dpiä¸º560ã€‚å¦‚æœæŠŠ180å¤§å°çš„å›¾ç‰‡åªæ”¾åœ¨xxxhdpiç›®å½•ä¸­ï¼Œæ˜¯ä¸æ˜¯å±å¹•å°±ä¼šæ˜¾ç¤º180pxçš„å¤§å°ï¼Ÿå…¶å®å¹¶ä¸æ˜¯ï¼Œdpi=640çš„æ‰æ˜¯çœŸæ­£çš„xxxhdpi(è¿™é‡Œéœ€è¦çœ‹DisplayMetricsçš„æºç )ï¼Œå½“Androidç³»ç»ŸåŠ è½½å›¾ç‰‡æ—¶ï¼Œä¼šé’ˆå¯¹å½“å‰ç³»ç»Ÿçš„dpiå’Œå›¾ç‰‡ç›®å½•çš„source dpiæ¯”è¾ƒåšç›¸åº”æ¯”ä¾‹çš„ç¼©æ”¾ï¼Œå¦‚æœä¸€å¼ å›¾ç‰‡æ”¾åœ¨drawable-xxxhdpiç›®å½•ï¼Œè¿™æ˜¯å‘Šè¯‰ç³»ç»Ÿï¼Œé’ˆå¯¹dpiä¸º640çš„æ‰‹æœºå±å¹•ä¸Šï¼Œè¿™å¼ å›¾ç‰‡æ˜¯åˆšåˆšå¥½çš„ï¼Œå®ƒçš„scaleä¸º1.0ï¼ŒåŒç†ï¼Œdrawable-xxhpiå¯¹åº”480dpiï¼Œdrawable-xhdpiå¯¹åº”çš„æ˜¯320dpiã€‚å¦‚æœå¸Œæœ›<code>180*180</code>åœ¨nexues6çš„å±å¹•ä¸ŠæŒ‰ç…§åŸæœ‰å°ºå¯¸æ˜¾ç¤ºï¼Œåªæœ‰å°†å…¶æ”¾åœ¨drawable-nodpiæˆ–è€…drawable-560dpiç›®å½•ä¸­æ‰å¯ä»¥ã€‚</p>
<p>å›åˆ°é—®é¢˜ï¼Œå¦‚æœå°†<code>180*180</code>æ”¾å…¥hdpiç›®å½•ä¸­ï¼Œé‚£å®é™…æ˜¾ç¤ºçš„å›¾ç‰‡å¤§å°åº”è¯¥ä¸ºï¼š<code>int (180 * (560 / 240) +0.5f ) = 420px</code>ï¼Œå®é™…å›¾ç‰‡çš„å¤§å°åº”è¯¥ä¸º420pxï¼åŒç†:<br>æ”¾å…¥xhdpiç›®å½•ä¸­ï¼Œå®é™…å¤§å°åº”è¯¥ä¸º<code>int (180 * (560 / 320) +0.5f ) = 315px</code><br>æ”¾å…¥xxhdpiç›®å½•ä¸­ï¼Œå®é™…å¤§å°åº”è¯¥ä¸º<code>int (180 * (560 / 480) +0.5f ) = 210px</code></p>
<p><a href="https://android.googlesource.com/platform/frameworks/base/+/7b2f8b8/core/jni/android/graphics/BitmapFactory.cpp" target="_blank" rel="external">BitmapFactory.cppæºç é“¾æ¥</a></p>
<p>å¦‚æœç”¨å°çš„Bitmapå®¹å™¨ï¼Œæ”¾ç½®è¾ƒå¤§çš„Bitmapï¼Œé‚£è¿™ä¸ªBitmapçš„å°ºå¯¸å¤§å°æ˜¯æŒ‰ç…§å®¹å™¨çš„å¤§å°è®¡ç®—ï¼Ÿè¿˜æ˜¯æŒ‰ç…§dpiç¼©æ”¾çš„è§„åˆ™è®¡ç®—ï¼Ÿ</p>
<h3 id="å››ã€ä¸€å¼ å›¾ç‰‡å å¤šå¤§å†…å­˜">å››ã€ä¸€å¼ å›¾ç‰‡å å¤šå¤§å†…å­˜</h3><p>ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“äº†ä¸€å¼ å›¾ç‰‡æ”¾ç½®åœ¨ä¸åŒçš„èµ„æºç›®å½•ä¸­ï¼Œç³»ç»Ÿdecodeçš„bitmapçš„å°ºå¯¸å¤§å°æ˜¯å¦‚ä½•è®¡ç®—çš„äº†ã€‚ä¸€å¼ å›¾ç‰‡å¤§æ¦‚å ç”¨å¤šå°‘å†…å­˜ï¼Œå…¶å®åªç”¨çœ‹ä¸€ä¸ªåƒç´ å ç”¨å¤šå°‘å†…å­˜å°±å¯ä»¥å–½ï¼Ÿæˆ‘ä»¬éƒ½çŸ¥é“å±å¹•ä¸Šçš„é¢œè‰²æ˜¯æœ‰Rï¼ŒGï¼ŒBåŠ é€æ˜åº¦è¡¨ç¤ºçš„ï¼ŒAndroidå®˜æ–¹æ”¯æŒçš„RGBæ ¼å¼ï¼Œä¸»è¦æ˜¯<code>ALPHA_8</code>ï¼Œ<code>RGB_565</code>ï¼Œ<code>ARGB_4444</code>ï¼Œ<code>ARGB_8888</code>è¿™å‡ ç§ã€‚</p>
<p>ä»¥ARGB_8888ä¸ºä¾‹ï¼Œè¡¨ç¤ºä¸€ä¸ªåƒç´ ç‚¹ï¼Œä½¿ç”¨8ä½è¡¨ç¤ºé€æ˜åº¦ï¼Œ8ä½è¡¨ç¤ºRedï¼Œ8ä½è¡¨ç¤ºGreenï¼Œ8ä½è¡¨ç¤ºBlueã€‚åŠ èµ·æ¥ï¼Œä¸€ä¸ªåƒç´ å°±éœ€è¦4byteï¼ŒåŒç†ï¼ŒRGB_565ä¸€ä¸ªåƒç´ éœ€è¦2byteã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public enum Config &#123;&#10;    ALPHA_8     (1),&#10;    RGB_565     (3),&#10;    @Deprecated&#10;    ARGB_4444   (4),&#10;    ARGB_8888   (5);&#10;    final int nativeInt;&#10;    Config(int ni) &#123;&#10;        this.nativeInt = ni;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>Android decodeèµ„æºå›¾ç‰‡æ—¶é»˜è®¤ä¼šé€‰æ‹©ARGB_8888ï¼Œå¦‚æœå°†<code>180*180</code>æ”¾å…¥hdpiç›®å½•ä¸­ï¼Œé‚£å®é™…å¤§å°åº”è¯¥ä¸º<code>int (180 * (560 / 240) +0.5f ) = 420px</code>ï¼Œåƒç´ å†…å­˜å¤§å°ä¸º <code>420 * 420 * 4 = 705600byte = 689kb</code>ã€‚åŒç†:<br>æ”¾å…¥xhdpiç›®å½•ä¸­ï¼Œå®é™…å¤§å°åº”è¯¥ä¸º<code>int (180 * (560 / 320) +0.5f ) = 315px</code>ï¼Œåƒç´ å†…å­˜å¤§å°ä¸º<code>315 * 315 * 4 = 396900byte = 387.6kb</code><br>æ”¾å…¥xxhdpiç›®å½•ä¸­ï¼Œå®é™…å¤§å°åº”è¯¥ä¸º<code>int (180 * (560 / 480) +0.5f ) = 210px</code>ï¼Œåƒç´ å†…å­˜å¤§å°ä¸º<code>210 * 210 * 4 = 176400byte = 172.2kb</code></p>
<h3 id="äº”ã€å¦‚ä½•åˆ†æå†…å­˜ä¸­çš„å›¾ç‰‡é—®é¢˜ï¼Ÿ">äº”ã€å¦‚ä½•åˆ†æå†…å­˜ä¸­çš„å›¾ç‰‡é—®é¢˜ï¼Ÿ</h3><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œç»ˆäºåˆ°äº†æˆ‘åŸæœ¬æƒ³è¯´çš„ã€‚Androidçš„å†…å­˜ä¼˜åŒ–éœ€è¦é‡ç‚¹å…³æ³¨çš„å‡ ä¸ªæ–¹é¢ï¼ŒBitmapçš„åŠ è½½ï¼ŒActivityçš„æ³„éœ²ï¼Œwebviewå†…å­˜ç­‰ã€‚å›¾ç‰‡çš„å†…å­˜é—®é¢˜ï¼Œæ˜¯å¾ˆå¤šAndroidåº”ç”¨ï¼Œç‰¹åˆ«æ˜¯ç”µå•†APPéœ€è¦é¦–è¦å…³æ³¨çš„é—®é¢˜ã€‚é‚£å¦‚ä½•ç®€å•çš„åˆ†æå‡ºå†…å­˜ä¸­Bitmapçš„æƒ…å†µï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªå·¥å…·ã€‚å€ŸåŠ©leakcanaryçš„æ€è·¯ï¼Œé€šè¿‡åˆ†æå†…å­˜å †dumpæ–‡ä»¶ä¸­<code>android.graphics.Bitmap</code>å¯¹è±¡çš„æƒ…å†µï¼Œ<strong>å°†å†…å­˜ä¸­Bitmapå¯¹è±¡æ‰¹é‡ä¿å­˜åˆ°å›¾ç‰‡æ–‡ä»¶ä¸­</strong>ï¼Œè¿™æ ·å°±å¯ä»¥ç›´è§‚çš„çœ‹åˆ°å†…å­˜ä¸­åŠ è½½çš„Bitmapä¸ªæ•°ã€å†…å®¹å’Œå¤§å°ï¼Œè¿›è€Œåˆ†æå¯èƒ½çš„å†…å­˜é—®é¢˜ã€‚</p>
<p><img src="/res/bitmap/bitmap_buffer.png" alt=""></p>
<p><img src="/res/bitmap/1.png" alt=""></p>
<p><strong>ç¤ºä¾‹</strong></p>
<p>ä»¥åˆ†æè˜‘è‡è¡—APPå†…å­˜ä¸­bitmapä¸ºä¾‹:</p>
<ul>
<li>å…ˆä½¿ç”¨Android monitor dump hprof</li>
<li>hprof-convåšæ ¼å¼è½¬æ¢</li>
<li><code>java -jar ./bitmap-analyzer-0.0.1-SNAPSHOT.jar /Users/Ivonhoe/hprof/com.mogujie-conv.hprof è˜‘è‡è¡—</code></li>
</ul>
<p><strong>å‚æ•°è¯´æ˜</strong>ï¼š</p>
<ul>
<li>å‚æ•°1ï¼šéœ€è¦å¤„ç†hprofæ–‡ä»¶çš„ç»å¯¹è·¯å¾„</li>
<li>å‚æ•°2ï¼šå›¾ç‰‡è¾“å‡ºçš„æ–‡ä»¶å¤¹åç§°ï¼Œåœ¨hprofæ–‡ä»¶ç›®å½•ä¸­åˆ›å»ºè¯¥æ–‡ä»¶å¤¹,ç¼ºçœæ—¶ç›´æ¥ä¼šåœ¨hprofæ–‡ä»¶ç›®å½•è¾“å‡ºæ–‡ä»¶</li>
</ul>
<p><strong>è¾“å‡ºè¯´æ˜</strong></p>
<p><img src="/res/bitmap/bitmap-analyzer.png" alt=""></p>
<ul>
<li>å¤§å°æ’åº.txt æŒ‰ç…§å›¾ç‰‡åƒç´ å°ºå¯¸ï¼Œä»å¤§åˆ°å°æ’åº</li>
<li>ä¸ªæ•°æ’åº.txt æŒ‰ç…§ç›¸åŒå°ºå¯¸å›¾ç‰‡ä¸ªæ•°ï¼Œä»å¤§åˆ°å°æ’åº</li>
<li>æ–‡ä»¶å width*height_index.png</li>
</ul>
<p><strong>JaråŒ…åœ°å€</strong></p>
<p><a href="https://raw.githubusercontent.com/Ivonhoe/mvn-repo/master/ivonhoe/java/heapanalyzer/bitmap-analyzer/0.0.1-SNAPSHOT/bitmap-analyzer-0.0.1-20170327.112600-1.jar" target="_blank" rel="external">https://raw.githubusercontent.com/Ivonhoe/mvn-repo/master/ivonhoe/java/heapanalyzer/bitmap-analyzer/0.0.1-SNAPSHOT/bitmap-analyzer-0.0.1-20170327.112600-1.jar</a></p>
<h3 id="å…­ã€å‚è€ƒæ–‡æ¡£">å…­ã€å‚è€ƒæ–‡æ¡£</h3><p><a href="http://blog.csdn.net/guolin_blog/article/details/50727753" target="_blank" rel="external">Android drawableå¾®æŠ€å·§ï¼Œä½ æ‰€ä¸çŸ¥é“çš„drawableçš„é‚£äº›ç»†èŠ‚</a></p>
<p><a href="http://www.10tiao.com/html/336/201703/2652262290/1.html" target="_blank" rel="external">å…³äºAndroidé€‚é…ï¼Œçœ‹å®Œè¿™ç¯‡æ–‡ç« å°±å¤Ÿäº†</a></p>
<p><a href="http://wangjunyan.github.io/2014/12/02/export-android-bitmap-from-dump-file/" target="_blank" rel="external">æ‰¹é‡å¯¼å‡ºdumpæ–‡ä»¶ä¸­çš„Bitmap</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzA3NTYzODYzMg==&amp;mid=403263974&amp;idx=1&amp;sn=b0315addbc47f3c38e65d9c633a12cd6&amp;scene=21#wechat_redirect" target="_blank" rel="external">Android å¼€å‘ç»•ä¸è¿‡çš„å‘ï¼šä½ çš„ Bitmap ç©¶ç«Ÿå å¤šå¤§å†…å­˜ï¼Ÿ</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä¸€ã€å‰è¨€&quot;&gt;ä¸€ã€å‰è¨€&lt;/h3&gt;&lt;p&gt;æœ¬æ¥åªæƒ³è¯´ä¸‹Bitmapå’Œå†…å­˜çš„åŸºæœ¬å…³ç³»ï¼Œä½†å‘ç°å¦‚æœçœŸçš„æƒ³æŠŠè¿™çœ‹ä¼¼ç®€å•çš„äº‹æƒ…è¯´æ¸…æ¥šï¼Œå®é™…ä¸Šæœªå¿…é‚£ä¹ˆç®€å•ï¼Œä½ ä¸ä¿¡ï¼Ÿä¸å¦¨å…ˆå°è¯•ä¸‹å›ç­”ä¸‹é¢å‡ ä¸ªé—®é¢˜ï¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é—®1ï¼šä»€ä¹ˆæ˜¯dpiï¼Ÿä»€ä¹ˆæ˜¯dpï¼Ÿç­”ï¼šä½ åœ¨ä¾®è¾±æˆ‘ï¼Ÿæˆ‘æ‹’ç»å›ç­”ï¼ï¼ˆï¼šæ— è¾œè„¸&lt;/li&gt;
&lt;li&gt;é—®2ï¼šä»¥Nexus6ä¸ºä¾‹ï¼Œåˆ†è¾¨ç‡1440*2560ï¼Œ5.96è‹±å¯¸ï¼Œppiæ˜¯ä»€ä¹ˆï¼Ÿdpiæ˜¯ä»€ä¹ˆï¼Ÿ1dpæ˜¯å¤šå°‘åƒç´ ï¼Ÿ&lt;/li&gt;
&lt;li&gt;é—®3ï¼šè¿˜ä»¥Nexus6ä¸ºä¾‹ï¼Œä¸€å¼ 180*180çš„å›¾ç‰‡ï¼Œæ”¾ç½®åœ¨è®¾ç½®äº†&lt;code&gt;wrap_content&lt;/code&gt;å±æ€§çš„ImageViewä¸­ï¼Œå½“è¿™å¼ å›¾ç‰‡ï¼Œåˆ†åˆ«æ”¾åœ¨&lt;code&gt;drawable-nodpi&lt;/code&gt;,&lt;code&gt;drawable-mdpi&lt;/code&gt;,&lt;code&gt;drawable-hdpi&lt;/code&gt;, &lt;code&gt;drawable-xxhdpi&lt;/code&gt;,&lt;code&gt;drawable-xxxhdpi&lt;/code&gt;è¿™å‡ ä¸ªèµ„æºç›®å½•ä¸­ï¼Œåœ¨å±å¹•ä¸Šåˆ†åˆ«æ˜¾ç¤ºå¤šå¤§(åƒç´ )çš„å›¾ç‰‡ï¼Ÿ&lt;/li&gt;
&lt;li&gt;é—®4ï¼šè¿™å¼ å›¾ç‰‡å ç”¨çš„å†…å­˜å¤§å°åˆ†åˆ«ä¸ºå¤šå°‘ï¼Ÿ&lt;/li&gt;
&lt;li&gt;é—®5ï¼šå¦‚æœè®¾ç½®ImageViewçš„å®½å’Œé«˜ä¸ºå›ºå®šçš„å€¼ï¼Œå¦‚50pxï¼Œé‚£ä¹ˆä¸Šè¿°æƒ…å†µä¸‹ï¼ŒåŠ è½½çš„Bitmapå ç”¨å†…å­˜å¤§å°åˆ†åˆ«ä¸ºå¤šå¤§ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦å›´ç»•ä¸Šè¿°é—®é¢˜ï¼Œä»‹ç»Androidå›¾ç‰‡èµ„æºåŠ è½½çš„åŸºæœ¬æœºåˆ¶ï¼Œå›¾ç‰‡çš„å†…å­˜å¤§å°å¦‚ä½•è®¡ç®—ï¼Œä»¥åŠå†…å­˜å›¾ç‰‡åˆ†æå·¥å…·ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Bitmap" scheme="https://ivonhoe.github.io/tags/Bitmap/"/>
    
      <category term="Drawable" scheme="https://ivonhoe.github.io/tags/Drawable/"/>
    
      <category term="å†…å­˜" scheme="https://ivonhoe.github.io/tags/%E5%86%85%E5%AD%98/"/>
    
  </entry>
  
  <entry>
    <title>Androidå®‰å…¨ä¹‹---åº”ç”¨é˜²dex2jaråŸç†åŠå®ç°</title>
    <link href="https://ivonhoe.github.io/2017/02/09/%E7%BE%8E%E5%9B%A2%E5%A6%82%E4%BD%95%E9%98%B2dex2jar/"/>
    <id>https://ivonhoe.github.io/2017/02/09/ç¾å›¢å¦‚ä½•é˜²dex2jar/</id>
    <published>2017-02-09T13:55:01.000Z</published>
    <updated>2017-03-23T08:47:01.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€åç¼–è¯‘æŸå¹³å°ä»£ç ">ä¸€ã€åç¼–è¯‘æŸå¹³å°ä»£ç </h3><p>æœ€è¿‘åœ¨çœ‹æŸå¤–å–å¹³å°çš„ä»£ç ï¼Œå‘ç°æŸå¤–å–å¹³å°æœ€æ–°ç‰ˆæœ¬ç‰ˆæœ¬æ— æ³•æ­£å¸¸çš„é€šè¿‡dex2jarå·¥å…·å°†dexè½¬æ¢å‡ºJavaæºä»£ç ï¼Œåœ¨è½¬æ¢è¿‡ç¨‹ä¸­ä¼šæç¤ºå‡ºé”™ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://ivonhoe.github.io/res/dex2jar_error/dex2jar_error1.png" alt="dex2jarå¼‚å¸¸å›¾"></p>
<p>æŸ¥çœ‹è½¬æ¢å‡ºçš„Javaæºä»£ç ï¼Œä¼šå‘ç°å¾ˆå¤šç±»æ–¹æ³•æç¤ºä¸‹å›¾æ‰€ç¤ºå¼‚å¸¸ï¼Œå¾ˆå¤šæ–¹æ³•ä¸­éƒ½ä¼šæŠ›å‡º<code>RuntimeExceptionï¼šcan not merge I and Z</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class AsyncTaskService extends IntentService &#123; &#10;  &#10;  protected void onHandleIntent(Intent paramIntent)&#123;&#10;    throw new RuntimeException(&#34;d2j fail translate: java.lang.RuntimeException: can not merge I and Z\n\tat...);&#10;  &#125;&#10;  &#10;  public int onStartCommand(Intent paramIntent, int paramInt1, int paramInt2)&#123;&#10;    throw new RuntimeException(&#34;d2j fail translate: java.lang.RuntimeException: can not merge I and Z\n\tat...&#34;);&#10;  &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ä¼šå‘ç°å¾ˆå¤šç±»ä¼¼çš„é”™è¯¯ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°æ–¹æ³•å†…<code>RuntimeException</code>æ ˆä¿¡æ¯å’Œåç¼–è¯‘çš„é”™è¯¯ä¿¡æ¯æ˜¯ç›¸åŒçš„ï¼Œéƒ½æç¤º<code>can not merge I and Z</code>ã€‚</p>
<p><img src="https://ivonhoe.github.io/res/dex2jar_error/dex2jar_error2.png" alt="dex2jaræ—¥å¿—"></p>
<h3 id="äºŒã€ä¸ºä»€ä¹ˆï¼Ÿ">äºŒã€ä¸ºä»€ä¹ˆï¼Ÿ</h3><p>æœ¬æ¥ä»¥ä¸ºè¿™æ˜¯dex2jarå·¥å…·ä½ç‰ˆæœ¬çš„ä¸€ä¸ªbugï¼Œä½†æ›´æ–°äº†dex2jarä»¥åï¼Œä¾ç„¶è¿˜æ˜¯ä¼šå‡ºç°ä¸Šè¿°é”™è¯¯ã€‚<br><code>java.lang.RuntimeException: can not merge I and Z</code>è¿™ä¸ªå¼‚å¸¸ï¼Œåœ¨<a href="https://sourceforge.net/p/dex2jar/tickets/238/" target="_blank" rel="external">sourceforge</a>ä¸Šè§£é‡Šçš„æ¯”è¾ƒæ¸…æ¥šï¼Œå…¶å®æ˜¯ä¸€ä¸ªdex2jarå·¥å…·æ£€æŸ¥å‡ºçš„ä¸€ä¸ªå‚æ•°å¼‚å¸¸â€ï¼Œ<strong>The problem is caused by strict type calculation, because in java syntaxt, a boolean can not assign to an inteager. so dex2jar forbid merge type Z and I.</strong> ä½ ç”¨å¸ƒå°”ç±»å‹å…¥å‚è°ƒç”¨ä¸€ä¸ªå‚æ•°ä¸ºæ•´å‹çš„å‡½æ•°ï¼Œå½“ç„¶ä¼šæ£€æŸ¥å‡ºé”™ï¼Œä¸ºå•¥è¿™ä¹ˆè¯´ï¼Œæˆ‘ä½¿ç”¨apktoolå·¥å…·ï¼Œçœ‹äº†ä¸€ä¸‹apkçš„smaliä»£ç ã€‚å‘ç°æŠ¥é”™çš„å‡½æ•°çš„æœ€å‰é¢éƒ½å«æœ‰ä¸€æ®µå¥‡æ€ªsmaliçš„ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invoke-static &#123;&#125;, Lpnf/this/object/does/not/Exist;-&#62;a()Z&#10;&#10;move-result v0&#10;&#10;invoke-static &#123;v0&#125;, Lpnf/this/object/does/not/Exist;-&#62;b(I)V</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸Šé¢çš„ä»£ç ï¼Œ<code>pnf.this.object.does.not.Exist.a()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªbooleanç±»å‹æ•°æ®ï¼Œæ”¾å…¥v0å¯„å­˜å™¨ï¼Œä½œä¸º<code>pnf.this.object.does.not.Exist.b(int)</code>å‡½æ•°çš„å…¥å‚ã€‚æ­£å¸¸æƒ…å†µä¸‹è¿™æ ·çš„è¯­æ³•é”™è¯¯åœ¨javaä»£ç ç¼–è¯‘æ—¶å°±ä¸ä¼šé€šè¿‡çš„ã€‚çœ‹åˆ°è¿™é‡Œä½ ä¼šä¸ä¼šæƒ³ï¼Œå¦‚æœæˆ‘ä¸æƒ³åˆ«äººç›´æ¥çœ‹åˆ°æˆ‘çš„Javaä»£ç ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡åœ¨æ ¸å¿ƒå‡½æ•°ä¸­æ’å…¥ä¸Šé¢è¿™æ®µæœ‰è¯­æ³•é”™è¯¯çš„ä»£ç ï¼Œä»¥è¾¾åˆ°dex2jarå·¥å…·æ£€æŸ¥å‡ºé”™çš„ç›®çš„å‘¢ï¼Ÿä»è€Œå°†ä»£ç è¢«é˜…è¯»çš„é—¨æ§›ä»javaæé«˜åˆ°smaliã€‚</p>
<h3 id="ä¸‰ã€æ‰‹åŠ¨ä»£ç æ³¨å…¥">ä¸‰ã€æ‰‹åŠ¨ä»£ç æ³¨å…¥</h3><p>ä¸ºäº†éªŒè¯ä¸Šé¢çš„çŒœæƒ³ï¼Œè¿™é‡Œæˆ‘é€šè¿‡åç¼–è¯‘ä¸€ä¸ªapkï¼Œæ‰‹åŠ¨æ’å…¥æœ‰è¯­æ³•é”™è¯¯çš„smaliä»£ç ï¼Œä»¥éªŒè¯é˜²dex2jarçš„æ€è·¯ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>1.åç¼–è¯‘ä¸€ä¸ªapkã€‚</li>
<li>2.ä¿®æ”¹smaliä»£ç ï¼Œæ’å…¥ä¸Šé¢è¿™ä¸‰å¥æœ‰è¯­æ³•é”™è¯¯çš„ä»£ç ã€‚</li>
<li>3.é‡æ‰“åŒ…ï¼Œä½¿ç”¨dex2jarå·¥å…·è½¬æ¢æ–°åŒ…çš„dexï¼Œçœ‹æ˜¯å¦èƒ½æ­£å¸¸è½¬æ¢å‡ºJavaæºä»£ç ã€‚å¹¶æ£€æŸ¥è¿è¡Œæ—¶æ˜¯å¦å‡ºé”™ã€‚</li>
</ul>
<p>æˆ‘è¿™é‡Œç”¨ä¸€ä¸ªHello Worldåº”ç”¨æ¥æµ‹è¯•ï¼Œä½¿ç”¨apktoolåç¼–è¯‘å‡ºsmaliä»£ç ï¼Œå¹¶åœ¨Applicationçš„onCreateæ–¹æ³•ä¸­æ’å…¥è¿™æ®µæœ‰è¯­æ³•é”™è¯¯çš„ä»£ç ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># virtual methods&#10;.method public onCreate()V&#10;    .locals 3&#10;&#10;    invoke-super &#123;p0&#125;, Lcn/trinea/android/lib/h/c;-&#62;onCreate()V&#10;&#10;    invoke-virtual &#123;p0&#125;, Lcn/trinea/android/developertools/MyApplication;-&#62;getApplicationContext()Landroid/content/Context;&#10;&#10;    move-result-object v0&#10;&#10;    invoke-static &#123;&#125;, Lpnf/object/does/not/Exist;-&#62;a()Z&#10;&#10;    move-result v3&#10;&#10;    invoke-static &#123;v3&#125;, Lpnf/object/does/not/Exist;-&#62;b(I)V&#10;&#10;    return-void&#10;.end method</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸è¦å¿˜äº†ï¼Œä½ å¯èƒ½éœ€è¦å¦å¤–ç¼–è¯‘å‡ºExist.smaliè¿™ä¸ªæ–‡ä»¶ï¼Œä¸ç„¶è¿è¡Œæ—¶ä¸€å®šä¼šçˆ†å‡ºClassNotFoundå¼‚å¸¸ã€‚å°†ä¸‹é¢çš„Exist.java<strong>ç¼–è¯‘å‡ºExist.smali</strong>æ”¾å…¥ç›¸åº”çš„åŒ…è·¯å¾„ï¼Œé‡æ‰“åŒ…å°±å¯ä»¥äº†ã€‚Javaä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class Exist &#123;&#10;    public static boolean a() &#123;&#10;        return false;&#10;    &#125;&#10;&#10;    public static void b(int test) &#123;&#10;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼ŒéªŒè¯ä¸‹æœç„¶é‡æ–°æ‰“åŒ…åçš„apkï¼Œç¡®å®ä¸èƒ½æ­£å¸¸è½¬æ¢å‡ºJavaæºä»£ç ï¼Œè¿™é‡Œå°±ä¸è´´å›¾äº†ï¼Œå› ä¸ºè½¬æ¢å‡ºé”™æ—¥å¿—æ˜¯ä¸€æ ·çš„ã€‚å¹¶ä¸”è¿è¡Œæ—¶ä¹Ÿä¸ä¼šå‡ºé”™ã€‚æ¥ä¸‹æ¥ä¼šå†™ä¸€ä¸ªGradleç¼–è¯‘æ’ä»¶ï¼Œé’ˆå¯¹ç‰¹å®šçš„å‡½æ•°ï¼Œæ’å…¥ä»£ç ï¼Œé˜²æ­¢dex2jarå·¥å…·æŸ¥çœ‹Javaæºä»£ç ã€‚</p>
<h3 id="å››ã€å®ç°æ€è·¯">å››ã€å®ç°æ€è·¯</h3><p>Androidå®¢æˆ·ç«¯åœ¨é˜²æ­¢å…¶Javaä»£ç è¢«dex2jarè½¬æ¢æ—¶å…¶å®å°±æ˜¯å€ŸåŠ©dex2jarçš„è¯­æ³•æ£€æŸ¥æœºåˆ¶ï¼Œå°†æœ‰è¯­æ³•é”™è¯¯çš„å­—èŠ‚ç æ’å…¥åˆ°æƒ³è¦ä¿æŠ¤çš„Javaå‡½æ•°ä¸­é‡Œé¢ï¼Œä»¥è¾¾åˆ°dex2jarè½¬æ¢å‡ºé”™çš„ç›®çš„ã€‚æ¥ä¸‹æ¥æˆ‘å°±å¤§è‡´è®°å½•ä¸‹å¦‚ä½•å¼€å‘Gradleç¼–è¯‘æ’ä»¶ï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å®ç°ä¸Šè¿°é˜²æŠ¤æ€è·¯ï¼Œå…ˆçœ‹ä¸‹Android APKæ‰“åŒ…æµç¨‹ï¼š</p>
<!--more-->
<p><img src="https://ivonhoe.github.io/res/dexguard/dexguard4.jpeg" alt="Android apkæ‰“åŒ…æµç¨‹"></p>
<p>Android APKæ‰“åŒ…æµç¨‹å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒJavaä»£ç å…ˆé€šè¿‡Java Compilerç”Ÿæˆ.classæ–‡ä»¶ï¼Œå†é€šè¿‡dxå·¥å…·ç”Ÿæˆdexæ–‡ä»¶ï¼Œæœ€åä½¿ç”¨apkbuilderå·¥å…·å®Œæˆä»£ç ä¸èµ„æºæ–‡ä»¶çš„æ‰“åŒ…ï¼Œå¹¶ä½¿ç”¨jarsignerç­¾åï¼Œæœ€åå¯èƒ½è¿˜æœ‰ä½¿ç”¨zipalignå¯¹ç­¾ååçš„apkåšå¯¹é½å¤„ç†ã€‚</p>
<p>å¦‚æœéœ€è¦å®Œæˆå¯¹ç‰¹å®šå‡½æ•°çš„ä»£ç æ³¨å…¥ï¼Œå¯ä»¥åœ¨Javaä»£ç ç¼–è¯‘ç”Ÿæˆclassæ–‡ä»¶åï¼Œåœ¨dexæ–‡ä»¶ç”Ÿæˆå‰ï¼Œé’ˆå¯¹classå­—èŠ‚ç è¿›è¡Œæ“ä½œï¼Œä»¥æœ¬ä¾‹ä¸ºä¾‹éœ€è¦åŠ¨æ€ç”ŸæˆExsitç±»æ–‡ä»¶çš„å­—èŠ‚ç ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#21160;&#24577;&#29983;&#25104;Exist.class&#10;public class Exist &#123;&#10;    public static boolean a() &#123;&#10;        return false;&#10;    &#125;&#10;&#10;    public static void b(int test) &#123;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>å°†ä¸‹åˆ—Javaä»£ç è½¬æ¢æˆå­—èŠ‚ç æ’å…¥éœ€è¦ä¿æŠ¤çš„å‡½æ•°ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#25554;&#20837;&#21040;&#29305;&#23450;&#30340;Java&#20989;&#25968;&#20869;&#10;Exist.b(Exist.a());</span><br></pre></td></tr></table></figure>
<p>å¹¶å°†ä¿®æ”¹åçš„.classæ–‡ä»¶æ”¾å…¥dexæ‰“åŒ…ç›®å½•ä¸­ï¼Œå®Œæˆdexæ‰“åŒ…ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://ivonhoe.github.io/res/dexguard/dexguard6.png" alt=""></p>
<p>Gradleæä¾›äº†å«<code>Transform</code>çš„APIï¼Œå…è®¸ä¸‰æ–¹æ’ä»¶åœ¨classæ–‡ä»¶è½¬æ¢ä¸ºdexæ–‡ä»¶å‰æ“ä½œç¼–è¯‘å¥½çš„classæ–‡ä»¶ï¼Œè¿™ä¸ªAPIçš„ç›®æ ‡å°±æ˜¯ç®€åŒ–classæ–‡ä»¶çš„è‡ªå®šä¹‰çš„æ“ä½œè€Œä¸ç”¨å¯¹Taskè¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å¯ä»¥æ›´åŠ çµæ´»åœ°è¿›è¡Œæ“ä½œã€‚è¯¦ç»†çš„å¯ä»¥å‚è€ƒ<a href="http://blog.csdn.net/sbsujjbcy/article/details/50839263" target="_blank" rel="external">åŒºé•¿çš„åšå®¢</a>ã€‚</p>
<h3 id="äº”ã€ä½¿ç”¨ASMæ“ä½œJavaå­—èŠ‚ç ">äº”ã€ä½¿ç”¨ASMæ“ä½œJavaå­—èŠ‚ç </h3><p>ASM æ˜¯ä¸€ä¸ª Java å­—èŠ‚ç æ“æ§æ¡†æ¶ã€‚å®ƒèƒ½è¢«ç”¨æ¥åŠ¨æ€ç”Ÿæˆç±»æˆ–è€…å¢å¼ºæ—¢æœ‰ç±»çš„åŠŸèƒ½ã€‚ASM å¯ä»¥ç›´<br>æ¥äº§ç”ŸäºŒè¿›åˆ¶ class æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»è¢«åŠ è½½å…¥ Java è™šæ‹Ÿæœºä¹‹å‰åŠ¨æ€æ”¹å˜ç±»è¡Œä¸ºã€‚è¿™é‡Œæ¨èä¸€ä¸ªIDEAæ’ä»¶:<code>ASM ByteCode Outline</code>ã€‚å¯ä»¥æŸ¥çœ‹.classæ–‡ä»¶çš„å­—èŠ‚ç ï¼Œå¹¶å¯ä»¥ç”ŸæˆæˆASMæ¡†æ¶ä»£ç ã€‚å®‰è£…<code>ASM Bytecode Outline</code>æ’ä»¶åï¼Œå¯ä»¥åœ¨<code>Intellij IDEA</code>-&gt;<code>Code</code>-&gt;<code>Show Bytecode Outline</code>æŸ¥çœ‹ç±»æ–‡ä»¶å¯¹åº”ä¸ªå­—èŠ‚ç å’ŒASMæ¡†æ¶ä»£ç ï¼Œåˆ©ç”¨ASMæ¡†æ¶ä»£ç å°±å¯ä»¥ç”Ÿæˆç›¸åº”çš„.classæ–‡ä»¶äº†ã€‚</p>
<p><img src="https://ivonhoe.github.io/res/dexguard/dexguard3.png" alt=""></p>
<p>ç”ŸæˆExistå­—èŠ‚ç çš„å…·ä½“å®ç°ï¼Œç”ŸæˆExist.javaçš„æ„é€ å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ClassWriter cw = new ClassWriter(0);&#10;FieldVisitor fv;&#10;MethodVisitor mv;&#10;AnnotationVisitor av0;&#10;&#10;cw.visit(51, ACC_PUBLIC + ACC_SUPER, &#34;ivonhoe/dexguard/java/Exist&#34;, null, &#34;java/lang/Object&#34;, null);&#10;&#10;cw.visitSource(&#34;Exist.java&#34;, null);&#10;&#10;mv = cw.visitMethod(ACC_PUBLIC, &#34;&#60;init&#62;&#34;, &#34;()V&#34;, null, null);&#10;mv.visitCode();&#10;Label l0 = new Label();&#10;mv.visitLabel(l0);&#10;mv.visitLineNumber(7, l0);&#10;mv.visitVarInsn(ALOAD, 0);&#10;mv.visitMethodInsn(INVOKESPECIAL, &#34;java/lang/Object&#34;, &#34;&#60;init&#62;&#34;, &#34;()V&#34;, false);&#10;mv.visitInsn(RETURN);&#10;Label l1 = new Label();&#10;mv.visitLabel(l1);&#10;mv.visitLocalVariable(&#34;this&#34;, &#34;Livonhoe/dexguard/java/Exist;&#34;, null, l0, l1, 0);&#10;mv.visitMaxs(1, 1);&#10;mv.visitEnd();</span><br></pre></td></tr></table></figure>
<p>å£°æ˜ä¸€ä¸ªå‡½æ•°åä¸ºaï¼Œè¿”å›å€¼ä¸ºbooleanç±»å‹çš„æ— å‚å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv = cw.visitMethod(ACC_PUBLIC + ACC_STATIC, &#34;a&#34;, &#34;()Z&#34;, null, null);&#10;mv.visitCode();&#10;l0 = new Label();&#10;mv.visitLabel(l0);&#10;mv.visitLineNumber(10, l0);&#10;mv.visitInsn(ICONST_0);&#10;mv.visitInsn(IRETURN);&#10;mv.visitMaxs(1, 0);&#10;mv.visitEnd();</span><br></pre></td></tr></table></figure>
<p>å£°æ˜ä¸€ä¸ªå‡½æ•°åä¸ºbï¼Œå‚æ•°ä¸ºintå‹ï¼Œè¿”å›ç±»å‹ä¸ºvoidçš„å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MV = CW.VISITmETHOD(acc_public + acc_static, &#34;b&#34;, &#34;(i)v&#34;, NULL, NULL);&#10;MV.VISITcODE();&#10;L0 = NEW lABEL();&#10;MV.VISITlABEL(L0);&#10;MV.VISITlINEnUMBER(14, L0);&#10;MV.VISITiNSN(return);&#10;L1 = NEW lABEL();&#10;MV.VISITlABEL(L1);&#10;MV.VISITlOCALvARIABLE(&#34;TEST&#34;, &#34;i&#34;, NULL, L0, L1, 0);&#10;MV.VISITmAXS(0, 1);&#10;MV.VISITeND();</span><br></pre></td></tr></table></figure>
<p>åœ¨æŒ‡å®šå‡½æ•°å†…ï¼Œæ’å…¥<code>Exist.b(Exist.a());</code>å¯¹åº”çš„å­—èŠ‚ç çš„å…·ä½“å®ç°ï¼Œç»•è¿‡Javaç¼–è¯‘å™¨çš„è¯­æ³•æ£€æŸ¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static class InjectClassVisitor extends ClassVisitor &#123;&#10;&#10;        private String methodName;&#10;&#10;        InjectClassVisitor(int i, ClassVisitor classVisitor, String method) &#123;&#10;            super(i, classVisitor)&#10;&#10;            this.methodName = method;&#10;        &#125;&#10;&#10;        @Override&#10;        public MethodVisitor visitMethod(int access, String name, String desc,&#10;                                         String signature, String[] exceptions) &#123;&#10;&#10;            MethodVisitor mv = super.visitMethod(access, name, desc, signature, exceptions);&#10;            mv = new MethodVisitor(Opcodes.ASM4, mv) &#123;&#10;&#10;                @Override&#10;                void visitCode() &#123;&#10;                    // &#22312;&#26041;&#27861;&#20307;&#24320;&#22987;&#35843;&#29992;&#26102;&#10;                    if (name.equals(methodName)) &#123;&#10;                        mv.visitMethodInsn(INVOKESTATIC, &#34;ivonhoe/dexguard/java/Exist&#34;, &#34;a&#34;, &#34;()Z&#34;, false);&#10;                        mv.visitMethodInsn(INVOKESTATIC, &#34;ivonhoe/dexguard/java/Exist&#34;, &#34;b&#34;, &#34;(I)V&#34;, false);&#10;                    &#125;&#10;                    super.visitCode()&#10;                &#125;&#10;&#10;                @Override&#10;                public void visitMaxs(int maxStack, int maxLocal) &#123;&#10;                    if (name.equals(methodName)) &#123;&#10;                        super.visitMaxs(maxStack + 1, maxLocal);&#10;                    &#125; else &#123;&#10;                        super.visitMaxs(maxStack, maxLocal);&#10;                    &#125;&#10;                &#125;&#10;            &#125;&#10;            return mv;&#10;        &#125;&#10;    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="å…­ã€æ€»ç»“">å…­ã€æ€»ç»“</h3><p>çœ‹åˆ°è¿™é‡Œå¯èƒ½ä½ ä¼šæœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆæœ‰è¯­æ³•é”™è¯¯çš„ä»£ç ï¼Œåœ¨è¿è¡Œæ—¶ä¸ä¼šå‡ºé”™ï¼Œä¸ªäººç†è§£ä¸å•å•æ˜¯å› ä¸ºboolç±»å‹åœ¨å†…å­˜ä¸­æ˜¯ä»¥<code>0æˆ–1</code>è¡¨ç¤ºï¼Œä¹Ÿå› ä¸º<code>int</code>å’Œ<code>bool</code>åœ¨Androidè™šæ‹Ÿæœºä¸­éƒ½å­˜å‚¨åœ¨32ä½å¯„å­˜å™¨ä¸­ï¼Œå¦‚æœä½¿ç”¨<code>int</code>å’Œ<code>long</code>ç±»å‹çš„å‚æ•°äº’æ¢ï¼Œåœ¨dxé˜¶æ®µçš„ç¼–è¯‘å°±ä¼šæŠ¥é”™ã€‚ä¸‹é¢æ˜¯æ’ä»¶æºç ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å°è¯•ä¸€ä¸‹~</p>
<h4 id="æ’ä»¶æºç ">æ’ä»¶æºç </h4><p>è¯¦ç»†çš„Gradleæºç å’Œå®ä¾‹å¯å‚è€ƒ<a href="https://github.com/Ivonhoe/dexguard" target="_blank" rel="external">https://github.com/Ivonhoe/dexguard</a></p>
<h4 id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</h4><ul>
<li>åœ¨root projectçš„build.gradleä¸­æ·»åŠ ä¾èµ–<code>classpath &#39;ivonhoe.gradle.dexguard:dexguard-gradle:0.0.2-SNAPSHOT&#39;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;&#10;    repositories &#123;&#10;        maven &#123; url &#39;https://raw.githubusercontent.com/Ivonhoe/mvn-repo/master/&#39; &#125;&#10;        mavenCentral()&#10;    &#125;&#10;    dependencies &#123;&#10;        classpath &#39;com.android.tools.build:gradle:2.3.0&#39;&#10;        classpath &#39;ivonhoe.gradle.dexguard:dexguard-gradle:0.0.2-SNAPSHOT&#39;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨appé¡¹ç›®çš„build.gradleä¸­æ·»åŠ æ’ä»¶ï¼Œmap.txtä¸­é…ç½®éœ€è¦ä¿æŠ¤çš„æ–¹æ³•å</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &#39;ivonhoe.dexguard&#39;&#10;dexguard &#123;&#10;    guardConfig = &#34;$&#123;rootDir&#125;/map.txt&#34;&#10;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ƒã€å‚è€ƒæ–‡æ¡£">ä¸ƒã€å‚è€ƒæ–‡æ¡£</h3><ul>
<li><a href="https://sourceforge.net/p/dex2jar/tickets/238/" target="_blank" rel="external">#238 java.lang.RuntimeException: can not merge I and Z</a></li>
<li><a href="http://www.jianshu.com/p/730c6e3e21f6" target="_blank" rel="external">Smaliè¯­æ³•</a></li>
<li><a href="http://blog.csdn.net/sbsujjbcy/article/details/50839263" target="_blank" rel="external">Android çƒ­ä¿®å¤ä½¿ç”¨Gradle Plugin1.5æ”¹é€ Nuwaæ’ä»¶</a></li>
<li><a href="http://www.wangyuwei.me/2017/01/20/ASM-%E6%93%8D%E4%BD%9C%E5%AD%97%E8%8A%82%E7%A0%81%E5%88%9D%E6%8E%A2/" target="_blank" rel="external">ASM-æ“ä½œå­—èŠ‚ç åˆæ¢</a></li>
<li><a href="https://www.diycode.cc/topics/581" target="_blank" rel="external">æ‰‹æ‘¸æ‰‹å¢åŠ å­—èŠ‚ç å¾€æ–¹æ³•ä½“å†…æ’ä»£ç </a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä¸€ã€åç¼–è¯‘æŸå¹³å°ä»£ç &quot;&gt;ä¸€ã€åç¼–è¯‘æŸå¹³å°ä»£ç &lt;/h3&gt;&lt;p&gt;æœ€è¿‘åœ¨çœ‹æŸå¤–å–å¹³å°çš„ä»£ç ï¼Œå‘ç°æŸå¤–å–å¹³å°æœ€æ–°ç‰ˆæœ¬ç‰ˆæœ¬æ— æ³•æ­£å¸¸çš„é€šè¿‡dex2jarå·¥å…·å°†dexè½¬æ¢å‡ºJavaæºä»£ç ï¼Œåœ¨è½¬æ¢è¿‡ç¨‹ä¸­ä¼šæç¤ºå‡ºé”™ï¼Œå¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://ivonhoe.github.io/res/dex2jar_error/dex2jar_error1.png&quot; alt=&quot;dex2jarå¼‚å¸¸å›¾&quot;&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹è½¬æ¢å‡ºçš„Javaæºä»£ç ï¼Œä¼šå‘ç°å¾ˆå¤šç±»æ–¹æ³•æç¤ºä¸‹å›¾æ‰€ç¤ºå¼‚å¸¸ï¼Œå¾ˆå¤šæ–¹æ³•ä¸­éƒ½ä¼šæŠ›å‡º&lt;code&gt;RuntimeExceptionï¼šcan not merge I and Z&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public class AsyncTaskService extends IntentService &amp;#123; &amp;#10;  &amp;#10;  protected void onHandleIntent(Intent paramIntent)&amp;#123;&amp;#10;    throw new RuntimeException(&amp;#34;d2j fail translate: java.lang.RuntimeException: can not merge I and Z\n\tat...);&amp;#10;  &amp;#125;&amp;#10;  &amp;#10;  public int onStartCommand(Intent paramIntent, int paramInt1, int paramInt2)&amp;#123;&amp;#10;    throw new RuntimeException(&amp;#34;d2j fail translate: java.lang.RuntimeException: can not merge I and Z\n\tat...&amp;#34;);&amp;#10;  &amp;#125;&amp;#10;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Gradle" scheme="https://ivonhoe.github.io/tags/Gradle/"/>
    
      <category term="dex2jar" scheme="https://ivonhoe.github.io/tags/dex2jar/"/>
    
      <category term="ç§»åŠ¨å®‰å…¨" scheme="https://ivonhoe.github.io/tags/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>Androidå®‰å…¨ä¹‹---APPå»å¹¿å‘Š</title>
    <link href="https://ivonhoe.github.io/2017/02/04/Android%E5%AE%89%E5%85%A8%E4%B9%8B---APP%E5%8E%BB%E5%B9%BF%E5%91%8A/"/>
    <id>https://ivonhoe.github.io/2017/02/04/Androidå®‰å…¨ä¹‹---APPå»å¹¿å‘Š/</id>
    <published>2017-02-04T05:27:20.000Z</published>
    <updated>2017-03-09T03:38:26.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€å·¥å…·ä»‹ç»">ä¸€ã€å·¥å…·ä»‹ç»</h3><ul>
<li><strong>apktoolï¼š</strong>googleæä¾›Android apkç¼–è¯‘ä¸åç¼–è¯‘å·¥å…·ï¼Œ<a href="https://ibotpeaches.github.io/Apktool/" target="_blank" rel="external">https://ibotpeaches.github.io/Apktool/</a></li>
<li><strong>dex2jarï¼š</strong>dexæ–‡ä»¶è½¬jaræ–‡ä»¶å·¥å…·ï¼Œ<a href="https://github.com/pxb1988/dex2jar" target="_blank" rel="external">https://github.com/pxb1988/dex2jar</a></li>
<li><strong>jd-guiï¼š</strong>æŸ¥çœ‹jaræ–‡ä»¶ï¼Œ<a href="http://jd.benow.ca/" target="_blank" rel="external">http://jd.benow.ca/</a></li>
<li><strong>keytoolï¼š</strong>åˆ¶ä½œå’Œç®¡ç†æ•°å­—è¯ä¹¦</li>
<li><strong>jarsignerï¼š</strong>ä½¿ç”¨æ•°å­—è¯ä¹¦å¯¹jarå’Œapkè¿›è¡Œç­¾å</li>
<li><strong>Android killerï¼š</strong>Windowç³»ç»Ÿä¸­ï¼Œä¸Šè¿°å·¥å…·çš„é›†æˆå·¥å…·</li>
</ul>
<p>æ›´å¤šåç¼–è¯‘å·¥å…·å¯æŸ¥çœ‹ï¼š<a href="http://unclechen.github.io/2016/09/07/Android%E5%8F%8D%E7%BC%96%E8%AF%91%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/" target="_blank" rel="external">Uncle Chenâ€”Androidåç¼–è¯‘æŠ€æœ¯æ€»ç»“</a></p>
<h3 id="äºŒã€å»é™¤åº”ç”¨å¼€å‘åŠ©æ‰‹çš„å¹¿å‘Š">äºŒã€å»é™¤åº”ç”¨å¼€å‘åŠ©æ‰‹çš„å¹¿å‘Š</h3><p>CodeKKå…¬ä¼—å·åœ¨17å¹´åˆæ¨å‡ºäº†ä¸€ä¸ª<a href="https://mp.weixin.qq.com/s?__biz=MzAxNjI3MDkzOQ==&amp;mid=2654472664&amp;idx=1&amp;sn=dfc2b5beb90daa8fd068d8064ce0dcce&amp;chksm=803bfaecb74c73fa9a9addfd4d8bce031186c34b7d7b59ee22df41799c7eaa71a34863890f56&amp;mpshare=1&amp;scene=1&amp;srcid=0220tEQNaL7PwIgfBT8sIITK&amp;key=776fc8cdd0b88c0d0b9a6c8e271e4cfe2b2363aeda110198d4250b0a422befd0f43f78e2a17d528112f757336e136c56f488bc174baa56c116045a9bdbb37dbccf508eb8c70e48a2d09ca1da1b4d92d3&amp;ascene=0&amp;uin=MTMzNzYxMDM2MQ%3D%3D&amp;devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12.1+build(16B2555" target="_blank" rel="external">åº”ç”¨å¼€å‘åŠ©æ‰‹</a>)ã€‚V1.0ç‰ˆæœ¬æ˜¯æœ‰å¹¿å‘Šç‰ˆæœ¬çš„ï¼Œä¸‹é¢ä»¥è¿™ä¸ªç‰ˆæœ¬ä¸ºä¾‹ï¼Œç®€å•çœ‹ä¸‹å»å¹¿å‘Šè¿‡ç¨‹ã€‚å®ƒçš„åç»­çš„V1.1.0å’ŒV1.2.0å·²ç»å»é™¤äº†å¹¿å‘ŠåŠŸèƒ½ã€‚</p>
<a id="more"></a>
<h4 id="2-1ã€åç¼–è¯‘">2.1ã€åç¼–è¯‘</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool.sh d -f ./dev-tools.apk</span><br></pre></td></tr></table></figure>
<p><img src="/res/dev-tool/dev-tool1.png" alt=""><br><img src="/res/dev-tool/dev-tool2.png" alt=""></p>
<h4 id="2-2ã€æ³¨é‡Šå¹¿å‘Šä»£ç ">2.2ã€æ³¨é‡Šå¹¿å‘Šä»£ç </h4><p>è¿™é‡Œå¯ä»¥å…ˆç”¨dex2jarè½¬jaråæŸ¥çœ‹ä¸‹æºç ï¼Œä¼šå‘ç°ä½¿ç”¨çš„æ˜¯Google AdMobä½œä¸ºå¹¿å‘Šå¹³å°ï¼Œç®€å•çœ‹ä¸‹ä»£ç å¯ä»¥å‘ç°åœ¨ä¸»é¡µé¢activty_main.xmlä¸­åŒ…å«å¹¿å‘Šè§†å›¾çš„å¸ƒå±€æ–‡ä»¶ã€‚æ‰€ä»¥åªéœ€è¦æ‰¾åˆ°<code>ad_layout.xml</code>å°†å…¶<code>android:visibility=&quot;gone&quot;</code>å±æ€§è®¾ç½®æˆ<code>gone</code>å°±å¯ä»¥äº†ã€‚</p>
<p><img src="/res/dev-tool/dev-tool3.png" alt=""></p>
<h4 id="2-3ã€é‡æ‰“åŒ…">2.3ã€é‡æ‰“åŒ…</h4><p>è¿™é‡Œé‡æ‰“åŒ…çš„è¿‡ç¨‹å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é”™è¯¯ï¼Œä¸è¿‡è®¤çœŸæŸ¥çœ‹æ—¥å¿—å¹¶ç»“åˆGoogleéƒ½æ˜¯å¯ä»¥æ‰¾åˆ°è§£å†³æ–¹æ¡ˆçš„ï¼Œè¿™é‡Œæš‚ä¸”ä¸è¡¨ã€‚ä½¿ç”¨apktool bå‘½ä»¤ï¼Œç”Ÿæˆçš„apké»˜è®¤è·¯å¾„ä¸º<code>/dist</code>è·¯å¾„ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool.sh b ./dev-tools</span><br></pre></td></tr></table></figure>
<p><img src="/res/dev-tool/dev-tool4.png" alt=""></p>
<h4 id="2-4ã€åˆ¶ä½œä¸€ä¸ªåä¸ºhackapk-keystoreçš„è¯ä¹¦,å¹¶é‡æ–°ç­¾ååº”ç”¨">2.4ã€åˆ¶ä½œä¸€ä¸ªåä¸ºhackapk.keystoreçš„è¯ä¹¦,å¹¶é‡æ–°ç­¾ååº”ç”¨</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#21046;&#20316;&#35777;&#20070;&#65306;&#10;keytool -genkey -keystore hackapk.keystore -keyalg RSA -validity 10000 -alias hackapk&#10;&#10;&#31614;&#21517;&#65306;&#10;jarsigner -verbose -keystore hackapk.keystore -signedjar dev-tools-no-ads.apk ./dev-tools/dist/dev-tools.apk hackapk</span><br></pre></td></tr></table></figure>
<p><img src="/res/dev-tool/dev-tool5.png" alt=""></p>
<p>è¯¦ç»†çš„å‚æ•°å¯ä»¥å‚è€ƒï¼š<br><a href="http://www.tttabc.com/android/keytool-keystore-jarsigner-apk.htm" target="_blank" rel="external">APKç­¾åä¹‹keytoolç”Ÿæˆkeystoreå’Œjarsignerç­¾åapk</a></p>
<h4 id="2-5ã€å®‰è£…">2.5ã€å®‰è£…</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb install -r dev-tools-no-ads.apk</span><br></pre></td></tr></table></figure>
<p><img src="/res/dev-tool/dev-tool6.png" alt=""></p>
<p><img src="/res/dev-tool/dev-tool11.png" alt="æœ‰å¹¿å‘Šç‰ˆæœ¬"></p>
<p><img src="/res/dev-tool/dev-tool10.png" alt="æ— å¹¿å‘Šç‰ˆæœ¬"></p>
<h4 id="2-6ã€ä¸‹è½½å»å¹¿å‘Šç‰ˆæœ¬çš„åº”ç”¨å¼€å‘åŠ©æ‰‹">2.6ã€ä¸‹è½½å»å¹¿å‘Šç‰ˆæœ¬çš„åº”ç”¨å¼€å‘åŠ©æ‰‹</h4><p><img src="/res/dev-tool/dev-tool7.png" alt=""></p>
<h3 id="ä¸‰ã€åç¼–è¯‘è„šæœ¬">ä¸‰ã€åç¼–è¯‘è„šæœ¬</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh&#10;workDir=./&#10;if [ &#34;$2&#34; ]&#10;then&#10;         mkdir $2&#10;         workDir=./$2/&#10;fi&#10;&#10;echo $workDir&#10;name=`basename $1 .apk`&#10;zipPath=$workDir$name.zip&#10;&#10;##apkTool&#21453;&#32534;&#35793;&#10;smaliDir=$workDir$name@smali&#10;apktool.sh d -f $1 -o $smaliDir&#10;&#10;## &#35299;&#21387;&#32553;&#65292;&#20351;&#29992;dex2jar&#22788;&#29702;&#10;unzipDir=$workDir$name@unzip&#10;cp $1 $zipPath&#10;unzip $zipPath -d $unzipDir&#10;&#10;d2j-dex2jar.sh -f $unzipDir/classes.dex -o $&#123;workDir&#125;dex2jar.jar&#10;d2j-dex2jar.sh -f $unzipDir/classes2.dex -o $&#123;workDir&#125;dex2jar2.jar&#10;d2j-dex2jar.sh -f $unzipDir/classes3.dex -o $&#123;workDir&#125;dex2jar3.jar&#10;open $workDir</span><br></pre></td></tr></table></figure>
<p>å°†ä¸Šè¿°å†…å®¹ä¿å­˜åˆ°æœ¬åœ°<code>hack.sh</code>æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°±ä¼šæŠŠapktoolå’Œdex2jarçš„ç»“æœè¾“å‡ºåˆ°<code>meipu</code>è¿™ä¸ªç›®å½•ä¸­ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¯æ¬¡æ”¶åˆ°æ•²å‘½ä»¤å–½ï¼Œåªè¦çŸ¥é“éœ€è¦åç¼–è¯‘çš„apkå’Œè¾“å‡ºçš„æ–‡ä»¶å¤¹åç§°å°±å¯ä»¥~</p>
<p><code>./hack.sh ./ç¾é“º_1487845975713.apk meipu</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä¸€ã€å·¥å…·ä»‹ç»&quot;&gt;ä¸€ã€å·¥å…·ä»‹ç»&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;apktoolï¼š&lt;/strong&gt;googleæä¾›Android apkç¼–è¯‘ä¸åç¼–è¯‘å·¥å…·ï¼Œ&lt;a href=&quot;https://ibotpeaches.github.io/Apktool/&quot;&gt;https://ibotpeaches.github.io/Apktool/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;dex2jarï¼š&lt;/strong&gt;dexæ–‡ä»¶è½¬jaræ–‡ä»¶å·¥å…·ï¼Œ&lt;a href=&quot;https://github.com/pxb1988/dex2jar&quot;&gt;https://github.com/pxb1988/dex2jar&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;jd-guiï¼š&lt;/strong&gt;æŸ¥çœ‹jaræ–‡ä»¶ï¼Œ&lt;a href=&quot;http://jd.benow.ca/&quot;&gt;http://jd.benow.ca/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;keytoolï¼š&lt;/strong&gt;åˆ¶ä½œå’Œç®¡ç†æ•°å­—è¯ä¹¦&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;jarsignerï¼š&lt;/strong&gt;ä½¿ç”¨æ•°å­—è¯ä¹¦å¯¹jarå’Œapkè¿›è¡Œç­¾å&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Android killerï¼š&lt;/strong&gt;Windowç³»ç»Ÿä¸­ï¼Œä¸Šè¿°å·¥å…·çš„é›†æˆå·¥å…·&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ›´å¤šåç¼–è¯‘å·¥å…·å¯æŸ¥çœ‹ï¼š&lt;a href=&quot;http://unclechen.github.io/2016/09/07/Android%E5%8F%8D%E7%BC%96%E8%AF%91%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/&quot;&gt;Uncle Chenâ€”Androidåç¼–è¯‘æŠ€æœ¯æ€»ç»“&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;äºŒã€å»é™¤åº”ç”¨å¼€å‘åŠ©æ‰‹çš„å¹¿å‘Š&quot;&gt;äºŒã€å»é™¤åº”ç”¨å¼€å‘åŠ©æ‰‹çš„å¹¿å‘Š&lt;/h3&gt;&lt;p&gt;CodeKKå…¬ä¼—å·åœ¨17å¹´åˆæ¨å‡ºäº†ä¸€ä¸ª&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzAxNjI3MDkzOQ==&amp;amp;mid=2654472664&amp;amp;idx=1&amp;amp;sn=dfc2b5beb90daa8fd068d8064ce0dcce&amp;amp;chksm=803bfaecb74c73fa9a9addfd4d8bce031186c34b7d7b59ee22df41799c7eaa71a34863890f56&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=0220tEQNaL7PwIgfBT8sIITK&amp;amp;key=776fc8cdd0b88c0d0b9a6c8e271e4cfe2b2363aeda110198d4250b0a422befd0f43f78e2a17d528112f757336e136c56f488bc174baa56c116045a9bdbb37dbccf508eb8c70e48a2d09ca1da1b4d92d3&amp;amp;ascene=0&amp;amp;uin=MTMzNzYxMDM2MQ%3D%3D&amp;amp;devicetype=iMac+MacBookPro11%2C4+OSX+OSX+10.12.1+build(16B2555&quot;&gt;åº”ç”¨å¼€å‘åŠ©æ‰‹&lt;/a&gt;)ã€‚V1.0ç‰ˆæœ¬æ˜¯æœ‰å¹¿å‘Šç‰ˆæœ¬çš„ï¼Œä¸‹é¢ä»¥è¿™ä¸ªç‰ˆæœ¬ä¸ºä¾‹ï¼Œç®€å•çœ‹ä¸‹å»å¹¿å‘Šè¿‡ç¨‹ã€‚å®ƒçš„åç»­çš„V1.1.0å’ŒV1.2.0å·²ç»å»é™¤äº†å¹¿å‘ŠåŠŸèƒ½ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Android" scheme="https://ivonhoe.github.io/tags/Android/"/>
    
      <category term="å»å¹¿å‘Š" scheme="https://ivonhoe.github.io/tags/%E5%8E%BB%E5%B9%BF%E5%91%8A/"/>
    
      <category term="ç§»åŠ¨å®‰å…¨" scheme="https://ivonhoe.github.io/tags/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>Mac OSä¸Šç¼–è¯‘Androidæºç </title>
    <link href="https://ivonhoe.github.io/2017/01/20/MacOS%E4%B8%8A%E7%BC%96%E8%AF%91Android%E6%BA%90%E7%A0%81/"/>
    <id>https://ivonhoe.github.io/2017/01/20/MacOSä¸Šç¼–è¯‘Androidæºç /</id>
    <published>2017-01-20T14:16:46.000Z</published>
    <updated>2017-02-21T10:03:13.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€åˆ¶ä½œä¸€ä¸ªå¤§å°å†™æ•æ„Ÿçš„ç£ç›˜åˆ†åŒº">ä¸€ã€åˆ¶ä½œä¸€ä¸ªå¤§å°å†™æ•æ„Ÿçš„ç£ç›˜åˆ†åŒº</h3><h4 id="1-1-Mac_OSç£ç›˜å·¥å…·">1.1.Mac OSç£ç›˜å·¥å…·</h4><p>è¿™é‡Œæˆ‘ä½¿ç”¨ä¸€å—ç§»åŠ¨ç¡¬ç›˜ï¼Œå°†ç§»åŠ¨ç¡¬ç›˜çš„ä¸€ä¸ªåˆ†åŒºä½¿ç”¨Mac OSçš„ç¡¬ç›˜å·¥å…·ï¼ŒæŠ¹æ‰æ•°æ®ï¼Œé€‰æ‹©MacOSæ‰©å±•(åŒºåˆ†å¤§å°å†™ï¼Œæ—¥å¿—å¼)ï¼Œåˆ›å»ºæˆå¤§å°å†™æ•æ„Ÿçš„åˆ†åŒºã€‚</p>
<p><img src="/res/compile_android_source/android-source-disk1.jpeg" alt=""></p>
<p>è¿™é‡Œä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼ŒæŠ¹æ‰åˆ†åŒºæ•°æ®çš„æ—¶å€™ï¼Œ<code>ä¼šæŠ¥é”™ï¼šâ€œMac OSX æŠ¹ç›˜å‘ç”Ÿé”™è¯¯:Mediakit æŠ¥å‘Šè®¾å¤‡ä¸Šç©ºé—´ä¸è¶³ä»¥æ‰§è¡Œæ­¤æ“ä½œâ€</code>ï¼Œè¿™é‡Œçš„åŸå› æ˜¯ç£ç›˜æ²¡æœ‰å¤§äº200Mçš„UEFIåˆ†åŒºã€‚</p>
<a id="more"></a>
<h4 id="1-2-åˆ¶ä½œUEFIåˆ†åŒº">1.2.åˆ¶ä½œUEFIåˆ†åŒº</h4><blockquote>
<p>æˆ‘æ˜¯åœ¨windowsä¸Šæ“ä½œçš„ï¼Œ<br>ä½¿ç”¨DiskGeniuså·¥å…·ï¼Œåœ¨ç§»åŠ¨ç¡¬ç›˜çš„ç¬¬ä¸€åˆ†åŒºå‰éƒ¨ï¼Œåˆ’åˆ†å‡º200MBçš„ç©ºé—´ã€‚<br>åœ¨cmdå‘½ä»¤è¡Œä¸‹è¿è¡Œä¸‹åˆ—å‘½ä»¤,è®°å¾—åˆ†æ­¥æ‰§è¡Œå•Šï¼Œå°å¿ƒå‡ºé”™ï¼Œæ•°æ®æ— ä»·ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diskpart&#10;list disk&#10;select disk 1 ###&#36825;&#37324;&#36873;&#20013;&#35201;&#20998;&#21306;&#30340;&#30913;&#30424;&#65292;&#22240;&#20026;&#25105;&#26159;&#31227;&#21160;&#30828;&#30424;&#65292;index&#26159;1&#65292;&#36825;&#37324;&#24212;&#35813;&#20250;&#30475;&#21040;&#36873;&#25321;&#20809;&#26631;&#19981;&#35201;&#36873;&#38169;&#20102;&#10;&#10;create partition efi size=200</span><br></pre></td></tr></table></figure>
<p>è¯¦ç»†çš„å›¾æ–‡è¯·å‚è€ƒ:</p>
<p><a href="https://blog.zzzmode.com/2016/05/02/osx-mediakit-reports-partition-map-too-small/" target="_blank" rel="external">Mac OSX æŠ¹ç›˜å‘ç”Ÿé”™è¯¯:Mediakit æŠ¥å‘Šè®¾å¤‡ä¸Šç©ºé—´ä¸è¶³ä»¥æ‰§è¡Œæ­¤æ“ä½œçš„è§£å†³åŠæ³•
</a></p>
<h3 id="äºŒã€ä¸‹è½½Androidæºç ">äºŒã€ä¸‹è½½Androidæºç </h3><h4 id="2-1-repo_sync_å‡ºé”™">2.1.repo sync å‡ºé”™</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error: RPC failed; result=56, HTTP code = 200&#60;br&#62;&#10;fatal: The remote end hung up unexpectedly&#60;br&#62;&#10;fatal: early EOF&#60;br&#62;&#10;fatal: index-pack failed</span><br></pre></td></tr></table></figure>
<p>repo syncæ—¶ä¼šå‡ºç°å¦‚ä¸Šé”™è¯¯ï¼Œå®‰è£…<code>gnutls</code>å’Œ<code>wget</code>å,<br>å¹¶å‚è€ƒ<a href="http://stackoverflow.com/questions/6842687/the-remote-end-hung-up-unexpectedly-while-git-cloning" target="_blank" rel="external">stackoverflow</a>è§£å†³ã€‚</p>
<h4 id="2-2-å¦‚ä½•é€‰æ‹©é©±åŠ¨">2.2.å¦‚ä½•é€‰æ‹©é©±åŠ¨</h4><p><a href="https://source.android.com/source/build-numbers.html#source-code-tags-and-builds" target="_blank" rel="external">Source Code Tags and Builds</a></p>
<p><img src="/res/compile_android_source/android-source2.jpeg" alt=""></p>
<p><a href="https://developers.google.com/android/drivers" target="_blank" rel="external">AndroidåŸç”Ÿè®¾å¤‡é©±åŠ¨</a><br><img src="/res/compile_android_source/android-source3.jpeg" alt=""></p>
<p>è¯¦ç»†çš„å›¾æ–‡è¯·å‚è€ƒ:</p>
<p><a href="http://wl9739.github.io/2016/05/09/Android%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%8B%E8%BD%BD%E3%80%81%E7%BC%96%E8%AF%91%E4%B8%8E%E5%AF%BC%E5%85%A5%E5%88%B0Android-Studio/" target="_blank" rel="external">Androidæºç çš„ä¸‹è½½ã€ç¼–è¯‘ä¸å¯¼å…¥åˆ°Android Studio</a></p>
<p><a href="http://www.jianshu.com/p/1c3d47b2031f" target="_blank" rel="external">Mac OS Xä¸‹ç¼–è¯‘Android Mæºç </a></p>
<h3 id="ä¸‰ã€ç¼–è¯‘">ä¸‰ã€ç¼–è¯‘</h3><p><code>ä¸€å®šè¦ä¸‹è½½å¹¶å®‰è£…é©±åŠ¨ï¼Œä¸‹è½½nexus5 6.0.1_r17ç‰ˆæœ¬ä¸ºä¾‹ï¼Œéœ€è¦ä¸‹è½½æ‰§è¡Œä¸‹å›¾ä¸‰ä¸ªsh</code></p>
<p><img src="/res/compile_android_source/android-source4.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$chmod a+x ./*****.sh&#10;$./*****.sh&#10;&#10;&#36755;&#20837;I ACCEPT&#23436;&#25104;&#23433;&#35013;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$source build/envsetup.sh&#10;&#10;$lunch&#10;&#10;$make -j16</span><br></pre></td></tr></table></figure>
<h3 id="å››ã€å¦‚ä½•å°†ç¼–è¯‘å¥½çš„Android_imgåˆ·å…¥æ¨¡æ‹Ÿå™¨">å››ã€å¦‚ä½•å°†ç¼–è¯‘å¥½çš„Android imgåˆ·å…¥æ¨¡æ‹Ÿå™¨</h3><p>éœ€è¦è®¾ç½®<code>ANDROID_PRODUCT_OUT</code>å˜é‡åˆ°<code>~/.bash_profile</code>æ–‡ä»¶ä¸­</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#Android &#28304;&#30721;&#32534;&#35793;&#30446;&#24405;&#10;export PATH=$PATH:/Volumes/AOSP/android-6.0.1_r17-x86_64/out/host/darwin-x86/bin&#10;export ANDROID_PRODUCT_OUT=/Volumes/AOSP/android-6.0.1_r17-x86_64/out/target/product/generic_x86_64&#10;export PATH=$PATH:$ANDROID_PRODUCT_OUT</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨å‘½ä»¤å¯åŠ¨emulatorï¼ŒåŠ è½½æŒ‡å®šçš„kernelå†…æ ¸å’Œimg</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kans-MacBook-Pro:android-6.0.1_r17-x86_64 Ivonhoe$&#10;emulator -kernel  /Volumes/AOSP/android-6.0.1_r17-x86_64/prebuilts/qemu-kernel/x86_64/kernel-qemu -sysdir ./out/target/product/generic_x86_64/ -system /Volumes/AOSP/android-6.0.1_r17-x86_64/out/target/product/generic_x86_64/system.img -data /Volumes/AOSP/android-6.0.1_r17-x86_64/out/target/product/generic_x86_64/userdata.img -ramdisk /Volumes/AOSP/android-6.0.1_r17-x86_64/out/target/product/generic_x86_64/ramdisk.img</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒè€ç½—çš„åšå®¢<a href="http://blog.csdn.net/luoshengyang/article/details/6559955" target="_blank" rel="external">åœ¨Ubuntuä¸Šä¸‹è½½ã€ç¼–è¯‘å’Œå®‰è£…Androidæœ€æ–°æºä»£ç </a></p>
<h3 id="äº”ã€åˆ·å…¥Nexus6çœŸæœº">äº”ã€åˆ·å…¥Nexus6çœŸæœº</h3><p>Nexus6å…³æœºçŠ¶æ€ä¸‹,é•¿æŒ‰éŸ³é‡ä¸‹+ç”µæº,è¿›å…¥recoveryæ¨¡å¼</p>
<p>ç„¶ååœ¨æºç æ ¹ç›®å½•ä¸‹(Androidæ ¹ç›®å½•ä¸‹)æ‰§è¡Œä¸‹é¢å‘½ä»¤:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastboot -w flashall</span><br></pre></td></tr></table></figure>
<p><img src="/res/compile_android_source/android-source5.png" alt=""></p>
<p>ä½¿ç”¨<code>mmm framework/base</code>å•ç‹¬ç¼–è¯‘frameworkä»£ç </p>
<p>adb pushå¯èƒ½ä¼šæç¤º <code>Read-only file system</code></p>
<p><code>failed to copy &#39;out/target/product/shamu/system/framework/framework.jar&#39;
 to &#39;/system/framework/framework.jar&#39;: Read-only file system</code></p>
<p>é€šè¿‡ä¸‹åˆ—å‘½ä»¤è§£å†³ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb root&#10;adb remount&#10;adb disable-verity&#10;adb reboot&#10;adb root&#10;adb remount</span><br></pre></td></tr></table></figure>
<h3 id="å…­ã€å‚è€ƒæ–‡æ¡£">å…­ã€å‚è€ƒæ–‡æ¡£</h3><p><a href="http://blog.csdn.net/ljphhj/article/details/51512263" target="_blank" rel="external">Androidç³»ç»Ÿæºç ä¸‹è½½ä¸ç¼–è¯‘ã€åˆ·æœºâ€“Nexus6å®æµ‹</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä¸€ã€åˆ¶ä½œä¸€ä¸ªå¤§å°å†™æ•æ„Ÿçš„ç£ç›˜åˆ†åŒº&quot;&gt;ä¸€ã€åˆ¶ä½œä¸€ä¸ªå¤§å°å†™æ•æ„Ÿçš„ç£ç›˜åˆ†åŒº&lt;/h3&gt;&lt;h4 id=&quot;1-1-Mac_OSç£ç›˜å·¥å…·&quot;&gt;1.1.Mac OSç£ç›˜å·¥å…·&lt;/h4&gt;&lt;p&gt;è¿™é‡Œæˆ‘ä½¿ç”¨ä¸€å—ç§»åŠ¨ç¡¬ç›˜ï¼Œå°†ç§»åŠ¨ç¡¬ç›˜çš„ä¸€ä¸ªåˆ†åŒºä½¿ç”¨Mac OSçš„ç¡¬ç›˜å·¥å…·ï¼ŒæŠ¹æ‰æ•°æ®ï¼Œé€‰æ‹©MacOSæ‰©å±•(åŒºåˆ†å¤§å°å†™ï¼Œæ—¥å¿—å¼)ï¼Œåˆ›å»ºæˆå¤§å°å†™æ•æ„Ÿçš„åˆ†åŒºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/res/compile_android_source/android-source-disk1.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼ŒæŠ¹æ‰åˆ†åŒºæ•°æ®çš„æ—¶å€™ï¼Œ&lt;code&gt;ä¼šæŠ¥é”™ï¼šâ€œMac OSX æŠ¹ç›˜å‘ç”Ÿé”™è¯¯:Mediakit æŠ¥å‘Šè®¾å¤‡ä¸Šç©ºé—´ä¸è¶³ä»¥æ‰§è¡Œæ­¤æ“ä½œâ€&lt;/code&gt;ï¼Œè¿™é‡Œçš„åŸå› æ˜¯ç£ç›˜æ²¡æœ‰å¤§äº200Mçš„UEFIåˆ†åŒºã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æºç ç¼–è¯‘" scheme="https://ivonhoe.github.io/tags/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>Mac/Linuxä¸‹gccç¼–è¯‘åŠ¨æ€é“¾æ¥åº“[.soæ–‡ä»¶]</title>
    <link href="https://ivonhoe.github.io/2016/12/16/Mac-Linux%E4%B8%8Bgcc%E7%BC%96%E8%AF%91%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93-so%E6%96%87%E4%BB%B6/"/>
    <id>https://ivonhoe.github.io/2016/12/16/Mac-Linuxä¸‹gccç¼–è¯‘åŠ¨æ€é“¾æ¥åº“-soæ–‡ä»¶/</id>
    <published>2016-12-16T05:47:55.000Z</published>
    <updated>2017-02-09T10:03:54.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€ä»¥bsdiff-cå’Œbspatch-cä¸ºä¾‹ç¼–è¯‘bsdiff-so">ä¸€ã€ä»¥bsdiff.cå’Œbspatch.cä¸ºä¾‹ç¼–è¯‘bsdiff.so</h2><p>bsdiff.cå’Œbspatch.cåˆ†åˆ«ä¾èµ–bzip2</p>
<h3 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h3><h3 id="æ­¥éª¤">æ­¥éª¤</h3><ul>
<li><p>ä½¿ç”¨BsDiff.javaç”ŸæˆBsDiff.classæ–‡ä»¶</p>
<p><strong>javac</strong> ivonhoe/spring/wrcenter/jni/BsDiff.java</p>
</li>
<li><p>ç”ŸæˆBsDiff.hæ–‡ä»¶</p>
<p><strong>javah</strong> ivonhoe.spring.wrcenter.jni.BsDiff </p>
</li>
<li><p>ç”Ÿæˆbspatch.o</p>
<a id="more"></a>
<p><strong>gcc -fPIC -D_REENTRANT</strong> -I<strong>JAVA_INCLUDE1</strong> -I/JAVA_INCLUDE2/ -I/Users/Ivonhoe/Downloads/VelocityDemo/src/main/java/jni/bzip2 -I/Users/Ivonhoe/Downloads/VelocityDemo/src/main/java/jni -c ./jni/bspatch.c</p>
</li>
<li><p>ç”Ÿæˆbsdiff.o</p>
<p><strong>gcc -fPIC -D_REENTRANT</strong> -I/Library/Java/JavaVirtualMachines/jdk1.8.0_60.jdk/Contents/Home/include -I/Library/Java/JavaVirtualMachines/jdk1.8.0_60.jdk/Contents/Home/include/darwin -I/Users/Ivonhoe/Downloads/VelocityDemo/src/main/java/jni/bzip2 -I/Users/Ivonhoe/Downloads/VelocityDemo/src/main/java/jni -c ./jni/bsdiff.c</p>
</li>
<li><p>å°†bzip2ä¸‹çš„cæ–‡ä»¶ç”Ÿæˆç›¸åº”çš„.oæ–‡ä»¶</p>
<p><strong>gcc -fPIC -D_REENTRANT</strong> -I/Library/Java/JavaVirtualMachines/jdk1.8.0_60.jdk/Contents/Home/include -I/Library/Java/JavaVirtualMachines/jdk1.8.0_60.jdk/Contents/Home/include/darwin -I/Users/Ivonhoe/Downloads/VelocityDemo/src/main/java/jni/bzip2 -c ./jni/bzip2/*.c</p>
</li>
<li><p>ç”Ÿæˆsoæ–‡ä»¶</p>
<p><strong>gcc *.o -o bsdiff.so -shared  -v</strong></p>
</li>
</ul>
<ul>
<li>æ³¨:</li>
</ul>
<p>  JAVA_INCLUDE1:/usr/local/java/jdk1.7.0_40/include<br>  JAVA_INCLUDE2:/usr/local/java/jdk1.7.0_40/include/linux<br>  æ˜¯ jdk ä¸­çš„ jni.h æ–‡ä»¶çš„æ‰€åœ¨ç›®å½•ï¼Œè¿™ä¸¤ä¸ªç›®å½•éœ€è¦å¤§å®¶æ›¿æ¢ä¸ºè‡ªå·±çš„å¯¹åº”è·¯å¾„</p>
<p>  BZIP2_INCLUDE:</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š<br><a href="http://www.cppblog.com/deane/articles/165216.html" target="_blank" rel="external">http://www.cppblog.com/deane/articles/165216.html</a><br><a href="http://blog.csdn.net/hongquan1991/article/details/12426615" target="_blank" rel="external">http://blog.csdn.net/hongquan1991/article/details/12426615</a><br><a href="http://codepub.cn/2015/05/19/How-to-load-dll-file-in-Java-Web-Project/" target="_blank" rel="external">http://codepub.cn/2015/05/19/How-to-load-dll-file-in-Java-Web-Project/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸€ã€ä»¥bsdiff-cå’Œbspatch-cä¸ºä¾‹ç¼–è¯‘bsdiff-so&quot;&gt;ä¸€ã€ä»¥bsdiff.cå’Œbspatch.cä¸ºä¾‹ç¼–è¯‘bsdiff.so&lt;/h2&gt;&lt;p&gt;bsdiff.cå’Œbspatch.cåˆ†åˆ«ä¾èµ–bzip2&lt;/p&gt;
&lt;h3 id=&quot;é¡¹ç›®ç»“æ„&quot;&gt;é¡¹ç›®ç»“æ„&lt;/h3&gt;&lt;h3 id=&quot;æ­¥éª¤&quot;&gt;æ­¥éª¤&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ä½¿ç”¨BsDiff.javaç”ŸæˆBsDiff.classæ–‡ä»¶&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;javac&lt;/strong&gt; ivonhoe/spring/wrcenter/jni/BsDiff.java&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ç”ŸæˆBsDiff.hæ–‡ä»¶&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;javah&lt;/strong&gt; ivonhoe.spring.wrcenter.jni.BsDiff &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ç”Ÿæˆbspatch.o&lt;/p&gt;
    
    </summary>
    
    
      <category term="åŠ¨æ€é“¾æ¥åº“" scheme="https://ivonhoe.github.io/tags/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>[è½¬è½½]å¦‚ä½•å†™å‡ºGCå‹å¥½çš„Androidåº”ç”¨</title>
    <link href="https://ivonhoe.github.io/2015/10/25/%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BAGC%E5%8F%8B%E5%A5%BD%E7%9A%84Android%E5%BA%94%E7%94%A8/"/>
    <id>https://ivonhoe.github.io/2015/10/25/å¦‚ä½•å†™å‡ºGCå‹å¥½çš„Androidåº”ç”¨/</id>
    <published>2015-10-25T13:21:23.000Z</published>
    <updated>2015-11-08T04:03:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä½œè€…ï¼šä¹è›™ç§‘æŠ€é«˜çº§ç ”å‘ç»ç† æ˜“å®</p>
<p>Androidåº”ç”¨æ™®éæ²¡æœ‰iOSåº”ç”¨æµç•…ï¼Œè¿™ä¸Androidåº”ç”¨æ˜¯è¿è¡Œåœ¨Javaè™šæ‹Ÿæœºä¸Šæœ‰å¾ˆå¤§çš„å…³ç³»ï¼Œè€Œå…³ç³»æœ€å¤§çš„ææ€•å°±æ˜¯Javaè™šæ‹Ÿæœºä¸Šçš„Garbage Collectionï¼ˆGCï¼‰äº†ã€‚Javaè¯­è¨€æä¾›äº†è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œåƒåœ¾å¯¹è±¡ä¼šåœ¨GCè¿‡ç¨‹ä¸­è‡ªåŠ¨è¢«é‡Šæ”¾ã€‚è¿™æä¾›äº†å¼€å‘æ•ˆç‡ï¼Œä½¿å¼€å‘è€…èƒ½é›†ä¸­ç²¾åŠ›åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šï¼›ä½†å¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ï¼Œä½ å†™çš„Androidåº”ç”¨çš„æŸäº›æ€§èƒ½ä¸Šçš„é—®é¢˜å¾ˆå¯èƒ½å°±æ˜¯GCå¯¼è‡´çš„ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€æ®µéå¸¸ç®€å•çš„Javaè¯­å¥ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] data = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span> * <span class="number">512</span> * <span class="number">4</span>];</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ¡è¯­å¥ç”³è¯·äº†ä¸€å—å¤§å°ç›¸ç­‰äº512*512å¤§å°å›¾ç‰‡çš„å†…å­˜ã€‚æ‰§è¡Œè¿™æ¡è¯­å¥ä¼šæ¶ˆè€—å¤šå°‘æ—¶é—´å‘¢ï¼Ÿ0+mså—ï¼ŸåŸºæœ¬æ²¡æœ‰æ€§èƒ½å½±å“å—ï¼Ÿ</p>
<a id="more"></a>
<p>å®é™…çš„æƒ…å†µæ˜¯ï¼š0~200msï¼Œç”šè‡³æ›´å¤šï¼è¿™å–å†³äºåº”ç”¨å½“å‰Heapä½¿ç”¨æƒ…å†µã€‚åœ¨ä¸€ä¸ªç±»ä¼¼Hello Worldçš„æµ‹è¯•ç¨‹åºé‡Œï¼Œæ‰§è¡Œè¿™æ¡è¯­å¥æœ‰æ—¶å€™åªéœ€è¦0+mså°±å®Œæˆäº†ï¼Œä½†ä¸€èˆ¬æƒ…å†µæ˜¯16+msï¼Œç”šè‡³æœ‰æ—¶å€™éœ€è¦30+msã€‚æˆ‘ä»¬çŸ¥é“ä¸€æ®µæµç•…çš„åŠ¨ç”»æ¯å¸§ç»˜å›¾æ¶ˆè€—çš„æ—¶é—´åº”è¯¥å°äº16msï¼Œå› ä¸ºè¿™æ ·æ‰èƒ½ä¿è¯åŠ¨ç”»æœ‰60FPSçš„å¸§ç‡ã€‚ä½†å¦‚æœæ‰§è¡Œä¸Šé¢é‚£å¥ç®€å•çš„è¯­å¥å°±è¦é”™è¿‡1~2å¸§ï¼Œé‚£å°±éš¾æ€ªåŠ¨ç”»ä¸æµç•…äº†ã€‚</p>
<p>ä¸è¿‡ï¼Œæœ‰äººå¯èƒ½è¦è¯´äº†ï¼šâ€œæ²¡äººä¼šå‚»åˆ°åœ¨æ¯å¸§ç»˜å›¾çš„æ—¶å€™å»ç”³è¯·ä¸€å—è¿™ä¹ˆå¤§çš„å†…å­˜ï¼Œå®é™…æƒ…å†µä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜â€ã€‚å®é™…çš„å·¥ç¨‹ä¸­çš„ç¡®ä¸ä¼šè¿™ä¹ˆå†™ï¼Œä½†é€ æˆæ‰§è¡Œè¿™æ¡è¯­å¥è€—æ—¶æ¯”è¾ƒé•¿çš„åŸå› ä¸æ˜¯å› ä¸ºç”³è¯·çš„å†…å­˜å¤ªå¤§ï¼Œè€Œæ˜¯ç”³è¯·è¿‡ç¨‹ä¸­äº§ç”Ÿäº†GCï¼Œå°±ç®—æ˜¯ä¸€ä¸ªByteçš„å†…å­˜ç”³è¯·ä¹Ÿå¯èƒ½æ¶ˆè€—æ¯”è¿™æ›´é•¿çš„æ—¶é—´ã€‚</p>
<h3 id="Dalvikä¸­GCçš„åŸç†">Dalvikä¸­GCçš„åŸç†</h3><p>åœ¨Dalvikè™šæ‹Ÿæœºä¸­å®šä¹‰äº†å››ç§è§¦å‘GCçš„æ¡ä»¶ï¼ˆå‚çœ‹<a href="http://androidxref.com/4.2.2_r1/xref/dalvik/vm/alloc/Heap.h" target="_blank" rel="external">Heap.h</a>ï¼‰ï¼š</p>
<blockquote>
<ul>
<li><code>GC_CONCURRENT</code>ï¼Œå½“Heapçš„ä½¿ç”¨ç‡è¾¾åˆ°æŸä¸€é˜ˆå€¼æ—¶è‡ªåŠ¨è§¦å‘ã€‚</li>
<li><code>GC_FOR_MALLOC</code>ï¼Œå½“Heapæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´ç”¨äºå®¹ä¸‹æ–°åˆ›å»ºçš„å¯¹è±¡æ—¶ã€‚</li>
<li><code>GC_EXPLICIT</code>ï¼Œç”¨æˆ·ä¸»åŠ¨è°ƒç”¨GCæ—¶ã€‚</li>
<li><code>GC_BEFORE_OOM</code>ï¼Œå½“è¦å‘ç”ŸOOMæ—¶ç³»ç»Ÿå°è¯•è¿›è¡Œæœ€åGCçš„åŠªåŠ›ã€‚</li>
</ul>
</blockquote>
<p><code>GC_CONCURRENT</code>å’Œ<code>GC_EXPLICIT</code>æ˜¯å¹¶è¡Œçš„ï¼ŒGCè¿‡ç¨‹ä¸­åº”ç”¨ä¸ä¼šè¢«æš‚åœï¼Œåªåœ¨GCå¼€å§‹å’Œç»“æŸæ—¶ä¼šæš‚åœåº”ç”¨ï¼Œæ¯æ¬¡æš‚åœçš„æ—¶é—´æ¯”è¾ƒçŸ­ï¼Œä¸€èˆ¬åªæœ‰3~4msã€‚<code>GC_FOR_MALLOC</code>æ˜¯éå¹¶è¡Œçš„ï¼ŒGCè¿‡ç¨‹ä¸­åº”ç”¨è¢«æš‚åœï¼Œè€—æ—¶æ¯”è¾ƒé•¿ï¼Œå¯èƒ½å‡ åæ¯«ç§’ä¹Ÿå¯èƒ½å‡ ç™¾æ¯«ç§’ã€‚åœ¨åº”ç”¨å‘Dalvikç”³è¯·å†…å­˜æ—¶ï¼ŒDalvikå…ˆæ£€æŸ¥å½“å‰Heapä¸­æœ‰æ— è¶³å¤Ÿçš„ç©ºä½™ç©ºé—´ç”¨æ¥å®‰æ’å¯¹è±¡ï¼Œå½“å‘ç°æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´çš„æ—¶å€™ä¼šå…ˆè¿›è¡Œ<code>GC_FOR_MALLOC</code>ä»¥è¯•å›¾é‡Šæ”¾åƒåœ¾å¯¹è±¡æ¥è·å–æ–°çš„ç©ºé—´ï¼Œå¦‚æœå‘ç°ç©ºé—´è¿˜ä¸å¤Ÿåˆ™è¿›è¡ŒHeapçš„å¢é•¿ã€‚åœ¨æ¯æ¬¡æˆåŠŸåˆ†é…å®Œæ–°çš„ç©ºé—´åï¼ŒDalvikä¼šæ£€æŸ¥å½“å‰Heapçš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœä½¿ç”¨ç©ºé—´è¶…è¿‡ä¸€å®šçš„é˜ˆå€¼çš„æ—¶å€™ï¼Œ<code>GC_CONCURRENT</code>å°±ä¼šè§¦å‘ã€‚</p>
<p>æ¯æ¬¡GCçš„æ—¶å€™ä¼šæ‰“å°å¦‚ä¸‹çš„Logä¿¡æ¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D/dalvikvm(10497): GC_CONCURRENT freed 2940K, 54% free 2885K/6204K, paused 1ms+4ms&#65292; total 38ms</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„Logä¿¡æ¯è¡¨æ˜ï¼šè¿™æ¬¡<code>GC_CONCURRENT</code>é‡Šæ”¾äº†2940Kçš„ç©ºé—´ï¼Œå½“å‰Heapä½¿ç”¨ç‡ä¸º54%ï¼Œæ€»çš„Heapå¤§å°æ˜¯6204Kï¼Œç©ºä½™2885Kï¼ŒGCå¼€å§‹æ—¶æš‚åœäº†1msï¼ŒGCç»“æŸæ—¶æš‚åœäº†4msï¼ŒGCæ€»å…±èŠ±äº†38msã€‚</p>
<p>Dalvikè™šæ‹Ÿæœºé€šè¿‡ä¸‹é¢å‡ ä¸ªä¸ªå±æ€§å€¼æ¥æ§åˆ¶Heapçš„ç©ºé—´é…ç½®ï¼š</p>
<blockquote>
<ul>
<li><code>targetUtilization</code>ï¼Œç†æƒ³çš„Heapåˆ©ç”¨ç‡ï¼Œæ¯å½“Heapå¢é•¿æ—¶Dalvikä¼šä½¿å¢é•¿åçš„Heapç»´æŒåœ¨è¿™ä¸ªåˆ©ç”¨ç‡é™„è¿‘ã€‚</li>
<li><code>minFree</code>ï¼Œç©ºä½™ç©ºé—´æœ€å°å€¼ã€‚</li>
<li><code>maxFree</code>ï¼Œç©ºä½™ç©ºé—´æœ€å¤§å€¼ã€‚</li>
<li><code>startSize</code>ï¼Œè™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆå§‹çš„Heapå¤§å°ã€‚</li>
<li><code>growthLimit</code>ï¼Œç”¨æˆ·è®¾ç½®çš„å…è®¸çš„æœ€å¤§Heapå¤§å°ã€‚</li>
<li><code>maximumSize</code>ï¼Œ Heapç©ºé—´æœ€å¤§æé™å€¼ã€‚</li>
</ul>
</blockquote>
<p>è¿™äº›å±æ€§å€¼éƒ½å¯ä»¥é€šè¿‡<code>system/build.prop</code>æ¥é…ç½®ï¼Œzygoteå¯åŠ¨dalvikè™šæ‹Ÿæœºæ—¶ä¼šä»è¯¥æ–‡ä»¶ä¸­è¯»å–è¿™äº›å‚æ•°ã€‚é€šå¸¸æ¥è¯´ï¼ŒHeapç©ºä½™ç©ºé—´è¶Šå¤§åº”ç”¨è¶Šæµç•…ï¼Œæ¶ˆè€—çš„å†…å­˜ä¹Ÿæ›´å¤šã€‚</p>
<p>ä¸‹å›¾ä¸ºä¸€æ¬¡â€œé¡ºåˆ©â€çš„4Må†…å­˜ç”³è¯·:<br><img src="/res/dalvik_gc/1.png" alt="Alt text"><br>å¯ä»¥çœ‹åˆ°åœ¨ç”³è¯·ä¹‹å‰ï¼Œç©ºä½™çš„ç©ºé—´è¾¾åˆ°8Mï¼Œç”³è¯·4Mçš„å†…å­˜å¾ˆé¡ºåˆ©æ²¡æœ‰ä»»ä½•GCå‘ç”Ÿã€‚</p>
<p>ä¸‹å›¾ä¸ºä¸€æ¬¡â€œä¸é¡ºåˆ©â€çš„8Må†…å­˜ç”³è¯·ï¼š<br><img src="/res/dalvik_gc/2.png" alt="Alt text"><br>è™½ç„¶ç©ºä½™çš„ç©ºé—´å·²ç»æœ‰8Mï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯æ­£å¸¸çš„Heapåˆ©ç”¨ç‡ï¼ŒHeapç©ºé—´è¿˜æ˜¯å¢é•¿äº†ï¼Œå¹¶ä¸”å¢é•¿Heapä¹‹å‰è¿›è¡Œäº†ä¸€æ¬¡<code>GC_FOR_MALLOC</code>ã€‚</p>
<p>ä¸‹å›¾ä¸ºç»§ç»­ç”³è¯·8Mçš„å†…å­˜ï¼š<br><img src="/res/dalvik_gc/3.png" alt="Alt text"><br>ç›¸åº”çš„è¾“å‡ºLogï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D/dalvikvm&#65109; GC_FOR_ALLOC freed 8195K, 34% free 16726K/24972K, paused 23ms, total 23ms</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šå›¾å’ŒLogæ›´åŠ æ¸…æ™°çš„è¡¨æ˜Heapç©ºé—´ä¸å¤Ÿæ—¶ä¼šå…ˆè¿›è¡Œä¸€æ¬¡GCï¼ŒGCçš„ç±»å‹å°±æ˜¯<code>GC_FOR_MALLOC</code>ã€‚</p>
<h3 id="Androidæµç•…çš„å…³é”®ï¼šGC_FOR_MALLOC">Androidæµç•…çš„å…³é”®ï¼š<code>GC_FOR_MALLOC</code></h3><p><code>GC_CONCURRENT</code>å’Œ<code>GC_FOR_MALLOC</code>è™½ç„¶éƒ½æ˜¯ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨çš„ï¼Œéƒ½æš‚åœäº†åº”ç”¨ï¼Œä½†å®ƒä»¬èŠ±è´¹çš„æ—¶é—´ä¸åœ¨ä¸€ä¸ªæ•°é‡çº§ã€‚é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬çŸ¥é“æ¯æ¬¡ç”³è¯·å†…å­˜ç©ºé—´ä¸å¤Ÿæ—¶å°±ä¼šäº§ç”Ÿ<code>GC_FOR_MALLOC</code>ï¼Œæˆ‘ä»¬ä¸å¯èƒ½ä¸ç”³è¯·å†…å­˜ï¼Œæ‰€ä»¥ä¹Ÿä¸å¯èƒ½å®Œå…¨é¿å…<code>GC_FOR_MALLOC</code>ï¼Œä½†è¿˜æ˜¯æœ‰äº›ç­–ç•¥èƒ½é™ä½<code>GC_FOR_MALLOC</code>çš„å½±å“ï¼š</p>
<ol>
<li><p>é¿å…ä¸å¿…è¦çš„<code>GC_FOR_MALLOC</code></p>
<blockquote>
<ul>
<li>Heapç©ºé—´éƒ½æœ‰å…¶ç†æƒ³çš„åˆ©ç”¨ç‡ï¼Œåœ¨ç†æƒ³çš„åˆ©ç”¨ç©ºé—´å†…ï¼Œç”³è¯·å†…å­˜æ˜¯ä¸ä¼šå‘ç”Ÿ<code>GC_FOR_MALLOC</code>ã€‚</li>
<li>åº”ç”¨åº”è¯¥é¿å…å†…å­˜å¼€é”€çš„æ³¢åŠ¨ï¼Œå°†å†…å­˜çš„æ³¢åŠ¨ç»´æŒåœ¨<code>maxFree</code>å’Œ<code>mixFree</code>ä¹‹é—´ã€‚</li>
<li>é¿å…å¤§çš„å†…å­˜éœ€æ±‚ã€‚æ¯”å¦‚ï¼Œä¸è¦è½»æ˜“å»ç”¨<code>WallpaperManager</code>ï¼Œå› ä¸ºå£çº¸å ç”¨å·¨å¤§çš„å†…å­˜ã€‚</li>
<li>åº”è¯¥å°½é‡å¤ç”¨å¯¹è±¡ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨<code>BitmapFactory</code>åŠ è½½å›¾ç‰‡æ—¶ä½¿ç”¨<code>BitmapFactory.Option.inBitmap</code>å¤ç”¨Bitmapï¼Œé¿å…ç”³è¯·å†…å­˜ã€‚</li>
<li>å¯¹äºå·²çŸ¥æœ‰åƒåœ¾å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œå…ˆè¿›è¡Œæ‰‹åŠ¨çš„<code>System.gc()</code>æ¥é‡Šæ”¾ç©ºé—´ï¼Œè€Œä¸æ˜¯ç­‰åˆ°ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨<code>GC_FOR_MALLOC</code>ã€‚å› ä¸º<code>GC_EXPLICIT</code>æ˜¯å¼‚æ­¥çš„ï¼Œæš‚åœåº”ç”¨çš„æ—¶é—´è¿œå°äº<code>GC_FOR_MALLOC</code>ã€‚</li>
<li>ä¸è¦åœ¨å¾ªç¯ä¸­ç”³è¯·åˆ›å»ºå¯¹è±¡ã€‚å¾ªç¯ä¸­ç”³è¯·çš„å¯¹è±¡ä¼šä¸æ–­ç´¯ç§¯ï¼Œç›´åˆ°ç©ºé—´ä¸å¤Ÿå‘ç”Ÿ<code>GC_FOR_MALLOC</code>ã€‚</li>
</ul>
</blockquote>
</li>
<li><p>å‡å°‘<code>GC_FOR_MALLOC</code>çš„å½±å“</p>
<blockquote>
<ul>
<li>ä¸è¦åœ¨Androidåº”ç”¨è¿è¡Œçš„å…³é”®é˜¶æ®µç”³è¯·å†…å­˜ã€‚æ¯”å¦‚ï¼Œä¸è¦åœ¨<code>onDraw</code>, <code>onLayout</code>, <code>onXXX</code>ä¸­åˆ›å»ºå¯¹è±¡ã€‚åœ¨å…³é”®é˜¶æ®µåˆ›å»ºå¯¹è±¡å¯èƒ½ä½¿åº”ç”¨å‡ºç°éšæœºæ€§å¡é¡¿ã€‚</li>
<li>å°½é‡åœ¨<code>onCreate</code>å’Œ<code>onStart</code>é˜¶æ®µåˆ›å»ºå¯¹è±¡ï¼ŒåŒæ—¶åœ¨<code>onStop</code>å’Œ<code>onDestroy</code>é˜¶æ®µé‡Šæ”¾å¯¹è±¡ã€‚</li>
<li>å°½é‡å¤ç”¨<code>ListView</code>ä¸­Itemï¼Œåœ¨<code>ListView</code>æ»‘åŠ¨æ—¶ä¸è¦åˆ›å»ºå¯¹è±¡ã€‚</li>
</ul>
</blockquote>
</li>
<li><p>é™ä½æ¯æ¬¡<code>GC_FOR_MALLOC</code>çš„æ—¶é—´æ¶ˆè€—</p>
<blockquote>
<ul>
<li>é¿å…å¤§é‡çš„ï¼Œç»†å°çš„å¯¹è±¡ã€‚è¿™äº›å¯¹è±¡ä¼šå¢åŠ Heapç©ºé—´çš„å¤æ‚åº¦ï¼Œåœ¨GCæ—¶ä¼šä¸¥é‡å½±å“GCçš„è€—æ—¶ã€‚</li>
<li>å¯¹äºä¸ç”¨çš„å¯¹è±¡è¿‘æ—©å°†å…¶å¼•ç”¨æ¶ˆé™¤ï¼Œå‡å°‘Heapç©ºé—´å ç”¨å’Œå¤æ‚åº¦ã€‚</li>
<li>å°½é‡ç”¨æ•°æ®ç»“æ„ï¼Œæ•°ç»„æ¥ç»„ç»‡å¯¹è±¡ã€‚</li>
<li>æ˜ç¡®å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œä½¿å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ç®€å•æ˜äº†ã€‚</li>
<li>å‡å°‘Viewçš„æ•°é‡ã€‚æ¯ä¸ªViewåŒ…å«å¤§é‡å±æ€§ï¼Œå¯¹äºæ²¡æœ‰äº¤äº’çš„Viewï¼Œå¤§å¤šæ•°çš„å±æ€§éƒ½æ˜¯æ²¡æœ‰ç”¨çš„ï¼Œå¯ä»¥ç”¨Drawableæ›¿ä»£ã€‚</li>
</ul>
</blockquote>
</li>
</ol>
<p><em>éœ€è¦æ³¨æ„çš„æ˜¯</em>ï¼šæœ¬æ–‡è®¨è®ºçš„åªé™äºDalvikè™šæ‹Ÿæœºã€‚å¯¹äºArtè™šæ‹Ÿæœºï¼Œ<a href="https://developer.android.com/guide/practices/verifying-apps-art.html#GC_Migration" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>å·²ç»è¡¨æ˜Artè™šæ‹Ÿæœºæœ‰æå¤§çš„æ”¹è¿›ï¼Œå…¶ä¸­å°±ç‰¹åˆ«æåˆ°<strong>ä¸ç”¨</strong>ä¸»åŠ¨è°ƒç”¨<code>System.gc()</code>æ¥é¿å…äº§ç”Ÿ<code>GC_FOR_MALLOC</code>ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä½œè€…ï¼šä¹è›™ç§‘æŠ€é«˜çº§ç ”å‘ç»ç† æ˜“å®&lt;/p&gt;
&lt;p&gt;Androidåº”ç”¨æ™®éæ²¡æœ‰iOSåº”ç”¨æµç•…ï¼Œè¿™ä¸Androidåº”ç”¨æ˜¯è¿è¡Œåœ¨Javaè™šæ‹Ÿæœºä¸Šæœ‰å¾ˆå¤§çš„å…³ç³»ï¼Œè€Œå…³ç³»æœ€å¤§çš„ææ€•å°±æ˜¯Javaè™šæ‹Ÿæœºä¸Šçš„Garbage Collectionï¼ˆGCï¼‰äº†ã€‚Javaè¯­è¨€æä¾›äº†è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œåƒåœ¾å¯¹è±¡ä¼šåœ¨GCè¿‡ç¨‹ä¸­è‡ªåŠ¨è¢«é‡Šæ”¾ã€‚è¿™æä¾›äº†å¼€å‘æ•ˆç‡ï¼Œä½¿å¼€å‘è€…èƒ½é›†ä¸­ç²¾åŠ›åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šï¼›ä½†å¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ï¼Œä½ å†™çš„Androidåº”ç”¨çš„æŸäº›æ€§èƒ½ä¸Šçš„é—®é¢˜å¾ˆå¯èƒ½å°±æ˜¯GCå¯¼è‡´çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€æ®µéå¸¸ç®€å•çš„Javaè¯­å¥ï¼š&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;byte&lt;/span&gt;[] data = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;byte&lt;/span&gt;[&lt;span class=&quot;number&quot;&gt;512&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;512&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ¡è¯­å¥ç”³è¯·äº†ä¸€å—å¤§å°ç›¸ç­‰äº512*512å¤§å°å›¾ç‰‡çš„å†…å­˜ã€‚æ‰§è¡Œè¿™æ¡è¯­å¥ä¼šæ¶ˆè€—å¤šå°‘æ—¶é—´å‘¢ï¼Ÿ0+mså—ï¼ŸåŸºæœ¬æ²¡æœ‰æ€§èƒ½å½±å“å—ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
    
      <category term="Android" scheme="https://ivonhoe.github.io/tags/Android/"/>
    
      <category term="Delvik" scheme="https://ivonhoe.github.io/tags/Delvik/"/>
    
      <category term="GC" scheme="https://ivonhoe.github.io/tags/GC/"/>
    
      <category term="è½¬è½½" scheme="https://ivonhoe.github.io/tags/%E8%BD%AC%E8%BD%BD/"/>
    
  </entry>
  
  <entry>
    <title>AndroidåŠ¨ç”»æ€»ç»“ä¹‹æœ‰èµã€é‚®ç®±å¤§å¸ˆè¿›åº¦æ¡å®ç°åŸç†</title>
    <link href="https://ivonhoe.github.io/2015/09/01/Android%E5%8A%A8%E7%94%BB%E6%80%BB%E7%BB%93%E4%B9%8B%E6%9C%89%E8%B5%9E%E3%80%81%E9%82%AE%E7%AE%B1%E5%A4%A7%E5%B8%88%E8%BF%9B%E5%BA%A6%E6%9D%A1%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/"/>
    <id>https://ivonhoe.github.io/2015/09/01/AndroidåŠ¨ç”»æ€»ç»“ä¹‹æœ‰èµã€é‚®ç®±å¤§å¸ˆè¿›åº¦æ¡å®ç°åŸç†/</id>
    <published>2015-09-01T15:17:29.000Z</published>
    <updated>2017-02-09T10:12:55.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€æ•ˆæœ">ä¸€ã€æ•ˆæœ</h2><p><img src="/res/android_animation2/xiaoguo.gif" alt=" "></p>
<h2 id="äºŒã€æœ‰èµåŠ è½½è¿›åº¦æ¡">äºŒã€æœ‰èµåŠ è½½è¿›åº¦æ¡</h2><p>å››ä¸ªæ­£æ–¹å½¢çš„è¿åŠ¨å¯ä»¥åˆ†è§£æˆä¸¤ä¸ªåˆ†è¿åŠ¨ï¼Œä¸€ä¸ªæ˜¯å¹³ç§»è¿åŠ¨ï¼Œä¸€ä¸ªæ˜¯è‡ªèº«çš„æ—‹è½¬è¿åŠ¨ã€‚åœ¨å®ç°è¿™ä¸ªåŠ¨ç”»ä¸Šæœ‰ä¸¤ä¸ªæ€è·¯ï¼š</p>
<ul>
<li>ä¸€ä¸ªæ˜¯é€šè¿‡Androidæä¾›çš„Animationæˆ–è€…Animatoræ“ä½œè§†å›¾ï¼Œè®©ä¸€ä¸ªæ­£æ–¹å½¢çš„è§†å›¾åœ¨translateåŠ¨ç”»çš„åŒæ—¶è¿›è¡ŒrotateåŠ¨ç”»ï¼Œåªéœ€è¦è®¾ç½®rotateåŠ¨ç”»çš„pivotåæ ‡ä¸ºè§†å›¾çš„ä¸­å¿ƒç‚¹å°±å¯ä»¥äº†ã€‚</li>
<li>å¦ä¸€ä¸ªæ˜¯ç›´æ¥åœ¨canvasä¸Šç»˜åˆ¶æ­£æ–¹å½¢ï¼Œé€šè¿‡canvasçš„åæ ‡å˜æ¢å®ç°åŠ¨ç”»ã€‚</li>
</ul>
<a id="more"></a>
<p>ä¸‹é¢ä¸»è¦è¯´ç¬¬äºŒç§æ–¹å¼çš„åŸç†ï¼š</p>
<ul>
<li><p>å¹³ç§»ï¼šå¹³ç§»canvasï¼Œåœ¨å¹³è¡Œä¸æ‰‹æœºå±å¹•çš„å¹³é¢åæ ‡ç³»ä¸­ï¼Œæ°´å¹³å‘å³æ–¹å‘ä¸ºXè½´ï¼Œç«–ç›´å‘ä¸‹æ–¹å‘ä¸ºYè½´ï¼ŒæŠŠåŸç‚¹å¹³ç§»åˆ°è§†å›¾çš„ä¸­å¿ƒç‚¹ï¼Œåªéœ€è¦åœ¨æ°´å¹³å’Œç«–ç›´çš„æ­£æ–¹å‘å¹³ç§»å°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">canvas.translate(mBounds.width() / 2, mBounds.height() / 2);</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ—‹è½¬ï¼šæƒ³è¦å®Œæˆä¸€ä¸ªçŸ©å½¢å›´ç»•å…¶ä¸­å¿ƒç‚¹é¡ºæ—¶é’ˆæ—‹è½¬ä¸€ä¸ªè§’åº¦ï¼Œé¦–å…ˆè¦æ„è¯†åˆ°æ—‹è½¬çš„è¿‡ç¨‹ä¸­ï¼Œåªæ”¹å˜äº†åæ ‡ç³»çš„æ–¹å‘å¹¶æ²¡æœ‰æ”¹å˜åæ ‡ç³»çš„åŸç‚¹ä½ç½®ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ éœ€è¦å›´ç»•åæ ‡ç³»åŸç‚¹åšæ—‹è½¬ï¼Œé‚£ä¹ˆä½ åªéœ€è¦æ—‹è½¬æ“ä½œï¼Œå¦‚æœä½ éœ€è¦å›´ç»•é™¤äº†åŸç‚¹ä»¥å¤–çš„å¦å¤–ä¸€ä¸ªç‚¹ï¼ˆæ¯”å¦‚å½“å‰ç°åœ¨æ­£æ–¹å½¢çš„ä¸­å¿ƒç‚¹ï¼‰ï¼Œé‚£ä¹ˆä½ éœ€è¦å…ˆåšå¹³ç§»æ“ä½œï¼Œå…ˆæŠŠåæ ‡ç³»å¹³ç§»åˆ°ä¸€ä¸ªæ­£ç¡®çš„ç‚¹åœ¨åšæ—‹è½¬æ“ä½œã€‚å¦‚å›¾æ‰€ç¤ºï¼š<br><img src="/res/android_animation2/xuanzhuanzuobiao.png" alt=" "></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">canvas.translate((float) (x + (1 - 1.414f * Math.sin((45 - degree) / 180f * Math.PI)) * halfLength),(float) (y - (1.414f * Math.cos((45 - degree) / 180f * Math.PI) - 1) * halfLength));&#10;canvas.rotate(degree);&#10;drawable.draw(canvas);</span><br></pre></td></tr></table></figure>
<ul>
<li>åŠ¨ç”»æ’å€¼ï¼šå¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªæ­£æ–¹å½¢çš„å¹³ç§»è¿åŠ¨å‘¨æœŸæ˜¯ä»èµ·å§‹ç‚¹å›åˆ°èµ·å§‹ç‚¹ï¼Œåœ¨æ—¶é—´çš„ä¸­ç‚¹ä¸Šè¾¾åˆ°å¹³ç§»çš„æœ€å¤§å€¼ã€‚ååº”åœ¨å¹³é¢åæ ‡ä¸­çš„æƒ…å†µå°±æ˜¯ï¼Œä¸€æ¡é€šè¿‡(0, 0), (0.5, 1),(1, 0)ä¸‰ç‚¹ï¼Œåœ¨(0.5, 1)è¾¾åˆ°æœ€å¤§å€¼çš„ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ã€‚å¯ä»¥é—´æ¥å¾—åˆ°è¿™ä¸ªæ’å€¼å™¨æ˜¯ï¼š<br><img src="/res/android_animation2/chazhiqi.jpg" alt=" "></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#36807;&#65288;0,0&#65289;&#65292;&#65288;0.5,1&#65289;&#65292;&#65288;1,0&#65289;&#30340;&#19968;&#20803;&#20108;&#27425;&#26041;&#31243;&#10;Interpolator mInterpolator = new Interpolator() &#123;&#10;    @Override&#10;    public float getInterpolation(float input) &#123;&#10;        return -4 * input * input + 4 * input;&#10;    &#125;&#10;&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰ã€ç½‘æ˜“é‚®ç®±å¤§å¸ˆåŠ è½½è¿›åº¦æ¡">ä¸‰ã€ç½‘æ˜“é‚®ç®±å¤§å¸ˆåŠ è½½è¿›åº¦æ¡</h2><p>åœ†å¼§çš„åŠ¨ç”»éœ€è¦åˆ†è§£æˆå››ä¸ªåˆ†åŠ¨ç”»ï¼š</p>
<ul>
<li>ç”»ç¬”å®½åº¦å˜åŒ–ï¼šç»˜åˆ¶åœ†å¼§çš„ç”»ç¬”å®½åº¦åœ¨åŠ¨ç”»</li>
<li>åœ†å¼§é•¿åº¦å˜åŒ–ï¼šç»˜åˆ¶åœ†å¼§çš„é•¿åº¦åœ¨åŠ¨ç”»</li>
<li>æ—‹è½¬å˜åŒ–ï¼šç»˜åˆ¶æ¯æ®µåœ†å¼§çš„èµ·ç‚¹åœ¨åŠ¨ç”»</li>
<li>åœ†å¼§åŠå¾„å˜åŒ–ï¼šç»˜åˆ¶åœ†å¼§çš„åŠå¾„åœ¨åŠ¨ç”»</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public ObjectAnimator[] getAtomAnimator(Atom atom, Rect bound) &#123;&#10;    ObjectAnimator[] result = new ObjectAnimator[4];&#10;    result[0] = ObjectAnimator.ofFloat(atom, &#34;delta&#34;, 4f, 9f);&#10;    result[0].setInterpolator(mPaintInterpolator);&#10;    switch (atom.getId()) &#123;&#10;        case 0:&#10;            result[1] = ObjectAnimator.ofInt(atom, &#34;rotate&#34;, 0, 360);&#10;            break;&#10;        case 1:&#10;            result[1] = ObjectAnimator.ofInt(atom, &#34;rotate&#34;, 120, 480);&#10;            break;&#10;        case 2:&#10;            result[1] = ObjectAnimator.ofInt(atom, &#34;rotate&#34;, 240, 600);&#10;            break;&#10;        default:&#10;            throw new RuntimeException();&#10;    &#125;&#10;    result[1].setInterpolator(mRotateInterpolator);&#10;    result[2] = ObjectAnimator.ofFloat(atom, &#34;length&#34;, 80f, 59f);&#10;    result[2].setInterpolator(mPaintInterpolator);&#10;    result[3] = ObjectAnimator.ofFloat(atom, &#34;r&#34;, 0, mScaleFactor * getIntrinsicWidth());&#10;    result[3].setInterpolator(mPaintInterpolator);&#10;    return result;&#10;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å››ã€Canvaså›¾å½¢å˜æ¢åŸç†">å››ã€Canvaså›¾å½¢å˜æ¢åŸç†</h2><h3 id="2-1ã€å¹³ç§»">2.1ã€å¹³ç§»</h3><p>è®¾å›¾å½¢ä¸Šç‚¹P(x, y)ï¼Œåœ¨xè½´å’Œyè½´æ–¹å‘åˆ†åˆ«ç§»åŠ¨Txå’ŒTyï¼Œç»“æœç”Ÿæˆæ–°çš„ç‚¹Pâ€™(xâ€™, yâ€™)ï¼Œåˆ™:<br> <img src="/res/android_animation2/pingy0.png" alt=" "></p>
<p>ç”¨çŸ©é˜µå½¢å¼å¯è¡¨ç¤ºä¸º:<br><img src="/res/android_animation2/pingyi.png" alt=" "><br>å¹³ç§»å˜æ¢çŸ©é˜µä¸ºï¼š<br><img src="/res/android_animation2/pingyi2.png" alt=" "><br><img src="/res/android_animation2/pingyimatrix_å‰¯æœ¬.png" alt=" "></p>
<h3 id="2-2ã€ç¼©æ”¾">2.2ã€ç¼©æ”¾</h3><p>è®¾å›¾å½¢ä¸Šçš„ç‚¹P(x, y)åœ¨xè½´å’Œyè½´æ–¹å‘åˆ†åˆ«ä½œSxå€å’ŒSyå€çš„ç¼©æ”¾ï¼Œç»“æœç”Ÿæˆæ–°çš„ç‚¹åæ ‡Pâ€™(xâ€™, yâ€™)ï¼Œåˆ™:<br><img src="/res/android_animation2/suofang.png" alt=" "><br>ç”¨çŸ©é˜µè¡¨ç¤ºä¸ºï¼š<br><img src="/res/android_animation2/suofang2.png" alt=" "><br>æ¯”ä¾‹å˜æ¢çŸ©é˜µä¸ºï¼š<br><img src="/res/android_animation2/suofang 3.png" alt=" "><br><img src="/res/android_animation2/suofangMatrix_å‰¯æœ¬.png" alt=" "></p>
<h3 id="2-3ã€æ—‹è½¬">2.3ã€æ—‹è½¬</h3><p>è®¾ç‚¹P(x, y)ç»•åŸç‚¹æ—‹è½¬å˜æ¢Î¸è§’åº¦(å‡è®¾æŒ‰é€†æ—¶é’ˆæ—‹è½¬ä¸ºæ­£è§’)ï¼Œç”Ÿæˆçš„æ–°çš„ç‚¹åæ ‡Pâ€™(xâ€™, yâ€™)ï¼Œåˆ™ï¼š<br><img src="/res/android_animation2/xuanzhuan1.png" alt=" "><br>ç”¨çŸ©é˜µè¡¨ç¤ºä¸ºï¼š<br><img src="/res/android_animation2/xuanzhuan2.png" alt=" "><br>æ—‹è½¬å˜æ¢çŸ©é˜µä¸ºï¼š<br><img src="/res/android_animation2/xuanzhuan3.png" alt=" "><br><img src="/res/android_animation2/xuanzhuanMatrix_å‰¯æœ¬.png" alt=" "></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸€ã€æ•ˆæœ&quot;&gt;ä¸€ã€æ•ˆæœ&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/res/android_animation2/xiaoguo.gif&quot; alt=&quot; &quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;äºŒã€æœ‰èµåŠ è½½è¿›åº¦æ¡&quot;&gt;äºŒã€æœ‰èµåŠ è½½è¿›åº¦æ¡&lt;/h2&gt;&lt;p&gt;å››ä¸ªæ­£æ–¹å½¢çš„è¿åŠ¨å¯ä»¥åˆ†è§£æˆä¸¤ä¸ªåˆ†è¿åŠ¨ï¼Œä¸€ä¸ªæ˜¯å¹³ç§»è¿åŠ¨ï¼Œä¸€ä¸ªæ˜¯è‡ªèº«çš„æ—‹è½¬è¿åŠ¨ã€‚åœ¨å®ç°è¿™ä¸ªåŠ¨ç”»ä¸Šæœ‰ä¸¤ä¸ªæ€è·¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªæ˜¯é€šè¿‡Androidæä¾›çš„Animationæˆ–è€…Animatoræ“ä½œè§†å›¾ï¼Œè®©ä¸€ä¸ªæ­£æ–¹å½¢çš„è§†å›¾åœ¨translateåŠ¨ç”»çš„åŒæ—¶è¿›è¡ŒrotateåŠ¨ç”»ï¼Œåªéœ€è¦è®¾ç½®rotateåŠ¨ç”»çš„pivotåæ ‡ä¸ºè§†å›¾çš„ä¸­å¿ƒç‚¹å°±å¯ä»¥äº†ã€‚&lt;/li&gt;
&lt;li&gt;å¦ä¸€ä¸ªæ˜¯ç›´æ¥åœ¨canvasä¸Šç»˜åˆ¶æ­£æ–¹å½¢ï¼Œé€šè¿‡canvasçš„åæ ‡å˜æ¢å®ç°åŠ¨ç”»ã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="Android" scheme="https://ivonhoe.github.io/tags/Android/"/>
    
      <category term="åŠ¨ç”»" scheme="https://ivonhoe.github.io/tags/%E5%8A%A8%E7%94%BB/"/>
    
      <category term="è¿›åº¦æ¡" scheme="https://ivonhoe.github.io/tags/%E8%BF%9B%E5%BA%A6%E6%9D%A1/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®è§£æå·¥å…·</title>
    <link href="https://ivonhoe.github.io/2015/08/19/%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/"/>
    <id>https://ivonhoe.github.io/2015/08/19/æ•°æ®è§£æå·¥å…·è®¾è®¡æ–‡æ¡£/</id>
    <published>2015-08-19T13:49:49.000Z</published>
    <updated>2016-03-06T13:35:36.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€è®¾è®¡ç›®æ ‡">ä¸€ã€è®¾è®¡ç›®æ ‡</h2><ul>
<li>è®¾è®¡ä¸€ä¸ªç›¸å¯¹é€šç”¨çš„æ•°æ®è§£æå·¥å…·ï¼Œé«˜æ•ˆè§£æé€šè¿‡æŠ“åŒ…å·¥å…·æŠ“å–çš„ç½‘ç»œæ•°æ®å†…å®¹</li>
<li>åªéœ€è¦æ·»åŠ å°‘é‡ä»£ç ï¼Œå®ç°ä¸åŒæ•°æ®æ ¼å¼çš„è§£æï¼Œå¹¶æ”¯æŒä¸åŒæ–‡ä»¶æ ¼å¼ä¿å­˜</li>
</ul>
<h2 id="äºŒã€å®æ–½æ­¥éª¤">äºŒã€å®æ–½æ­¥éª¤</h2><p>æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯ä½¿ç”¨MonkeyRunnerè‡ªåŠ¨æµ‹è¯•è„šæœ¬å¯¹æ‰‹æœºè¿›è¡ŒæŸä¸€äº›å…·ä½“çš„æ“ä½œæ—¶ï¼Œé€šè¿‡Fiddlerå·¥å…·æˆªå–æ‰‹æœºAppçš„Httpé€šè®¯æ•°æ®ï¼Œé€šè¿‡å¯¹è¿™äº›æ•°æ®è¿›è¡Œè§£æä»è€Œè¾¾åˆ°è·å–åº”ç”¨æ•°æ®çš„è¿‡ç¨‹ã€‚</p>
<h3 id="2-1ã€ç¼–å†™MonkeyRunnerè‡ªåŠ¨è„šæœ¬">2.1ã€ç¼–å†™MonkeyRunnerè‡ªåŠ¨è„šæœ¬</h3><ul>
<li>ç¯å¢ƒå’Œå·¥å…·ï¼šPythonï¼ŒAndroid SDKå¼€å‘ç¯å¢ƒï¼Œ Androidæ‰‹æœºä¸€å°ï¼ˆdebugé€‰é¡¹è¿æ¥PCï¼‰</li>
<li>è„šæœ¬ç›®æ ‡ï¼šå¾ªç¯å¯¹æ‰‹æœºå±å¹•è¿›è¡Œä¸Šåˆ’æ“ä½œ</li>
<li>ä»£ç ï¼š<a id="more"></a>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8&#10;from com.android.monkeyrunner import MonkeyRunner,MonkeyDevice,MonkeyImage&#10;device = MonkeyRunner.waitForConnection(5,&#39;351BBJHUHDPU&#39;)&#10;sleepTime = 0.2&#10;for x in xrange(1,10000):&#10;&#9;MonkeyRunner.sleep(sleepTime)&#10;&#9;device.drag((436,1234),(378,346),1,10)</span><br></pre></td></tr></table></figure>
<ul>
<li>æ³¨ï¼šMonkeyRunner.waitForConnectionæ–¹æ³•å‚æ•°ä¸ºadb devices ä¸‹çš„æ‰‹æœºè®¾å¤‡å</li>
</ul>
<h3 id="2-2ã€æŠ“å–åº”ç”¨æµé‡ä¿¡æ¯">2.2ã€æŠ“å–åº”ç”¨æµé‡ä¿¡æ¯</h3><ul>
<li>ä¸‹è½½å¹¶å®‰è£…éœ€è¦æŠ“å–æ•°æ®çš„Androidåº”ç”¨</li>
<li>Googleæœç´¢è·å¾—<a href="http://jingyan.baidu.com/article/fd8044faebfaa85030137a72.html" target="_blank" rel="external">Androidæ‰‹æœºè®¾ç½®ä»£ç†ä¸Šç½‘</a>æ–¹æ³•ï¼Œå¹¶æˆåŠŸè®¾ç½®æ‰‹æœºé€šè¿‡PCä»£ç†ä¸Šç½‘åŠŸèƒ½</li>
<li>å®‰è£…Fiddlerï¼Œé€šè¿‡è®¾ç½®Fiddler hostè¿‡æ»¤å¯ä»¥è·å–å›ºå®šhostçš„HTTP Requestå’ŒResponse</li>
<li>ä½¿ç”¨MonkeyRunneræµ‹è¯•è„šæœ¬ï¼Œå¾ªç¯è§¦å‘æ‰‹æœºä¸Šåˆ’æ“ä½œï¼Œè‡ªåŠ¨æµè§ˆæ‰‹æœºåº”ç”¨å•†åº—çš„åº”ç”¨åˆ†ç±»ç•Œé¢ï¼Œé€šè¿‡FiddleræŠ“å–æ‰‹æœºçš„HTTPè¯·æ±‚å’Œå“åº”æ¶ˆæ¯å†…å®¹ï¼Œå¹¶å¯¼å‡º</li>
</ul>
<h3 id="2-3ã€æ•°æ®è§£æå®ç°">2.3ã€æ•°æ®è§£æå®ç°</h3><h4 id="2-3-1ã€æ•°æ®å¤„ç†æµç¨‹">2.3.1ã€æ•°æ®å¤„ç†æµç¨‹</h4><p><img src="/res/parser/liuchentu.png" alt="Alt text"></p>
<h4 id="2-3-2ã€ä½¿ç”¨ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼å¤„ç†æ•°æ®">2.3.2ã€ä½¿ç”¨ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼å¤„ç†æ•°æ®</h4><p>ç”Ÿäº§è€…çº¿ç¨‹è¯»å–æºæ•°æ®æ–‡ä»¶ï¼Œç”Ÿäº§å‡ºå¾…è§£æçš„å­—ç¬¦ä¸²æ•°æ®æ”¾å…¥æ•°æ®æ± ä¸­ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10;  * &#29983;&#20135;&#32773;&#30340;&#29983;&#20135;&#23481;&#22120;&#10;  */&#10;private LinkedList&#60;Object&#62; mProductPool = new LinkedList&#60;Object&#62;();&#10;&#10;private void addProduct(List&#60;Object&#62; data) &#123;&#10;    while (!data.isEmpty()) &#123;&#10;        synchronized (mProductPool) &#123;&#10;             while (mProductPool.size() &#62;= MAX_SIZE) &#123;&#10;                try &#123;&#10;                    mProductPool.wait();&#10;                &#125; catch (InterruptedException e) &#123;&#10;                    e.printStackTrace();&#10;                &#125;&#10;            &#125;&#10;&#10;        getDataProducer().startProduce();&#10;&#10;        for (int i = 0; i &#60; Math.min(MAX_SIZE, data.size()) &#38;&#38;&#10;                mProductPool.size() &#60; MAX_SIZE; i++) &#123;&#10;                if (!data.isEmpty()) &#123;&#10;                    mProductPool.add(data.get(0));&#10;                    data.remove(0);&#10;                &#125;&#10;            &#125;&#10;            mProductPool.notifyAll();&#10;        &#125;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¤šä¸ªæ¶ˆè´¹è€…çº¿ç¨‹æ¯æ¬¡ä»æ•°æ®æ± ä¸­è·å–ä¸€å®šæ•°é‡çš„æ•°æ®å†…å®¹ç”¨æ¥è§£æï¼Œå¹¶æŠŠè§£æç»“æœæ”¾å…¥æœ€ç»ˆçš„å¤„ç†ç»“æœæ± ä¸­ã€‚è¿™é‡Œå¹¶æ²¡æœ‰ä½¿ç”¨äºŒçº§çš„æ¶ˆè´¹è€…å»åšæ•°æ®ä¿å­˜æ“ä½œï¼Œå› ä¸ºå¯èƒ½éœ€è¦æŠŠæ‰€æœ‰æ•°æ®è§£æå®Œæˆååšç»Ÿä¸€çš„åˆ†ç±»ã€ç»Ÿè®¡ã€ç­›é€‰æ“ä½œã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10;  * &#28040;&#36153;&#32773;&#22788;&#29702;&#25968;&#25454;&#21518;&#30340;&#23481;&#22120;&#10;  */&#10;private List&#60;Unit&#62; mConsumedPool = new ArrayList&#60;Unit&#62;()&#65307;&#10;&#10;public class Consumer implements Runnable &#123;&#10;&#10;    @Override&#10;    public void run() &#123;&#10;        while (true) &#123;&#10;            List&#60;Object&#62; queue = mEngine.getProductPool();&#10;            if (queue == null) &#123;&#10;                return;&#10;            &#125;&#10;&#10;            List&#60;Object&#62; temp = new ArrayList&#60;Object&#62;();&#10;            synchronized (queue) &#123;&#10;                while (queue.size() == 0 &#38;&#38; !mEngine.isProduceComplete()) &#123;&#10;                    try &#123;&#10;                        queue.wait();&#10;                    &#125; catch (InterruptedException e) &#123;&#10;                        e.printStackTrace();&#10;                        queue.notify();&#10;                    &#125;&#10;                &#125;&#10;&#10;                int size = queue.size();&#10;                int k = Math.max(0, size - NUM_PER_CONSUME);&#10;                for (int i = size - 1; i &#62;= k; i--) &#123;&#10;                    temp.add(queue.get(i));&#10;                    queue.remove(i);&#10;                &#125;&#10;&#10;                queue.notifyAll();&#10;            &#125;&#10;&#10;            for (Object str : temp) &#123;&#10;                ArrayList&#60;Unit&#62; result = onParse((String) str);&#10;                if (result != null) &#123;&#10;                    mEngine.addParsedUnit(result);&#10;                &#125;&#10;            &#125;&#10;&#10;            if (mEngine.isProduceComplete() &#38;&#38; queue.isEmpty()) &#123;&#10;                complete(this);&#10;                Thread t = Thread.currentThread();&#10;                t.interrupt();&#10;                return;&#10;            &#125;&#10;        &#125;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>Engine.javaä½œä¸ºæ•´ä¸ªè§£æè¿‡ç¨‹çš„å¼•æ“ï¼Œä¸åŒçš„æ•°æ®éœ€è¦ä¸åŒçš„è§£æå®ç°å’Œä¿å­˜æ ¼å¼å®ç°,ä½¿ç”¨Readerè¯»å–æ•°æ®çš„æ•°æ®ï¼Œå°†è¯»å–çš„æ•°æ®å¡«å……åˆ°æ•°æ®æ± ä¸­ï¼Œå½“æ± æ»¡æ—¶ï¼ŒReaderçº¿ç¨‹é˜»å¡å½“æ± ç©ºæ—¶ï¼Œè§£æçº¿ç¨‹é˜»å¡ã€‚åœ¨æ•°æ®å…¨éƒ¨è¯»å–å¹¶è§£æå®Œæˆä¹‹åï¼Œé€šè¿‡IWriterå°†ç»“æœä¿å­˜åˆ°æ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class Engine implements IParser.ParseListener &#123;&#10;    // &#25351;&#23450;&#35299;&#26512;&#30340;&#25968;&#25454;&#36335;&#24452;&#10;    public void setSourcePath(String path) &#123;&#125;&#10;    // &#35774;&#32622;Reader&#10;    public void setReader(IReader reader) &#123;&#125;&#10;    // &#35774;&#32622;&#35299;&#26512;&#22120;&#10;    public void setParser(IParser parser) &#123;&#125;&#10;    // &#35774;&#32622;Writer&#10;    public void setWriter(IWriter writer) &#123;&#125;&#10;    // &#35299;&#26512;&#22120;&#35299;&#26512;&#23436;&#25104;&#30340;&#22238;&#35843;&#10;    public void onParseComplete() &#123;&#125;&#10;    // &#21551;&#21160;&#65292;&#24320;&#22987;&#22788;&#29702;&#25968;&#25454;&#10;    public void start()&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="ä¸‰ã€é’ˆå¯¹ç¬¬ä¸‰æ–¹åº”ç”¨å•†åº—åˆ†ç±»æ•°æ®çš„è§£æ">ä¸‰ã€é’ˆå¯¹ç¬¬ä¸‰æ–¹åº”ç”¨å•†åº—åˆ†ç±»æ•°æ®çš„è§£æ</h2><h3 id="2-1ã€å®šä¹‰ä¸åŒç±»å‹çš„è§£æå™¨">2.1ã€å®šä¹‰ä¸åŒç±»å‹çš„è§£æå™¨</h3><p>åœ¨åˆ†æç¬¬ä¸‰æ–¹å•†åº—æ•°æ®çš„è¿‡ç¨‹ä¸­å‘ç°ï¼Œæ¯ä¸ªåº”ç”¨å¸‚åœºéƒ½ä¼šé€‰æ‹©æ€§çš„å±è”½ç«å“ä¿¡æ¯çš„è¡Œä¸ºï¼Œä¾‹å¦‚é™¤éé€šè¿‡æœç´¢åŠŸèƒ½ï¼Œä½ å¾ˆéš¾åœ¨360åº”ç”¨å•†åº—çœ‹åˆ°ç›´æ¥ç™¾åº¦çš„åº”ç”¨ã€‚æ·˜å®åº”ç”¨å•†åº—çš„å±è”½è¡Œä¸ºç›¸å¯¹è¾ƒå°‘ï¼Œä½†æ˜¯ä¼šåˆ»æ„æé«˜ä¸€äº›æ¨å¹¿åº”ç”¨çš„ä¸‹è½½æ’åã€‚å¾ˆéš¾åœ¨åº”ç”¨å•†åº—ä¸­æŠ“å–å®Œå…¨çš„åº”ç”¨ä¿¡æ¯ï¼Œå¯èƒ½éœ€è¦è§£æä¸€äº›è‡ªå·±æ‰‹åŠ¨æ”¶é›†çš„åº”ç”¨åˆ†ç±»ä¿¡æ¯ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#20570;&#20855;&#20307;&#38024;&#23545;&#28120;&#23453;&#25968;&#25454;&#30340;JSON&#23383;&#31526;&#20018;&#36827;&#34892;&#25968;&#25454;&#35299;&#26512;&#10;public class TBParser extends IParser &#123;&#10;    @Override&#10;    public ArrayList&#60;Unit&#62; onParse(String source) &#123;&#10;    &#125;&#10;&#125;&#10;//&#20570;&#20855;&#20307;&#38024;&#23545;360&#30340;JSON&#23383;&#31526;&#20018;&#36827;&#34892;&#25968;&#25454;&#35299;&#26512;&#10;public class QHParser extends IParser &#123;&#10;    @Override&#10;    public ArrayList&#60;Unit&#62; onParse(String source) &#123;&#10;    &#125;&#10;&#125;&#10;// &#38024;&#23545;&#33258;&#24049;&#23450;&#20041;&#30340;&#25968;&#25454;&#36827;&#34892;&#35299;&#26512;&#10;public class CustomParser extends IParser &#123;&#10;    @Override&#10;    public ArrayList&#60;Unit&#62; onParse(String source) &#123;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="2-2ã€Zipå‹ç¼©å’ŒHuffmanç¼–ç æ•°æ®å‹ç¼©çš„æ¯”è¾ƒ">2.2ã€Zipå‹ç¼©å’ŒHuffmanç¼–ç æ•°æ®å‹ç¼©çš„æ¯”è¾ƒ</h3><p>é’ˆå¯¹ZIPå‹ç¼©ï¼Œjavaæä¾›äº†æ ‡å‡†çš„æ¥å£<br>é’ˆå¯¹Huffmanç¼–ç å‹ç¼©æ–‡æœ¬çš„åŸç†ï¼Œå¯ä»¥å‚ç…§<a href="http://coolshell.cn/articles/7459.html" target="_blank" rel="external">è¿™é‡Œ</a>,å…·ä½“å®ç°åœ¨å·¥ç¨‹ä»£ç åœ¨ï¼šcom.ivonhoe.parser.huffman.HuffmanCode.javaçš„å®ç°<br>æ¯”è¾ƒå‘ç°é’ˆå¯¹å­—ç¬¦çš„å‹ç¼©ï¼Œç›´æ¥ZIPå‹ç¼©æ¯”å…ˆHuffmanå‹ç¼©åZIPå‹ç¼©çš„å‹ç¼©æ¯”ç‡é«˜ã€‚</p>
<h3 id="2-3ã€ä¿å­˜æ–‡æœ¬æ ¼å¼">2.3ã€ä¿å­˜æ–‡æœ¬æ ¼å¼</h3><p>ä¿å­˜çš„æ•°æ®æ–‡ä»¶åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†</p>
<ul>
<li>ç¬¬ä¸€éƒ¨åˆ†è¡¨ç¤ºå„ç§åˆ†ç±»æ•°æ®çš„æ¡ç›®æ•°é‡<br>{å¥åº·è¿åŠ¨:81}<br>{é€šè®¯ç¤¾äº¤:326}<br>{ç”Ÿæ´»ä¼‘é—²:485}<br>â€¦â€¦</li>
<li>ç¬¬äºŒéƒ¨åˆ†è¡¨ç¤ºæ‰€æœ‰çš„åŒ…åï¼ŒæŒ‰ç…§æ–‡ä»¶å¼€å§‹éƒ¨åˆ†çš„åˆ†ç±»é¡ºåºå’Œæ¡ç›®æ•°ä¾æ¬¡ä¿å­˜<br>com.hk515.patient<br>com.guokr.zhixing<br>com.yidian.health<br>â€¦â€¦</li>
<li>å¦‚ä¸Šæ‰€ç¤ºï¼Œå¥åº·è¿åŠ¨åº”ç”¨æ•°é‡81ä¸ªï¼Œåˆ†åˆ«æ˜¯ç¬¬äºŒéƒ¨åˆ†çš„1~81æ¡ç›®ï¼Œé€šè®¯ç¤¾äº¤åº”ç”¨æœ‰326ä¸ªï¼Œåˆ†åˆ«æ˜¯ç¬¬äºŒéƒ¨åˆ†çš„82~408æ¡ç›®ï¼Œä¾æ¬¡ç±»æ¨ã€‚</li>
</ul>
<h2 id="å››ã€é’ˆå¯¹äº¬ä¸œå•†å“è¯„è®ºæ•°æ®çš„è§£æ">å››ã€é’ˆå¯¹äº¬ä¸œå•†å“è¯„è®ºæ•°æ®çš„è§£æ</h2><p>é’ˆå¯¹äº¬ä¸œçš„è¯„è®ºæ•°æ®ä¿¡æ¯ï¼Œé€šè¿‡ç»§æ‰¿IParserçš„æ¥å£å®ç°å…·ä½“é’ˆå¯¹äº¬ä¸œæ•°æ®çš„è§£ææ–¹å¼ã€‚<br>é’ˆå¯¹è§£ææ•°æ®çš„ä¿å­˜ï¼Œé€šè¿‡ç»§æ‰¿IWriterçš„ä¿å­˜æ¥å£ï¼Œå®ç°é’ˆå¯¹Excelæ–‡ä»¶æ ¼å¼çš„ä¿å­˜<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">**&#10; * &#38024;&#23545;JD&#30340;&#35780;&#35770;&#25968;&#25454;&#35299;&#26512;&#10; *&#10; * @author ivonhoe&#10; */&#10;public class JDWebParser extends IParser &#123;&#10;    @Override&#10;    public ArrayList&#60;Unit&#62; onParse(String source) &#123;&#10;    &#125;&#10;&#125;&#10;&#10;**&#10; * &#36890;&#36807;&#25509;&#21475;&#20445;&#23384;&#21040;Excel&#34920;&#26684;&#20013;&#10; *&#10; * @author ivonhoe&#10; */&#10;public class JDCommentWriter extends ExlWriter &#123;&#10;    @Override&#10;    public void onWrite(List&#60;Unit&#62; list) &#123;&#10;        // TODO Auto-generated method stub&#10;        exportToSheet(&#34;comments&#34;, TITLE_STRINGS, list);&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="äº”ã€æ€»ç»“">äº”ã€æ€»ç»“</h2><ul>
<li>åœ¨pythonéƒ¨åˆ†ï¼Œåœ¨å®ç°ä¸Šåªéœ€è¦é€šè¿‡ç®€å•çš„å¾ªç¯è®©æ‰‹æœºå±å¹•ä¸åœçš„æ»‘åŠ¨å°±å¯ä»¥äº†ã€‚é’ˆå¯¹ç§»åŠ¨ç«¯æ•°æ®ä¼ è¾“çš„ç‰¹ç‚¹ï¼Œç»å¤§å¤šæ•°çš„å®¢æˆ·ç«¯åº”ç”¨å’ŒæœåŠ¡å™¨æ•°æ®ä¼ è¾“çš„æ ¼å¼éƒ½æ˜¯é€šè¿‡JSONæˆ–è€…XMLã€‚ä½ ä¸å†éœ€è¦æƒ³åŠæ³•åœ¨çˆ¬å–ç½‘ç«™é¡µé¢çš„åŸºç¡€ä¸Šè¿›è¡Œæ•°æ®æ”¶é›†ï¼Œä¸å†éœ€è¦è€ƒè™‘å¦‚ä½•ä»ç¹æ‚çš„ç½‘é¡µä¸Šç­›é€‰ä½ æƒ³è¦çš„æ­£æ–‡ã€‚é€šè¿‡æŠ“åŒ…åˆ†æçš„æ–¹å¼ï¼Œè¿™å°±åƒä¸€ä¸ªæ¼æ–—ï¼Œä½ ä¸éœ€è¦å†å»ç­›é€‰æ•°æ®ã€‚ä½ æ‹¿åˆ°çš„éƒ½æ˜¯æ ¼å¼åŒ–çš„æ•°æ®äº†ã€‚</li>
<li>å¦‚æœèƒ½å¤Ÿé›†åˆä¸€äº›æ›´æ™ºèƒ½çš„è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·å¦‚ç™¾åº¦çš„MTCæµ‹è¯•å·¥å…·ï¼Œå½•åˆ¶ä¸€äº›ç‰¹æ®Šçš„æ“ä½œè„šæœ¬ï¼Œé‚£åº”è¯¥å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ã€‚</li>
<li>å¦‚æœé’ˆå¯¹å¤æ‚çš„ä¸šåŠ¡éœ€æ±‚ï¼Œå¯ä»¥å¢åŠ äºŒçº§çš„æ¶ˆè´¹è€…é’ˆå¯¹æ•°æ®è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ã€‚</li>
<li>é’ˆå¯¹åº”ç”¨åˆ†ç±»æ•°æ®çš„ç­›é€‰ï¼Œå› ä¸ºä¸åŒæ•°æ®æºçš„ä¿¡æ¯ï¼ˆå¦‚ä¸‹è½½é‡ï¼‰ä¹Ÿå¹¶ä¸æ˜¯å®Œå…¨å¯ä¿¡çš„ã€‚è¿˜éœ€è¦åšè¿›ä¸€æ­¥çš„ç­›é€‰ã€‚ç›®å‰çš„åšæ³•æ˜¯æ ¹æ®ä¸åŒæ•°æ®æºè¿›è¡ŒåŠ æƒå¹³å‡å–æ’åçš„æ–¹å¼ï¼ˆæµ‹è¯•æ•ˆæœå¹¶ä¸å¥½ï¼‰ï¼Œæˆ–è€…æ ¹æ®æ•°æ®æºçš„å¹¶é›†å’Œåº”ç”¨ä¸‹è½½é‡çš„æ’åç»¼åˆç­›é€‰ï¼Œåº”è¯¥å¯ä»¥æœ‰æ›´å¥½çš„æ–¹å¼ã€‚</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸€ã€è®¾è®¡ç›®æ ‡&quot;&gt;ä¸€ã€è®¾è®¡ç›®æ ‡&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;è®¾è®¡ä¸€ä¸ªç›¸å¯¹é€šç”¨çš„æ•°æ®è§£æå·¥å…·ï¼Œé«˜æ•ˆè§£æé€šè¿‡æŠ“åŒ…å·¥å…·æŠ“å–çš„ç½‘ç»œæ•°æ®å†…å®¹&lt;/li&gt;
&lt;li&gt;åªéœ€è¦æ·»åŠ å°‘é‡ä»£ç ï¼Œå®ç°ä¸åŒæ•°æ®æ ¼å¼çš„è§£æï¼Œå¹¶æ”¯æŒä¸åŒæ–‡ä»¶æ ¼å¼ä¿å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;äºŒã€å®æ–½æ­¥éª¤&quot;&gt;äºŒã€å®æ–½æ­¥éª¤&lt;/h2&gt;&lt;p&gt;æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯ä½¿ç”¨MonkeyRunnerè‡ªåŠ¨æµ‹è¯•è„šæœ¬å¯¹æ‰‹æœºè¿›è¡ŒæŸä¸€äº›å…·ä½“çš„æ“ä½œæ—¶ï¼Œé€šè¿‡Fiddlerå·¥å…·æˆªå–æ‰‹æœºAppçš„Httpé€šè®¯æ•°æ®ï¼Œé€šè¿‡å¯¹è¿™äº›æ•°æ®è¿›è¡Œè§£æä»è€Œè¾¾åˆ°è·å–åº”ç”¨æ•°æ®çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id=&quot;2-1ã€ç¼–å†™MonkeyRunnerè‡ªåŠ¨è„šæœ¬&quot;&gt;2.1ã€ç¼–å†™MonkeyRunnerè‡ªåŠ¨è„šæœ¬&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;ç¯å¢ƒå’Œå·¥å…·ï¼šPythonï¼ŒAndroid SDKå¼€å‘ç¯å¢ƒï¼Œ Androidæ‰‹æœºä¸€å°ï¼ˆdebugé€‰é¡¹è¿æ¥PCï¼‰&lt;/li&gt;
&lt;li&gt;è„šæœ¬ç›®æ ‡ï¼šå¾ªç¯å¯¹æ‰‹æœºå±å¹•è¿›è¡Œä¸Šåˆ’æ“ä½œ&lt;/li&gt;
&lt;li&gt;ä»£ç ï¼š
    
    </summary>
    
    
      <category term="æ•°æ®è§£æ" scheme="https://ivonhoe.github.io/tags/%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90/"/>
    
      <category term="ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼" scheme="https://ivonhoe.github.io/tags/%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Drawable,ä»ç®€åŒ–å¸ƒå±€è°ˆèµ·</title>
    <link href="https://ivonhoe.github.io/2015/04/28/Drawable-%E4%BB%8E%E7%AE%80%E5%8C%96%E5%B8%83%E5%B1%80%E8%B0%88%E8%B5%B7/"/>
    <id>https://ivonhoe.github.io/2015/04/28/Drawable-ä»ç®€åŒ–å¸ƒå±€è°ˆèµ·/</id>
    <published>2015-04-28T15:31:29.000Z</published>
    <updated>2016-03-06T13:37:50.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€Drawbleæ˜¯å¹²å˜›çš„ï¼Ÿ">ä¸€ã€Drawbleæ˜¯å¹²å˜›çš„ï¼Ÿ</h2><p>è¯´åˆ°Drawableè‚¯å®šä¼šç¬¬ä¸€æ—¶é—´æƒ³åˆ°å›¾ç‰‡èµ„æºï¼Œå¯èƒ½æœ‰äººä¼šè®¤ä¸ºDrawableå°±æ˜¯å›¾ç‰‡ã€‚Drawbleä»å­—é¢ä¸Šè¯´å°±æ˜¯â€œå¯ç»˜åˆ¶çš„â€ï¼Œgoogleæ–‡æ¡£çš„æè¿°:â€œA Drawable is a general abstraction for â€œsomething that can be drawn.â€â€ï¼ŒDrawableå…¶å®å°±æ˜¯ä¸ºé‚£äº›â€å¯ä»¥è¢«ç»˜åˆ¶çš„â€™â€™æä¾›çš„æŠ½è±¡ç±»ã€‚</p>
<ul>
<li><strong>å“ªäº›ä¸œè¥¿æ˜¯â€can be drawnâ€ï¼Ÿ</strong></li>
<li><strong>ç»˜åˆ¶åœ¨å“ªé‡Œçš„ï¼Ÿ</strong></li>
</ul>
<p>çœ‹ä¸‹androidåŸç”Ÿçš„Drawableå’ŒCanvasæä¾›äº†çš„ç»˜å›¾çš„æ¥å£ï¼š<a href="http://developer.android.com/reference/android/graphics/drawable/package-summary.html" target="_blank" rel="external">android.graphics.drawable</a><br><a href="http://developer.android.com/reference/android/graphics/Canvas.html" target="_blank" rel="external">android.graphics.Canvas</a>ã€‚Canvasæä¾›äº†ä¸€ç³»åˆ—çš„æ¥å£å»å®ç°ç»˜åˆ¶æƒ³è¦çš„å›¾å½¢ã€å›¾ç‰‡ã€é¢œè‰²æˆ–è€…å…¶ä»–somethingï¼ŒDrawableå°±æ˜¯ä¸ºäº†è¿™äº›â€somethingâ€æä¾›çš„ã€‚</p>
<a id="more"></a>
<h2 id="äºŒã€å¦‚ä½•è‡ªå®šä¹‰Drawableï¼Ÿå¦‚ä½•ç®€åŒ–å¸ƒå±€ï¼Ÿ">äºŒã€å¦‚ä½•è‡ªå®šä¹‰Drawableï¼Ÿå¦‚ä½•ç®€åŒ–å¸ƒå±€ï¼Ÿ</h2><p><img src="/res/drawable/1.jpg" alt="Canvaså’Œå¸ƒå±€å®ç°"></p>
<p>ç›¸ä¿¡ä¸€å®šè§è¿‡ç±»ä¼¼è¿™æ ·çš„å¸ƒå±€ï¼Œåœ¨Androidç³»ç»Ÿä¸­å¦‚ä½•æŠŠæƒ³è¦çš„å›¾å½¢ç»˜åˆ¶å¤„ç†ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>æŠŠä½ æƒ³è¦çš„è§†å›¾ç®€å•çš„å®šä¹‰åˆ°å¸ƒå±€æ–‡ä»¶ä¸­ï¼Œç³»ç»Ÿè¯»å–å¸ƒå±€æ–‡ä»¶ç»˜åˆ¶è§†å›¾</li>
<li>æŠŠæƒ³è¦çš„å›¾å½¢é€šè¿‡canvasçš„ç»˜å›¾æ¥å£ç›´æ¥è¿›è¡Œç»˜åˆ¶<br>åœ¨ç¬¬äºŒç§æ–¹å¼ä¸­ï¼Œä½ éœ€è¦é€šè¿‡æ¯”å¦‚Drawableï¼Œæ¯”å¦‚è‡ªå®šä¹‰çš„Viewçš„onDraw()æ–¹æ³•ï¼Œæˆ–è€…è°ƒç”¨Canvasçš„drawâ€¦()æ–¹æ³•ï¼Œè€ŒViewçš„æ–¹å¼å®é™…ä¸Šä¹Ÿæ˜¯Canvasç»˜åˆ¶çš„æ–¹å¼ï¼ŒViewä¹Ÿå¯ä»¥çœ‹åšæ˜¯å¯¹Canvasç»˜å›¾æ¥å£çš„åŒ…è£…ã€‚è€Œç›´æ¥ç»˜åˆ¶åˆ°Canvasä¸Šçš„æ–¹å¼ä¹Ÿå•å•æ˜¯è¿™äº›ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸Šä½ å¯ä»¥é€šè¿‡è°ƒç”¨Viewçš„invalidate()æ–¹æ³•è§¦å‘ç»˜åˆ¶ï¼Œåœ¨onDraw()æ–¹æ³•å¤„ç†ç»˜å›¾çš„å›è°ƒã€‚å¦ä¸€ç§éä¸»çº¿ç¨‹ç»˜åˆ¶çš„æ–¹å¼å°±æ˜¯SurfaceViewäº†ã€‚</li>
</ul>
<p>é€šè¿‡Drawableç»˜åˆ¶æƒ³è¦çš„å›¾å½¢æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼ŒDrawableæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œdraw()æ–¹æ³•æä¾›äº†ç»˜åˆ¶çš„Canvasï¼ŒinvalidateSelf()æ–¹æ³•æä¾›äº†é‡ç»˜çš„å¯èƒ½ã€‚Drawableçš„æŠ½è±¡æ–¹æ³•åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><p><strong>draw(Canvas canvas)</strong>å°†æƒ³è¦çš„ä¸œè¥¿ç»˜åˆ¶åˆ°è¿™ä¸ªcanvaså¯¹è±¡ä¸Š</p>
</li>
<li><p><strong>setAlpha(int alpha)</strong> ä¸ºdrawableæŒ‡å®šä¸€ä¸ªalphaå€¼ï¼Œ0ä»£è¡¨å…¨é€æ˜ï¼Œ255ä»£è¡¨å…¨ä¸é€æ˜ã€‚</p>
</li>
<li><p><strong>setColorFilter(ColorFilter cf)</strong> ä¸ºdrawableæŒ‡å®šä¸€ä¸ªé¢œè‰²è¿‡æ»¤å™¨</p>
</li>
<li><p><strong>getOpacity()</strong> è·å–é€æ˜åº¦</p>
</li>
</ul>
<p>å®ç°è‡ªå®šä¹‰çš„Drawableåªéœ€è¦ç»§æ‰¿Drawable.javaï¼Œå¹¶ä¸”åœ¨drawæ–¹æ³•é‡Œé€šè¿‡canvasç»˜åˆ¶éœ€è¦çš„å›¾å½¢å°±å¯ä»¥äº†ï¼Œå¬èµ·æ¥å¾ˆç®€å•ã€‚æ— è®ºæ˜¯ä¸€ç»„å›¾ç‰‡ã€ä¸€æ¡æ›²çº¿è¿˜æ˜¯ä¸€ä¸ªè‰²å—ï¼Œæ‰€æœ‰ä½ æƒ³è¦çš„å›¾å½¢éƒ½å¯é€šè¿‡canvaså‚æ•°ç»˜åˆ¶ä¸Šå»ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ä½•ä½¿ç”¨Drawableç®€åŒ–ä¸Šå›¾æ‰€ç¤ºçš„ç½‘æ ¼å¸ƒå±€ï¼Ÿå‡è®¾ä½ éœ€è¦åœ¨ç½‘æ ¼å¸ƒå±€é‡Œæ˜¾ç¤ºä¸åŒçš„å›¾ç‰‡ï¼Œå°±å¯ä»¥æŠŠåœºæ™¯å¾®ä¿¡æœ‹å‹ç¾¤ç»„çš„å›¾æ ‡ã€‚å½“ç„¶ä½ å¯ä»¥ä½¿ç”¨viewå¸ƒå±€æ¥åšï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨canvasæ–¹å¼ã€‚æ ¹æ®Drawableæ·»åŠ çš„é¡ºåºä¾æ¬¡ç¡®å®šæ¯ä¸ªå›¾ç‰‡çš„åæ ‡ä½ç½®ï¼Œåœ¨draw()æ–¹æ³•é‡Œæ ¹æ®æ¯ä¸ªå›¾ç‰‡çš„åæ ‡ä½ç½®å’Œå›¾ç‰‡æ˜¾ç¤ºä½ç½®ç»˜åˆ¶åˆ°canvasä¸Šã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Override&#10;public void draw(Canvas canvas) &#123;&#10;    final int N = Math.min(mChildDrawable.size(), mRowCount * mColumnCount);&#10;    for (int i = 0; i &#60; N; i++) &#123;&#10;        ChildDrawable itemToDraw = mChildDrawable.get(i);&#10;        Drawable drawable = itemToDraw.mDrawable;&#10;        if (drawable != null) &#123;&#10;            itemToDraw.mDrawable.setBounds(itemToDraw.mInsetL, itemToDraw.mInsetT, itemToDraw.mInsetR, itemToDraw.mInsetB);&#10;            drawable.draw(canvas);&#10;        &#125;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="ä¸‰ã€è®©DrawableåŠ¨èµ·æ¥æ€ä¹ˆæ ·ï¼Ÿ">ä¸‰ã€è®©DrawableåŠ¨èµ·æ¥æ€ä¹ˆæ ·ï¼Ÿ</h2><ul>
<li><strong>é¦–å…ˆçœ‹ä¸‹Drawableçš„Canvasä»å“ªé‡Œæ¥</strong></li>
</ul>
<p>ä¸€èˆ¬ä½¿ç”¨ImageViewæ˜¾ç¤ºdrawableï¼Œçœ‹ä¸‹ImageViewçš„onDraw(Canvas canvas)ï¼Œå¯ä»¥çœ‹åˆ°Drawableåœ¨ImageViewé‡Œçš„ç»˜åˆ¶å‘ç”Ÿåœ¨Viewçš„onDrawå›è°ƒé‡Œï¼Œæ ¹æ®scaleTypeå’Œpaddingç¡®å®šç»˜åˆ¶çš„æ–¹å¼å’Œä½ç½®ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protected void onDraw(Canvas canvas) &#123;&#10;    super.onDraw(canvas);&#10;    ....&#10;&#10;    // mDrawMatrix&#26681;&#25454;ImageView&#30340;ScaleType&#26469;&#30830;&#23450;&#30340;&#10;    if (mDrawMatrix == null &#38;&#38; mPaddingTop == 0 &#38;&#38; mPaddingLeft == 0) &#123;&#10;        mDrawable.draw(canvas);&#10;    &#125; else &#123;&#10;        ......&#10;        mDrawable.draw(canvas);&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>Viewç»˜åˆ¶Background Drawableåœ¨draw(Canvas canvas)æ–¹æ³•ï¼Œå¹¶åœ¨setBackgroundDrawableæ—¶ä¼šæ‰§è¡Œbackground.setCallback(this)æ“ä½œã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// Step 1, draw the background, if needed&#10;if (background != null) &#123;&#10;     ......&#10;     if ((scrollX | scrollY) == 0) &#123;&#10;         background.draw(canvas);&#10;     &#125; else &#123;&#10;         ......&#10;         background.draw(canvas);&#10;         ......&#10;     &#125;&#10; &#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>å†çœ‹Drawableå¦‚ä½•é‡ç»˜</strong>ï¼Œ<br>Drawableæ˜¯ä¾èµ–Canvasç»˜åˆ¶çš„ï¼ŒæŸ¥çœ‹Drawableæºç å‘ç°è°ƒç”¨invalidateSelf()æ–¹æ³•éœ€è¦è·å–Callbackï¼Œåœ¨Callbackæ˜¯ç©ºçš„æƒ…å†µä¸‹æ— æ³•é‡ç»˜Drawableã€‚é‚£ä¹ˆåœ¨Viewé‡Œå¦‚ä½•å®ç°Drawableçš„é‡ç»˜ï¼Œæ˜¾ç„¶éœ€è¦å…ˆè®¾ç½®Drawableçš„é‡ç»˜å›è°ƒï¼ŒView.javaå®ç°äº†Drawable.Callbackæ¥å£ï¼Œåœ¨Viewé‡Œè°ƒç”¨setImageDrawable()æ–¹æ³•é‡Œä¼šé¦–å…ˆè®¾ç½®å½“å‰Viewä¸ºDrawableçš„å›è°ƒã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public void invalidateSelf() &#123;&#10;    final Callback callback = getCallback();&#10;    if (callback != null) &#123;&#10;        callback.invalidateDrawable(this);&#10;    &#125;&#10;&#125;&#10;&#10;public static interface Callback &#123;&#10;    public void invalidateDrawable(Drawable who);&#10;    public void scheduleDrawable(Drawable who, Runnable what, long when);&#10;    public void unscheduleDrawable(Drawable who, Runnable what);&#10;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ImageViewè°ƒç”¨invalidateè§¦å‘é‡ç»˜ï¼Œå›è°ƒImageViewçš„onDraw()æ–¹æ³•ï¼Œå®ŒæˆDrawableçš„é‡ç»˜ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Override&#10;public void invalidateDrawable(Drawable dr) &#123;&#10;    if (dr == mDrawable) &#123;&#10;        /* we invalidate the whole view in this case because it&#39;s very&#10;         * hard to know where the drawable actually is. This is made&#10;         * complicated because of the offsets and transformations that&#10;         * can be applied. In theory we could get the drawable&#39;s bounds&#10;         * and run them through the transformation and offsets, but this&#10;         * is probably not worth the effort.&#10;         */&#10;        invalidate();&#10;    &#125; else &#123;&#10;        super.invalidateDrawable(dr);&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>äº†è§£äº†Drawableç»˜åˆ¶çš„ç”»å¸ƒå’Œé‡ç»˜çš„æ–¹æ³•ï¼Œå¦‚ä½•å®ç°åŠ¨ç”»çš„Drawableåªéœ€è¦æŒ‰æ—¶é‡ç»˜Drawableå°±å¯ä»¥äº†ï¼Œç”¨åŠ¨ç”»æ§åˆ¶é‡ç»˜æ•ˆæœã€‚å…·ä½“å®ç°å¯ä»¥çœ‹<a href="https://github.com/Ivonhoe/FancyDrawable" target="_blank" rel="external">https://github.com/Ivonhoe/FancyDrawable</a>ï¼Œç°åœ¨çœ‹å¦‚ä½•å®ç°æˆ‘åœ¨<a href="https://ivonhoe.github.io/2015/04/17/%E5%9F%BA%E4%BA%8E%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF%E7%9A%84Android%E5%8A%A8%E7%94%BB%E5%B7%AE%E5%80%BC%E5%99%A8/">è´èµ›å°”æ’å€¼å™¨</a>é‡Œè¯´è¿‡çš„BallsLineè¿›åº¦æ¡æ•ˆæœï¼Œåªéœ€è¦åœ¨æ¯æ¬¡é‡ç»˜çš„å›è°ƒé‡ŒåŠ¨æ€çš„æ§åˆ¶æ¯ä¸ªå°çƒç‚¹çš„ä½ç½®å°±å¯ä»¥äº†ï¼Œéœ€è¦çš„åŠ¨ç”»æ’å€¼å™¨å‚æ•°å¯ä»¥å‚è€ƒ<a href="http://thecodeplayer.com/walkthrough/windows-phone-loading-animation" target="_blank" rel="external">Webä»£ç </a>ã€‚</p>
<p><img src="/res/drawable/2.jpg" alt="åŠ¨æ€Drawableå’ŒGridDrawable"></p>
<pre><code><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> FRAME_DURATION = <span class="number">1000</span> / <span class="number">60</span>;

<span class="keyword">protected</span> Runnable mUpdater = <span class="keyword">new</span> Runnable() {
    <span class="annotation">@Override</span>
    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{
        onFrame();

        scheduleSelf(mUpdater, SystemClock.uptimeMillis() + FRAME_DURATION);
        invalidateSelf();
    }
};

<span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>{
    <span class="keyword">if</span> (!isRunning()) {
        mIsRunning = <span class="keyword">true</span>;

        <span class="comment">// start</span>
        onStart();
        scheduleSelf(mUpdater, SystemClock.uptimeMillis() + FRAME_DURATION);
        invalidateSelf();
    }
}

<span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>{
    <span class="keyword">if</span> (isRunning()) {
        mIsRunning = <span class="keyword">false</span>;
        unscheduleSelf(mUpdater);

        <span class="comment">//stop</span>
        onStop();
    }
}
</code></pre><h1 id="äº”ã€å‚è€ƒæ–‡æ¡£">äº”ã€å‚è€ƒæ–‡æ¡£</h1><p><a href="http://developer.android.com/reference/android/graphics/drawable/Drawable.html" target="_blank" rel="external">http://developer.android.com/reference/android/graphics/drawable/Drawable.html</a></p>
<p><a href="http://developer.android.com/guide/topics/graphics/2d-graphics.html" target="_blank" rel="external">http://developer.android.com/guide/topics/graphics/2d-graphics.html</a></p>
<p><a href="http://wiresareobsolete.com/2012/12/textdrawable-draw-some-text/" target="_blank" rel="external">http://wiresareobsolete.com/2012/12/textdrawable-draw-some-text/</a></p>
<p><a href="http://cyrilmottier.com/2012/11/27/actionbar-on-the-move/" target="_blank" rel="external">http://cyrilmottier.com/2012/11/27/actionbar-on-the-move/</a></p>
<p><a href="http://antoine-merle.com/blog/2013/11/12/make-your-progressbar-more-smooth/" target="_blank" rel="external">http://antoine-merle.com/blog/2013/11/12/make-your-progressbar-more-smooth/</a></p>
<h2 id="å…­ã€Github">å…­ã€Github</h2><p><a href="https://github.com/Ivonhoe/FancyDrawable" target="_blank" rel="external">https://github.com/Ivonhoe/FancyDrawable</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸€ã€Drawbleæ˜¯å¹²å˜›çš„ï¼Ÿ&quot;&gt;ä¸€ã€Drawbleæ˜¯å¹²å˜›çš„ï¼Ÿ&lt;/h2&gt;&lt;p&gt;è¯´åˆ°Drawableè‚¯å®šä¼šç¬¬ä¸€æ—¶é—´æƒ³åˆ°å›¾ç‰‡èµ„æºï¼Œå¯èƒ½æœ‰äººä¼šè®¤ä¸ºDrawableå°±æ˜¯å›¾ç‰‡ã€‚Drawbleä»å­—é¢ä¸Šè¯´å°±æ˜¯â€œå¯ç»˜åˆ¶çš„â€ï¼Œgoogleæ–‡æ¡£çš„æè¿°:â€œA Drawable is a general abstraction for â€œsomething that can be drawn.â€â€ï¼ŒDrawableå…¶å®å°±æ˜¯ä¸ºé‚£äº›â€å¯ä»¥è¢«ç»˜åˆ¶çš„â€™â€™æä¾›çš„æŠ½è±¡ç±»ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å“ªäº›ä¸œè¥¿æ˜¯â€can be drawnâ€ï¼Ÿ&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»˜åˆ¶åœ¨å“ªé‡Œçš„ï¼Ÿ&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çœ‹ä¸‹androidåŸç”Ÿçš„Drawableå’ŒCanvasæä¾›äº†çš„ç»˜å›¾çš„æ¥å£ï¼š&lt;a href=&quot;http://developer.android.com/reference/android/graphics/drawable/package-summary.html&quot;&gt;android.graphics.drawable&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://developer.android.com/reference/android/graphics/Canvas.html&quot;&gt;android.graphics.Canvas&lt;/a&gt;ã€‚Canvasæä¾›äº†ä¸€ç³»åˆ—çš„æ¥å£å»å®ç°ç»˜åˆ¶æƒ³è¦çš„å›¾å½¢ã€å›¾ç‰‡ã€é¢œè‰²æˆ–è€…å…¶ä»–somethingï¼ŒDrawableå°±æ˜¯ä¸ºäº†è¿™äº›â€somethingâ€æä¾›çš„ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Android" scheme="https://ivonhoe.github.io/tags/Android/"/>
    
      <category term="Drawable" scheme="https://ivonhoe.github.io/tags/Drawable/"/>
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://ivonhoe.github.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>ColorOSå’ŒAPEXæ¡Œé¢äº§å“åˆ†æ</title>
    <link href="https://ivonhoe.github.io/2015/04/23/ColorOS%E5%92%8CAPEX%E6%A1%8C%E9%9D%A2%E4%BA%A7%E5%93%81%E5%88%86%E6%9E%90/"/>
    <id>https://ivonhoe.github.io/2015/04/23/ColorOSå’ŒAPEXæ¡Œé¢äº§å“åˆ†æ/</id>
    <published>2015-04-23T13:30:35.000Z</published>
    <updated>2016-03-06T13:37:30.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€æ¡Œé¢åŸºæœ¬æ“ä½œ">ä¸€ã€æ¡Œé¢åŸºæœ¬æ“ä½œ</h2><h3 id="1-1_å®‰è£…åˆä½“éªŒ">1.1 å®‰è£…åˆä½“éªŒ</h3><ul>
<li><p><strong>å®‰è£…åŒ…å¤§å°</strong><br>ColorOSæ¡Œé¢å«æœ‰ä¸¤ä¸ªå®‰è£…åŒ…ï¼ŒOppoLauncher.apk(2.8M)å’ŒOppoLauncherSystem.apk(8.5KB)<br>APEXæ¡Œé¢å®‰è£…åŒ…å¤§å°4.36Mï¼Œå¹¶ä¸”è¿›è¡Œäº†ä»£ç æ··æ·†</p>
</li>
<li><p><strong>é»˜è®¤æ¡Œé¢</strong><br>ColorOSæ¡Œé¢ï¼Œå‰ä¸¤ä¸ªå±å¹•æ˜¯ç³»ç»Ÿåº”ç”¨ï¼ŒåŒ…å«ä¸€ä¸ªå°å·¥å…·çš„æ–‡ä»¶å¤¹ï¼Œå…¶ä»–æ‰€æœ‰åº”ç”¨å¹³é“ºæ¡Œé¢ï¼Œç”¨æˆ·è‡ªå·±å®‰è£…çš„åº”ç”¨ä»ç¬¬ä¸‰å±å¼€å§‹å¹³é“ºã€‚<br>APEXæ¡Œé¢ï¼Œé»˜è®¤çš„åº”ç”¨æ’åˆ—å°±å¾ˆéšæ„ï¼Œåœ¨ä¸åŒçš„æ‰‹æœºä¸Šçš„è¡¨ç°æœ‰å·®åˆ«ï¼Œåº”è¯¥æ˜¯ä¸åŒæ‰‹æœºçš„ç³»ç»Ÿåº”ç”¨çš„åŒ…åä¸åŒï¼Œé€ æˆAPEXçš„é¢„åˆ¶æ¡Œé¢å¹¶ä¸æ˜¯é¡ºåºç´§å¯†åœ¨æ¡Œé¢æ˜¾ç¤ºåº”ç”¨å›¾æ ‡ã€‚</p>
<a id="more"></a>
</li>
</ul>
<h3 id="1-2_æ‰“å¼€åº”ç”¨">1.2 æ‰“å¼€åº”ç”¨</h3><p>   æ¡Œé¢çš„æœ¬åˆ†æ— éå°±æ˜¯å¸®åŠ©ç”¨æˆ·æ‰“å¼€å…¶ä»–åº”ç”¨äº†ï¼Œä½“éªŒColorOSå’ŒAPEXçš„æ‰“å¼€åº”ç”¨æ“ä½œè¿‡ç¨‹æ²¡æœ‰å·®åˆ«ï¼Œé¦–å…ˆæ˜¯ç”¨æˆ·æ‰¾åˆ°ç›¸åº”çš„åº”ç”¨ï¼Œé€šè¿‡å•å‡»å›¾æ ‡æ‰“å¼€åº”ç”¨ã€‚APEXåŸºäºAndroidåŸç”Ÿæ¡Œé¢ï¼Œä¿ç•™äº†æŠ½å±‰åŠŸèƒ½ï¼Œæ‰€ä»¥é’ˆå¯¹è¿˜æ²¡æœ‰æ·»åŠ åˆ°æ¡Œé¢çš„å›¾æ ‡è¿˜éœ€è¦å…ˆè¿›å…¥æŠ½å±‰ç•Œé¢ã€‚ColorOSçš„å¦ä¸€ä¸ªç»†èŠ‚æ˜¯æ–°å®‰è£…çš„åº”ç”¨å›¾æ ‡åœ¨å›¾æ ‡ä¸Šä¼šæœ‰ç±»ä¼¼IOSçš„æç¤ºï¼Œæé†’ç”¨æˆ·è¿™æ˜¯ä¸€ä¸ªæ–°å®‰è£…çš„åº”ç”¨ï¼Œæ‰“å¼€æ–°å®‰è£…åº”ç”¨åæç¤ºå°±æ¶ˆå¤±ã€‚</p>
<h3 id="1-3_ç§»åŠ¨å›¾æ ‡å’Œå½’çº³æ–‡ä»¶å¤¹">1.3 ç§»åŠ¨å›¾æ ‡å’Œå½’çº³æ–‡ä»¶å¤¹</h3><ul>
<li><p><strong>é•¿æŒ‰å’Œæ‹–åŠ¨</strong><br>å‡ ä¹æ‰€æœ‰çš„æ¡Œé¢äº§å“ç§»åŠ¨å›¾æ ‡çš„æ“ä½œéƒ½æ˜¯é•¿æŒ‰å›¾æ ‡æ‹–æ‹½å³å¯ç§»åŠ¨ï¼ŒColorOSåœ¨é•¿æŒ‰æ—¶æ‰€æœ‰å›¾æ ‡ä¼šè¿›å…¥æŠ–åŠ¨çš„æ¨¡å¼ï¼Œè¿™ç‚¹åˆå’ŒIOSçš„è¡¨ç°ä¸€ç›´ï¼ŒåŒæ—¶å¯å¸è½½çš„åº”ç”¨å·¦ä¸Šè§’ä¼šå‡ºç°å¯åˆ é™¤çš„æç¤ºã€‚åœ¨æŠ–åŠ¨æ¨¡å¼ä¸‹å¯ç›´æ¥å¸è½½åº”ç”¨ã€‚<br>ç›¸æ¯”APEXåœ¨é•¿æŒ‰æ¡Œé¢å›¾æ ‡åä¼šå‡ºç°ä¸€ä¸ªå¼¹å‡ºçš„è§†å›¾ï¼Œä¸Šé¢å¯ä»¥è¿›è¡Œåˆ é™¤ã€ç¼–è¾‘å›¾æ ‡åç§°ã€å¢åŠ æ‰‹åŠ¿ç­‰æ“ä½œã€‚åœ¨æ‹–åŠ¨è¿‡ç¨‹ä¸­ï¼ŒColorOSçš„å›¾æ ‡ä¼šæ ¹æ®æ‹–åŠ¨åå“æœ‰å€¾æ–œçš„æ•ˆæœã€‚</p>
</li>
<li><p><strong>å½’çº³åº”ç”¨åˆ°æ–‡ä»¶å¤¹</strong><br>ColorOSã€APEXçš„æ¡Œé¢å›¾æ ‡åˆå¹¶éƒ½æ˜¯åŸºäºåŸç”ŸLauncherçš„ï¼Œæ²¡æœ‰æœ¬è´¨çš„å·®åˆ«ï¼Œéƒ½ä¸æ”¯æŒåŒæ—¶åˆå¹¶ä¸¤ä¸ªæ–‡ä»¶å¤¹ã€‚ä½†åƒæ¯”è¾ƒä¹‹ä¸‹ï¼ŒColorOSåœ¨æ‹–åŠ¨å›¾æ ‡æ›´æ¢ä½ç½®ä¸Šæ”¯æŒè·¨å±æŸ¥æ‰¾ä½ç½®ï¼Œå³å½“ä»Dockä½ç½®æ‹–å‘ä¸€ä¸ªæ’æ»¡å›¾æ ‡çš„å±å¹•æ—¶ï¼Œå›¾æ ‡ä¼šè‡ªåŠ¨å‘åä¸€ä¸ªå±å¹•å¯»æ‰¾ä½ç½®ã€‚ç›¸æ¯”å…¶ä»–æ¡Œé¢äº§å“å¾ˆå°‘æœ‰å…³æ³¨è¿™ä¸ªç»†èŠ‚çš„ã€‚åŒæ—¶ColorOSçš„æ–‡ä»¶å¤¹ä¸­æä¾›äº†ä¸€ä¸ªâ€œ+â€æ“ä½œï¼Œå¯ä»¥æ‰¹é‡é€‰æ‹©æ¡Œé¢ä¸Šçš„å›¾æ ‡åŠ å…¥å½“å‰æ–‡ä»¶å¤¹ä¸­ï¼Œé’ˆå¯¹ç”¨æˆ·å½’çº³åº”ç”¨è¡Œä¸ºé¿å…äº†åå¤æ‹–åŠ¨å’Œé€‰æ‹©çš„æ“ä½œï¼Œä½†æ˜¯â€œ+â€æ“ä½œåªèƒ½é’ˆå¯¹æ¡Œé¢å›¾æ ‡ï¼Œå·²ç»æ”¾å…¥å…¶ä»–æ–‡ä»¶å¤¹çš„å›¾æ ‡ä¸åœ¨è¢«é€‰åˆ—è¡¨ä¸­ï¼ŒåŒæ—¶â€œ+â€æ”¯æŒæŠŠå½“å‰æ–‡ä»¶å¤¹ä¸­çš„å›¾æ ‡ç§»å‡ºæ–‡ä»¶å¤¹çš„æ“ä½œï¼Œç§»å‡ºçš„å›¾æ ‡è‡ªåŠ¨æ”¾åˆ°æ¡Œé¢æœ€åçš„ä½ç½®ã€‚</p>
</li>
</ul>
<h3 id="1-4_å¸è½½åº”ç”¨">1.4 å¸è½½åº”ç”¨</h3><p>ColorOSåœ¨é•¿æŒ‰å›¾æ ‡è¿›å…¥è·³åŠ¨æ¨¡å¼åï¼Œå¯å¸è½½å›¾æ ‡å·¦ä¸Šè§’éƒ½ä¼šå‡ºç°åˆ é™¤æç¤ºï¼Œåˆæ˜¯IOSçš„ç—•è¿¹ã€‚<br>APEXå¸è½½æ“ä½œç›¸å¯¹åŸç”ŸLauncheråŒæ ·æ²¡æœ‰å·®åˆ«ã€‚å¥½æ‡’å•Šï¼åœ¨æ¡Œé¢ä¸Šçš„å›¾æ ‡åªæä¾›åˆ é™¤æ¥å£ï¼Œä»æŠ½å±‰ä¸­é•¿æŒ‰çš„å›¾æ ‡æ‰å¯ä»¥åˆ é™¤ã€‚åˆ é™¤åº”ç”¨åŒæ ·ä¼šå¼¹å‡ºæ¡†ç¡®è®¤ã€‚</p>
<h2 id="äºŒã€ç”¨æˆ·æ„ŸçŸ¥">äºŒã€ç”¨æˆ·æ„ŸçŸ¥</h2><h3 id="2-1_å›¾æ ‡é£æ ¼å’Œæ¡Œé¢ä¸»é¢˜èŒƒå›´">2.1 å›¾æ ‡é£æ ¼å’Œæ¡Œé¢ä¸»é¢˜èŒƒå›´</h3><ul>
<li><p><strong>å›¾æ ‡é£æ ¼</strong><br>ColorOSçš„é»˜è®¤å›¾æ ‡å¹¶æ²¡æœ‰å®šä¹‰åº”ç”¨å›¾æ ‡çš„å½¢çŠ¶ä¹Ÿæ²¡æœ‰åŠ åœ†è§’ï¼Œä½†æ˜¯å°½é‡ä¿è¯äº†å›¾æ ‡å¤§å°çš„ç»Ÿä¸€ï¼ŒåŒæ—¶é»˜è®¤ç³»ç»Ÿå›¾æ ‡åŠ äº†é˜´å½±ï¼Œåœ¨è‰²å½©ä¸Šç³»ç»Ÿé»˜è®¤å›¾æ ‡ä»¥ç»¿è‰²å’Œç™½è‰²è‰²è°ƒå±…å¤šï¼Œå› ä¸ºå¹¶æ²¡æœ‰ç»™æ‰€æœ‰çš„å›¾æ ‡åŠ èƒŒæ¿ï¼Œæ‰€ä»¥æ•´ä½“çš„æ„Ÿè§‰æ˜¯è¾¨è¯†åº¦å¾ˆå¥½ï¼Œå°½é‡ä¿æŒäº†åº”ç”¨å›¾æ ‡çš„æœ¬è‰²ã€‚ä½†æ˜¯ç»Ÿä¸€åº¦ä¸å¤Ÿï¼Œä¸è¿‡å› ä¸ºæœ‰æ¢ä¸»é¢˜åŠŸèƒ½è¿™ç‚¹ä¹Ÿå¹¶æ²¡æœ‰ä»€ä¹ˆä¸å¥½ï¼Œä¸å–œæ¬¢é»˜è®¤å›¾æ ‡ï¼Ÿé—´æ¥çš„æŠŠç”¨æˆ·èµ¶å‘äº†ä¸»é¢˜å•†åº—ã€‚ç›¸æ¯”APEXçš„å›¾æ ‡é£æ ¼ï¼Œè¿˜æ˜¯ä¸€ä¸ªå­—ï¼Œâ€œæ‡’æƒ°â€ã€‚å’ŒåŸç”ŸLauncherå‡ ä¹æ²¡æœ‰åŒºåˆ«ï¼Œå¯¼è‡´ä¸‰æ–¹åº”ç”¨çš„æ˜¾ç¤ºæ•ˆæœå¾ˆå·®ã€‚</p>
</li>
<li><p><strong>æ¡Œé¢ä¸»é¢˜èŒƒå›´</strong><br>ColorOSçš„ä¸»é¢˜èŒƒå›´</p>
</li>
<li>å›¾æ ‡ï¼ŒåŒ…å«èƒŒæ¿ã€åœ†è§’ã€å¤§å°ã€å›¾æ ‡å†…å®¹<br>l å£çº¸ï¼ŒåŒ…æ‹¬åŠ¨æ€å£çº¸(ColorOSçš„ä¸€å¤§ç‰¹è‰²)ã€é™æ€å£çº¸<br>l æ–‡ä»¶å¤¹å›¾æ ‡èƒŒæ™¯<br>l é¡µé¢æŒ‡ç¤ºæŒ‡ç¤ºæ ·å¼</li>
</ul>
<p>APEX:éœ€è¦åˆ°google playä¸‹è½½</p>
<h3 id="2-2_åŠ¨ç”»å’Œå£°æ•ˆ">2.2 åŠ¨ç”»å’Œå£°æ•ˆ</h3><p>ColorOSæ¡Œé¢çš„åŠ¨ç”»åªè¦é›†ä¸­åœ¨ç¼–è¾‘æ¨¡å¼ä¸­ï¼Œé•¿æŒ‰å›¾æ ‡çš„è·³åŠ¨æ¨¡å¼å’Œä¸‹ä¾§ç¼–è¾‘æ¡†ç©ºé—´çš„è¿›åœºåŠ¨ç”»ã€‚æœ€æœ‰äº®ç‚¹çš„åŠ¨ç”»å¤©æ°”æ•ˆæœå’Œå…¶ä»–çš„åŠ¨æ€å£çº¸ï¼Œæ¯”å¦‚é»˜è®¤çš„è’²å…¬è‹±ä¼šéšç€æ»‘åŠ¨æ–¹å‘é£˜åŠ¨ã€‚åœ¨éŸ³æ•ˆæ–¹é¢ï¼ŒColorOSåœ¨ç”¨æˆ·çš„æ“ä½œåé¦ˆä¸Šä¹Ÿå¾ˆæœ‰ç‰¹ç‚¹ï¼Œç”šè‡³åœ¨å¤©æ°”åŠ¨ç”»å’ŒéŸ³æ•ˆçš„æ¥åˆä¸Šï¼Œä¸‹é›¨çš„å£°éŸ³ï¼Œé—ªç”µçš„æ•ˆæœï¼Œåšçš„éƒ½å¾ˆåˆ°ä½ã€‚æ›´å¯è´µçš„æ˜¯ï¼Œé’ˆå¯¹é›¾éœ¾å¤©æ°”çš„æ˜¾ç¤ºå¹¶ä¸æ˜¯ç°è’™è’™çš„ä¸€ç‰‡å¹¶ä¸ä¼šç»™äººå¤ªå¤šå¾ˆå‹æŠ‘æˆ–è€…æ¶ˆæçš„æš—ç¤ºã€‚</p>
<p>APEXçš„åŠ¨ç”»å’Œå£°æ•ˆè¿˜æ˜¯ç”¨ä¸€ä¸ªå­—å½¢å®¹ã€‚</p>
<h3 id="2-3_ç”¨æˆ·ç¼–è¾‘å’Œè®¾ç½®">2.3 ç”¨æˆ·ç¼–è¾‘å’Œè®¾ç½®</h3><p>é’ˆå¯¹ç”¨æˆ·ç¼–è¾‘å’Œè®¾ç½®åœ¨ä¸Šé¢ä¹Ÿå·²ç»æåˆ°ï¼ŒåŒ…æ‹¬å›¾æ ‡å’Œæ–‡ä»¶å¤¹çš„äº¤äº’ã€‚è¿˜æœ‰æ–°å»ºå±å¹•æ–¹é¢ï¼ŒColorOSä¾ç„¶æ˜¯åœ¨ç¼–è¾‘æ¨¡å¼è‡ªåŠ¨å‘åæ–°åŠ ä¸€ä¸ªå±å¹•ï¼Œå¯¹äºAPEXæˆ‘è¡¨ç¤ºè®¾ç½®é¡¹å¤ªå¤šæˆ‘è¿˜æ²¡æ‰¾åˆ°ã€‚ColorOSé’ˆå¯¹ç”¨æˆ·çš„è®¾ç½®ï¼Œä¸ç®¡æ˜¯æ¢å£çº¸æ¢ä¸»é¢˜è¿˜æ˜¯æ·»åŠ å°éƒ¨ä»¶ï¼Œæ¡Œé¢éƒ½ä¼šé©¬ä¸Šç¨‹åºå‡ºç”¨æˆ·è®¾ç½®åçš„æ•ˆæœï¼Œå¹¶ä¸æ˜¯é€šè¿‡èœå•é¡¹çš„é€‰æ‹©æˆ–è€…å…¶ä»–è®¾ç½®é¡µé¢çš„è·³è½¬æ¥å®Œæˆï¼Œæ‰€æœ‰çš„è®¾ç½®éƒ½åœ¨æ¡Œé¢ä¸Šå®Œæˆï¼Œå¹¶ä¸”å‡ ä¹æ–‡å­—çš„æè¿°ï¼Œå› ä¸ºä¸éœ€è¦ã€‚<br>è€Œç›¸æ¯”è¾ƒAPEXï¼Œå‡ ä¹æ‰€æœ‰çš„è®¾ç½®éƒ½æ˜¯é€šè¿‡èœå•çš„é€‰æ‹©æ¥è®¾ç½®å®Œæˆçš„ï¼Œå› ä¸ºéœ€è¦åŒæ—¶é’ˆå¯¹æ¡Œé¢å’Œåº”ç”¨æŠ½å±‰ä¸¤ä¸ªç•Œé¢ï¼ŒAPEXæ¡Œé¢çš„è®¾ç½®èŒƒå›´å’ŒåŠŸèƒ½ä¸èƒ½è¯´ä¸å¼ºå¤§ã€‚å‡ ä¹é’ˆå¯¹æ¡Œé¢æ‰€æœ‰èƒ½æƒ³åˆ°çš„è®¾ç½®é¡¹å®ƒéƒ½è¦†ç›–åˆ°äº†ã€‚ç”šè‡³å¾ˆå¤šåŠŸèƒ½ï¼Œé€šè¿‡åå­—ä¹Ÿæ— æ³•ç†è§£åˆ°åº•æ˜¯æœ‰ä»€ä¹ˆä½œç”¨ï¼Œåªè¦è¯•è¯•æ‰ä¼šçŸ¥é“ï¼Œè€Œè®¾ç½®çš„è¿‡ç¨‹å¯èƒ½éœ€è¦2~3ä¸ªç•Œé¢çš„è·³è½¬æ‰èƒ½è®¾ç½®æˆåŠŸï¼Œé¢„è§ˆè®¾ç½®æ•ˆæœè¿˜éœ€è¦è¿”å›æ¡Œé¢æ‰èƒ½çœ‹åˆ°ï¼Œåœ¨ä½“éªŒä¸Šç¡®å®å¤ªå¤šç¹çã€‚æ‰€æœ‰é’ˆå¯¹è¿™ä¹ˆå¤šè®¾ç½®é¡¹ï¼Œä¸€ä¸ªå¤‡ä»½å’Œæ¢å¤è®¾ç½®é¡¹æ˜¾å¾—æœ‰å¤šä¹ˆé‡è¦ï¼ŒAPEXåšåˆ°äº†ã€‚ä½†æ˜¯ä¸å¾—ä¸æ‰¿è®¤ï¼ŒAPEXæ¡Œé¢çš„è®¾ç½®çœŸçš„æ˜¯åº”æœ‰å°½æœ‰ï¼Œæ¯ä¸€å—è§†å›¾åŒºåŸŸéƒ½å¯¹åº”ä¸€ç³»åˆ—çš„è®¾ç½®é¡¹ï¼ŒåŒ…æ‹¬ä¸»å±å¹•è®¾ç½®ã€æŠ½å±‰è®¾ç½®(è¿™é‡Œè¿˜åŒ…æ‹¬æŠ½å±‰åº”æœ‰çš„åˆ†ç»„åˆ†ç±»åŠŸèƒ½)ã€æ‰˜ç›˜åŒºåŸŸçš„è®¾ç½®ã€æ–‡ä»¶å¤¹æ ·å¼çš„è®¾ç½®ã€é€šçŸ¥è®¾ç½®ç­‰ã€‚ç«Ÿç„¶è¿˜æ„çŠ¹æœªå°½åŠ ä¸Šäº†æ‰€è°“é«˜çº§è®¾ç½®ã€‚æˆ‘æƒ³æ”¶å›ä¸Šé¢å¯¹APEXçš„è¯„ä»·ã€‚APEXæ¡Œé¢çœŸæ˜¯å¤ªå‹¤å¥‹äº†â€¦<br>ç®€å•çœ‹ä¸‹é«˜çº§è®¾ç½®ï¼Œå°±åŒ…æ‹¬å›¾æ ‡å°ºå¯¸è®¾ç½®ã€å›¾æ ‡æ–‡å­—å¤§å°è®¾ç½®ã€å›¾æ ‡å­—ä½“è®¾ç½®ã€è¯­è¨€è®¾ç½®ã€‚ç”šè‡³è¿˜æœ‰ä¸»å±å¹•å’ŒæŠ½å±‰é¡µé¢çš„æ»šåŠ¨é€Ÿåº¦è®¾ç½®ã€‚æƒ³è±¡åŠ›ä¸å¯è°“ä¸ä¸°å¯Œã€‚(è¿™é‡Œæˆ‘å°±ä¸åˆ—ä¸¾äº†ï¼Œè¯¦ç»†äº†è§£è¯·ä¸‹è½½ä½“éªŒã€‚)</p>
<h2 id="ä¸‰ã€ç”¨æˆ·ä½“éªŒ">ä¸‰ã€ç”¨æˆ·ä½“éªŒ</h2><h3 id="3-1_ç‰¹è‰²å’Œé™„åŠ åŠŸèƒ½">3.1 ç‰¹è‰²å’Œé™„åŠ åŠŸèƒ½</h3><p>è¯´åˆ°ç‰¹è‰²ï¼Œå¦‚æœé’ˆå¯¹æ²¡æœ‰æ¥è§¦è¿‡IOSçš„æ™®é€šä½ç«¯ç”¨æˆ·ï¼Œç…§æ¬IOSçš„æ¨¡å¼æ˜¯ä¸€ä¸ªå¾ˆè®¨å·§çš„æ–¹å¼ï¼Œåœ¨å›¾æ ‡çš„ç¼–è¾‘ç­‰å¾ˆå¤šæ–¹é¢ColorOSéƒ½æœ‰ç€IOSçš„çƒ™å°ã€‚è¿™æ ·ä¹Ÿæ²¡æœ‰é”™ï¼Œä¼˜ç§€çš„äº‹ç‰©éƒ½æ˜¯ç›¸ä¼¼çš„ã€‚å½“ç„¶ColorOSç§°å¾—ä¸Šç‰¹è‰²çš„ä¸ä»…ä»…æ˜¯è¿™äº›ï¼Œå¤©æ°”å£çº¸å’ŒåŠ¨æ€å£çº¸ç»“åˆå›¾æ ‡çš„æ•ˆæœä¸å¯è°“ä¸æƒŠè‰³ã€‚åœ¨ä¸‹é›¨çš„æ—¶å€™å›¾æ ‡ä¸Šéƒ½æœ‰é›¨ç çš„æ•ˆæœï¼Œä¸å•å•æ˜¯äº§å“è®¾ç½®çš„æƒ³è±¡åŠ›ï¼Œåœ¨ç¨‹åºè®¾è®¡ä¸Šä¹Ÿæ˜¯å¾ˆæœ‰éš¾åº¦çš„ã€‚ç»“åˆä¸»é¢˜çš„æ¢è‚¤åŠŸèƒ½ï¼Œè™½ç„¶æ²¡æœ‰å¤ªå¤šçš„äº®ç‚¹ï¼ŒåŠŸèƒ½ä¸Šä¹Ÿæ˜¯ä¸­è§„ä¸­çŸ©ï¼Œä½†æ˜¯åœ¨ç´ æå’Œèµ„æºçš„è´¨é‡ä¸Šä¹Ÿä¸é”™ï¼Œå•ç‹¬å°±æ‹¿å›¾æ ‡æ¥è¯´ï¼Œå…è´¹çš„ä¸»é¢˜ç»™äººçš„æ„Ÿè§‰ä¹Ÿä¸æ˜¯æ°´å‹éšä¾¿å¼„å¼„çš„æ„Ÿè§‰ã€‚åŒæ—¶åœ¨ä¸»é¢˜åŠŸèƒ½ä¸Šå®ç°äº†å¤šè¿è¥ç®¡é“çš„æ¥å…¥ï¼Œä¸ºæ›´å¤šæ›´ä¼˜è´¨çš„èµ„æºæä¾›äº†å¯èƒ½ã€‚</p>
<p>ç›¸å¯¹APEXæ¡Œé¢ï¼Œæœ€å¤§çš„ç‰¹è‰²åº”è¯¥å°±æ˜¯ï¼Œâ€œä½ çœ‹åˆ°çš„ä¸œè¥¿å‡ ä¹éƒ½èƒ½æ”¹å˜â€ï¼Œä¸Šé¢å·²ç»ç®€å•åˆ—ä¸¾è¿‡äº†ã€‚æŠ›å¼€ç”¨æˆ·çš„æ“ä½œä½“éªŒä¸è¯´ï¼Œå•åœ¨ç¨‹åºè®¾è®¡çš„è§’åº¦ä¸Šè¯´ï¼Œå¦‚ä½•ç»„ç»‡å¦‚æ­¤å¤šçš„è®¾ç½®åŠŸèƒ½ï¼Œå…‰æ˜¯æƒ³æƒ³éƒ½æœ‰ç‚¹å¤´çš®å‘éº»ï¼Œè€Œç›¸å¯¹ä¸APEXæ¡Œé¢çš„æµç•…å’Œç¨³å®šæ€§ï¼Œå®ƒçš„è½¯ä»¶æ¶æ„ä¸€å®šæœ‰å¾ˆå¤šèƒ½å¤Ÿå­¦ä¹ çš„åœ°æ–¹ã€‚å¯æƒœä»£ç è¢«æ··æ·†äº†ã€‚</p>
<h3 id="3-2_æµç¨‹åº¦å’Œå†…å­˜">3.2 æµç¨‹åº¦å’Œå†…å­˜</h3><ul>
<li><p><strong>æµç•…åº¦</strong><br>ColorOSåœ¨æ¡Œé¢æ»‘åŠ¨ç‰¹æ•ˆä¸Šï¼Œå¼€å§‹æ»‘åŠ¨çš„å‡ å¸§å¯èƒ½ä¼šæœ‰æ‰å¸§çš„ç°è±¡ï¼Œè€Œä¸”å°±è’²å…¬è‹±åŠ¨æ€å£çº¸ï¼Œåœ¨æ»‘åŠ¨æ¡Œé¢æ˜¯è’²å…¬è‹±çš„é£åŠ¨æ•ˆæœä¹Ÿç¨æœ‰æ‰å¸§çš„æ„Ÿè§‰ï¼Œå¯èƒ½æ˜¯åˆ·æ–°é¢‘ç‡çš„é—®é¢˜ã€‚<br>APEXæ¡Œé¢çš„æµç•…æ€§ä¸Šä¹Ÿæ˜¯è¡¨ç°ä¸é”™ï¼ŒAPEXåœ¨åŸç”Ÿæ¡Œé¢çš„äº¤äº’åŸºç¡€ä¸Šè¿›è¡Œçš„å¼€å‘ï¼Œäº¤äº’å¹¶ä¸å¤æ‚ï¼Œè§†å›¾çš„å±‚æ¬¡å’Œå¤æ‚åº¦ä¹Ÿå¹¶ä¸å¤æ‚ã€‚</p>
</li>
<li><p><strong>å†…å­˜</strong><br>ColorOSæ¡Œé¢åœ¨ä¸€èˆ¬æƒ…å†µå†…å­˜åœ¨100Mä»¥ä¸Šï¼Œå¢åŠ å¤šä¸ªä¸“å±ç©ºé—´ç©ºé—´å¯èƒ½ä¼šè¾¾åˆ°150Mã€‚æ­£å¸¸æƒ…å†µä¸‹ä¼šåœ¨150Mä»¥ä¸‹ã€‚<br>APEXæ¡Œé¢å¯åŠ¨ä¹‹åçš„å†…å­˜å æœ‰åœ¨40Må·¦å³ï¼Œæ­£å¸¸ä½¿ç”¨æƒ…å†µä¸‹åœ¨60Må·¦å³ã€‚ç›¸æ¯”è¾ƒä¸€ä¸ªhello worldéƒ½å¯èƒ½åˆ†é…10Mçš„å†…å­˜ï¼Œè¿™æ ·çš„å†…å­˜å ç”¨ç‡å·²ç»å¾ˆä¸é”™äº†ã€‚ä¸è¿‡æ¯•ç«ŸAPEXæ¡Œé¢çš„åŠ¨ç”»å’Œè§†å›¾å¹¶ä¸ç®—å¤æ‚ï¼Œè¿™æ ·çš„å æœ‰ç‡ä¹Ÿåœ¨æƒ…ç†ä¹‹ä¸­ã€‚</p>
</li>
</ul>
<h2 id="å››ã€åç¼–è¯‘åˆ†æ">å››ã€åç¼–è¯‘åˆ†æ</h2><p>åˆ†æç»“æœæš‚æ— ã€‚</p>
<h2 id="äº”ã€æˆ‘çš„çœ‹æ³•">äº”ã€æˆ‘çš„çœ‹æ³•</h2><p>ColorOSæ¡Œé¢å’ŒAPEXæ¡Œé¢åœ¨äº§å“æ€è·¯ä¸Šæ˜¯å®Œå…¨ä¸åŒçš„æ–¹å‘ã€‚ä¸€ä¸ªåœ¨å°½åŠ›è®¨å¥½ç”¨æˆ·ï¼Œå°½åŠ›æŠŠç‰¹æ•ˆå’Œäº¤äº’åšç‚«ï¼Œå®ƒå°½åŠ›å‘Šè¯‰ç”¨æˆ·ä»€ä¹ˆæ ·æ˜¯æ¯”è¾ƒå¥½çš„ï¼Œé’ˆå¯¹å›½å†…å¸‚åœºç¡®å®ç®—å¾ˆæœ‰ç‰¹è‰²ä¹Ÿå¾ˆæœ‰å–ç‚¹ã€‚è€Œå¯¹æ¯”å…¶ä»–ä¼˜ç§€æ¡Œé¢äº§å“åœ¨å¾ˆå¤šäº¤äº’ä¸Šä¹Ÿéš¾å…æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œå½“ç„¶è¿™å¹¶ä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯åˆ«äººæœ‰çš„æˆ‘ä¹Ÿæœ‰ï¼Œåˆ«äººæœ‰çš„æˆ‘æ²¡æœ‰ã€‚è¿˜å¥½ColorOSè¿ˆè¿‡äº†è¿™é“åï¼ŒåŠ¨æ€å£çº¸çš„æ•ˆæœä¹Ÿè¯æ˜äº†ColorOSæ¡Œé¢è¶³å¤Ÿä¼˜ç§€ã€‚é‚£è¿™ä¹ˆå¥½çš„æ•ˆæœä¸ºä»€ä¹ˆæ²¡æœ‰å¼•èµ·åˆ«äººè·Ÿé£ï¼Ÿï¼ˆäº‹å®ä¸Šä¹Ÿä¸æ˜¯æ²¡æœ‰ï¼ŒTCLå°±è·Ÿè¿‡ï¼‰ã€‚ä»£ç éƒ½æ²¡æœ‰åŠ æ··æ·†ï¼Œæè¿‡æ¥åº”è¯¥ä¸éš¾ã€‚ä½†æ˜¯ä¼´éšç€é…·ç‚«çš„è§†è§‰æ•ˆæœèƒŒåï¼Œèº²ä¸å¼€çš„å°±æ˜¯å†…å­˜å’ŒåŠŸè€—é—®é¢˜ï¼Œè¿™ä¸ªå¯æƒ³è€ŒçŸ¥ï¼Œåœ¨ä½“éªŒOPPOæ‰‹æœºçš„è¿‡ç¨‹ä¸­ï¼Œæœ€å¤§çš„æ„Ÿå—å°±æ˜¯å……ç”µå¤ªæ…¢äº†ï¼Œç”µæ± å¤ªä¸å¤Ÿç”¨ã€‚é¢å¯¹å¼€æ”¾å¸‚åœºçš„æ¡Œé¢åŠŸè€—å’Œå†…å­˜æ˜¯å¿…ä¸å¯å°‘çš„è€ƒæ ¸æ¡ä»¶ã€‚ï¼ˆæ­¤å¤„çœç•¥ä¸€ä¸‡å­—ï¼‰ã€‚<br>åœ¨å¦ä¸€æ–¹é¢ï¼ŒAPEXæ¡Œé¢ï¼Œå°½é‡åšçš„è®¨å·§ï¼Œæœ¬èº«åŸç”ŸLauncherçš„äº¤äº’å’Œç¨³å®šæ€§å¹¶ä¸å·®ã€‚å›½å†…æ¡Œé¢äº§å“ä¹‹æ‰€ä»¥æ‹¼çš„ä½ æ­»æˆ‘æ´»ï¼Œæ— æ³•å°±æ˜¯é¿å…åŒè´¨åŒ–ã€‚é¿å…å’Œåˆ«äººä¸€æ ·ï¼Œä¿æŒè‡ªå·±çš„ç‰¹ç‚¹æˆäº†å¾ˆå¤§çš„ä¸€ä¸ªå› ç´ ã€‚è€ŒAPEXä¹ŸåŒæ ·æ‡‚å¾—è¿™ä¸ªé“ç†ï¼Œä½†æ˜¯å®ƒçš„æ–¹å¼ä¸å¤ªä¸€æ ·ï¼Œå®ƒåœ¨é¿å…å’Œåˆ«äººç›¸åŒçš„é“è·¯ä¸ŠæŠŠæ›´å¤šçš„é€‰æ‹©æƒäº¤ç»™äº†ç”¨æˆ·ï¼Œç»™ç”¨æˆ·æä¾›äº†å„å¼çš„è®¾ç½®æ¥å£ï¼Œå¹¶ä¸”æä¾›äº†è®¾ç½®å¤‡ä»½çš„åŠŸèƒ½ã€‚ä¹Ÿæ˜¯ç”¨å¿ƒè‰¯è‹¦ï¼Œä½†æ˜¯åœ¨ç»„ç»‡å¦‚æ­¤å¤šè®¾ç½®æ¥å£çš„æ–¹å¼ä¸Šä¹Ÿæ˜¯è®©äººå¾ˆç—›çš„ï¼Œå¤ªç´¯ï¼Œæˆ‘å¤ªæ‡’ï¼Œæ¥ä¸åŠå»æ¢ç´¢å±äºè‡ªå·±æ›´å¤šçš„å¯èƒ½ã€‚</p>
<h2 id="å…­ã€å¯¹äºæ¡Œé¢äº§å“çš„å¯å‘">å…­ã€å¯¹äºæ¡Œé¢äº§å“çš„å¯å‘</h2><ul>
<li><p><strong>åšå¥½ç¬¬ä¸€æ„Ÿè§‰</strong><br>ç¬¬ä¸€æ„Ÿè§‰ï¼Œå®‰è£…åŒ…çš„å¤§å°ï¼Œé»˜è®¤æ¡Œé¢å›¾æ ‡çš„è®¾ç½®ã€‚èƒ½å¦çœŸæ­£é€‚é…ä¸åŒå‚å•†æ‰‹æœºï¼Œå°±æ‹¿Phoneè¿™ä¸ªåº”ç”¨æ¥è¯´ï¼Œä¸åŒå‚å•†çš„åŒ…åå¯èƒ½åƒå·®ä¸‡åˆ«ï¼Œèƒ½å¦æœ‰åˆé€‚çš„æ–¹æ³•ï¼Œè®©å®ƒåœ¨æ¯ä¸€å°æ‰‹æœºä¸Šéƒ½æ”¾åœ¨æ­£ç¡®çš„ä½ç½®ã€‚ä»ç”¨æˆ·å·²æœ‰çš„æ¡Œé¢ä¸­è·å–ç”¨æˆ·å·²æœ‰çš„æ¡Œé¢é…ç½®æ˜¯ä¸æ˜¯æ›´å¥½ï¼Ÿå¦‚ä½•åšåˆ°ï¼Ÿåœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™æ˜¯å¦åº”è¯¥ç»™ç±»ä¼¼åˆ†ç±»å’Œç›¸å…³å†·å¯åŠ¨çš„å‘å¯¼ï¼Œè¿™æ ·ä¼šä¸ä¼šæ›´å¥½ï¼Ÿè¿˜æœ‰å¾ˆå¤šæœªçŸ¥ï¼ï¼</p>
</li>
<li><p><strong>æµç•…å’Œæ€§èƒ½æ°¸è¿œæ˜¯é‡ç‚¹,è½»</strong></p>
</li>
<li><p><strong>æˆ‘ä»¬çš„äº®ç‚¹åœ¨å“ªï¼Ÿæˆ‘ä»¬çš„ç—›ç‚¹åœ¨å“ªï¼Ÿæˆ‘ä»¬äº§å“çš„è®¾è®¡åŸåˆ™æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
</li>
<li><p><strong>å¦‚æœæˆ‘ä»¬æƒ³è¦åšä¸€ä¸ªä¼˜ç§€çš„äº§å“ï¼Œé‚£è¯·å…ˆè¯´æœè‡ªå·±ï¼Œå…ˆè®©è‡ªå·±äººéƒ½å–œæ¬¢ä¸Šæˆ‘ä»¬çš„äº§å“</strong></p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸€ã€æ¡Œé¢åŸºæœ¬æ“ä½œ&quot;&gt;ä¸€ã€æ¡Œé¢åŸºæœ¬æ“ä½œ&lt;/h2&gt;&lt;h3 id=&quot;1-1_å®‰è£…åˆä½“éªŒ&quot;&gt;1.1 å®‰è£…åˆä½“éªŒ&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;å®‰è£…åŒ…å¤§å°&lt;/strong&gt;&lt;br&gt;ColorOSæ¡Œé¢å«æœ‰ä¸¤ä¸ªå®‰è£…åŒ…ï¼ŒOppoLauncher.apk(2.8M)å’ŒOppoLauncherSystem.apk(8.5KB)&lt;br&gt;APEXæ¡Œé¢å®‰è£…åŒ…å¤§å°4.36Mï¼Œå¹¶ä¸”è¿›è¡Œäº†ä»£ç æ··æ·†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;é»˜è®¤æ¡Œé¢&lt;/strong&gt;&lt;br&gt;ColorOSæ¡Œé¢ï¼Œå‰ä¸¤ä¸ªå±å¹•æ˜¯ç³»ç»Ÿåº”ç”¨ï¼ŒåŒ…å«ä¸€ä¸ªå°å·¥å…·çš„æ–‡ä»¶å¤¹ï¼Œå…¶ä»–æ‰€æœ‰åº”ç”¨å¹³é“ºæ¡Œé¢ï¼Œç”¨æˆ·è‡ªå·±å®‰è£…çš„åº”ç”¨ä»ç¬¬ä¸‰å±å¼€å§‹å¹³é“ºã€‚&lt;br&gt;APEXæ¡Œé¢ï¼Œé»˜è®¤çš„åº”ç”¨æ’åˆ—å°±å¾ˆéšæ„ï¼Œåœ¨ä¸åŒçš„æ‰‹æœºä¸Šçš„è¡¨ç°æœ‰å·®åˆ«ï¼Œåº”è¯¥æ˜¯ä¸åŒæ‰‹æœºçš„ç³»ç»Ÿåº”ç”¨çš„åŒ…åä¸åŒï¼Œé€ æˆAPEXçš„é¢„åˆ¶æ¡Œé¢å¹¶ä¸æ˜¯é¡ºåºç´§å¯†åœ¨æ¡Œé¢æ˜¾ç¤ºåº”ç”¨å›¾æ ‡ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="äº§å“åˆ†æ" scheme="https://ivonhoe.github.io/tags/%E4%BA%A7%E5%93%81%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäºè´å¡å°”æ›²çº¿çš„AndroidåŠ¨ç”»å·®å€¼å™¨</title>
    <link href="https://ivonhoe.github.io/2015/04/17/%E5%9F%BA%E4%BA%8E%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF%E7%9A%84Android%E5%8A%A8%E7%94%BB%E5%B7%AE%E5%80%BC%E5%99%A8/"/>
    <id>https://ivonhoe.github.io/2015/04/17/åŸºäºè´å¡å°”æ›²çº¿çš„AndroidåŠ¨ç”»å·®å€¼å™¨/</id>
    <published>2015-04-17T02:35:05.000Z</published>
    <updated>2016-12-16T05:25:42.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€ç®€ä»‹">ä¸€ã€ç®€ä»‹</h2><p>è´å¡å°”æ›²çº¿äº1962ï¼Œç”±æ³•å›½å·¥ç¨‹å¸ˆçš®åŸƒå°”Â·è´å¡å°”ï¼ˆPierre BÃ©zierï¼‰æ‰€å¹¿æ³›å‘è¡¨ï¼Œä»–è¿ç”¨è´å¡å°”æ›²çº¿æ¥ä¸ºæ±½è½¦çš„ä¸»ä½“è¿›è¡Œè®¾è®¡ã€‚è´å¡å°”æ›²çº¿æœ€åˆç”±Paul de Casteljauäº1959å¹´è¿ç”¨de Casteljauç®—æ³•å¼€å‘ï¼Œä»¥ç¨³å®šæ•°å€¼çš„æ–¹æ³•æ±‚å‡ºè´å…¹æ›²çº¿ã€‚è´å¡å°”æ›²çº¿ä¸ä»…ä»…å¯ä»¥åº”ç”¨åˆ°å·¥ä¸šè®¾è®¡ä¸­ï¼Œåœ¨è®¡ç®—æœºåŠ¨ç”»å¼€å‘ä¸­åŒæ ·å æœ‰ä¸€å¸­ä¹‹åœ°ï¼Œé€šè¿‡æ„é€ è´å¡å°”æ›²çº¿æ¨¡æ‹Ÿç‰©ä½“è¿åŠ¨çš„è½¨è¿¹ã€é€Ÿåº¦ç”šè‡³åŠ é€Ÿåº¦ï¼Œæ¥è¾¾åˆ°æƒ³è¦çš„åŠ¨ç”»æ•ˆæœã€‚åœ¨CSSå¼€å‘ä¸­ä½¿ç”¨â€˜cubic-bezierâ€™æ–¹æ³•ï¼Œä¼ é€’ä¸‰æ¬¡è´èµ›å°”æ›²çº¿çš„ä¸¤ä¸ªæ§åˆ¶ç‚¹P1å’ŒP2æ¥ç”Ÿæˆä¸€æ¡å¹³æ»‘çš„æ›²çº¿ã€‚ç”šè‡³ä¹Ÿæœ‰å¾ˆå¤šjavaScriptåŠ¨ç”»åº“ä½¿ç”¨è´èµ›å°”æ›²çº¿æ¥å®ç°å®Œç¾çš„åŠ¨ç”»æ•ˆæœã€‚</p>
<p><img src="/res/bezier/TimingFunction.png" alt="é€šè¿‡P1å’ŒP2æ§åˆ¶æ›²çº¿"></p>
<a id="more"></a>
<p>è€Œæˆ‘è¦åšçš„é€šè¿‡è´å¡å°”æ›²çº¿çš„åŸç†ç”ŸæˆAndroidåŠ¨ç”»æ’å€¼å™¨ï¼Œåœ¨Androidå¹³å°ä¸Šå®ç°åŸºäºè´èµ›å°”æ›²çº¿çš„åŠ¨ç”»æ•ˆæœã€‚æƒ³è¦äº†è§£AndroidåŠ¨ç”»åŸç†è¯·å…ˆé˜…è¯»<a href="https://ivonhoe.github.io/2015/02/09/Android%E5%8A%A8%E7%94%BB%E6%80%BB%E7%BB%93/">è¿™ç¯‡æ–‡ç« </a>ã€‚äº†è§£è´å¡å°”æ›²çº¿ç»˜åˆ¶è¿‡ç¨‹å¯ä»¥å…ˆé˜…è¯»<a href="http://www.html-js.com/article/1628" target="_blank" rel="external">è´å¡å°”æ›²çº¿æ‰«ç›²</a>ï¼Œå†™çš„å¾ˆå¥½ã€‚</p>
<h2 id="äºŒã€De_Casteljauç®—æ³•">äºŒã€De Casteljauç®—æ³•</h2><p><img src="/res/bezier/decu.png" alt="äºŒæ¬¡è´å¡å°”æ›²çº¿"></p>
<p>è´å¡å°”æ›²çº¿å¸¸è§çš„ç®—æ³•æ˜¯å¯ä»¥é€šè¿‡å¤šé¡¹å¼ã€De Casteljauç®—æ³•å’Œé€’å½’ç®—æ³•æ¥è¿›è¡Œè®¡ç®—ã€‚é’ˆå¯¹Deç®—æ³•ï¼Œè®¾P0,P1,P2ç¡®å®šäº†ä¸€æ¡äºŒæ¬¡è´å¡å°”æ›²çº¿qï¼Œå¼•å…¥å‚æ•°tï¼Œä»¤<img src="/res/bezier/1.gif" alt="">å³æœ‰ï¼š</p>
<p><img src="/res/bezier/2.gif" alt=" "></p>
<p>å½“tä»0å˜åˆ°1ï¼Œç¬¬ä¸€ã€äºŒå¼æ˜¯ä¸¤æ¡ä¸€æ¬¡Bezieræ›²çº¿ã€‚å°†ä¸€ã€äºŒå¼ä»£å…¥ç¬¬ä¸‰å¼å¾—åˆ°ï¼š</p>
<p><img src="/res/bezier/5.gif" alt=" "></p>
<p>å½“tä»0å˜åˆ°1æ—¶ï¼Œå®ƒè¡¨ç¤ºäº†ç”±P0ã€P1ã€P2ä¸‰ä¸ªæ§åˆ¶ç‚¹å½¢æˆä¸€æ¡äºŒæ¬¡Bezieræ›²çº¿ã€‚å¹¶ä¸”è¿™ä¸ªäºŒæ¬¡Bezieræ›²çº¿å¯ä»¥åˆ†åˆ«ç”±å‰ä¸¤ä¸ªé¡¶ç‚¹(P0,P1)å’Œåä¸¤ä¸ªé¡¶ç‚¹(P1,P2)å†³å®šçš„ä¸€æ¬¡Bezieræ›²çº¿çš„çº¿æ€§ç»„åˆã€‚ä»¥æ­¤ç±»æ¨ï¼Œç”±å››ä¸ªæ§åˆ¶ç‚¹å®šä¹‰çš„ä¸‰æ¬¡Bezieræ›²çº¿å¯è¢«å®šä¹‰ä¸ºåˆ†åˆ«ç”±(P0,P1,P2)å’Œ(P1,P2,P3)ç¡®å®šçš„ä¸¤æ¡äºŒæ¬¡Bezieræ›²çº¿çš„çº¿æ€§ç»„åˆï¼Œç”±(n+1)ä¸ªæ§åˆ¶ç‚¹å®šä¹‰çš„næ¬¡Bezieræ›²çº¿å¯è¢«å®šä¹‰ä¸ºåˆ†åˆ«ç”±å‰ånä¸ªæ§åˆ¶ç‚¹å®šä¹‰çš„ä¸¤æ¡(n-1)æ¬¡Bezieræ›²çº¿çš„çº¿æ€§ç»„åˆï¼š</p>
<p><img src="/res/bezier/3.gif" alt=" "></p>
<p>ç”±æ­¤å¾—åˆ°Bezieræ›²çº¿çš„é€’æ¨è®¡ç®—å…¬å¼:</p>
<p><img src="/res/bezier/4.gif" alt=" "></p>
<p>è¿™å°±æ˜¯De Casteljauç®—æ³•ã€‚ä½¿ç”¨è¿™ä¸ªé€’æ¨å…¬å¼ï¼Œåœ¨ç»™å®šå‚æ•°ä¸‹ï¼Œæ±‚Bezieræ›²çº¿ä¸Šä¸€ç‚¹P(t)éå¸¸æœ‰æ•ˆã€‚</p>
<h2 id="ä¸‰ã€BezieråŠ¨ç”»æ’å€¼å™¨å®ç°">ä¸‰ã€BezieråŠ¨ç”»æ’å€¼å™¨å®ç°</h2><p>åŸºäºDe Casteljauç®—æ³•çš„é€’æ¨å…¬å¼æ±‚æ›²çº¿ä¸Šç‚¹çš„åæ ‡ï¼š</p>
<pre><code><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Point <span class="title">deCasteljau</span><span class="params">(Point[] points, <span class="keyword">float</span> t)</span> </span>{
    final <span class="keyword">int</span> n = points.length;
    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)
        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n - i; j++) {
            points[j].x = (<span class="number">1</span> - t) * points[j].x + t * points[j + <span class="number">1</span>].x;
            points[j].y = (<span class="number">1</span> - t) * points[j].y + t * points[j + <span class="number">1</span>].y;
        }

    <span class="keyword">return</span> points[<span class="number">0</span>];
}
</code></pre><p>De Casteljauç®—æ³•ç›®çš„æ˜¯æ±‚å¾—æ›²çº¿ä¸Šçš„æ¯ä¸€ä¸ªç‚¹ï¼Œå¦‚ä½•ç”¨è¿™äº›é‡‡æ ·ç‚¹æè¿°ä¸€æ¡æ›²çº¿æ’å€¼å™¨è¿˜éœ€è¦è¿›ä¸€æ­¥çš„å¤„ç†ã€‚ä¸»è¦å°±æ˜¯å¤„ç†ç²¾åº¦çš„é—®é¢˜ï¼Œç”¨è·ç¦»å¾ˆè¿‘çš„ä¸¤ä¸ªç‚¹è¿çº¿çš„çº¿æ®µè¿‘ä¼¼æè¿°æ›²çº¿ï¼Œç†è®ºä¸Šé‡‡æ ·ç‚¹è¶Šå¯†é›†æè¿°çš„è¶Šå‡†ç¡®ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾åœ¨å®é™…é¡¹ç›®ä¸­ä¸èƒ½é€‰æ‹©å¤ªå¤šçš„é‡‡æ ·ç‚¹ï¼Œå› ä¸ºè¦è€ƒè™‘å†…å­˜å’Œæ•ˆç‡çš„é—®é¢˜ã€‚æ‰€ä»¥ç”¨å°½å¯èƒ½å°‘çš„ç‚¹å°½å¯èƒ½ç²¾ç»†çš„ç”¨ç›´çº¿æ®µæè¿°ä¸€æ¡æ›²çº¿ï¼Œä¸€ä¸ªä¸é”™çš„åšæ³•å°±æ˜¯åœ¨é‡‡æ ·ç‚¹çš„åœ¨æ¨ªåæ ‡æ–¹å‘ä¸Šä¸è¦ç­‰è·åˆ†å¸ƒï¼Œè€Œæ˜¯åœ¨æ›²çº¿å˜åŒ–è¾ƒå¿«çš„åœ°æ–¹ï¼ˆå³æ–œç‡è¾ƒå¤§ï¼‰é‡‡æ ·ç‚¹å°½å¯èƒ½çš„å¯†é›†ï¼Œè€Œåœ¨æ›²çº¿å˜åŒ–å¹³ç¼“çš„åœ°æ–¹é‡‡æ ·ç‚¹é€‰æ‹©ç¨€ç–ã€‚æ‰€ä»¥éœ€è¦åœ¨é€šè¿‡De Casteljauç®—æ³•è·å–åˆæ­¥çš„é‡‡æ ·ç‚¹åï¼Œå†è¿›ä¸€æ­¥è·å–éå‡åŒ€åˆ†å¸ƒçš„é‡‡æ ·ç‚¹ï¼Œæ›´åŠ å¤„ç†åçš„é‡‡æ ·ç‚¹å†è¿›è¡Œè®¡ç®—ã€‚</p>
<p>è€ƒè™‘åˆ°é’ˆå¯¹ä¸åŒåŠ¨ç”»çš„ç¼–è¾‘ï¼Œå¯èƒ½ä¸ä»…ä»…æ˜¯åŠ¨ç”»è¿›åº¦çš„æ’å€¼ï¼Œè¿˜éœ€è¦åŠ¨ç”»é€Ÿåº¦çš„æ’å€¼å’ŒåŠ¨ç”»å˜åŒ–ç‡çš„æ’å€¼ï¼Œé’ˆå¯¹ä¸åŒæ›²çº¿ç±»å‹çš„å˜åŒ–ï¼Œé€šè¿‡ä¸‹é¢çš„æ–¹å¼è¿›è¡Œæ‰©å±•ã€‚è¯¦ç»†ä»£ç å¯ä»¥æŸ¥çœ‹<a href="https://github.com/Ivonhoe/BezierInterpolator" target="_blank" rel="external">è¿™é‡Œ</a></p>
<h2 id="å››ã€ä½¿ç”¨èŒƒä¾‹">å››ã€ä½¿ç”¨èŒƒä¾‹</h2><p>é€šè¿‡æ§åˆ¶ç‚¹æ„é€ è´å¡å°”æ›²çº¿æ’å€¼å™¨ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡æ„é€ ä¸€ä¸ªç‰¹æ®Šçš„æ’å€¼å™¨ï¼Œæ§åˆ¶drawableçš„é‡ç»˜å’Œæ¯ä¸ªå°çƒçš„åŠ¨ç”»å¹¶é‡ç»˜drawableå°±å¯ä»¥å®ç°ç±»ä¼¼window phoneä¸Šç»å…¸çš„Balls Lineè¿›åº¦æ¡æ•ˆæœï¼Œè¯¦ç»†å®ç°å¯ä»¥å‚è€ƒ<a href="https://ivonhoe.github.io/2015/04/28/Drawable-%E4%BB%8E%E7%AE%80%E5%8C%96%E5%B8%83%E5%B1%80%E8%B0%88%E8%B5%B7/">è¿™é‡Œ</a>ã€‚</p>
<p><img src="/res/bezier/windows_balls_line.GIF" alt="window è¿›åº¦æ¡"></p>
<p>é€šè¿‡ä¸¤ä¸ªæ§åˆ¶ç‚¹æ„é€ ä¸‰æ¬¡è´èµ›å°”æ’å€¼å™¨(é»˜è®¤ä¼šå¢åŠ (0,0)å’Œ(1,1)ä½œä¸ºæ§åˆ¶ç‚¹)ã€‚</p>
<pre><code><span class="keyword">if</span> (mBezierInterpolator == null) {
    <span class="comment">// è´å¡å°”æ’å€¼å™¨</span>
    mBezierInterpolator = <span class="keyword">new</span> BezierInterpolator(<span class="number">0.03f</span>, <span class="number">0.615f</span>, <span class="number">0.995f</span>, <span class="number">0.415f</span>);
}
<span class="keyword">if</span> (mLinearInterpolator == null){
    <span class="comment">// æ™®é€šçº¿æ€§æ’å€¼å™¨</span>
    mLinearInterpolator = <span class="keyword">new</span> LinearInterpolator();
}
</code></pre><p>åŒæ ·å¯ä»¥ä¼ é€’åŒ…å«æ‰€æœ‰æ§åˆ¶ç‚¹çš„Listæ„é€ æ’å€¼å™¨ã€‚</p>
<pre><code>mBezierInterpolator = new BezierInterpolator<span class="list">(<span class="keyword">new</span> ArrayList&lt;Point&gt;<span class="list">()</span>)</span><span class="comment">;</span>
</code></pre><p>é’ˆå¯¹BezierInterpolatorçš„æ„é€ ä¼šæœ‰ä¸€å®šçš„è€—æ—¶ï¼Œæ‰€ä»¥å¹¶ä¸å»ºè®®åœ¨éœ€è¦ç”¨åˆ°çš„æ—¶å€™æ‰å»æ„é€ ï¼Œä¹Ÿä¸å»ºè®®é¢‘ç¹çš„æ„é€ ç›¸åŒçš„æ’å€¼å™¨å®ä¾‹ã€‚</p>
<h2 id="äº”ã€å‚è€ƒæ–‡æ¡£">äº”ã€å‚è€ƒæ–‡æ¡£</h2><p><a href="http://baike.baidu.com/view/10167166.htm" target="_blank" rel="external">3Dè®¡ç®—æœºå›¾å½¢å­¦ Samuel R.Buss</a><br><a href="http://wenku.baidu.com/view/2beaa4bc960590c69ec376cd.html" target="_blank" rel="external">Bezieræ›²çº¿çš„ç®—æ³•æè¿°åŠå…¶ç¨‹åºå®ç°</a><br><a href="http://cubic-bezier.com/" target="_blank" rel="external">åœ¨çº¿è´å¡å°”æ›²çº¿ç¼–è¾‘å™¨</a><br><a href="http://thecodeplayer.com/walkthrough/windows-phone-loading-animation" target="_blank" rel="external">window phone loading animation</a></p>
<h2 id="å…­ã€Github">å…­ã€Github</h2><p><a href="https://github.com/Ivonhoe/BezierInterpolator" target="_blank" rel="external">https://github.com/Ivonhoe/BezierInterpolator</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸€ã€ç®€ä»‹&quot;&gt;ä¸€ã€ç®€ä»‹&lt;/h2&gt;&lt;p&gt;è´å¡å°”æ›²çº¿äº1962ï¼Œç”±æ³•å›½å·¥ç¨‹å¸ˆçš®åŸƒå°”Â·è´å¡å°”ï¼ˆPierre BÃ©zierï¼‰æ‰€å¹¿æ³›å‘è¡¨ï¼Œä»–è¿ç”¨è´å¡å°”æ›²çº¿æ¥ä¸ºæ±½è½¦çš„ä¸»ä½“è¿›è¡Œè®¾è®¡ã€‚è´å¡å°”æ›²çº¿æœ€åˆç”±Paul de Casteljauäº1959å¹´è¿ç”¨de Casteljauç®—æ³•å¼€å‘ï¼Œä»¥ç¨³å®šæ•°å€¼çš„æ–¹æ³•æ±‚å‡ºè´å…¹æ›²çº¿ã€‚è´å¡å°”æ›²çº¿ä¸ä»…ä»…å¯ä»¥åº”ç”¨åˆ°å·¥ä¸šè®¾è®¡ä¸­ï¼Œåœ¨è®¡ç®—æœºåŠ¨ç”»å¼€å‘ä¸­åŒæ ·å æœ‰ä¸€å¸­ä¹‹åœ°ï¼Œé€šè¿‡æ„é€ è´å¡å°”æ›²çº¿æ¨¡æ‹Ÿç‰©ä½“è¿åŠ¨çš„è½¨è¿¹ã€é€Ÿåº¦ç”šè‡³åŠ é€Ÿåº¦ï¼Œæ¥è¾¾åˆ°æƒ³è¦çš„åŠ¨ç”»æ•ˆæœã€‚åœ¨CSSå¼€å‘ä¸­ä½¿ç”¨â€˜cubic-bezierâ€™æ–¹æ³•ï¼Œä¼ é€’ä¸‰æ¬¡è´èµ›å°”æ›²çº¿çš„ä¸¤ä¸ªæ§åˆ¶ç‚¹P1å’ŒP2æ¥ç”Ÿæˆä¸€æ¡å¹³æ»‘çš„æ›²çº¿ã€‚ç”šè‡³ä¹Ÿæœ‰å¾ˆå¤šjavaScriptåŠ¨ç”»åº“ä½¿ç”¨è´èµ›å°”æ›²çº¿æ¥å®ç°å®Œç¾çš„åŠ¨ç”»æ•ˆæœã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/res/bezier/TimingFunction.png&quot; alt=&quot;é€šè¿‡P1å’ŒP2æ§åˆ¶æ›²çº¿&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="Android" scheme="https://ivonhoe.github.io/tags/Android/"/>
    
      <category term="åŠ¨ç”»" scheme="https://ivonhoe.github.io/tags/%E5%8A%A8%E7%94%BB/"/>
    
      <category term="è´å¡å°”æ›²çº¿" scheme="https://ivonhoe.github.io/tags/%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF/"/>
    
  </entry>
  
  <entry>
    <title>[è¯‘]Context?ä»€ä¹ˆæ˜¯Contextï¼Ÿ</title>
    <link href="https://ivonhoe.github.io/2015/04/08/-%E7%BF%BB%E8%AF%91-Context-%E4%BB%80%E4%B9%88%E6%98%AFContext%EF%BC%9F/"/>
    <id>https://ivonhoe.github.io/2015/04/08/-ç¿»è¯‘-Context-ä»€ä¹ˆæ˜¯Contextï¼Ÿ/</id>
    <published>2015-04-08T03:06:31.000Z</published>
    <updated>2016-03-06T13:33:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæ–‡åœ°å€ï¼š<a href="http://possiblemobile.com/2013/06/context/" target="_blank" rel="external">http://possiblemobile.com/2013/06/context/</a></p>
<h2 id="Contextå¯èƒ½æ˜¯Androidåº”ç”¨ä¸­æœ€å¸¸ç”¨çš„å…ƒç´ ä¹Ÿæ˜¯æœ€å®¹æ˜“è¯¯ç”¨çš„å…ƒç´ ">Contextå¯èƒ½æ˜¯Androidåº”ç”¨ä¸­æœ€å¸¸ç”¨çš„å…ƒç´ ä¹Ÿæ˜¯æœ€å®¹æ˜“è¯¯ç”¨çš„å…ƒç´ </h2><p>Contextæ˜¯ç»å¸¸è¢«ä¼ é€’çš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥å¾ˆå®¹æ˜“çš„æ„é€ ä¸€ä¸ªä½ æ„æƒ³ä¸åˆ°çš„æƒ…æ™¯ï¼Œå¦‚åŠ è½½èµ„æºï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çš„Activityï¼Œå¾—åˆ°ä¸€ä¸ªç³»ç»ŸæœåŠ¡ï¼Œå¾—åˆ°å†…éƒ¨æ–‡ä»¶è·¯å¾„å’Œåˆ›å»ºè§†å›¾éƒ½éœ€è¦ä¸€ä¸ªContextå»å®Œæˆè¿™ä¸ªå·¥ä½œï¼Œæˆ‘æ¥ä¸‹æ¥ä¸ºä½ åœ¨Contextåˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„å’Œä¸ºä½ èƒ½åœ¨ä½ çš„åº”ç”¨ä¸­æ›´å¥½çš„è¿ç”¨Contextæä¾›å»ºè®®ã€‚<br><a id="more"></a></p>
<h2 id="Contextç±»å‹">Contextç±»å‹</h2><p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„Contextå®ä¾‹éƒ½æ˜¯ç›¸åŒçš„ï¼Œå¯¹äºä¸åŒçš„Androidåº”ç”¨ç»„ä»¶ï¼ŒContextä¼šæœ‰ä¸€äº›å·®åˆ«ã€‚</p>
<h3 id="Application">Application</h3><p>Application æ˜¯åº”ç”¨è¿›ç¨‹ä¸­çš„ä¸€ä¸ªå•ä¾‹ï¼Œå®ƒå¯ä»¥é€šè¿‡Activityæˆ–è€…Serviceçš„getApplication()æ–¹æ³•æˆ–è€…ä»Contextæ´¾ç”Ÿå‡ºçš„å…¶ä»–å¯¹è±¡è°ƒç”¨getApplicationContext()æ–¹æ³•å¾—åˆ°ï¼Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹é‡Œä»»æ„æ—¶åˆ»ä½ å¾—åˆ°çš„éƒ½æ˜¯ç›¸åŒçš„Applicationå®ä¾‹ã€‚</p>
<h3 id="Activityå’ŒService">Activityå’ŒService</h3><p>Activityå’ŒSeviceç»§æ‰¿ContextWrapperï¼Œè€ŒContxtWrapperåŒæ ·å®ç°äº†Contextçš„æ¥å£ï¼Œä½†æ˜¯ContextWrapperçš„æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯é€šè¿‡åŒ…è£…ä¸€ä¸ªå†…éƒ¨contextå¯¹è±¡å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„base contextï¼ˆæ³¨ï¼šçœ‹ContextWrapperæºç ï¼ŒContextWrapperé¡¾åæ€ä¹‰å°±æ˜¯Contextçš„åŒ…è£…ï¼ŒContextWrapperçš„å®é™…åŠŸèƒ½éƒ½æ˜¯æˆå‘˜å˜é‡mBaseå®Œæˆçš„ï¼ŒContextThemeWrapperé›†æˆContextWrapperï¼Œå¢åŠ äº†Themeå’ŒConfigurationä½œä¸ºæˆå‘˜å˜é‡ï¼ŒActivityç»§æ‰¿ContextThemeWrapperï¼Œæ‰€ä»¥è¯´Activityæ‰æ˜¯å”¯ä¸€åŒ…å«ä¸»é¢˜ä¿¡æ¯çš„contextã€‚è¯¦ç»†è§ä¸‹æ–‡ï¼‰ã€‚å½“frameworkåˆ›å»ºä¸€ä¸ªæ–°çš„Activityæˆ–è€…Serviceçš„å®ä¾‹æ—¶ï¼Œä¹Ÿä¼šåˆ›é€ ä¸€ä¸ªæ–°çš„ContextImplå®ä¾‹å»çœŸæ­£å®Œæˆcontextçš„å®é™…åŠŸèƒ½ï¼Œæ¯ä¸€ä¸ªActivityæˆ–è€…æœåŠ¡ï¼Œå’Œä»–ä»¬ç›¸åº”çš„base contextï¼Œéƒ½æ˜¯ä¸åŒçš„contextå®ä¾‹ã€‚</p>
<h3 id="BroadcastReceiver">BroadcastReceiver</h3><p>BroadcastReceiveræœ¬èº«å¹¶ä¸æ˜¯Contextï¼Œä½†æ˜¯å½“å¹¿æ’­äº‹ä»¶ä¼ é€’çš„æ—¶å€™ï¼Œframeworkéƒ½ä¼šåœ¨onReceive()æ–¹æ³•ä¸­ä¼ é€’ä¸€ä¸ªContextã€‚è¿™ä¸ªContextæ˜¯ä¸€ä¸ªReceiverRestrictedContextå®ä¾‹ï¼ˆæ³¨ï¼šçœ‹ContextImplçš„getReceiverRestrictedContext()æ–¹æ³•ï¼‰ï¼Œå®ƒçš„registerReceiver()å’ŒbindService()æ–¹æ³•æ˜¯å¤±æ•ˆçš„ï¼Œè¿™ä¸¤ä¸ªåŠŸèƒ½æ˜¯ä¸å…è®¸é€šè¿‡onReceive()æ–¹æ³•ä¼ é€’çš„Contextè°ƒç”¨çš„ï¼Œï¼ˆæ¯æ¬¡receiverå¤„ç†ä¸€ä¸ªå¹¿æ’­ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„contextå®ä¾‹ã€‚)</p>
<h3 id="ContentProvider">ContentProvider</h3><p>ContentProvideråŒæ ·ä¹Ÿä¸æ˜¯Contextï¼Œä½†æ˜¯å·²è¢«åˆ›å»ºå°±å¯ä»¥æ´»å–getContextæ–¹æ³•ï¼Œå¦‚æœContentProviderå’Œè°ƒç”¨è€…åœ¨åŒä¸€ä¸ªè¿›ç¨‹ï¼Œé‚£ä¼šè¿”å›ç›¸åŒçš„Applicationå®ä¾‹ï¼Œå¦‚æœåœ¨ä¸¤ä¸ªå•ç‹¬çš„è¿›ç¨‹é‡Œï¼ŒgetContext()ä¼šè¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„Contextï¼Œä»£è¡¨è¿™ä¸ªproviderè¿›ç¨‹çš„Contextã€‚ï¼ˆæ³¨ï¼šå¯ä»¥é˜…è¯»ActivityThread.javaä¸­çš„installProvider()å’ŒContentProviderçš„attachInfo()æ–¹æ³•ï¼ŒinstallProvideræ–¹æ³•ä¼šæ ¹æ®providerçš„åŒ…åå’Œå½“å‰è¿›ç¨‹åè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæ˜¯åŒä¸€ä¸ªè¿›ç¨‹é‚£å°±ä½¿ç”¨å½“å‰çš„application contextï¼Œå¦‚æœåœ¨ä¸åŒçš„è¿›ç¨‹ä¸­ï¼Œå°±ä¼šè°ƒç”¨createPackageContextåˆ›å»ºä¸€ä¸ªproviderç›¸å…³çš„Contextï¼Œå¹¶é€šè¿‡attachInfoç»‘å®šproviderï¼‰ã€‚</p>
<h2 id="ä¿å­˜å¼•ç”¨">ä¿å­˜å¼•ç”¨</h2><p>æˆ‘ä»¬é¦–å…ˆå…³æ³¨çš„é—®é¢˜æ˜¯ï¼Œå½“æˆ‘ä»¬åœ¨ä¸€ä¸ªå¯¹è±¡æˆ–è€…ç±»é‡Œé¢ä¿å­˜ä¸€ä¸ªcontextçš„å¼•ç”¨ï¼Œä½†æ˜¯è¿™ä¸ªå¯¹è±¡æˆ–è€…ç±»çš„ç”Ÿå‘½å‘¨æœŸè¶…è¿‡äº†ä½ ä¿å­˜çš„contextå®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºéœ€è¦ä¸€ä¸ªContextå¯¹è±¡å»åŠ è½½èµ„æºæˆ–è€…å»è°ƒç”¨CotentProviderï¼Œä¿å­˜å½“å‰Activityæˆ–è€…Serviceçš„å¼•ç”¨åœ¨è¿™ä¸ªå•ä¾‹ä¸­ã€‚</p>
<p>å¤±è´¥çš„å•ä¾‹ï¼š</p>
<pre><code><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomManager</span> {
    <span class="keyword">private</span> <span class="keyword">static</span> CustomManager sInstance;

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CustomManager <span class="title">getInstance</span>(<span class="params">Context context</span>) </span>{
        <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) {
            sInstance = <span class="keyword">new</span> CustomManager(context);
        }

        <span class="keyword">return</span> sInstance;
    }

    <span class="keyword">private</span> Context mContext;

    <span class="function"><span class="keyword">private</span> <span class="title">CustomManager</span>(<span class="params">Context context</span>) </span>{
        mContext = context;
    }
}
</code></pre><p>è¿™é‡Œçš„é—®é¢˜æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“è¿™ä¸ªContextä»å“ªé‡Œæ¥ï¼Œå½“æŒæœ‰ä¸€ä¸ªç»“æŸçš„Activityæˆ–è€…Serviceæ˜¯ä¸å®‰å…¨çš„ï¼Œè¿™æ˜¯å› ä¸ºåœ¨è¿™ä¸ªç±»é‡Œçš„å•ä¾‹æ˜¯ä¸€ä¸ªé™æ€å¼•ç”¨ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¼•ç”¨çš„å¯¹è±¡åŒ…æ‹¬æ‰€æœ‰è¢«è¿™ä¸ªå¯¹è±¡å¼•ç”¨çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚å¦‚æœè¿™ä¸ªContextæ˜¯ä¸€ä¸ªActivityï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆè¿™ä¸ªActivityå¼•ç”¨çš„æ‰€æœ‰è§†å›¾å’Œå…¶ä»–å¯èƒ½è·Ÿå®ƒå…³è”çš„å¯¹è±¡æŒç»­å æœ‰å†…å­˜ï¼Œé€ æˆå†…å­˜æ³„éœ²ã€‚</p>
<p>ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå•ä¾‹ä¿®æ”¹æˆå¼•ç”¨appliction contextã€‚</p>
<p>ä¿®æ”¹åçš„å•ä¾‹ï¼š</p>
<pre><code><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomManager</span> {
    <span class="keyword">private</span> <span class="keyword">static</span> CustomManager sInstance;

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CustomManager <span class="title">getInstance</span>(<span class="params">Context context</span>) </span>{
        <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) {
            <span class="comment">//Always pass in the Application Context</span>
            sInstance = <span class="keyword">new</span> CustomManager(context.getApplicationContext());
        }

        <span class="keyword">return</span> sInstance;
    }

    <span class="keyword">private</span> Context mContext;

    <span class="function"><span class="keyword">private</span> <span class="title">CustomManager</span>(<span class="params">Context context</span>) </span>{
        mContext = context;
    }
}
</code></pre><p>ç°åœ¨ä¸ç”¨å…³å¿ƒè¿™ä¸ªContextæ˜¯ä»€ä¹ˆï¼Œå› ä¸ºç°åœ¨æŒæœ‰çš„å¼•ç”¨æ˜¯å®‰å…¨çš„ã€‚Application contextæœ¬èº«å°±æ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œæˆ‘ä»¬åªæ˜¯åˆ›å»ºå¦ä¸€ä¸ªé™æ€å¼•ç”¨å¹¶ä¸ä¼šé€ æˆå†…å­˜æ³„éœ²ã€‚å¦ä¸€ä¸ªç±»ä¼¼ä¾‹å­å°±æ˜¯åœ¨ä¸€ä¸ªåå°çš„çº¿ç¨‹æˆ–è€…ç­‰å¾…çš„Handleré‡ŒæŒæœ‰ä¸€ä¸ªContextå¼•ç”¨ã€‚<br>æ—¢ç„¶è¿™æ ·é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆæ€»æ˜¯å¼•ç”¨ä¸€ä¸ªapplication contextå‘¢ï¼Ÿæˆ‘ä»¬å°±æ°¸è¿œä¸ç”¨æ‹…å¿ƒå†…å­˜æ³„éœ²çš„é—®é¢˜ã€‚ç­”æ¡ˆå½“ç„¶æ˜¯ä¸å¯ä»¥ï¼Œå°±æƒ³æˆ‘åœ¨å‰é¢æåˆ°çš„é‚£æ ·ï¼Œæ¯ç§ç±»å‹çš„Contextç±»å‹éƒ½ä¸ç›¸åŒã€‚</p>
<h2 id="Contextçš„åŠŸèƒ½">Contextçš„åŠŸèƒ½</h2><p>æˆ‘ä»¬å®‰å…¨çš„è°ƒç”¨Contextçš„æ–¹æ³•å–å†³äºè¿™ä¸ªContextæ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼Œä¸‹é¢çš„è¡¨æ˜¯ContextåŠŸèƒ½çš„ä½¿ç”¨æƒ…å†µï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">Application</th>
<th style="text-align:center">Activity</th>
<th style="text-align:center">Service</th>
<th style="text-align:center">ContentProvider</th>
<th style="text-align:center">BroadcastReceiver</th>
</tr>
</thead>
<tbody>
<tr>
<td>Show a Dialog</td>
<td style="text-align:center">NO</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">NO</td>
<td style="text-align:center">NO</td>
<td style="text-align:center">NO</td>
</tr>
<tr>
<td>Start an Activity</td>
<td style="text-align:center">NO1</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">NO1</td>
<td style="text-align:center">NO1</td>
<td style="text-align:center">NO1</td>
</tr>
<tr>
<td>Layout Inflation</td>
<td style="text-align:center">NO2</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">NO2</td>
<td style="text-align:center">NO2</td>
<td style="text-align:center">NO2</td>
</tr>
<tr>
<td>Start a Service</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
</tr>
<tr>
<td>Bind to a Service</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">NO</td>
</tr>
<tr>
<td>Send a Broadcast</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
</tr>
<tr>
<td>Register BroadcastReceiver</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">NO3</td>
</tr>
<tr>
<td>Load Resource Values</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
<td style="text-align:center">YES</td>
</tr>
</tbody>
</table>
<p>æ³¨ï¼š<br>1.ä¸€ä¸ªapplicationå¯ä»¥å¯åŠ¨ä¸€ä¸ªActivityï¼Œä½†æ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ä»»åŠ¡ã€‚è¿™æ ·åšå¯èƒ½æ»¡è¶³ä¸€äº›ç‰¹å®šçš„éœ€æ±‚ï¼Œä½†æ˜¯åœ¨åº”ç”¨ä¸­åˆ›å»ºä¸€ä¸ªéæ ‡å‡†çš„å›é€€æ ˆå¹¶ä¸æ˜¯ä¸€ç§ç»è¿‡æ·±æ€ç†Ÿè™‘çš„æ¨èåšæ³•ã€‚<br>2.è¿™æ ·æ˜¯åˆæ³•çš„ï¼Œä½†æ˜¯è¿™æ ·æ˜¯åŠ è½½å‡ºæ¥çš„ç³»ç»Ÿé»˜è®¤çš„ä¸»é¢˜å¸ƒå±€ï¼Œè€Œå¹¶ä¸æ˜¯ä½ åœ¨åº”ç”¨é‡Œå®šä¹‰çš„ä¸»é¢˜æ ·å¼ã€‚<br>3.åœ¨receiveræ˜¯nullçš„æƒ…å†µä¸‹æ˜¯å…è®¸çš„ï¼ˆæ³¨ï¼šçœ‹ContextImplçš„å†…éƒ¨ç±»ReceiverRestrictedContextï¼ŒReceiverRestrictedContextè¿›ç¨‹ContentWrapperä½†æ˜¯é‡å†™äº†æ³¨å†Œå¹¿æ’­å’Œç»‘å®šæœåŠ¡çš„æ–¹æ³•ï¼Œä¼šåœ¨è¿™ä¸¤ä¸ªæ–¹æ³•é‡ŒæŠ›å‡ºå¼‚å¸¸ã€‚ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿï¼‰ï¼Œåœ¨4.2ä»¥ä¸Šç‰ˆæœ¬ç”¨æ¥è·å–ç²˜æ€§å¹¿æ’­ã€‚</p>
<h2 id="ç”¨æˆ·æ¥å£">ç”¨æˆ·æ¥å£</h2><p>ä»ä¸Šä¸ªè¡¨æ ¼ä½ å¯ä»¥çœ‹å‡ºï¼Œæœ‰å¾ˆå¤šå’ŒUIå¤„ç†ç›¸å…³çš„Contextçš„åŠŸèƒ½å¹¶ä¸é€‚åˆç”¨application contextå»å¤„ç†ã€‚äº‹å®ä¸Šï¼Œå®ç°äº†æ‰€æœ‰å’Œæ‰€æœ‰UIç›¸å…³çš„æ“ä½œæ¥å£çš„æ˜¯Activityï¼Œè€Œå…¶ä»–çš„ç±»åˆ«çš„åŠŸèƒ½éƒ½å‡ ä¹ç›¸åŒã€‚<br>å¹¸è¿çš„æ˜¯è¿™ä¸‰ä¸ªæ“ä½œï¼ˆæ³¨ï¼šæŒ‡Application contextä¸å…·å¤‡çš„ä¸‰ä¸ªContextåŠŸèƒ½ï¼‰æ˜¯applicationåœ¨ActivityèŒƒå›´ä¹‹å¤–æ ¹æœ¬ä¸éœ€è¦å»åšçš„ï¼Œè¿™å¥½åƒå°±æ˜¯frameworkæ•…æ„è®¾è®¡å¦‚æ­¤ï¼Œå¦‚æœä½ å°è¯•é€šè¿‡ä¸€ä¸ªapplication contextå»åˆ›å»ºä¸€ä¸ªå¯¹è¯æ¡†æˆ–è€…å¯åŠ¨ä¸€ä¸ªActivityä¼šæŠ›å‡ºå¼‚å¸¸å¹¶é€ æˆåº”ç”¨ç¨‹åºç»ˆæ­¢ï¼Œä¼šæœ‰æ˜æ˜¾çš„æŒ‡ç¤ºå‘Šè¯‰ä½ è¿™æ ·å‡ºé”™äº†ã€‚<br>å¦ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„é—®é¢˜æ˜¯åŠ è½½å¸ƒå±€ï¼Œå¦‚æœä½ é˜…è¯»è¿‡æˆ‘çš„æ–‡ç« <a href="http://www.doubleencore.com/2013/05/layout-inflation-as-intended" target="_blank" rel="external">layout inflation</a>,ä½ ä¼šè§‰å¾—è¿™ä¸ªè¿‡ç¨‹ä¼šæ˜¯ç¨å¾®éš¾ç†è§£çš„è¿‡ç¨‹ï¼Œä½¿ç”¨æ­£ç¡®çš„contextå°±ç®—ä¸€ä¸ªã€‚å½“ä½ ä½¿ç”¨é€šè¿‡application contextæ„é€ çš„LayoutInflaterå»åŠ è½½è§†å›¾ï¼Œå½“ç„¶frameworkåŒæ ·ä¼šè¿”å›ä¸€ä¸ªæ­£ç¡®çš„è§†å›¾æ ‘ï¼Œä½†æ˜¯ä½ åœ¨åº”ç”¨ä¸­è®¾ç½®çš„ä¸»é¢˜å’Œæ ·å¼æ˜¯è¢«å¿½ç•¥çš„ï¼Œè¿™æ˜¯å› ä¸ºActivityæ‰æ˜¯çœŸæ­£å…³è”ä½ åœ¨manifestä¸­è®¾ç½®çš„ä¸»é¢˜çš„Contextã€‚å…¶ä»–ç±»å‹çš„Contextå®ä¾‹ä¼šä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„ä¸»é¢˜æ ·å¼å»æ„å»ºè§†å›¾ã€‚æ‰€ä»¥è¿™æ ·æ„å»ºå‡ºçš„è§†å›¾å¯èƒ½å¹¶ä¸æ˜¯åƒä½ é¢„æœŸçš„é‚£æ ·ã€‚</p>
<h2 id="äº¤é›†">äº¤é›†</h2><p>ä¸€å®šä¼šæœ‰äººå¾—åˆ°è¿™æ ·çš„å†²çªçš„ç»“è®ºï¼Œåœ¨åº”ç”¨è®¾è®¡ä¸­ä¼šæœ‰ä¸€ç§æƒ…å†µï¼Œå¯èƒ½å¿…é¡»é•¿æœŸæŒæœ‰ä¸€ä¸ªActivity Contextå¼•ç”¨ï¼Œå› ä¸ºæˆ‘æƒ³å®Œæˆçš„ä»»åŠ¡åŒ…å«UIçš„æ“ä½œã€‚å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œé‚£æˆ‘åªèƒ½å¼ºçƒˆå»ºè®®ä½ é‡æ–°è€ƒè™‘ä½ çš„è®¾è®¡ï¼Œå› ä¸ºé‚£æ ·çš„è®¾è®¡å°†æ˜¯å’ŒAndroidåº”ç”¨æ¶æ„èƒŒé“è€Œé©°çš„è¿‡ç¨‹ã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä½ å½“å‰å°é—­çš„ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨Contextå°±æ˜¯å¯ä»¥äº†ï¼Œåªæœ‰ä½ æŒæœ‰å¼•ç”¨ä¸è¶…è¿‡è¿™ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå°±ä¸ä¼šæœ‰é—®é¢˜ï¼Œåªè¦ä½ éœ€è¦ä¿å­˜ä¸€ä¸ªContextçš„å¼•ç”¨è¶…å‡ºActivityæˆ–è€…Serviceçš„ç”Ÿå‘½å‘¨æœŸï¼Œå“ªæ€•æ˜¯æš‚æ—¶çš„å¼•ç”¨ï¼Œé‚£å°±è¯·è½¬æ¢æˆä¿å­˜application contextçš„å¼•ç”¨ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åŸæ–‡åœ°å€ï¼š&lt;a href=&quot;http://possiblemobile.com/2013/06/context/&quot;&gt;http://possiblemobile.com/2013/06/context/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Contextå¯èƒ½æ˜¯Androidåº”ç”¨ä¸­æœ€å¸¸ç”¨çš„å…ƒç´ ä¹Ÿæ˜¯æœ€å®¹æ˜“è¯¯ç”¨çš„å…ƒç´ &quot;&gt;Contextå¯èƒ½æ˜¯Androidåº”ç”¨ä¸­æœ€å¸¸ç”¨çš„å…ƒç´ ä¹Ÿæ˜¯æœ€å®¹æ˜“è¯¯ç”¨çš„å…ƒç´ &lt;/h2&gt;&lt;p&gt;Contextæ˜¯ç»å¸¸è¢«ä¼ é€’çš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥å¾ˆå®¹æ˜“çš„æ„é€ ä¸€ä¸ªä½ æ„æƒ³ä¸åˆ°çš„æƒ…æ™¯ï¼Œå¦‚åŠ è½½èµ„æºï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çš„Activityï¼Œå¾—åˆ°ä¸€ä¸ªç³»ç»ŸæœåŠ¡ï¼Œå¾—åˆ°å†…éƒ¨æ–‡ä»¶è·¯å¾„å’Œåˆ›å»ºè§†å›¾éƒ½éœ€è¦ä¸€ä¸ªContextå»å®Œæˆè¿™ä¸ªå·¥ä½œï¼Œæˆ‘æ¥ä¸‹æ¥ä¸ºä½ åœ¨Contextåˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„å’Œä¸ºä½ èƒ½åœ¨ä½ çš„åº”ç”¨ä¸­æ›´å¥½çš„è¿ç”¨Contextæä¾›å»ºè®®ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="https://ivonhoe.github.io/tags/Android/"/>
    
      <category term="Context" scheme="https://ivonhoe.github.io/tags/Context/"/>
    
      <category term="ç¿»è¯‘" scheme="https://ivonhoe.github.io/tags/%E7%BF%BB%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>AndroidåŠ¨ç”»æ€»ç»“</title>
    <link href="https://ivonhoe.github.io/2015/02/09/Android%E5%8A%A8%E7%94%BB%E6%80%BB%E7%BB%93/"/>
    <id>https://ivonhoe.github.io/2015/02/09/AndroidåŠ¨ç”»æ€»ç»“/</id>
    <published>2015-02-09T11:40:53.000Z</published>
    <updated>2016-03-06T13:36:33.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="è¯´åœ¨å¼€å§‹">è¯´åœ¨å¼€å§‹</h3><p>è¿™ç¯‡æ–‡æ¡£è®°å½•äº†ä¸€ä¸‹è‡ªå·±åœ¨å®é™…å·¥ä½œä¸­å®ç°çš„ä¸€äº›AndroidåŠ¨ç”»æ•ˆæœæ—¶çš„å¼€å‘æ€è·¯ï¼Œæ€»ç»“äº†æˆ‘è‡ªå·±å¦‚ä½•çœ‹å¾…AndroidåŠ¨ç”»é—®é¢˜ï¼Œå¸Œæœ›èƒ½ç»™å¤§å®¶çš„åŠ¨ç”»å¼€å‘æä¾›ä¸€äº›æ€è·¯å’Œå¸®åŠ©ã€‚</p>
<h3 id="ä¸€ã€AndroidåŠ¨ç”»åŸºç¡€">ä¸€ã€AndroidåŠ¨ç”»åŸºç¡€</h3><h4 id="1-1_åŠ¨ç”»ç±»å‹">1.1 åŠ¨ç”»ç±»å‹</h4><ul>
<li><strong>Frame Animationï¼š</strong><br>å¸§åŠ¨ç”»ï¼Œé¡ºåºæ’­æ”¾äº‹å…ˆåšå¥½çš„å›¾åƒï¼Œæ˜¯ä¸€ç§ç”»é¢è½¬æ¢åŠ¨ç”»</li>
<li><strong>Tween Animation:</strong><br>è¡¥é—´åŠ¨ç”»ï¼ˆæˆ–è€…å«æ¸å˜åŠ¨ç”»ï¼‰ï¼Œé€šè¿‡å¯¹åœºæ™¯é‡Œçš„å¯¹è±¡ä¸æ–­åšå›¾åƒå˜æ¢(å¹³ç§»ã€ç¼©æ”¾ã€æ—‹è½¬)äº§ç”ŸåŠ¨ç”»æ•ˆæœ<a id="more"></a></li>
<li><strong>Property Animation:</strong><br>å±æ€§åŠ¨ç”»ï¼Œé€šè¿‡åŠ¨æ€åœ°æ”¹å˜å¯¹è±¡çš„å±æ€§ä»è€Œè¾¾åˆ°åŠ¨ç”»æ•ˆæœï¼Œå±æ€§åŠ¨ç”»ä¸ºAPI 11æ–°ç‰¹æ€§</li>
</ul>
<h4 id="1-2_å¸§åŠ¨ç”»ï¼š">1.2 å¸§åŠ¨ç”»ï¼š</h4><p>æ˜¯æŒ‡é¡ºåºæ‰§è¡Œé¢„å…ˆè®¾ç½®å¥½çš„ä¸€ç»„å›¾ç‰‡ï¼Œç±»ä¼¼ç”µå½±èƒ¶ç‰‡çš„å½¢å¼ï¼Œè®¾ç½®æ¯ä¸€å¸§drawableï¼Œåœ¨javaä»£ç ä¸­åŠ è½½èµ„æºç”Ÿæˆä¸€ä¸ªAnimationDrawableå¯¹è±¡ã€‚ä¾‹å¦‚ï¼šåœ¨xmlä¸­é…ç½®spin_animation.xmlåœ¨æ–‡ä»¶å¤¹res/drawable/ä¸­ï¼š</p>
<pre><code><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> 
<span class="tag">&lt;<span class="title">animation-list</span>  
  <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span>  
  <span class="attribute">android:oneshot</span>=<span class="value">"false"</span>  &gt;</span>  
       <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:drawable</span>=<span class="value">"@drawable/p1"</span> <span class="attribute">android:duration</span>=<span class="value">"1000"</span>&gt;</span><span class="tag">&lt;/<span class="title">item</span>&gt;</span>  
       <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:drawable</span>=<span class="value">"@drawable/p2"</span> <span class="attribute">android:duration</span>=<span class="value">"1000"</span>&gt;</span><span class="tag">&lt;/<span class="title">item</span>&gt;</span>  
       <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:drawable</span>=<span class="value">"@drawable/p3"</span> <span class="attribute">android:duration</span>=<span class="value">"1000"</span>&gt;</span><span class="tag">&lt;/<span class="title">item</span>&gt;</span>  
       <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:drawable</span>=<span class="value">"@drawable/p4"</span> <span class="attribute">android:duration</span>=<span class="value">"1000"</span>&gt;</span><span class="tag">&lt;/<span class="title">item</span>&gt;</span>  
<span class="tag">&lt;/<span class="title">animation-list</span>&gt;</span>
</code></pre><p>åŠ è½½èµ„æºå¹¶åº”ç”¨ï¼š</p>
<pre><code>// <span class="operator"><span class="keyword">Load</span> the ImageView that will host the animation <span class="keyword">and</span>
// <span class="keyword">set</span> its background <span class="keyword">to</span> our AnimationDrawable <span class="keyword">XML</span> <span class="keyword">resource</span>.
ImageView img = (ImageView)findViewById(R.<span class="keyword">id</span>.spinning_wheel_image);</span>
img.setBackgroundResource(R.drawable.spin_animation);

// Get the background, which has been compiled to an AnimationDrawable object.
AnimationDrawable frameAnimation = (AnimationDrawable) img.getBackground();

// <span class="operator"><span class="keyword">Start</span> the animation (looped playback <span class="keyword">by</span> <span class="keyword">default</span>).
frameAnimation.<span class="keyword">start</span>();</span>
</code></pre><h4 id="1-3_è¡¥é—´åŠ¨ç”»ï¼š">1.3 è¡¥é—´åŠ¨ç”»ï¼š</h4><p>è¡¥é—´åŠ¨ç”»æœ‰å››ç§åŠ¨ç”»å½¢å¼ï¼Œåˆ†åˆ«æ˜¯:</p>
<ul>
<li>alpha æ¸å˜é€æ˜åº¦åŠ¨ç”»æ•ˆæœ</li>
<li>scale æ¸å˜å°ºå¯¸ä¼¸ç¼©åŠ¨ç”»æ•ˆæœ</li>
<li>translate ç”»é¢ä½ç½®ç§»åŠ¨åŠ¨ç”»æ•ˆæœ</li>
<li>rotate ç”»é¢æ—‹è½¬åŠ¨ç”»æ•ˆæœ</li>
</ul>
<p>å¯ä»¥å’Œå¸§åŠ¨ç”»ä¸€æ ·åœ¨xmlä¸­é…ç½®åŠ¨ç”»ï¼Œä¾‹å¦‚æ—‹è½¬åŠ¨ç”»rotate.xmlï¼Œè®¾ç½®èµ·å§‹å’Œç»ˆæ­¢çš„è§’åº¦ï¼ŒåŠ¨ç”»ä¸­å¿ƒçš„ç›¸å¯¹ä½ç½®ï¼ŒåŠ¨ç”»æ—¶é•¿ç­‰ã€‚</p>
<pre><code><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> 
<span class="tag">&lt;<span class="title">set</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span>  
    <span class="attribute">android:fillAfter</span> = "<span class="attribute">false</span>"  
    <span class="attribute">android:zAdjustment</span>=<span class="value">"bottom"</span> &gt;</span>  
    <span class="tag">&lt;<span class="title">rotate</span>  
        <span class="attribute">android:fromDegrees</span>=<span class="value">"0"</span>  
        <span class="attribute">android:toDegrees</span>=<span class="value">"360"</span>  
        <span class="attribute">android:pivotX</span>=<span class="value">"50%"</span>  
        <span class="attribute">android:pivotY</span>=<span class="value">"50%"</span>  
        <span class="attribute">android:duration</span>=<span class="value">"4000"</span> /&gt;</span>  
<span class="tag">&lt;/<span class="title">set</span>&gt;</span>
</code></pre><p>ä½¿ç”¨AnimationUtilsåŠ è½½åŠ¨ç”»çš„xmlæ–‡ä»¶ç”ŸæˆAnimationçš„å®ä¾‹ï¼Œä¹Ÿå¯ä»¥åœ¨JAVAä»£ç ä¸­æ„é€ è¡¥é—´åŠ¨ç”»</p>
<pre><code><span class="comment">// åŠ è½½xmlæ„é€ Animation</span>
Animation anim = AnimationUtils.loadAnimation(mContext, R.anim.rotate);
<span class="comment">// ä¸é€šè¿‡xmlæ„é€ </span>
Animation rotate = <span class="keyword">new</span> RotateAnimation(<span class="number">0.0f</span>, +<span class="number">360</span>,  Animation.RELATIVE_TO_SELF, <span class="number">0.5f</span>, 
                   Animation.RELATIVE_TO_SELF, <span class="number">0.5f</span>);
</code></pre><p><img src="/res/android_animation/android_animation_animation_class.png" alt="Animationç±»å›¾"></p>
<h4 id="1-4_å±æ€§åŠ¨ç”»ï¼š">1.4 å±æ€§åŠ¨ç”»ï¼š</h4><p>è¡¥é—´åŠ¨ç”»åªèƒ½åº”ç”¨äºè§†å›¾(View)å¯¹è±¡ï¼ŒåŠ¨ç”»çš„æ–¹å¼ä¹Ÿä»…é™äºä¸Šé¢æ‰€è¯´çš„å››ç§æ–¹å¼ï¼Œè€Œå±æ€§åŠ¨ç”»å¯ä»¥åº”ç”¨äºæ‰€æœ‰çš„Objectå¯¹è±¡ï¼Œå®ƒé€šè¿‡æ”¹å˜å¯¹è±¡çš„å±æ€§å€¼å®ŒæˆåŠ¨ç”»æ•ˆæœï¼Œå½“ç„¶å‰ææ˜¯éœ€è¦æœ‰è¯¥å±æ€§çš„getå’Œsetæ–¹æ³•ï¼Œé€šè¿‡åœ¨åŠ¨ç”»çš„è¿‡ç¨‹ä¸­è°ƒç”¨getå’Œsetæ–¹æ³•æ”¹å˜å¯¹è±¡çš„å±æ€§å€¼æ¥å®ŒæˆåŠ¨ç”»æ•ˆæœã€‚ä¾‹å¦‚é€šè¿‡ObjectAnimatoræŒ‡å®šè¦æ”¹å˜çš„å¯¹è±¡å’Œå±æ€§åç§°ï¼š</p>
<pre><code>ObjectAnimator animator = ObjectAnimator.ofInt(testObject, <span class="string">"data"</span>, <span class="number">0</span>, <span class="number">10</span>);
animator.start();

<span class="keyword">private</span> <span class="keyword">class</span> TestObject {
    <span class="keyword">private</span> <span class="keyword">int</span> data;
    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getData</span><span class="params">()</span> </span>{
        <span class="keyword">return</span> data;
    }
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(<span class="keyword">int</span> data)</span> </span>{
        <span class="keyword">this</span>.data = data;
    }
}
</code></pre><p>å½“ç„¶ä¹Ÿé€šè¿‡ValueAnimatorï¼Œä¸éœ€è¦æŒ‡å®šå±æ€§åæ›´çµæ´»ï¼Œè®¾ç½®AnimatorUpdateListenerï¼Œåœ¨åŠ¨ç”»æ›´æ–°çš„å›è°ƒä¸­å®Œæˆæƒ³è¦çš„åŠ¨ä½œï¼Œä¾‹å¦‚ï¼Œåœ¨ä»0åˆ°10çš„å˜åŒ–è¿‡ç¨‹ä¸­ï¼Œå»æ›´æ–°è§†å›¾çš„ä½ç½®ï¼Ÿæˆ–è€…å…¶ä»–æƒ³è¦çš„ä»»ä½•å¯èƒ½æ“ä½œã€‚</p>
<pre><code>ValueAnimator animator = ValueAnimator.ofInt(<span class="number">0</span>, <span class="number">10</span>);
animator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() {
    @<span class="function">Override
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>{
    <span class="keyword">int</span> factor = (Integer) animation.getAnimatedValue();
    }
});
</code></pre><h4 id="1-5_åŠ¨ç”»æ’å€¼ï¼š">1.5 åŠ¨ç”»æ’å€¼ï¼š</h4><p>æ’å€¼å™¨çš„ä½œç”¨æ˜¯æ ¹æ®æ—¶é—´è¿è¡Œçš„ç™¾åˆ†æ¯”æ¥è®¡ç®—å‡ºå½“å‰å±æ€§æ”¹å˜çš„ç™¾åˆ†æ¯”ï¼Œåæ˜ çš„æ˜¯æ—¶é—´å’ŒåŠ¨ç”»è¿›åº¦ï¼ˆæˆ–å±æ€§å˜åŒ–ï¼‰çš„å…³ç³»ï¼Œé€šè¿‡åŠ¨ç”»å½“å‰è¿è¡Œçš„æ—¶é—´ï¼Œè®¡ç®—å‡ºå½“å‰åŠ¨ç”»çš„å˜åŒ–é‡ã€‚ä¾‹å¦‚ç³»ç»Ÿé¢„åˆ¶çš„çº¿æ€§æ’å€¼å™¨ï¼ˆLinearInterpolatorï¼‰ï¼Œæ—¶é—´å’ŒåŠ¨ç”»è¿›åº¦çš„å‡½æ•°å…³ç³»æ˜¯y = xçš„ç›´çº¿æ–¹ç¨‹ï¼Œå°±è¡¨ç¤ºå½“å‰åŠ¨ç”»æ˜¯å‡é€Ÿå˜åŒ–çš„ã€‚è€Œå½“æ—¶é—´å’ŒåŠ¨ç”»è¿›åº¦çš„å‡½æ•°å…³ç³»å¼è¡¨è¾¾ä¸ºy=x^2çš„æ—¶å€™ï¼Œé‚£è¡¨ç¤ºåŠ¨ç”»çš„å˜åŒ–ç‡éšç€æ—¶é—´çš„å¢åŠ è€Œå¢åŠ çš„ï¼Œåœ¨è§†è§‰ä¸Šå°±è¡¨ç°ä¸ºåŠ é€ŸåŠ¨ç”»ã€‚åœ¨ç†è®ºä¸Šå°±å¯ä»¥é€šè¿‡åŠ¨ç”»æ’å€¼å™¨å®ç°ä¸åŒå¿«æ…¢æ•ˆæœçš„åŠ¨ç”»ã€‚</p>
<p><img src="/res/android_animation/jiasu_jiansu.png" alt="åŠ é€Ÿå‡é€Ÿæ’å€¼å™¨ï¼Œæ›²çº¿çš„æ–œç‡æ˜¯å…ˆå˜å¤§åå˜å°ï¼Œè¯´æ˜é€Ÿåº¦æ˜¯å…ˆåŠ é€Ÿåå‡é€Ÿçš„"></p>
<p>åœ¨ç³»ç»Ÿé¢„åˆ¶çš„æ’å€¼å™¨æœ‰ï¼šAccelerateInterpolatorï¼ˆåŠ é€Ÿæ’å€¼å™¨ï¼‰ï¼ŒAccelerateDecelerateInterpolatorï¼ˆåŠ é€Ÿå‡é€Ÿæ’å€¼å™¨ï¼‰ï¼Œ LinearInterpolatorï¼ˆçº¿æ€§æ’å€¼å™¨ï¼‰ï¼ŒBounceInterpolatorï¼ˆå¼¹è·³æ’å€¼å™¨ï¼‰ï¼ŒAnticipateInterpolatorï¼ˆå›è¡ç§‹åƒæ’å€¼å™¨ï¼‰ï¼ŒAnticipateOvershootInterpolatorï¼Œ CycleInterpolatorï¼ˆæ­£å¼¦å‘¨æœŸå˜åŒ–æ’å€¼å™¨ï¼‰ï¼ŒOvershootInterpolator ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å®ç°TimeTimeInterpolatoræˆ–è€…Interpolatorræ¥å£å®ç°è‡ªå®šä¹‰çš„æ’å€¼å™¨ã€‚</p>
<p><img src="/res/android_animation/android_animation_interpolator_class.png" alt="Interpolatorç±»å›¾"></p>
<h4 id="1-6_åŠ¨ç”»ä¼°å€¼å™¨">1.6 åŠ¨ç”»ä¼°å€¼å™¨</h4><p>ä¼°å€¼å™¨çš„ä½œç”¨æ˜¯ï¼Œæ ¹æ®æ’å€¼å™¨ç»“æœï¼ˆå½“å‰å±æ€§å˜åŒ–çš„ç™¾åˆ†æ¯”ï¼‰è®¡ç®—å‡ºå½“å‰å±æ€§çš„å€¼ï¼Œç³»ç»Ÿé¢„ç½®çš„æœ‰IntEvaluatorï¼ˆé’ˆå¯¹æ•´å‹å±æ€§ï¼‰ã€FloatEvaluatorï¼ˆé’ˆå¯¹æµ®ç‚¹å‹å±æ€§ï¼‰å’ŒArgbEvaluatorï¼ˆé’ˆå¯¹Colorå±æ€§ï¼‰ã€‚æ»¡è¶³çš„å…³ç³»æ˜¯ï¼š</p>
<h3 id="äºŒã€æ¡Œé¢æ–‡ä»¶å¤¹ä¼¸ç¼©åŠ¨ç”»">äºŒã€æ¡Œé¢æ–‡ä»¶å¤¹ä¼¸ç¼©åŠ¨ç”»</h3><h4 id="2-1_IOSæ–‡ä»¶å¤¹åŠ¨ç”»åŸç†">2.1 IOSæ–‡ä»¶å¤¹åŠ¨ç”»åŸç†</h4><p>ç±»ä¼¼IOSçš„æ–‡ä»¶å¤¹è§†å›¾å±•å¼€åŠ¨ç”»ï¼Œç®€å•è¯´å°±æ˜¯é’ˆå¯¹æ–‡ä»¶å¤¹è§†å›¾çš„ä¸€ä¸ªä¼¸ç¼©åŠ¨ç”»ï¼Œè€Œè§†è§‰æ•ˆæœä¸Šçš„åŠ¨ç”»ç›®æ ‡å°±æ˜¯å¦‚ä½•è®©æ–‡ä»¶å¤¹çš„æ¡Œé¢å›¾æ ‡å’Œæ–‡ä»¶å¤¹æ‰“å¼€åçš„è§†å›¾çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªè¿›è¡Œæ”¾å¤§ç¼©å°çš„æ•´ä½“ï¼Œå¤„ç†ä¼¸ç¼©åŠ¨ç”»çš„å…³é”®ï¼š<br>1.ä¼¸ç¼©çš„å‰åæ¯”ä¾‹ï¼ˆå¤šå°‘ï¼‰<br>2.ä¼¸ç¼©è§†å›¾çš„ä¸­å¿ƒåæ ‡ï¼ˆç›¸å¯¹äºå“ªä¸€ç‚¹åšä¼¸ç¼©ï¼‰<br>é’ˆå¯¹ä¼¸ç¼©çš„æ¯”ä¾‹ï¼Œåº”è¯¥æ˜¯æ–‡ä»¶å¤¹å±•å¼€å‰åæ–‡ä»¶å¤¹å†…åº”ç”¨å›¾æ ‡å¤§å°ç¡®å®šçš„ã€‚é’ˆå¯¹å¦‚ä½•ç¡®å®šä¼¸ç¼©è§†å›¾çš„ä¸­å¿ƒåæ ‡ï¼Œå°±éœ€è¦é¦–å…ˆç¡®å®šåæ ‡ç³»ï¼Œå°±æ˜¯ä¸­å¿ƒç‚¹æ˜¯ç›¸å¯¹å“ªä¸ªåæ ‡ç³»ç¡®å®šçš„ï¼ä¼¸ç¼©åŠ¨ç”»åæ ‡ç³»çš„çš„åŸç‚¹åœ¨å“ªé‡Œï¼Ÿ</p>
<ul>
<li>ä¼¸ç¼©åŠ¨ç”»çš„åæ ‡ç³»æ˜¯ç”±å½“å‰ç¼©æ”¾è§†å›¾ç¡®å®šçš„ï¼Œå½“å‰è§†å›¾çš„å·¦ä¸Šè§’ä¸ºåæ ‡ç³»çš„åŸç‚¹ï¼Œå³ï¼ˆ0ï¼Œ0ï¼‰ç‚¹ã€‚</li>
<li>åŸç‚¹çš„æ°´å¹³å‘å³æ–¹å‘ä¸ºæ¨ªåæ ‡çš„æ­£æ–¹å‘ï¼Œå¹³è¡Œæ‰‹æœºå±å¹•å‚ç›´å‘ä¸‹æ–¹å‘æœªçºµåæ ‡çš„æ­£æ–¹å‘ã€‚</li>
</ul>
<p>ç¡®å®šäº†ä¼¸ç¼©çš„åæ ‡ç³»ï¼Œç°åœ¨çš„é—®é¢˜å°±æ˜¯å¦‚ä½•ç¡®å®šä¼¸ç¼©ä¸­å¿ƒç‚¹çš„åæ ‡ï¼Œåœ¨æˆ‘ä»¬å­¦ä¹ æ•°å­¦çš„è¿‡ç¨‹ä¸­ï¼Œè€å¸ˆæ•™æˆ‘ä»¬å¦‚ä½•æŠŠå®é™…é—®é¢˜æŠ½è±¡æˆæ•°å­¦é—®é¢˜ï¼Œå°±åƒå°å­¦æ—¶ç»å…¸çš„èˆ¹åœ¨é¡ºæµå’Œé€†æµä¸­èˆªå½¢çš„é—®é¢˜ä¸€æ ·ã€‚é¢å¯¹è§†å›¾çš„ç¼©æ”¾ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæƒ³åˆ°çš„åº”è¯¥å°±æ˜¯å¤šè¾¹å½¢çš„ç›¸ä¼¼é—®é¢˜ï¼Œçœ‹å¾…ç°åœ¨çš„æ–‡ä»¶å¤¹è§†å›¾ï¼Œå¯ä»¥æŠ½è±¡æˆä¸€ä¸ªçŸ©å½¢ï¼Œåœ¨ä»¥çŸ©å½¢çš„å·¦ä¸Šè§’ç¡®å®šçš„åæ ‡ç³»é‡Œï¼Œä»ä¸€ä¸ªSizeæ”¾å¤§ï¼ˆæˆ–ç¼©å°ï¼‰åˆ°å¦ä¸€ä¸ªSizeï¼Œåœ¨çŸ©å½¢é•¿å’Œå®½å˜åŒ–æ¯”ä¾‹ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå˜åŒ–å‰åçš„çŸ©å½¢å°±æ˜¯ä¸¤ä¸ªç›¸ä¼¼çŸ©å½¢ï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆå®¹æ˜“çš„ç”»å‡ºä¸‹å›¾.</p>
<p><img src="/res/android_animation/xiangsi.jpg" alt="ç›¸ä¼¼çŸ©å½¢"></p>
<p>é’ˆå¯¹ç›¸ä¼¼å¤šè¾¹å½¢å¯¹åº”ç‚¹è¿çº¿æˆ–è€…åå‘å»¶é•¿çº¿ç›¸äº¤äºä¸€ç‚¹çš„åŸç†ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å¾—å‡ºä¸‹é¢çš„å…³ç³»ï¼Œå³ä¼¸ç¼©å‰åå¤§å°ã€ä¼¸ç¼©æ¯”ä¾‹å’Œä¼¸ç¼©ç‚¹åæ ‡çš„å…³ç³»å¼ï¼š</p>
<pre><code>h2 = <span class="built_in">offset</span> / (<span class="number">1</span>-<span class="built_in">scale</span>)
</code></pre><p>é€šè¿‡ä¸Šé¢çš„å…¬å¼ï¼Œå°±å¾ˆå®¹æ˜“è®¡ç®—å‡ºæ–‡ä»¶å¤¹è§†å›¾ä¼¸ç¼©åŠ¨ç”»çš„pivotXå’ŒpivotYçš„å€¼è®¡ç®—ä»£ç ï¼š</p>
<pre><code><span class="comment">// set scale pivotX and pivotY</span>
<span class="built_in">int</span> leftOffset = folderIconRect.left - folderViewLeft;
<span class="built_in">int</span> topOffset = folderIconRect.top - folderViewTop;
<span class="built_in">float</span> <span class="variable">height</span> = folderHeight * mFolderScale;
<span class="built_in">float</span> delta = ((<span class="built_in">float</span>) folderHeight) / (folderHeight - <span class="variable">height</span>);
<span class="built_in">float</span> folderPivotX = leftOffset * delta;
<span class="built_in">float</span> folderPivotY = topOffset * delta;
</code></pre><p>ä½†æ˜¯è¿™å¯¹å±•å¼€åŠ¨ç”»ä»…ä»…è§£å†³ç¼©æ”¾åŠ¨ç”»çš„é—®é¢˜è¿˜åŸå› ä¸å¤Ÿï¼Œå› ä¸ºç¼©æ”¾åŠ¨ç”»åªæ˜¯é’ˆå¯¹æ–‡ä»¶å¤¹çš„è§†å›¾ï¼Œè€Œé’ˆå¯¹æ–‡ä»¶å¤¹å†…æ¯ä¸ªåº”ç”¨å›¾æ ‡è§†å›¾ä¹Ÿåº”è¯¥æœ‰ç›¸åº”çš„åŠ¨ç”»ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæŒ‰ç…§æ–‡ä»¶å¤¹çš„ä½ç½®è¿›è¡Œçš„ç¼©æ”¾åŠ¨ç”»ï¼Œæ— æ³•ä¿è¯æ–‡ä»¶å¤¹å†…çš„åº”ç”¨å›¾æ ‡å’Œæ–‡ä»¶å¤¹å›¾æ ‡ä¸Šåº”ç”¨çš„ç¼©ç•¥å›¾å®Œå…¨é‡åˆã€‚è”æƒ³åˆ°å­¦ä¹ è¿‡çš„ä¸­å­¦ç‰©ç†çŸ¥è¯†ï¼Œè¿™ä¸ªåœºæ™¯å°±å¥½åƒä½ ä¸€å®šèƒ½å¤Ÿæƒ³åˆ°äº†åˆ†è¿åŠ¨å’Œåˆè¿åŠ¨ï¼Œç«è½¦åœ¨è½¨é“ä¸Šè¡Œé©¶ï¼Œäººåœ¨ç«è½¦å†…è¡Œèµ°ï¼Œé—®äººç›¸å¯¹ä¸åœ°é¢çš„è¿åŠ¨æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿæ•´ä½“æ–‡ä»¶å¤¹çš„è§†å›¾ç›¸å¯¹äºå®ƒçš„ä¼¸ç¼©ä¸­å¿ƒç‚¹è¿›è¡Œä¼¸ç¼©ï¼Œæ–‡ä»¶å¤¹è§†å›¾å†…çš„åº”ç”¨å›¾æ ‡ç›¸å¯¹äºæ–‡ä»¶å¤¹è§†å›¾è¿›è¡Œä½ç§»ï¼Œæ•ˆæœåˆä¼šæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿæƒ³æ˜ç™½è¿™ä¸ªï¼Œç›¸ä¿¡ä½ ä¸€å®šèƒ½æ„Ÿå—åˆ°é€‰æ‹©ä¸€ä¸ªæ­£ç¡®çš„åæ ‡ç³»æ˜¯å¤šä¹ˆé‡è¦ã€‚</p>
<p><img src="/android_animation/tubiaodonghua.jpg" alt="æ–‡ä»¶å¤¹å†…å›¾æ ‡åŠ¨ç”»æ•ˆæœ"></p>
<p>æŠ½è±¡å‡ºäº†è¿åŠ¨çš„ç†è®ºï¼Œé‚£è®¡ç®—çš„æ€è·¯å°±æ˜¯è®¡ç®—å‡ºæ¯ä¸ªåº”ç”¨ç¼©ç•¥å›¾æ ‡ç›¸å¯¹äºæ–‡ä»¶å¤¹å›¾æ ‡çš„ä½ç½®ï¼Œè®¡ç®—å‡ºæ–‡ä»¶å¤¹å±•å¼€åæ¯ä¸ªåº”ç”¨å›¾æ ‡ç›¸å¯¹äºæ–‡ä»¶å¤¹è§†å›¾çš„ç›¸å¯¹ä½ç½®ï¼Œæ¥åˆæ¯ä¸ªåº”ç”¨å›¾æ ‡çš„ä¼¸ç¼©æ¯”ä¾‹ï¼Œå°±èƒ½å¾—åˆ°æ¯ä¸ªåº”ç”¨å›¾æ ‡åœ¨æ–‡ä»¶å¤¹è§†å›¾çš„ç¼©æ”¾è¿‡ç¨‹ä¸­éœ€è¦å®Œæˆçš„ä½ç§»ï¼Œç®€å•æ¥è¯´å°±æ˜¯Folderçš„è§†å›¾åœ¨ç¼©æ”¾ï¼ŒFolderé‡Œçš„Appå›¾æ ‡åœ¨Folderè§†å›¾ä¸Šåšç›¸åº”çš„ä½ç§»ï¼Œç»“æœä½ ä¼šå‘ç°æ˜¯è¿™æ ·ï¼š</p>
<p><img src="/android_animation/guangbixiaoguo.jpg" alt="å…³é—­æ•ˆæœ"></p>
<p>å¤„ç†å®Œæ–‡ä»¶å¤¹è§†å›¾çš„é—®é¢˜ï¼Œç›¸ä¿¡è¿™ä¸ªé—®é¢˜å·²ç»è§£å†³å¤§åŠäº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯æ¡Œé¢ä¸Šå…¶ä»–å›¾æ ‡çš„ç§»åŠ¨ï¼Œç®€å•æ¥è¯´è¿˜æ˜¯ç¼©æ”¾åŠ¨ç”»ï¼Œåªéœ€è¦è®©æ¯ä¸ªå›¾æ ‡çš„ç¼©æ”¾ç‚¹å’ŒFolderè§†å›¾çš„ç¼©æ”¾ç‚¹ç›¸å¯¹äºå±å¹•åæ ‡ç³»é‡åˆå°±å¯ä»¥äº†ã€‚</p>
<h4 id="2-2_æ€»ç»“">2.2 æ€»ç»“</h4><p>1.å¤„ç†åŠ¨ç”»é—®é¢˜é¦–å…ˆç¡®å®šåŠ¨ç”»èµ·å§‹å’Œç»ˆæ­¢çš„çŠ¶æ€ï¼Œæ ¹æ®çŠ¶æ€ç¡®å®šåŠ¨ç”»ç±»å‹ã€‚<br>2.ç¡®å®šåŠ¨ç”»åæ ‡ç³»ã€‚åŠ¨ç”»åæ ‡ç³»å¦‚ä½•ç¡®å®šå–å†³ä¸åŠ¨ç”»æ”¹å˜çš„å±æ€§ï¼Œå¯¹äºç¼©æ”¾åŠ¨ç”»ï¼Œç¼©æ”¾æ”¹å˜æ˜¯è§†å›¾æœ¬èº«ï¼Œé‚£ç¼©æ”¾åŠ¨ç”»çš„åæ ‡ç³»ä¸€å®šæ˜¯ç›¸å¯¹äºè§†å›¾è‡ªå·±å»ºç«‹çš„ï¼Œå·¦ä¸Šè§’æ˜¯åŸç‚¹ã€‚è€Œå¯¹äºä½ç§»åŠ¨ç”»ï¼Œæ”¹å˜translationXå’ŒXçš„å€¼éƒ½èƒ½å®ç°ä½ç½®ä¸Šçš„æ”¹å˜ï¼Œä½†æ˜¯ä»–ä»¬è¡¨ç¤ºçš„å«ä¹‰ä¸ä¸€æ ·ï¼ŒtranslationXæ˜¯ç›¸å¯¹äºè§†å›¾æœ¬èº«è€Œè¨€çš„ï¼ŒXæ˜¯ç›¸å¯¹äºçˆ¶å¸ƒå±€è€Œè¨€çš„ï¼Œé‚£ä»–ä»¬å»ºç«‹çš„åæ ‡ç³»è‚¯å®šä¹Ÿä¸ä¸€æ ·ã€‚<br>3.æ ¹æ®å»ºç«‹åæ ‡ç³»å®ŒæˆåŠ¨ç”»ï¼ŒæŠŠå¤æ‚çš„åˆè¿åŠ¨åˆ†è§£æˆåœ¨ä¸åŒåæ ‡ç³»ä¸Šçš„åˆ†è¿åŠ¨ç®€å•æ±‚è§£ã€‚</p>
<h3 id="ä¸‰ã€åŠ¨ç”»æºç åˆ†æï¼ˆåŸºäºAndroid_5-0ï¼‰">ä¸‰ã€åŠ¨ç”»æºç åˆ†æï¼ˆåŸºäºAndroid 5.0ï¼‰</h3><h4 id="3-1_åŠ¨ç”»æ’å€¼æºç ">3.1 åŠ¨ç”»æ’å€¼æºç </h4><p>æƒ³è¦å®ç°åŠ¨ç”»æ— éæƒ³åšä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯æŠŠåŠ¨ç”»çš„å¯¹è±¡åœ¨åˆé€‚çš„æ—¶é—´ç”»å‡ºåˆé€‚çš„çŠ¶æ€ï¼Œå¦‚ä½•æ§åˆ¶æ—¶é—´ï¼Ÿå°±æ˜¯é€šè¿‡è¡¥é—´åŠ¨ç”»æˆ–è€…å±æ€§åŠ¨ç”»è®¾ç½®åŠ¨ç”»çš„æ—¶é•¿ã€èµ·å§‹æ—¶é—´ã€èµ·å§‹å»¶è¿Ÿè¿™äº›å±æ€§æ¥æ§åˆ¶åŠ¨ç”»çš„æ—¶é—´ã€‚å¦‚ä½•æ§åˆ¶åŠ¨ç”»çŠ¶æ€ï¼Ÿå°±å¯ä»¥é€šè¿‡åŠ¨ç”»æ’å€¼ï¼Œæ’å€¼æ–¹æ³•getInterpolation(input),inputå°±æ˜¯å½“å‰åŠ¨ç”»è¿è¡Œæ—¶é—´çš„ç™¾åˆ†æ¯”ï¼Œè€Œå‡½æ•°è¿”å›å€¼å°±æ˜¯å½“å‰åŠ¨ç”»çš„è¿›åº¦ç™¾åˆ†æ¯”ï¼Œé€šè¿‡åŠ¨ç”»è¿›åº¦å’ŒåŠ¨ç”»çš„èµ·å§‹çŠ¶æ€å’Œç»“æŸçŠ¶æ€æ¥æ§åˆ¶åŠ¨ç”»å¯¹è±¡çš„å½“å‰çŠ¶æ€ã€‚æ— è®ºæ˜¯è¡¥é—´åŠ¨ç”»æˆ–è€…å±æ€§åŠ¨ç”»éƒ½æ˜¯å®šä¹‰åŠ¨ç”»çŠ¶æ€çš„èµ·å§‹çŠ¶æ€ã€ç»ˆæ­¢çŠ¶æ€ã€åŠ¨ç”»å¤šä¹…ã€å¦‚ä½•åŠ¨ç”»ã€‚</p>
<h4 id="3-2_è¡¥é—´åŠ¨ç”»æºç ">3.2 è¡¥é—´åŠ¨ç”»æºç </h4><p>å…ˆæ‰¾åˆ°åŠ¨ç”»æ‰§è¡Œçš„å…¥å£View.startAnimation(animation)ï¼ŒstartAnimationæ‰§è¡Œäº†invalidateï¼Œè§¦å‘äº†é‡ç»˜åˆ·æ–°è§†å›¾ç•Œé¢ã€‚</p>
<pre><code>public void <span class="function">startAnimation</span>(<span class="attribute">Animation</span> <span class="attribute">animation</span>) {
    <span class="attribute">animation</span><span class="class">.setStartTime</span>(<span class="attribute">Animation</span><span class="class">.START_ON_FIRST_FRAME</span>);
    <span class="function">setAnimation</span>(<span class="attribute">animation</span>);
    <span class="function">invalidateParentCaches</span>();
    <span class="function">invalidate</span>(true);
}
</code></pre><p>invalidate()è§¦å‘æ‰§è¡ŒView.draw(Canvas canvas, ViewGroup parent, long drawingTime)å‡½æ•°</p>
<ul>
<li>è°ƒç”¨åŠ¨ç”»çš„ getTransformation æ–¹æ³•ï¼Œå¾—åˆ°å½“å‰æ—¶é—´ç‚¹çš„çŸ©é˜µ</li>
<li>å°†è¯¥çŸ©é˜µè®¾ç½®æˆ Canvas çš„å½“å‰çŸ©é˜µ</li>
<li>è°ƒç”¨ canvas çš„ drawBitmap æ–¹æ³•ï¼Œç»˜åˆ¶å±å¹•</li>
<li>åˆ¤æ–­ getTransformation çš„è¿”å›å€¼ï¼Œè‹¥ä¸ºçœŸï¼Œè°ƒç”¨ invalidate æ–¹æ³•ï¼Œåˆ·æ–°å±å¹•è¿›å…¥ä¸‹ä¸€æ¡¢ï¼›è‹¥ä¸ºå‡ï¼Œè¯´æ˜åŠ¨ç”»å®Œæˆã€‚</li>
</ul>
<pre><code><span class="built_in">boolean</span> draw(Canvas canvas, ViewGroup <span class="keyword">parent</span>, long drawingTime) {
    <span class="attribute">...</span><span class="attribute">...</span>
    <span class="comment">// å¦‚æœæœ‰éœ€è¦æ‰§è¡Œçš„åŠ¨ç”»</span>
    final Animation a = getAnimation();
    <span class="keyword">if</span> (a != <span class="built_in">null</span>) {
        <span class="comment">// æ ¹æ®åŠ¨ç”»å’Œå½“å‰æ—¶é—´è®¡ç®—Transformationï¼Œå¹¶è¿”å›æ˜¯å¦éœ€è¦å†ç»§ç»­åšåŠ¨ç”»</span>
        more = drawAnimation(<span class="keyword">parent</span>, drawingTime, a, scalingRequired);
        concatMatrix = a<span class="built_in">.</span>willChangeTransformationMatrix();
        <span class="keyword">if</span> (concatMatrix) {
            mPrivateFlags3 |= PFLAG3_VIEW_IS_ANIMATING_TRANSFORM;
        }
        <span class="comment">// å¾—åˆ°åŠ¨ç”»çš„å˜æ¢ç»“æœ</span>
        transformToApply = <span class="keyword">parent</span><span class="built_in">.</span>mChildTransformation;
    } <span class="keyword">else</span> {
        <span class="attribute">...</span><span class="attribute">...</span>
    }

    <span class="attribute">...</span><span class="attribute">...</span>

    float alpha = useDisplayListProperties ? <span class="number">1</span> : getAlpha();
    <span class="keyword">if</span> (transformToApply != <span class="built_in">null</span> <span class="subst">||</span> alpha &lt; <span class="number">1</span> <span class="subst">||</span> <span class="subst">!</span>hasIdentityMatrix() <span class="subst">||</span>
            (mPrivateFlags3 <span class="subst">&amp;</span> PFLAG3_VIEW_IS_ANIMATING_ALPHA) == PFLAG3_VIEW_IS_ANIMATING_ALPHA) {
        <span class="attribute">...</span><span class="attribute">...</span>
            <span class="comment">// æ ¹æ®Transformationå€¼å˜æ¢canvs</span>
            <span class="keyword">if</span> (transformToApply != <span class="built_in">null</span>) {
                <span class="keyword">if</span> (concatMatrix) {
                    <span class="keyword">if</span> (useDisplayListProperties) {
                        displayList<span class="built_in">.</span>setAnimationMatrix(transformToApply<span class="built_in">.</span>getMatrix());
                    } <span class="keyword">else</span> {
                        <span class="comment">// Undo the scroll translation, apply the transformation matrix,</span>
                        <span class="comment">// then redo the scroll translate to get the correct result.</span>
                        canvas<span class="built_in">.</span>translate(<span class="attribute">-transX</span>, <span class="attribute">-transY</span>);
                        canvas<span class="built_in">.</span>concat(transformToApply<span class="built_in">.</span>getMatrix());
                        canvas<span class="built_in">.</span>translate(transX, transY);
                    }
                    <span class="keyword">parent</span><span class="built_in">.</span>mGroupFlags |= ViewGroup<span class="built_in">.</span>FLAG_CLEAR_TRANSFORMATION;
                }

                float transformAlpha = transformToApply<span class="built_in">.</span>getAlpha();
                <span class="keyword">if</span> (transformAlpha &lt; <span class="number">1</span>) {
                    alpha *= transformAlpha;
                    <span class="keyword">parent</span><span class="built_in">.</span>mGroupFlags |= ViewGroup<span class="built_in">.</span>FLAG_CLEAR_TRANSFORMATION;
                }

            <span class="keyword">if</span> (<span class="subst">!</span>childHasIdentityMatrix <span class="subst">&amp;&amp;</span> <span class="subst">!</span>useDisplayListProperties) {
                canvas<span class="built_in">.</span>translate(<span class="attribute">-transX</span>, <span class="attribute">-transY</span>);
                canvas<span class="built_in">.</span>concat(getMatrix());
                canvas<span class="built_in">.</span>translate(transX, transY);
            }
        }
        <span class="attribute">...</span><span class="attribute">...</span>
    }

    <span class="keyword">if</span> (a != <span class="built_in">null</span> <span class="subst">&amp;&amp;</span> <span class="subst">!</span>more) {
        <span class="keyword">if</span> (<span class="subst">!</span>hardwareAccelerated <span class="subst">&amp;&amp;</span> <span class="subst">!</span>a<span class="built_in">.</span>getFillAfter()) {
            onSetAlpha(<span class="number">255</span>);
        }
        <span class="keyword">parent</span><span class="built_in">.</span>finishAnimatingView(this, a);
    }

    <span class="comment">// æ ¹æ®åŠ¨ç”»è¿›åº¦åˆ¤æ–­æ˜¯å¦éœ€è¦ç»§ç»­é‡ç»˜</span>
    <span class="keyword">if</span> (more <span class="subst">&amp;&amp;</span> hardwareAccelerated) {
        <span class="comment">// invalidation is the trigger to recreate display lists, so if we're using</span>
        <span class="comment">// display lists to render, force an invalidate to allow the animation to</span>
        <span class="comment">// continue drawing another frame</span>
        <span class="keyword">parent</span><span class="built_in">.</span>invalidate(<span class="literal">true</span>);
        <span class="keyword">if</span> (a<span class="built_in">.</span>hasAlpha() <span class="subst">&amp;&amp;</span> (mPrivateFlags <span class="subst">&amp;</span> PFLAG_ALPHA_SET) == PFLAG_ALPHA_SET) {
            <span class="comment">// alpha animations should cause the child to recreate its display list</span>
            invalidate(<span class="literal">true</span>);
        }
    }

    mRecreateDisplayList = <span class="literal">false</span>;

    <span class="keyword">return</span> more;
}
</code></pre><p>æ—¶åºå›¾ï¼š</p>
<h4 id="3-2_å±æ€§åŠ¨ç”»æºç ">3.2 å±æ€§åŠ¨ç”»æºç </h4><p>onsyncæ—¶åºå›¾ï¼š<br><img src="/res/android_animation/choreographer_seq_diag.png" alt="choreographer onVsyncæ—¶åºå›¾"></p>
<p>ä»ObjectAnimatorçš„start()æ–¹æ³•å¼€å§‹,è·³è½¬åˆ°çˆ¶ç±»ValueAnimatorçš„start()æ–¹æ³•ï¼Œä¸ºäº†å‡å°‘ç¯‡å¹…ï¼Œè¿™é‡Œçš„ä»£ç å°±ä¸è´´å‡ºæ¥äº†ï¼Œè¯¦ç»†çš„ä»£ç å¯ä»¥æŸ¥çœ‹ä»ObjectAnimator.javaã€‚</p>
<pre><code><span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>{
    <span class="comment">// See if any of the current active/pending animators need to be canceled</span>
    <span class="comment">// è¿™é‡Œå…ˆåˆ¤æ–­å½“å‰çš„åŠ¨ç”»ã€ç­‰å¾…çš„åŠ¨ç”»å’Œå»¶è¿Ÿæ‰§è¡Œçš„åŠ¨ç”»å’Œthiså»æ¯”è¾ƒï¼Œå¦‚æœåŠ¨ç”»çš„ç›®æ ‡å¯¹è±¡ç›¸åŒå¹¶ä¸”å±æ€§ç›¸åŒå°±å–æ¶ˆç›¸åŒçš„åŠ¨ç”»ã€‚</span>
    ......

    <span class="keyword">super</span>.start();
}
</code></pre><p>ValueAnimatorçš„start(boolean)æ–¹æ³•åªæ˜¯åšäº†ä¸¤ä»¶äº‹ï¼š<br>1.æŠŠå½“å‰çš„animatoråŠ å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œ<br>2.å¯åŠ¨animationHandlerã€‚AnimationHandlerå¹¶ä¸æ˜¯ä¸€ä¸ªHandlerï¼Œè€Œæ˜¯Runnableã€‚</p>
<pre><code><span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">start</span><span class="params">(<span class="keyword">boolean</span> playBackwards)</span> </span>{
    <span class="keyword">if</span> (Looper.myLooper() == <span class="keyword">null</span>) {
        <span class="keyword">throw</span> <span class="keyword">new</span> AndroidRuntimeException(<span class="string">"Animators may only be run on Looper threads"</span>);
    }

    ......

    AnimationHandler animationHandler = getOrCreateAnimationHandler();
    animationHandler.mPendingAnimations.add(<span class="keyword">this</span>);
    <span class="keyword">if</span> (mStartDelay == <span class="number">0</span>) {
        <span class="comment">// This sets the initial value of the animation, prior to actually starting it running</span>
        setCurrentPlayTime(<span class="number">0</span>);
        mPlayingState = STOPPED;
        mRunning = <span class="keyword">true</span>;
        notifyStartListeners();
    }
    animationHandler.start();
}
</code></pre><p>å°†AnimationHandlerå¯¹è±¡ä¼ é€’ç»™Choreographer(ç¼–èˆè€…)ï¼ŒChoreographeræ˜¯å’Œçº¿ç¨‹ç»‘å®šçš„å•ä¾‹ã€‚å‘Šè¯‰ç¼–èˆè€…ï¼Œæˆ‘æ˜¯ä¸€ä¸ªCALLBACK_ANIMATION(åŠ¨ç”»ç±»å‹)ï¼Œä½ è‡ªå·±çœ‹ç€åŠå§ã€‚</p>
<pre><code><span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">scheduleAnimation</span><span class="params">()</span> </span>{
    <span class="keyword">if</span> (!mAnimationScheduled) {
        mChoreographer.postCallback(Choreographer.CALLBACK_ANIMATION, <span class="keyword">this</span>, <span class="keyword">null</span>);
        mAnimationScheduled = <span class="keyword">true</span>;
    }
}
</code></pre><p>ç¼–èˆè€…æ ¹æ®callbackType(å°±æ˜¯ä¸Šé¢çš„CALLBACK_ANIMATIONç±»å‹)ï¼ŒæŠŠå½“å‰çš„action(å°±æ˜¯animationHandler)åŠ å…¥ç›¸åº”ç±»å‹çš„Callbacké˜Ÿåˆ—ç­‰å¾…è¢«æ‰§è¡Œã€‚å¹¶ä¸”å®‰æ’ä¸‹ä¸€å¸§çš„æ—¶é—´ã€‚</p>
<pre><code><span class="keyword">private</span> <span class="keyword">void</span> postCallbackDelayedInternal(<span class="built_in">int</span> callbackType,
        <span class="keyword">Object</span> action, <span class="keyword">Object</span> token, <span class="keyword">long</span> delayMillis) {

    <span class="keyword">synchronized</span> (mLock) {
        <span class="keyword">final</span> <span class="keyword">long</span> now = SystemClock.uptimeMillis();
        <span class="keyword">final</span> <span class="keyword">long</span> dueTime = now + delayMillis;
        <span class="comment">// åŠ å…¥ç›¸åº”ç±»å‹çš„Callbacké˜Ÿåˆ—ç­‰å¾…è¢«æ‰§è¡Œ</span>
        mCallbackQueues[callbackType].addCallbackLocked(dueTime, action, token);

        <span class="keyword">if</span> (dueTime &lt;= now) {
            scheduleFrameLocked(now);
        } <span class="keyword">else</span> {
            Message msg = mHandler.obtainMessage(MSG_DO_SCHEDULE_CALLBACK, action);
            msg.arg1 = callbackType;
            msg.setAsynchronous(<span class="keyword">true</span>);
            mHandler.sendMessageAtTime(msg, dueTime);
        }
    }
}
</code></pre><p>å¦‚æœä½¿ç”¨Vsyncï¼Œé€šè¿‡FrameDisplayEventReceiverçš„scheduleVsyncæ–¹æ³•ï¼Œç”³è¯·ä¸€æ¬¡VSYNCä¸­æ–­ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸­æ–­å¤„ç†çš„onVsyncå‡½æ•°å»è¿›è¡Œç»˜åˆ¶ã€‚å¦‚æœä¸éœ€è¦ç›´æ¥å‘é€MSG_DO_FRAMEæ¶ˆæ¯ã€‚</p>
<pre><code><span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">scheduleFrameLocked</span><span class="params">(<span class="keyword">long</span> now)</span> </span>{
    <span class="keyword">if</span> (!mFrameScheduled) {
        mFrameScheduled = <span class="keyword">true</span>;
        <span class="keyword">if</span> (USE_VSYNC) {
            <span class="comment">// If running on the Looper thread, then schedule the vsync immediately,</span>
            <span class="comment">// otherwise post a message to schedule the vsync from the UI thread</span>
            <span class="comment">// as soon as possible.</span>
            <span class="comment">// å¦‚æœä½¿ç”¨VSYNCå°±ç”³è¯·ä¸€æ¬¡ä¸­æ–­è¯·æ±‚</span>
            <span class="keyword">if</span> (isRunningOnLooperThreadLocked()) {
                scheduleVsyncLocked();
            } <span class="keyword">else</span> {
                Message msg = mHandler.obtainMessage(MSG_DO_SCHEDULE_VSYNC);
                msg.setAsynchronous(<span class="keyword">true</span>);
                mHandler.sendMessageAtFrontOfQueue(msg);
            }
        } <span class="keyword">else</span> {
            <span class="keyword">final</span> <span class="keyword">long</span> nextFrameTime = Math.max(
                    mLastFrameTimeNanos / TimeUtils.NANOS_PER_MS + sFrameDelay, now);
            <span class="comment">// å¦‚æœä¸æ˜¯è¦VSYNCï¼Œå°±ç›´æ¥è§¦å‘MSG_DO_FRAME</span>
            Message msg = mHandler.obtainMessage(MSG_DO_FRAME);
            msg.setAsynchronous(<span class="keyword">true</span>);
            mHandler.sendMessageAtTime(msg, nextFrameTime);
        }
    }
}
</code></pre><p>ä¸Šé¢æ³¨å†Œä¸€ä¸ªäº†reciverï¼Œåœ¨VSYNCå‘ç”Ÿçš„æ—¶å€™æ¥å—åˆ°æ¶ˆæ¯ï¼Œå°±ä¼šè§¦å‘onVsyncæ–¹æ³•,æ‰§è¡Œå½“å‰çš„FrameDisplayEventReceiver Runnableã€‚</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onVsync</span><span class="params">(<span class="keyword">long</span> timestampNanos, <span class="keyword">int</span> builtInDisplayId, <span class="keyword">int</span> frame)</span> </span>{
    ......
    Message msg = Message.obtain(mHandler, <span class="keyword">this</span>);
    msg.setAsynchronous(<span class="keyword">true</span>);
    mHandler.sendMessageAtTime(msg, timestampNanos / TimeUtils.NANOS_PER_MS);
}

<span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{
    mHavePendingVsync = <span class="keyword">false</span>;
    doFrame(mTimestampNanos, mFrame);
}
</code></pre><p>æˆ‘ä»¬çœ‹doFrameæ–¹æ³•åšäº†ä»€ä¹ˆï¼Ÿè°ƒç”¨doCallbacksæ–¹æ³•ï¼Œè·å–å½“å‰ç±»å‹çš„ç­‰å¾…åºåˆ—ä¸­åœ¨å½“å‰æ—¶é—´çš„callbackï¼Œå¾—åˆ°actionå¹¶æ‰§è¡Œrunæ–¹æ³•ï¼Œåœ¨è¿™é‡Œcallbackçš„actionå°±æ˜¯AnimationHandlerã€‚</p>
<pre><code><span class="function"><span class="keyword">void</span> <span class="title">doFrame</span><span class="params">(<span class="keyword">long</span> frameTimeNanos, <span class="keyword">int</span> frame)</span> </span>{
    ......
    <span class="comment">// ä¼˜å…ˆçº§æœ€é«˜ï¼Œå’Œè¾“å…¥äº‹ä»¶å¤„ç†æœ‰å…³</span>
    doCallbacks(Choreographer.CALLBACK_INPUT, frameTimeNanos);
    <span class="comment">// ä¼˜å…ˆçº§å…¶æ¬¡ï¼Œå’ŒAnimationçš„å¤„ç†æœ‰å…³</span>
    doCallbacks(Choreographer.CALLBACK_ANIMATION, frameTimeNanos);
    <span class="comment">// ä¼˜å…ˆçº§æœ€ä½ï¼Œå’ŒUIç­‰æ§ä»¶ç»˜åˆ¶æœ‰å…³</span>
    doCallbacks(Choreographer.CALLBACK_TRAVERSAL, frameTimeNanos);
}


<span class="function"><span class="keyword">void</span> <span class="title">doCallbacks</span><span class="params">(<span class="keyword">int</span> callbackType, <span class="keyword">long</span> frameTimeNanos)</span> </span>{
    CallbackRecord callbacks;
    <span class="keyword">synchronized</span> (mLock) {
        <span class="comment">// We use "now" to determine when callbacks become due because it's possible</span>
        <span class="comment">// for earlier processing phases in a frame to post callbacks that should run</span>
        <span class="comment">// in a following phase, such as an input event that causes an animation to start.</span>
        <span class="keyword">final</span> <span class="keyword">long</span> now = SystemClock.uptimeMillis();
        callbacks = mCallbackQueues[callbackType].extractDueCallbacksLocked(now);
        <span class="keyword">if</span> (callbacks == <span class="keyword">null</span>) {
            <span class="keyword">return</span>;
        }
        mCallbacksRunning = <span class="keyword">true</span>;
    }
    <span class="keyword">try</span> {
        <span class="keyword">for</span> (CallbackRecord c = callbacks; c != <span class="keyword">null</span>; c = c.next) {
            <span class="comment">// åœ¨è¿™é‡Œå›è°ƒcallbackçš„action</span>
            c.run(frameTimeNanos);
        }
    }
    ......
}
</code></pre><p>ç»ˆäºå›è°ƒäº†AnimationHandlerçš„runæ–¹æ³•ï¼Œä»£ç å¾ˆå¤šï¼Œèµ·å§‹æ— éå°±æ˜¯è®©åº”è¯¥å¯åŠ¨çš„animationå¯åŠ¨èµ·æ¥ï¼Œè¯¥å»¶è¿Ÿçš„æ”¾åœ¨å»¶è¿Ÿé˜Ÿåˆ—ï¼Œæ­£åœ¨åšåŠ¨ç”»çš„è°ƒç”¨doAnimationFrameæ–¹æ³•ï¼ŒåŠ¨ç”»æ’­æ”¾ç»“æŸçš„å°±ç»“æŸåŠ¨ç”»ã€‚å½“ç„¶å¦‚æœè¿˜éœ€è¦ç»§ç»­åŠ¨ç”»é‚£å°±ç»§ç»­è°ƒç”¨scheduleAnimationæ–¹æ³•ï¼Œå‘Šè¯‰ç¼–èˆè€…ï¼Œè¿˜æœ‰å‘¢ï¼Œç»§ç»­åœ¨ä¸‹ä¸ªå¸§æ—¶é—´æ‰§è¡Œæˆ‘ã€‚å½“ç„¶æ‰€æœ‰æ—¶é—´æ§åˆ¶æ˜¯æ ¹æ®VSYNCå›è°ƒä¸Šæ¥çš„æ—¶é—´å’Œæ¯ä¸ªåŠ¨ç”»çš„æ—¶é—´ä¿¡æ¯å…±åŒæ§åˆ¶çš„ã€‚</p>
<pre><code><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doAnimationFrame</span><span class="params">(<span class="keyword">long</span> frameTime)</span> </span>{
    ......
    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numAnims; ++i) {
        ValueAnimator anim = mTmpAnimations.get(i);
        <span class="keyword">if</span> (mAnimations.contains(anim) &amp;&amp; anim.doAnimationFrame(frameTime)) {
            mEndingAnims.add(anim);
        }
    }
    ......
    <span class="comment">// If there are still active or delayed animations, schedule a future call to</span>
    <span class="comment">// onAnimate to process the next frame of the animations.</span>
    <span class="keyword">if</span> (!mAnimations.isEmpty() || !mDelayedAnims.isEmpty()) {
        scheduleAnimation();
    }
}
</code></pre><h4 id="3-3_åŠ¨ç”»æºç æ€»ç»“">3.3 åŠ¨ç”»æºç æ€»ç»“</h4><p>1.é’ˆå¯¹è§†å›¾æ¥è¯´ï¼ŒAnimationå’ŒScrollerç›¸ä¼¼ï¼Œéƒ½æ˜¯å¦‚ä½•æ§åˆ¶è§†å›¾çš„é‡ç»˜ï¼Œå®ƒä»¬éƒ½æŒ‡ç¤ºå®šä¹‰äº†åœ¨æŸä¸€ä¸ªç‰¹å®šæ—¶åˆ»æˆ‘åº”è¯¥ç”»æˆä»€ä¹ˆæ ·å­ã€‚<br>2.Choreographerå®é™…ä¸Šæ˜¯è§†å›¾æ‰€æœ‰é‡ç»˜è¿›åº¦çš„å®é™…æ§åˆ¶è€…ï¼Œå› ä¸ºå®ƒåœ¨æ§åˆ¶ç€æ—¶é—´èŠ‚å¥ï¼Œå‘Šè¯‰åº”ç”¨ä»¬ä»€ä¹ˆæ—¶é—´å¯ä»¥ç”»ï¼Œè§†å›¾ä¸éœ€è¦è‡ªå·±æ§åˆ¶åˆ·æ–°æ—¶é—´ã€‚<br>3.å›å¤´çœ‹Animationçš„æºç åˆ†æï¼Œè§†å›¾çš„é‡ç»˜æœ€ç»ˆæ˜¯è§¦å‘ViewRootImplçš„invalidateå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†æœ€ç»ˆè°ƒç”¨ViewRootImplçš„scheduleTraversalsã€‚åŒæ ·æ˜¯é€šè¿‡mChoreographeråªæ˜¯ç±»å‹å˜æˆäº†CALLBACK_TRAVERSALï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>void scheduleTraversals<span class="literal">()</span> {
    <span class="keyword">if</span> (!mTraversalScheduled) {
        mTraversalScheduled = <span class="literal">true</span>;
        mTraversalBarrier = mHandler.getLooper<span class="literal">()</span>.postSyncBarrier<span class="literal">()</span>;
        mChoreographer.postCallback(
                <span class="type">Choreographer</span>.<span class="type">CALLBACK_TRAVERSAL</span>, mTraversalRunnable, null);
        <span class="keyword">if</span> (!mUnbufferedInputDispatch) {
            scheduleConsumeBatchedInput<span class="literal">()</span>;
        }
        notifyRendererOfFramePending<span class="literal">()</span>;
    }
}
</code></pre><p>4.Asynchronous Messageå’ŒSynchronization Barrieræˆ‘è¿˜æ²¡æœ‰ç†è§£ï¼Œå½“ä½ è§‰å¾—è‡ªå·±æ˜ç™½äº†çš„æ—¶å€™ï¼Œå…¶å®ä½ è¿˜æœ‰å¾ˆå¤šä¸çŸ¥é“ï¼Œå½“ä½ è§‰å¾—ä½ ä¸æ˜ç™½çš„æ—¶å€™ï¼Œé‚£æ˜¯ä½ çœŸçš„ä¸çŸ¥é“ã€‚ä¸çŸ¥é“è¿˜æ˜¯ä¸çŸ¥é“ï¼ï¼</p>
<h3 id="å››ã€å‚è€ƒæ–‡æ¡£">å››ã€å‚è€ƒæ–‡æ¡£</h3><p><a href="http://blog.csdn.net/lmj623565791/article/details/38067475" target="_blank" rel="external">Android å±æ€§åŠ¨ç”»ï¼ˆProperty Animationï¼‰ å®Œå…¨è§£æ ï¼ˆä¸Šï¼‰</a><br><a href="http://blog.csdn.net/lmj623565791/article/details/38092093" target="_blank" rel="external">Android å±æ€§åŠ¨ç”»ï¼ˆProperty Animationï¼‰ å®Œå…¨è§£æ ï¼ˆä¸‹ï¼‰</a><br><a href="http://www.uml.org.cn/mobiledev/201301081.asp" target="_blank" rel="external">Android Project Butteråˆ†æ</a><br><a href="http://developer.android.com/reference/android/view/Choreographer.html" target="_blank" rel="external">http://developer.android.com/reference/android/view/Choreographer.html</a><br><a href="http://developer.android.com/reference/android/view/Choreographer.FrameCallback.html" target="_blank" rel="external">http://developer.android.com/reference/android/view/Choreographer.FrameCallback.html</a><br><a href="https://github.com/samchen2009/android_uml" target="_blank" rel="external">https://github.com/samchen2009/android_uml</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;è¯´åœ¨å¼€å§‹&quot;&gt;è¯´åœ¨å¼€å§‹&lt;/h3&gt;&lt;p&gt;è¿™ç¯‡æ–‡æ¡£è®°å½•äº†ä¸€ä¸‹è‡ªå·±åœ¨å®é™…å·¥ä½œä¸­å®ç°çš„ä¸€äº›AndroidåŠ¨ç”»æ•ˆæœæ—¶çš„å¼€å‘æ€è·¯ï¼Œæ€»ç»“äº†æˆ‘è‡ªå·±å¦‚ä½•çœ‹å¾…AndroidåŠ¨ç”»é—®é¢˜ï¼Œå¸Œæœ›èƒ½ç»™å¤§å®¶çš„åŠ¨ç”»å¼€å‘æä¾›ä¸€äº›æ€è·¯å’Œå¸®åŠ©ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ä¸€ã€AndroidåŠ¨ç”»åŸºç¡€&quot;&gt;ä¸€ã€AndroidåŠ¨ç”»åŸºç¡€&lt;/h3&gt;&lt;h4 id=&quot;1-1_åŠ¨ç”»ç±»å‹&quot;&gt;1.1 åŠ¨ç”»ç±»å‹&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Frame Animationï¼š&lt;/strong&gt;&lt;br&gt;å¸§åŠ¨ç”»ï¼Œé¡ºåºæ’­æ”¾äº‹å…ˆåšå¥½çš„å›¾åƒï¼Œæ˜¯ä¸€ç§ç”»é¢è½¬æ¢åŠ¨ç”»&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Tween Animation:&lt;/strong&gt;&lt;br&gt;è¡¥é—´åŠ¨ç”»ï¼ˆæˆ–è€…å«æ¸å˜åŠ¨ç”»ï¼‰ï¼Œé€šè¿‡å¯¹åœºæ™¯é‡Œçš„å¯¹è±¡ä¸æ–­åšå›¾åƒå˜æ¢(å¹³ç§»ã€ç¼©æ”¾ã€æ—‹è½¬)äº§ç”ŸåŠ¨ç”»æ•ˆæœ
    
    </summary>
    
    
      <category term="Android" scheme="https://ivonhoe.github.io/tags/Android/"/>
    
      <category term="åŠ¨ç”»" scheme="https://ivonhoe.github.io/tags/%E5%8A%A8%E7%94%BB/"/>
    
  </entry>
  
</feed>
